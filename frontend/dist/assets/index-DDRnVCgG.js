var ane=Object.defineProperty;var cne=(n,o,a)=>o in n?ane(n,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[o]=a;var Hf=(n,o,a)=>cne(n,typeof o!="symbol"?o+"":o,a);function d5(n,o){for(var a=0;a<o.length;a++){const d=o[a];if(typeof d!="string"&&!Array.isArray(d)){for(const p in d)if(p!=="default"&&!(p in n)){const _=Object.getOwnPropertyDescriptor(d,p);_&&Object.defineProperty(n,p,_.get?_:{enumerable:!0,get:()=>d[p]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))d(p);new MutationObserver(p=>{for(const _ of p)if(_.type==="childList")for(const g of _.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&d(g)}).observe(document,{childList:!0,subtree:!0});function a(p){const _={};return p.integrity&&(_.integrity=p.integrity),p.referrerPolicy&&(_.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?_.credentials="include":p.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function d(p){if(p.ep)return;p.ep=!0;const _=a(p);fetch(p.href,_)}})();function Mb(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function xl(n){if(n.__esModule)return n;var o=n.default;if(typeof o=="function"){var a=function d(){return this instanceof d?Reflect.construct(o,arguments,this.constructor):o.apply(this,arguments)};a.prototype=o.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(n).forEach(function(d){var p=Object.getOwnPropertyDescriptor(n,d);Object.defineProperty(a,d,p.get?p:{enumerable:!0,get:function(){return n[d]}})}),a}var u5={exports:{}},Ly={},h5={exports:{}},Kt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zm=Symbol.for("react.element"),lne=Symbol.for("react.portal"),dne=Symbol.for("react.fragment"),une=Symbol.for("react.strict_mode"),hne=Symbol.for("react.profiler"),pne=Symbol.for("react.provider"),fne=Symbol.for("react.context"),mne=Symbol.for("react.forward_ref"),_ne=Symbol.for("react.suspense"),Ene=Symbol.for("react.memo"),gne=Symbol.for("react.lazy"),Dj=Symbol.iterator;function Sne(n){return n===null||typeof n!="object"?null:(n=Dj&&n[Dj]||n["@@iterator"],typeof n=="function"?n:null)}var p5={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f5=Object.assign,m5={};function np(n,o,a){this.props=n,this.context=o,this.refs=m5,this.updater=a||p5}np.prototype.isReactComponent={};np.prototype.setState=function(n,o){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,o,"setState")};np.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function _5(){}_5.prototype=np.prototype;function xb(n,o,a){this.props=n,this.context=o,this.refs=m5,this.updater=a||p5}var Ub=xb.prototype=new _5;Ub.constructor=xb;f5(Ub,np.prototype);Ub.isPureReactComponent=!0;var Pj=Array.isArray,E5=Object.prototype.hasOwnProperty,Vb={current:null},g5={key:!0,ref:!0,__self:!0,__source:!0};function S5(n,o,a){var d,p={},_=null,g=null;if(o!=null)for(d in o.ref!==void 0&&(g=o.ref),o.key!==void 0&&(_=""+o.key),o)E5.call(o,d)&&!g5.hasOwnProperty(d)&&(p[d]=o[d]);var C=arguments.length-2;if(C===1)p.children=a;else if(1<C){for(var R=Array(C),D=0;D<C;D++)R[D]=arguments[D+2];p.children=R}if(n&&n.defaultProps)for(d in C=n.defaultProps,C)p[d]===void 0&&(p[d]=C[d]);return{$$typeof:Zm,type:n,key:_,ref:g,props:p,_owner:Vb.current}}function yne(n,o){return{$$typeof:Zm,type:n.type,key:o,ref:n.ref,props:n.props,_owner:n._owner}}function Fb(n){return typeof n=="object"&&n!==null&&n.$$typeof===Zm}function vne(n){var o={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(a){return o[a]})}var kj=/\/+/g;function D0(n,o){return typeof n=="object"&&n!==null&&n.key!=null?vne(""+n.key):o.toString(36)}function vS(n,o,a,d,p){var _=typeof n;(_==="undefined"||_==="boolean")&&(n=null);var g=!1;if(n===null)g=!0;else switch(_){case"string":case"number":g=!0;break;case"object":switch(n.$$typeof){case Zm:case lne:g=!0}}if(g)return g=n,p=p(g),n=d===""?"."+D0(g,0):d,Pj(p)?(a="",n!=null&&(a=n.replace(kj,"$&/")+"/"),vS(p,o,a,"",function(D){return D})):p!=null&&(Fb(p)&&(p=yne(p,a+(!p.key||g&&g.key===p.key?"":(""+p.key).replace(kj,"$&/")+"/")+n)),o.push(p)),1;if(g=0,d=d===""?".":d+":",Pj(n))for(var C=0;C<n.length;C++){_=n[C];var R=d+D0(_,C);g+=vS(_,o,a,R,p)}else if(R=Sne(n),typeof R=="function")for(n=R.call(n),C=0;!(_=n.next()).done;)_=_.value,R=d+D0(_,C++),g+=vS(_,o,a,R,p);else if(_==="object")throw o=String(n),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return g}function qg(n,o,a){if(n==null)return n;var d=[],p=0;return vS(n,d,"","",function(_){return o.call(a,_,p++)}),d}function Tne(n){if(n._status===-1){var o=n._result;o=o(),o.then(function(a){(n._status===0||n._status===-1)&&(n._status=1,n._result=a)},function(a){(n._status===0||n._status===-1)&&(n._status=2,n._result=a)}),n._status===-1&&(n._status=0,n._result=o)}if(n._status===1)return n._result.default;throw n._result}var Hi={current:null},TS={transition:null},Cne={ReactCurrentDispatcher:Hi,ReactCurrentBatchConfig:TS,ReactCurrentOwner:Vb};function y5(){throw Error("act(...) is not supported in production builds of React.")}Kt.Children={map:qg,forEach:function(n,o,a){qg(n,function(){o.apply(this,arguments)},a)},count:function(n){var o=0;return qg(n,function(){o++}),o},toArray:function(n){return qg(n,function(o){return o})||[]},only:function(n){if(!Fb(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Kt.Component=np;Kt.Fragment=dne;Kt.Profiler=hne;Kt.PureComponent=xb;Kt.StrictMode=une;Kt.Suspense=_ne;Kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Cne;Kt.act=y5;Kt.cloneElement=function(n,o,a){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var d=f5({},n.props),p=n.key,_=n.ref,g=n._owner;if(o!=null){if(o.ref!==void 0&&(_=o.ref,g=Vb.current),o.key!==void 0&&(p=""+o.key),n.type&&n.type.defaultProps)var C=n.type.defaultProps;for(R in o)E5.call(o,R)&&!g5.hasOwnProperty(R)&&(d[R]=o[R]===void 0&&C!==void 0?C[R]:o[R])}var R=arguments.length-2;if(R===1)d.children=a;else if(1<R){C=Array(R);for(var D=0;D<R;D++)C[D]=arguments[D+2];d.children=C}return{$$typeof:Zm,type:n.type,key:p,ref:_,props:d,_owner:g}};Kt.createContext=function(n){return n={$$typeof:fne,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:pne,_context:n},n.Consumer=n};Kt.createElement=S5;Kt.createFactory=function(n){var o=S5.bind(null,n);return o.type=n,o};Kt.createRef=function(){return{current:null}};Kt.forwardRef=function(n){return{$$typeof:mne,render:n}};Kt.isValidElement=Fb;Kt.lazy=function(n){return{$$typeof:gne,_payload:{_status:-1,_result:n},_init:Tne}};Kt.memo=function(n,o){return{$$typeof:Ene,type:n,compare:o===void 0?null:o}};Kt.startTransition=function(n){var o=TS.transition;TS.transition={};try{n()}finally{TS.transition=o}};Kt.unstable_act=y5;Kt.useCallback=function(n,o){return Hi.current.useCallback(n,o)};Kt.useContext=function(n){return Hi.current.useContext(n)};Kt.useDebugValue=function(){};Kt.useDeferredValue=function(n){return Hi.current.useDeferredValue(n)};Kt.useEffect=function(n,o){return Hi.current.useEffect(n,o)};Kt.useId=function(){return Hi.current.useId()};Kt.useImperativeHandle=function(n,o,a){return Hi.current.useImperativeHandle(n,o,a)};Kt.useInsertionEffect=function(n,o){return Hi.current.useInsertionEffect(n,o)};Kt.useLayoutEffect=function(n,o){return Hi.current.useLayoutEffect(n,o)};Kt.useMemo=function(n,o){return Hi.current.useMemo(n,o)};Kt.useReducer=function(n,o,a){return Hi.current.useReducer(n,o,a)};Kt.useRef=function(n){return Hi.current.useRef(n)};Kt.useState=function(n){return Hi.current.useState(n)};Kt.useSyncExternalStore=function(n,o,a){return Hi.current.useSyncExternalStore(n,o,a)};Kt.useTransition=function(){return Hi.current.useTransition()};Kt.version="18.3.1";h5.exports=Kt;var J=h5.exports;const mc=Mb(J),Im=d5({__proto__:null,default:mc},[J]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rne=J,wne=Symbol.for("react.element"),Ine=Symbol.for("react.fragment"),bne=Object.prototype.hasOwnProperty,Ane=Rne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,One={key:!0,ref:!0,__self:!0,__source:!0};function v5(n,o,a){var d,p={},_=null,g=null;a!==void 0&&(_=""+a),o.key!==void 0&&(_=""+o.key),o.ref!==void 0&&(g=o.ref);for(d in o)bne.call(o,d)&&!One.hasOwnProperty(d)&&(p[d]=o[d]);if(n&&n.defaultProps)for(d in o=n.defaultProps,o)p[d]===void 0&&(p[d]=o[d]);return{$$typeof:wne,type:n,key:_,ref:g,props:p,_owner:Ane.current}}Ly.Fragment=Ine;Ly.jsx=v5;Ly.jsxs=v5;u5.exports=Ly;var Z=u5.exports,gI={},T5={exports:{}},Fo={},C5={exports:{}},R5={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function o(Ve,Ge){var ut=Ve.length;Ve.push(Ge);e:for(;0<ut;){var er=ut-1>>>1,Or=Ve[er];if(0<p(Or,Ge))Ve[er]=Ge,Ve[ut]=Or,ut=er;else break e}}function a(Ve){return Ve.length===0?null:Ve[0]}function d(Ve){if(Ve.length===0)return null;var Ge=Ve[0],ut=Ve.pop();if(ut!==Ge){Ve[0]=ut;e:for(var er=0,Or=Ve.length,Wo=Or>>>1;er<Wo;){var Wr=2*(er+1)-1,mi=Ve[Wr],tn=Wr+1,Rc=Ve[tn];if(0>p(mi,ut))tn<Or&&0>p(Rc,mi)?(Ve[er]=Rc,Ve[tn]=ut,er=tn):(Ve[er]=mi,Ve[Wr]=ut,er=Wr);else if(tn<Or&&0>p(Rc,ut))Ve[er]=Rc,Ve[tn]=ut,er=tn;else break e}}return Ge}function p(Ve,Ge){var ut=Ve.sortIndex-Ge.sortIndex;return ut!==0?ut:Ve.id-Ge.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;n.unstable_now=function(){return _.now()}}else{var g=Date,C=g.now();n.unstable_now=function(){return g.now()-C}}var R=[],D=[],L=1,k=null,M=3,Y=!1,z=!1,V=!1,Q=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(Ve){for(var Ge=a(D);Ge!==null;){if(Ge.callback===null)d(D);else if(Ge.startTime<=Ve)d(D),Ge.sortIndex=Ge.expirationTime,o(R,Ge);else break;Ge=a(D)}}function se(Ve){if(V=!1,q(Ve),!z)if(a(R)!==null)z=!0,jr(ue);else{var Ge=a(D);Ge!==null&&Br(se,Ge.startTime-Ve)}}function ue(Ve,Ge){z=!1,V&&(V=!1,G(Oe),Oe=-1),Y=!0;var ut=M;try{for(q(Ge),k=a(R);k!==null&&(!(k.expirationTime>Ge)||Ve&&!ze());){var er=k.callback;if(typeof er=="function"){k.callback=null,M=k.priorityLevel;var Or=er(k.expirationTime<=Ge);Ge=n.unstable_now(),typeof Or=="function"?k.callback=Or:k===a(R)&&d(R),q(Ge)}else d(R);k=a(R)}if(k!==null)var Wo=!0;else{var Wr=a(D);Wr!==null&&Br(se,Wr.startTime-Ge),Wo=!1}return Wo}finally{k=null,M=ut,Y=!1}}var $=!1,pe=null,Oe=-1,xe=5,je=-1;function ze(){return!(n.unstable_now()-je<xe)}function St(){if(pe!==null){var Ve=n.unstable_now();je=Ve;var Ge=!0;try{Ge=pe(!0,Ve)}finally{Ge?Bt():($=!1,pe=null)}}else $=!1}var Bt;if(typeof B=="function")Bt=function(){B(St)};else if(typeof MessageChannel<"u"){var st=new MessageChannel,Jn=st.port2;st.port1.onmessage=St,Bt=function(){Jn.postMessage(null)}}else Bt=function(){Q(St,0)};function jr(Ve){pe=Ve,$||($=!0,Bt())}function Br(Ve,Ge){Oe=Q(function(){Ve(n.unstable_now())},Ge)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ve){Ve.callback=null},n.unstable_continueExecution=function(){z||Y||(z=!0,jr(ue))},n.unstable_forceFrameRate=function(Ve){0>Ve||125<Ve?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):xe=0<Ve?Math.floor(1e3/Ve):5},n.unstable_getCurrentPriorityLevel=function(){return M},n.unstable_getFirstCallbackNode=function(){return a(R)},n.unstable_next=function(Ve){switch(M){case 1:case 2:case 3:var Ge=3;break;default:Ge=M}var ut=M;M=Ge;try{return Ve()}finally{M=ut}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ve,Ge){switch(Ve){case 1:case 2:case 3:case 4:case 5:break;default:Ve=3}var ut=M;M=Ve;try{return Ge()}finally{M=ut}},n.unstable_scheduleCallback=function(Ve,Ge,ut){var er=n.unstable_now();switch(typeof ut=="object"&&ut!==null?(ut=ut.delay,ut=typeof ut=="number"&&0<ut?er+ut:er):ut=er,Ve){case 1:var Or=-1;break;case 2:Or=250;break;case 5:Or=1073741823;break;case 4:Or=1e4;break;default:Or=5e3}return Or=ut+Or,Ve={id:L++,callback:Ge,priorityLevel:Ve,startTime:ut,expirationTime:Or,sortIndex:-1},ut>er?(Ve.sortIndex=ut,o(D,Ve),a(R)===null&&Ve===a(D)&&(V?(G(Oe),Oe=-1):V=!0,Br(se,ut-er))):(Ve.sortIndex=Or,o(R,Ve),z||Y||(z=!0,jr(ue))),Ve},n.unstable_shouldYield=ze,n.unstable_wrapCallback=function(Ve){var Ge=M;return function(){var ut=M;M=Ge;try{return Ve.apply(this,arguments)}finally{M=ut}}}})(R5);C5.exports=R5;var Nne=C5.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dne=J,xo=Nne;function De(n){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+n,a=1;a<arguments.length;a++)o+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var w5=new Set,bm={};function qd(n,o){zh(n,o),zh(n+"Capture",o)}function zh(n,o){for(bm[n]=o,n=0;n<o.length;n++)w5.add(o[n])}var Ec=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),SI=Object.prototype.hasOwnProperty,Pne=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Lj={},Mj={};function kne(n){return SI.call(Mj,n)?!0:SI.call(Lj,n)?!1:Pne.test(n)?Mj[n]=!0:(Lj[n]=!0,!1)}function Lne(n,o,a,d){if(a!==null&&a.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return d?!1:a!==null?!a.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Mne(n,o,a,d){if(o===null||typeof o>"u"||Lne(n,o,a,d))return!0;if(d)return!1;if(a!==null)switch(a.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Ki(n,o,a,d,p,_,g){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=d,this.attributeNamespace=p,this.mustUseProperty=a,this.propertyName=n,this.type=o,this.sanitizeURL=_,this.removeEmptyString=g}var fi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){fi[n]=new Ki(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var o=n[0];fi[o]=new Ki(o,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){fi[n]=new Ki(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){fi[n]=new Ki(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){fi[n]=new Ki(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){fi[n]=new Ki(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){fi[n]=new Ki(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){fi[n]=new Ki(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){fi[n]=new Ki(n,5,!1,n.toLowerCase(),null,!1,!1)});var jb=/[\-:]([a-z])/g;function Bb(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var o=n.replace(jb,Bb);fi[o]=new Ki(o,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var o=n.replace(jb,Bb);fi[o]=new Ki(o,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var o=n.replace(jb,Bb);fi[o]=new Ki(o,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){fi[n]=new Ki(n,1,!1,n.toLowerCase(),null,!1,!1)});fi.xlinkHref=new Ki("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){fi[n]=new Ki(n,1,!1,n.toLowerCase(),null,!0,!0)});function Wb(n,o,a,d){var p=fi.hasOwnProperty(o)?fi[o]:null;(p!==null?p.type!==0:d||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(Mne(o,a,p,d)&&(a=null),d||p===null?kne(o)&&(a===null?n.removeAttribute(o):n.setAttribute(o,""+a)):p.mustUseProperty?n[p.propertyName]=a===null?p.type===3?!1:"":a:(o=p.attributeName,d=p.attributeNamespace,a===null?n.removeAttribute(o):(p=p.type,a=p===3||p===4&&a===!0?"":""+a,d?n.setAttributeNS(d,o,a):n.setAttribute(o,a))))}var Cc=Dne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Yg=Symbol.for("react.element"),wh=Symbol.for("react.portal"),Ih=Symbol.for("react.fragment"),Gb=Symbol.for("react.strict_mode"),yI=Symbol.for("react.profiler"),I5=Symbol.for("react.provider"),b5=Symbol.for("react.context"),Hb=Symbol.for("react.forward_ref"),vI=Symbol.for("react.suspense"),TI=Symbol.for("react.suspense_list"),Kb=Symbol.for("react.memo"),_l=Symbol.for("react.lazy"),A5=Symbol.for("react.offscreen"),xj=Symbol.iterator;function Kf(n){return n===null||typeof n!="object"?null:(n=xj&&n[xj]||n["@@iterator"],typeof n=="function"?n:null)}var _n=Object.assign,P0;function sm(n){if(P0===void 0)try{throw Error()}catch(a){var o=a.stack.trim().match(/\n( *(at )?)/);P0=o&&o[1]||""}return`
`+P0+n}var k0=!1;function L0(n,o){if(!n||k0)return"";k0=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(D){var d=D}Reflect.construct(n,[],o)}else{try{o.call()}catch(D){d=D}n.call(o.prototype)}else{try{throw Error()}catch(D){d=D}n()}}catch(D){if(D&&d&&typeof D.stack=="string"){for(var p=D.stack.split(`
`),_=d.stack.split(`
`),g=p.length-1,C=_.length-1;1<=g&&0<=C&&p[g]!==_[C];)C--;for(;1<=g&&0<=C;g--,C--)if(p[g]!==_[C]){if(g!==1||C!==1)do if(g--,C--,0>C||p[g]!==_[C]){var R=`
`+p[g].replace(" at new "," at ");return n.displayName&&R.includes("<anonymous>")&&(R=R.replace("<anonymous>",n.displayName)),R}while(1<=g&&0<=C);break}}}finally{k0=!1,Error.prepareStackTrace=a}return(n=n?n.displayName||n.name:"")?sm(n):""}function xne(n){switch(n.tag){case 5:return sm(n.type);case 16:return sm("Lazy");case 13:return sm("Suspense");case 19:return sm("SuspenseList");case 0:case 2:case 15:return n=L0(n.type,!1),n;case 11:return n=L0(n.type.render,!1),n;case 1:return n=L0(n.type,!0),n;default:return""}}function CI(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Ih:return"Fragment";case wh:return"Portal";case yI:return"Profiler";case Gb:return"StrictMode";case vI:return"Suspense";case TI:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case b5:return(n.displayName||"Context")+".Consumer";case I5:return(n._context.displayName||"Context")+".Provider";case Hb:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Kb:return o=n.displayName||null,o!==null?o:CI(n.type)||"Memo";case _l:o=n._payload,n=n._init;try{return CI(n(o))}catch{}}return null}function Une(n){var o=n.type;switch(n.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=o.render,n=n.displayName||n.name||"",o.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return CI(o);case 8:return o===Gb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Pl(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function O5(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Vne(n){var o=O5(n)?"checked":"value",a=Object.getOwnPropertyDescriptor(n.constructor.prototype,o),d=""+n[o];if(!n.hasOwnProperty(o)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var p=a.get,_=a.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return p.call(this)},set:function(g){d=""+g,_.call(this,g)}}),Object.defineProperty(n,o,{enumerable:a.enumerable}),{getValue:function(){return d},setValue:function(g){d=""+g},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function Jg(n){n._valueTracker||(n._valueTracker=Vne(n))}function N5(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var a=o.getValue(),d="";return n&&(d=O5(n)?n.checked?"true":"false":n.value),n=d,n!==a?(o.setValue(n),!0):!1}function JS(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function RI(n,o){var a=o.checked;return _n({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??n._wrapperState.initialChecked})}function Uj(n,o){var a=o.defaultValue==null?"":o.defaultValue,d=o.checked!=null?o.checked:o.defaultChecked;a=Pl(o.value!=null?o.value:a),n._wrapperState={initialChecked:d,initialValue:a,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function D5(n,o){o=o.checked,o!=null&&Wb(n,"checked",o,!1)}function wI(n,o){D5(n,o);var a=Pl(o.value),d=o.type;if(a!=null)d==="number"?(a===0&&n.value===""||n.value!=a)&&(n.value=""+a):n.value!==""+a&&(n.value=""+a);else if(d==="submit"||d==="reset"){n.removeAttribute("value");return}o.hasOwnProperty("value")?II(n,o.type,a):o.hasOwnProperty("defaultValue")&&II(n,o.type,Pl(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(n.defaultChecked=!!o.defaultChecked)}function Vj(n,o,a){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var d=o.type;if(!(d!=="submit"&&d!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+n._wrapperState.initialValue,a||o===n.value||(n.value=o),n.defaultValue=o}a=n.name,a!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,a!==""&&(n.name=a)}function II(n,o,a){(o!=="number"||JS(n.ownerDocument)!==n)&&(a==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+a&&(n.defaultValue=""+a))}var am=Array.isArray;function Uh(n,o,a,d){if(n=n.options,o){o={};for(var p=0;p<a.length;p++)o["$"+a[p]]=!0;for(a=0;a<n.length;a++)p=o.hasOwnProperty("$"+n[a].value),n[a].selected!==p&&(n[a].selected=p),p&&d&&(n[a].defaultSelected=!0)}else{for(a=""+Pl(a),o=null,p=0;p<n.length;p++){if(n[p].value===a){n[p].selected=!0,d&&(n[p].defaultSelected=!0);return}o!==null||n[p].disabled||(o=n[p])}o!==null&&(o.selected=!0)}}function bI(n,o){if(o.dangerouslySetInnerHTML!=null)throw Error(De(91));return _n({},o,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Fj(n,o){var a=o.value;if(a==null){if(a=o.children,o=o.defaultValue,a!=null){if(o!=null)throw Error(De(92));if(am(a)){if(1<a.length)throw Error(De(93));a=a[0]}o=a}o==null&&(o=""),a=o}n._wrapperState={initialValue:Pl(a)}}function P5(n,o){var a=Pl(o.value),d=Pl(o.defaultValue);a!=null&&(a=""+a,a!==n.value&&(n.value=a),o.defaultValue==null&&n.defaultValue!==a&&(n.defaultValue=a)),d!=null&&(n.defaultValue=""+d)}function jj(n){var o=n.textContent;o===n._wrapperState.initialValue&&o!==""&&o!==null&&(n.value=o)}function k5(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function AI(n,o){return n==null||n==="http://www.w3.org/1999/xhtml"?k5(o):n==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Xg,L5=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,a,d,p){MSApp.execUnsafeLocalFunction(function(){return n(o,a,d,p)})}:n}(function(n,o){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=o;else{for(Xg=Xg||document.createElement("div"),Xg.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Xg.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;o.firstChild;)n.appendChild(o.firstChild)}});function Am(n,o){if(o){var a=n.firstChild;if(a&&a===n.lastChild&&a.nodeType===3){a.nodeValue=o;return}}n.textContent=o}var mm={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Fne=["Webkit","ms","Moz","O"];Object.keys(mm).forEach(function(n){Fne.forEach(function(o){o=o+n.charAt(0).toUpperCase()+n.substring(1),mm[o]=mm[n]})});function M5(n,o,a){return o==null||typeof o=="boolean"||o===""?"":a||typeof o!="number"||o===0||mm.hasOwnProperty(n)&&mm[n]?(""+o).trim():o+"px"}function x5(n,o){n=n.style;for(var a in o)if(o.hasOwnProperty(a)){var d=a.indexOf("--")===0,p=M5(a,o[a],d);a==="float"&&(a="cssFloat"),d?n.setProperty(a,p):n[a]=p}}var jne=_n({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function OI(n,o){if(o){if(jne[n]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(De(137,n));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(De(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(De(61))}if(o.style!=null&&typeof o.style!="object")throw Error(De(62))}}function NI(n,o){if(n.indexOf("-")===-1)return typeof o.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var DI=null;function zb(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var PI=null,Vh=null,Fh=null;function Bj(n){if(n=r_(n)){if(typeof PI!="function")throw Error(De(280));var o=n.stateNode;o&&(o=Fy(o),PI(n.stateNode,n.type,o))}}function U5(n){Vh?Fh?Fh.push(n):Fh=[n]:Vh=n}function V5(){if(Vh){var n=Vh,o=Fh;if(Fh=Vh=null,Bj(n),o)for(n=0;n<o.length;n++)Bj(o[n])}}function F5(n,o){return n(o)}function j5(){}var M0=!1;function B5(n,o,a){if(M0)return n(o,a);M0=!0;try{return F5(n,o,a)}finally{M0=!1,(Vh!==null||Fh!==null)&&(j5(),V5())}}function Om(n,o){var a=n.stateNode;if(a===null)return null;var d=Fy(a);if(d===null)return null;a=d[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(n=n.type,d=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!d;break e;default:n=!1}if(n)return null;if(a&&typeof a!="function")throw Error(De(231,o,typeof a));return a}var kI=!1;if(Ec)try{var zf={};Object.defineProperty(zf,"passive",{get:function(){kI=!0}}),window.addEventListener("test",zf,zf),window.removeEventListener("test",zf,zf)}catch{kI=!1}function Bne(n,o,a,d,p,_,g,C,R){var D=Array.prototype.slice.call(arguments,3);try{o.apply(a,D)}catch(L){this.onError(L)}}var _m=!1,XS=null,$S=!1,LI=null,Wne={onError:function(n){_m=!0,XS=n}};function Gne(n,o,a,d,p,_,g,C,R){_m=!1,XS=null,Bne.apply(Wne,arguments)}function Hne(n,o,a,d,p,_,g,C,R){if(Gne.apply(this,arguments),_m){if(_m){var D=XS;_m=!1,XS=null}else throw Error(De(198));$S||($S=!0,LI=D)}}function Yd(n){var o=n,a=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,o.flags&4098&&(a=o.return),n=o.return;while(n)}return o.tag===3?a:null}function W5(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function Wj(n){if(Yd(n)!==n)throw Error(De(188))}function Kne(n){var o=n.alternate;if(!o){if(o=Yd(n),o===null)throw Error(De(188));return o!==n?null:n}for(var a=n,d=o;;){var p=a.return;if(p===null)break;var _=p.alternate;if(_===null){if(d=p.return,d!==null){a=d;continue}break}if(p.child===_.child){for(_=p.child;_;){if(_===a)return Wj(p),n;if(_===d)return Wj(p),o;_=_.sibling}throw Error(De(188))}if(a.return!==d.return)a=p,d=_;else{for(var g=!1,C=p.child;C;){if(C===a){g=!0,a=p,d=_;break}if(C===d){g=!0,d=p,a=_;break}C=C.sibling}if(!g){for(C=_.child;C;){if(C===a){g=!0,a=_,d=p;break}if(C===d){g=!0,d=_,a=p;break}C=C.sibling}if(!g)throw Error(De(189))}}if(a.alternate!==d)throw Error(De(190))}if(a.tag!==3)throw Error(De(188));return a.stateNode.current===a?n:o}function G5(n){return n=Kne(n),n!==null?H5(n):null}function H5(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var o=H5(n);if(o!==null)return o;n=n.sibling}return null}var K5=xo.unstable_scheduleCallback,Gj=xo.unstable_cancelCallback,zne=xo.unstable_shouldYield,qne=xo.unstable_requestPaint,Nn=xo.unstable_now,Yne=xo.unstable_getCurrentPriorityLevel,qb=xo.unstable_ImmediatePriority,z5=xo.unstable_UserBlockingPriority,QS=xo.unstable_NormalPriority,Jne=xo.unstable_LowPriority,q5=xo.unstable_IdlePriority,My=null,Ua=null;function Xne(n){if(Ua&&typeof Ua.onCommitFiberRoot=="function")try{Ua.onCommitFiberRoot(My,n,void 0,(n.current.flags&128)===128)}catch{}}var ea=Math.clz32?Math.clz32:Zne,$ne=Math.log,Qne=Math.LN2;function Zne(n){return n>>>=0,n===0?32:31-($ne(n)/Qne|0)|0}var $g=64,Qg=4194304;function cm(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ZS(n,o){var a=n.pendingLanes;if(a===0)return 0;var d=0,p=n.suspendedLanes,_=n.pingedLanes,g=a&268435455;if(g!==0){var C=g&~p;C!==0?d=cm(C):(_&=g,_!==0&&(d=cm(_)))}else g=a&~p,g!==0?d=cm(g):_!==0&&(d=cm(_));if(d===0)return 0;if(o!==0&&o!==d&&!(o&p)&&(p=d&-d,_=o&-o,p>=_||p===16&&(_&4194240)!==0))return o;if(d&4&&(d|=a&16),o=n.entangledLanes,o!==0)for(n=n.entanglements,o&=d;0<o;)a=31-ea(o),p=1<<a,d|=n[a],o&=~p;return d}function eie(n,o){switch(n){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tie(n,o){for(var a=n.suspendedLanes,d=n.pingedLanes,p=n.expirationTimes,_=n.pendingLanes;0<_;){var g=31-ea(_),C=1<<g,R=p[g];R===-1?(!(C&a)||C&d)&&(p[g]=eie(C,o)):R<=o&&(n.expiredLanes|=C),_&=~C}}function MI(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Y5(){var n=$g;return $g<<=1,!($g&4194240)&&($g=64),n}function x0(n){for(var o=[],a=0;31>a;a++)o.push(n);return o}function e_(n,o,a){n.pendingLanes|=o,o!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,o=31-ea(o),n[o]=a}function rie(n,o){var a=n.pendingLanes&~o;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=o,n.mutableReadLanes&=o,n.entangledLanes&=o,o=n.entanglements;var d=n.eventTimes;for(n=n.expirationTimes;0<a;){var p=31-ea(a),_=1<<p;o[p]=0,d[p]=-1,n[p]=-1,a&=~_}}function Yb(n,o){var a=n.entangledLanes|=o;for(n=n.entanglements;a;){var d=31-ea(a),p=1<<d;p&o|n[d]&o&&(n[d]|=o),a&=~p}}var Ir=0;function J5(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var X5,Jb,$5,Q5,Z5,xI=!1,Zg=[],Cl=null,Rl=null,wl=null,Nm=new Map,Dm=new Map,gl=[],nie="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Hj(n,o){switch(n){case"focusin":case"focusout":Cl=null;break;case"dragenter":case"dragleave":Rl=null;break;case"mouseover":case"mouseout":wl=null;break;case"pointerover":case"pointerout":Nm.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dm.delete(o.pointerId)}}function qf(n,o,a,d,p,_){return n===null||n.nativeEvent!==_?(n={blockedOn:o,domEventName:a,eventSystemFlags:d,nativeEvent:_,targetContainers:[p]},o!==null&&(o=r_(o),o!==null&&Jb(o)),n):(n.eventSystemFlags|=d,o=n.targetContainers,p!==null&&o.indexOf(p)===-1&&o.push(p),n)}function iie(n,o,a,d,p){switch(o){case"focusin":return Cl=qf(Cl,n,o,a,d,p),!0;case"dragenter":return Rl=qf(Rl,n,o,a,d,p),!0;case"mouseover":return wl=qf(wl,n,o,a,d,p),!0;case"pointerover":var _=p.pointerId;return Nm.set(_,qf(Nm.get(_)||null,n,o,a,d,p)),!0;case"gotpointercapture":return _=p.pointerId,Dm.set(_,qf(Dm.get(_)||null,n,o,a,d,p)),!0}return!1}function e4(n){var o=Pd(n.target);if(o!==null){var a=Yd(o);if(a!==null){if(o=a.tag,o===13){if(o=W5(a),o!==null){n.blockedOn=o,Z5(n.priority,function(){$5(a)});return}}else if(o===3&&a.stateNode.current.memoizedState.isDehydrated){n.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}n.blockedOn=null}function CS(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var a=UI(n.domEventName,n.eventSystemFlags,o[0],n.nativeEvent);if(a===null){a=n.nativeEvent;var d=new a.constructor(a.type,a);DI=d,a.target.dispatchEvent(d),DI=null}else return o=r_(a),o!==null&&Jb(o),n.blockedOn=a,!1;o.shift()}return!0}function Kj(n,o,a){CS(n)&&a.delete(o)}function oie(){xI=!1,Cl!==null&&CS(Cl)&&(Cl=null),Rl!==null&&CS(Rl)&&(Rl=null),wl!==null&&CS(wl)&&(wl=null),Nm.forEach(Kj),Dm.forEach(Kj)}function Yf(n,o){n.blockedOn===o&&(n.blockedOn=null,xI||(xI=!0,xo.unstable_scheduleCallback(xo.unstable_NormalPriority,oie)))}function Pm(n){function o(p){return Yf(p,n)}if(0<Zg.length){Yf(Zg[0],n);for(var a=1;a<Zg.length;a++){var d=Zg[a];d.blockedOn===n&&(d.blockedOn=null)}}for(Cl!==null&&Yf(Cl,n),Rl!==null&&Yf(Rl,n),wl!==null&&Yf(wl,n),Nm.forEach(o),Dm.forEach(o),a=0;a<gl.length;a++)d=gl[a],d.blockedOn===n&&(d.blockedOn=null);for(;0<gl.length&&(a=gl[0],a.blockedOn===null);)e4(a),a.blockedOn===null&&gl.shift()}var jh=Cc.ReactCurrentBatchConfig,ey=!0;function sie(n,o,a,d){var p=Ir,_=jh.transition;jh.transition=null;try{Ir=1,Xb(n,o,a,d)}finally{Ir=p,jh.transition=_}}function aie(n,o,a,d){var p=Ir,_=jh.transition;jh.transition=null;try{Ir=4,Xb(n,o,a,d)}finally{Ir=p,jh.transition=_}}function Xb(n,o,a,d){if(ey){var p=UI(n,o,a,d);if(p===null)z0(n,o,d,ty,a),Hj(n,d);else if(iie(p,n,o,a,d))d.stopPropagation();else if(Hj(n,d),o&4&&-1<nie.indexOf(n)){for(;p!==null;){var _=r_(p);if(_!==null&&X5(_),_=UI(n,o,a,d),_===null&&z0(n,o,d,ty,a),_===p)break;p=_}p!==null&&d.stopPropagation()}else z0(n,o,d,null,a)}}var ty=null;function UI(n,o,a,d){if(ty=null,n=zb(d),n=Pd(n),n!==null)if(o=Yd(n),o===null)n=null;else if(a=o.tag,a===13){if(n=W5(o),n!==null)return n;n=null}else if(a===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null);return ty=n,null}function t4(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Yne()){case qb:return 1;case z5:return 4;case QS:case Jne:return 16;case q5:return 536870912;default:return 16}default:return 16}}var vl=null,$b=null,RS=null;function r4(){if(RS)return RS;var n,o=$b,a=o.length,d,p="value"in vl?vl.value:vl.textContent,_=p.length;for(n=0;n<a&&o[n]===p[n];n++);var g=a-n;for(d=1;d<=g&&o[a-d]===p[_-d];d++);return RS=p.slice(n,1<d?1-d:void 0)}function wS(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function eS(){return!0}function zj(){return!1}function jo(n){function o(a,d,p,_,g){this._reactName=a,this._targetInst=p,this.type=d,this.nativeEvent=_,this.target=g,this.currentTarget=null;for(var C in n)n.hasOwnProperty(C)&&(a=n[C],this[C]=a?a(_):_[C]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?eS:zj,this.isPropagationStopped=zj,this}return _n(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=eS)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=eS)},persist:function(){},isPersistent:eS}),o}var ip={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qb=jo(ip),t_=_n({},ip,{view:0,detail:0}),cie=jo(t_),U0,V0,Jf,xy=_n({},t_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zb,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Jf&&(Jf&&n.type==="mousemove"?(U0=n.screenX-Jf.screenX,V0=n.screenY-Jf.screenY):V0=U0=0,Jf=n),U0)},movementY:function(n){return"movementY"in n?n.movementY:V0}}),qj=jo(xy),lie=_n({},xy,{dataTransfer:0}),die=jo(lie),uie=_n({},t_,{relatedTarget:0}),F0=jo(uie),hie=_n({},ip,{animationName:0,elapsedTime:0,pseudoElement:0}),pie=jo(hie),fie=_n({},ip,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),mie=jo(fie),_ie=_n({},ip,{data:0}),Yj=jo(_ie),Eie={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gie={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sie={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yie(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=Sie[n])?!!o[n]:!1}function Zb(){return yie}var vie=_n({},t_,{key:function(n){if(n.key){var o=Eie[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=wS(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?gie[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zb,charCode:function(n){return n.type==="keypress"?wS(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?wS(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Tie=jo(vie),Cie=_n({},xy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Jj=jo(Cie),Rie=_n({},t_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zb}),wie=jo(Rie),Iie=_n({},ip,{propertyName:0,elapsedTime:0,pseudoElement:0}),bie=jo(Iie),Aie=_n({},xy,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Oie=jo(Aie),Nie=[9,13,27,32],eA=Ec&&"CompositionEvent"in window,Em=null;Ec&&"documentMode"in document&&(Em=document.documentMode);var Die=Ec&&"TextEvent"in window&&!Em,n4=Ec&&(!eA||Em&&8<Em&&11>=Em),Xj=" ",$j=!1;function i4(n,o){switch(n){case"keyup":return Nie.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function o4(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var bh=!1;function Pie(n,o){switch(n){case"compositionend":return o4(o);case"keypress":return o.which!==32?null:($j=!0,Xj);case"textInput":return n=o.data,n===Xj&&$j?null:n;default:return null}}function kie(n,o){if(bh)return n==="compositionend"||!eA&&i4(n,o)?(n=r4(),RS=$b=vl=null,bh=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return n4&&o.locale!=="ko"?null:o.data;default:return null}}var Lie={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Qj(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!Lie[n.type]:o==="textarea"}function s4(n,o,a,d){U5(d),o=ry(o,"onChange"),0<o.length&&(a=new Qb("onChange","change",null,a,d),n.push({event:a,listeners:o}))}var gm=null,km=null;function Mie(n){E4(n,0)}function Uy(n){var o=Nh(n);if(N5(o))return n}function xie(n,o){if(n==="change")return o}var a4=!1;if(Ec){var j0;if(Ec){var B0="oninput"in document;if(!B0){var Zj=document.createElement("div");Zj.setAttribute("oninput","return;"),B0=typeof Zj.oninput=="function"}j0=B0}else j0=!1;a4=j0&&(!document.documentMode||9<document.documentMode)}function eB(){gm&&(gm.detachEvent("onpropertychange",c4),km=gm=null)}function c4(n){if(n.propertyName==="value"&&Uy(km)){var o=[];s4(o,km,n,zb(n)),B5(Mie,o)}}function Uie(n,o,a){n==="focusin"?(eB(),gm=o,km=a,gm.attachEvent("onpropertychange",c4)):n==="focusout"&&eB()}function Vie(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Uy(km)}function Fie(n,o){if(n==="click")return Uy(o)}function jie(n,o){if(n==="input"||n==="change")return Uy(o)}function Bie(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var ra=typeof Object.is=="function"?Object.is:Bie;function Lm(n,o){if(ra(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var a=Object.keys(n),d=Object.keys(o);if(a.length!==d.length)return!1;for(d=0;d<a.length;d++){var p=a[d];if(!SI.call(o,p)||!ra(n[p],o[p]))return!1}return!0}function tB(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function rB(n,o){var a=tB(n);n=0;for(var d;a;){if(a.nodeType===3){if(d=n+a.textContent.length,n<=o&&d>=o)return{node:a,offset:o-n};n=d}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=tB(a)}}function l4(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?l4(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function d4(){for(var n=window,o=JS();o instanceof n.HTMLIFrameElement;){try{var a=typeof o.contentWindow.location.href=="string"}catch{a=!1}if(a)n=o.contentWindow;else break;o=JS(n.document)}return o}function tA(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}function Wie(n){var o=d4(),a=n.focusedElem,d=n.selectionRange;if(o!==a&&a&&a.ownerDocument&&l4(a.ownerDocument.documentElement,a)){if(d!==null&&tA(a)){if(o=d.start,n=d.end,n===void 0&&(n=o),"selectionStart"in a)a.selectionStart=o,a.selectionEnd=Math.min(n,a.value.length);else if(n=(o=a.ownerDocument||document)&&o.defaultView||window,n.getSelection){n=n.getSelection();var p=a.textContent.length,_=Math.min(d.start,p);d=d.end===void 0?_:Math.min(d.end,p),!n.extend&&_>d&&(p=d,d=_,_=p),p=rB(a,_);var g=rB(a,d);p&&g&&(n.rangeCount!==1||n.anchorNode!==p.node||n.anchorOffset!==p.offset||n.focusNode!==g.node||n.focusOffset!==g.offset)&&(o=o.createRange(),o.setStart(p.node,p.offset),n.removeAllRanges(),_>d?(n.addRange(o),n.extend(g.node,g.offset)):(o.setEnd(g.node,g.offset),n.addRange(o)))}}for(o=[],n=a;n=n.parentNode;)n.nodeType===1&&o.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<o.length;a++)n=o[a],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Gie=Ec&&"documentMode"in document&&11>=document.documentMode,Ah=null,VI=null,Sm=null,FI=!1;function nB(n,o,a){var d=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;FI||Ah==null||Ah!==JS(d)||(d=Ah,"selectionStart"in d&&tA(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Sm&&Lm(Sm,d)||(Sm=d,d=ry(VI,"onSelect"),0<d.length&&(o=new Qb("onSelect","select",null,o,a),n.push({event:o,listeners:d}),o.target=Ah)))}function tS(n,o){var a={};return a[n.toLowerCase()]=o.toLowerCase(),a["Webkit"+n]="webkit"+o,a["Moz"+n]="moz"+o,a}var Oh={animationend:tS("Animation","AnimationEnd"),animationiteration:tS("Animation","AnimationIteration"),animationstart:tS("Animation","AnimationStart"),transitionend:tS("Transition","TransitionEnd")},W0={},u4={};Ec&&(u4=document.createElement("div").style,"AnimationEvent"in window||(delete Oh.animationend.animation,delete Oh.animationiteration.animation,delete Oh.animationstart.animation),"TransitionEvent"in window||delete Oh.transitionend.transition);function Vy(n){if(W0[n])return W0[n];if(!Oh[n])return n;var o=Oh[n],a;for(a in o)if(o.hasOwnProperty(a)&&a in u4)return W0[n]=o[a];return n}var h4=Vy("animationend"),p4=Vy("animationiteration"),f4=Vy("animationstart"),m4=Vy("transitionend"),_4=new Map,iB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ul(n,o){_4.set(n,o),qd(o,[n])}for(var G0=0;G0<iB.length;G0++){var H0=iB[G0],Hie=H0.toLowerCase(),Kie=H0[0].toUpperCase()+H0.slice(1);Ul(Hie,"on"+Kie)}Ul(h4,"onAnimationEnd");Ul(p4,"onAnimationIteration");Ul(f4,"onAnimationStart");Ul("dblclick","onDoubleClick");Ul("focusin","onFocus");Ul("focusout","onBlur");Ul(m4,"onTransitionEnd");zh("onMouseEnter",["mouseout","mouseover"]);zh("onMouseLeave",["mouseout","mouseover"]);zh("onPointerEnter",["pointerout","pointerover"]);zh("onPointerLeave",["pointerout","pointerover"]);qd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qd("onBeforeInput",["compositionend","keypress","textInput","paste"]);qd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zie=new Set("cancel close invalid load scroll toggle".split(" ").concat(lm));function oB(n,o,a){var d=n.type||"unknown-event";n.currentTarget=a,Hne(d,o,void 0,n),n.currentTarget=null}function E4(n,o){o=(o&4)!==0;for(var a=0;a<n.length;a++){var d=n[a],p=d.event;d=d.listeners;e:{var _=void 0;if(o)for(var g=d.length-1;0<=g;g--){var C=d[g],R=C.instance,D=C.currentTarget;if(C=C.listener,R!==_&&p.isPropagationStopped())break e;oB(p,C,D),_=R}else for(g=0;g<d.length;g++){if(C=d[g],R=C.instance,D=C.currentTarget,C=C.listener,R!==_&&p.isPropagationStopped())break e;oB(p,C,D),_=R}}}if($S)throw n=LI,$S=!1,LI=null,n}function Zr(n,o){var a=o[HI];a===void 0&&(a=o[HI]=new Set);var d=n+"__bubble";a.has(d)||(g4(o,n,2,!1),a.add(d))}function K0(n,o,a){var d=0;o&&(d|=4),g4(a,n,d,o)}var rS="_reactListening"+Math.random().toString(36).slice(2);function Mm(n){if(!n[rS]){n[rS]=!0,w5.forEach(function(a){a!=="selectionchange"&&(zie.has(a)||K0(a,!1,n),K0(a,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[rS]||(o[rS]=!0,K0("selectionchange",!1,o))}}function g4(n,o,a,d){switch(t4(o)){case 1:var p=sie;break;case 4:p=aie;break;default:p=Xb}a=p.bind(null,o,a,n),p=void 0,!kI||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(p=!0),d?p!==void 0?n.addEventListener(o,a,{capture:!0,passive:p}):n.addEventListener(o,a,!0):p!==void 0?n.addEventListener(o,a,{passive:p}):n.addEventListener(o,a,!1)}function z0(n,o,a,d,p){var _=d;if(!(o&1)&&!(o&2)&&d!==null)e:for(;;){if(d===null)return;var g=d.tag;if(g===3||g===4){var C=d.stateNode.containerInfo;if(C===p||C.nodeType===8&&C.parentNode===p)break;if(g===4)for(g=d.return;g!==null;){var R=g.tag;if((R===3||R===4)&&(R=g.stateNode.containerInfo,R===p||R.nodeType===8&&R.parentNode===p))return;g=g.return}for(;C!==null;){if(g=Pd(C),g===null)return;if(R=g.tag,R===5||R===6){d=_=g;continue e}C=C.parentNode}}d=d.return}B5(function(){var D=_,L=zb(a),k=[];e:{var M=_4.get(n);if(M!==void 0){var Y=Qb,z=n;switch(n){case"keypress":if(wS(a)===0)break e;case"keydown":case"keyup":Y=Tie;break;case"focusin":z="focus",Y=F0;break;case"focusout":z="blur",Y=F0;break;case"beforeblur":case"afterblur":Y=F0;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=qj;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=die;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=wie;break;case h4:case p4:case f4:Y=pie;break;case m4:Y=bie;break;case"scroll":Y=cie;break;case"wheel":Y=Oie;break;case"copy":case"cut":case"paste":Y=mie;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=Jj}var V=(o&4)!==0,Q=!V&&n==="scroll",G=V?M!==null?M+"Capture":null:M;V=[];for(var B=D,q;B!==null;){q=B;var se=q.stateNode;if(q.tag===5&&se!==null&&(q=se,G!==null&&(se=Om(B,G),se!=null&&V.push(xm(B,se,q)))),Q)break;B=B.return}0<V.length&&(M=new Y(M,z,null,a,L),k.push({event:M,listeners:V}))}}if(!(o&7)){e:{if(M=n==="mouseover"||n==="pointerover",Y=n==="mouseout"||n==="pointerout",M&&a!==DI&&(z=a.relatedTarget||a.fromElement)&&(Pd(z)||z[gc]))break e;if((Y||M)&&(M=L.window===L?L:(M=L.ownerDocument)?M.defaultView||M.parentWindow:window,Y?(z=a.relatedTarget||a.toElement,Y=D,z=z?Pd(z):null,z!==null&&(Q=Yd(z),z!==Q||z.tag!==5&&z.tag!==6)&&(z=null)):(Y=null,z=D),Y!==z)){if(V=qj,se="onMouseLeave",G="onMouseEnter",B="mouse",(n==="pointerout"||n==="pointerover")&&(V=Jj,se="onPointerLeave",G="onPointerEnter",B="pointer"),Q=Y==null?M:Nh(Y),q=z==null?M:Nh(z),M=new V(se,B+"leave",Y,a,L),M.target=Q,M.relatedTarget=q,se=null,Pd(L)===D&&(V=new V(G,B+"enter",z,a,L),V.target=q,V.relatedTarget=Q,se=V),Q=se,Y&&z)t:{for(V=Y,G=z,B=0,q=V;q;q=_h(q))B++;for(q=0,se=G;se;se=_h(se))q++;for(;0<B-q;)V=_h(V),B--;for(;0<q-B;)G=_h(G),q--;for(;B--;){if(V===G||G!==null&&V===G.alternate)break t;V=_h(V),G=_h(G)}V=null}else V=null;Y!==null&&sB(k,M,Y,V,!1),z!==null&&Q!==null&&sB(k,Q,z,V,!0)}}e:{if(M=D?Nh(D):window,Y=M.nodeName&&M.nodeName.toLowerCase(),Y==="select"||Y==="input"&&M.type==="file")var ue=xie;else if(Qj(M))if(a4)ue=jie;else{ue=Vie;var $=Uie}else(Y=M.nodeName)&&Y.toLowerCase()==="input"&&(M.type==="checkbox"||M.type==="radio")&&(ue=Fie);if(ue&&(ue=ue(n,D))){s4(k,ue,a,L);break e}$&&$(n,M,D),n==="focusout"&&($=M._wrapperState)&&$.controlled&&M.type==="number"&&II(M,"number",M.value)}switch($=D?Nh(D):window,n){case"focusin":(Qj($)||$.contentEditable==="true")&&(Ah=$,VI=D,Sm=null);break;case"focusout":Sm=VI=Ah=null;break;case"mousedown":FI=!0;break;case"contextmenu":case"mouseup":case"dragend":FI=!1,nB(k,a,L);break;case"selectionchange":if(Gie)break;case"keydown":case"keyup":nB(k,a,L)}var pe;if(eA)e:{switch(n){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else bh?i4(n,a)&&(Oe="onCompositionEnd"):n==="keydown"&&a.keyCode===229&&(Oe="onCompositionStart");Oe&&(n4&&a.locale!=="ko"&&(bh||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&bh&&(pe=r4()):(vl=L,$b="value"in vl?vl.value:vl.textContent,bh=!0)),$=ry(D,Oe),0<$.length&&(Oe=new Yj(Oe,n,null,a,L),k.push({event:Oe,listeners:$}),pe?Oe.data=pe:(pe=o4(a),pe!==null&&(Oe.data=pe)))),(pe=Die?Pie(n,a):kie(n,a))&&(D=ry(D,"onBeforeInput"),0<D.length&&(L=new Yj("onBeforeInput","beforeinput",null,a,L),k.push({event:L,listeners:D}),L.data=pe))}E4(k,o)})}function xm(n,o,a){return{instance:n,listener:o,currentTarget:a}}function ry(n,o){for(var a=o+"Capture",d=[];n!==null;){var p=n,_=p.stateNode;p.tag===5&&_!==null&&(p=_,_=Om(n,a),_!=null&&d.unshift(xm(n,_,p)),_=Om(n,o),_!=null&&d.push(xm(n,_,p))),n=n.return}return d}function _h(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function sB(n,o,a,d,p){for(var _=o._reactName,g=[];a!==null&&a!==d;){var C=a,R=C.alternate,D=C.stateNode;if(R!==null&&R===d)break;C.tag===5&&D!==null&&(C=D,p?(R=Om(a,_),R!=null&&g.unshift(xm(a,R,C))):p||(R=Om(a,_),R!=null&&g.push(xm(a,R,C)))),a=a.return}g.length!==0&&n.push({event:o,listeners:g})}var qie=/\r\n?/g,Yie=/\u0000|\uFFFD/g;function aB(n){return(typeof n=="string"?n:""+n).replace(qie,`
`).replace(Yie,"")}function nS(n,o,a){if(o=aB(o),aB(n)!==o&&a)throw Error(De(425))}function ny(){}var jI=null,BI=null;function WI(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var GI=typeof setTimeout=="function"?setTimeout:void 0,Jie=typeof clearTimeout=="function"?clearTimeout:void 0,cB=typeof Promise=="function"?Promise:void 0,Xie=typeof queueMicrotask=="function"?queueMicrotask:typeof cB<"u"?function(n){return cB.resolve(null).then(n).catch($ie)}:GI;function $ie(n){setTimeout(function(){throw n})}function q0(n,o){var a=o,d=0;do{var p=a.nextSibling;if(n.removeChild(a),p&&p.nodeType===8)if(a=p.data,a==="/$"){if(d===0){n.removeChild(p),Pm(o);return}d--}else a!=="$"&&a!=="$?"&&a!=="$!"||d++;a=p}while(a);Pm(o)}function Il(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return n}function lB(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var a=n.data;if(a==="$"||a==="$!"||a==="$?"){if(o===0)return n;o--}else a==="/$"&&o++}n=n.previousSibling}return null}var op=Math.random().toString(36).slice(2),xa="__reactFiber$"+op,Um="__reactProps$"+op,gc="__reactContainer$"+op,HI="__reactEvents$"+op,Qie="__reactListeners$"+op,Zie="__reactHandles$"+op;function Pd(n){var o=n[xa];if(o)return o;for(var a=n.parentNode;a;){if(o=a[gc]||a[xa]){if(a=o.alternate,o.child!==null||a!==null&&a.child!==null)for(n=lB(n);n!==null;){if(a=n[xa])return a;n=lB(n)}return o}n=a,a=n.parentNode}return null}function r_(n){return n=n[xa]||n[gc],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Nh(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(De(33))}function Fy(n){return n[Um]||null}var KI=[],Dh=-1;function Vl(n){return{current:n}}function en(n){0>Dh||(n.current=KI[Dh],KI[Dh]=null,Dh--)}function zr(n,o){Dh++,KI[Dh]=n.current,n.current=o}var kl={},Pi=Vl(kl),co=Vl(!1),jd=kl;function qh(n,o){var a=n.type.contextTypes;if(!a)return kl;var d=n.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===o)return d.__reactInternalMemoizedMaskedChildContext;var p={},_;for(_ in a)p[_]=o[_];return d&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=o,n.__reactInternalMemoizedMaskedChildContext=p),p}function lo(n){return n=n.childContextTypes,n!=null}function iy(){en(co),en(Pi)}function dB(n,o,a){if(Pi.current!==kl)throw Error(De(168));zr(Pi,o),zr(co,a)}function S4(n,o,a){var d=n.stateNode;if(o=o.childContextTypes,typeof d.getChildContext!="function")return a;d=d.getChildContext();for(var p in d)if(!(p in o))throw Error(De(108,Une(n)||"Unknown",p));return _n({},a,d)}function oy(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||kl,jd=Pi.current,zr(Pi,n),zr(co,co.current),!0}function uB(n,o,a){var d=n.stateNode;if(!d)throw Error(De(169));a?(n=S4(n,o,jd),d.__reactInternalMemoizedMergedChildContext=n,en(co),en(Pi),zr(Pi,n)):en(co),zr(co,a)}var uc=null,jy=!1,Y0=!1;function y4(n){uc===null?uc=[n]:uc.push(n)}function eoe(n){jy=!0,y4(n)}function Fl(){if(!Y0&&uc!==null){Y0=!0;var n=0,o=Ir;try{var a=uc;for(Ir=1;n<a.length;n++){var d=a[n];do d=d(!0);while(d!==null)}uc=null,jy=!1}catch(p){throw uc!==null&&(uc=uc.slice(n+1)),K5(qb,Fl),p}finally{Ir=o,Y0=!1}}return null}var Ph=[],kh=0,sy=null,ay=0,ms=[],_s=0,Bd=null,pc=1,fc="";function Ad(n,o){Ph[kh++]=ay,Ph[kh++]=sy,sy=n,ay=o}function v4(n,o,a){ms[_s++]=pc,ms[_s++]=fc,ms[_s++]=Bd,Bd=n;var d=pc;n=fc;var p=32-ea(d)-1;d&=~(1<<p),a+=1;var _=32-ea(o)+p;if(30<_){var g=p-p%5;_=(d&(1<<g)-1).toString(32),d>>=g,p-=g,pc=1<<32-ea(o)+p|a<<p|d,fc=_+n}else pc=1<<_|a<<p|d,fc=n}function rA(n){n.return!==null&&(Ad(n,1),v4(n,1,0))}function nA(n){for(;n===sy;)sy=Ph[--kh],Ph[kh]=null,ay=Ph[--kh],Ph[kh]=null;for(;n===Bd;)Bd=ms[--_s],ms[_s]=null,fc=ms[--_s],ms[_s]=null,pc=ms[--_s],ms[_s]=null}var Lo=null,No=null,ln=!1,Qs=null;function T4(n,o){var a=Ss(5,null,null,0);a.elementType="DELETED",a.stateNode=o,a.return=n,o=n.deletions,o===null?(n.deletions=[a],n.flags|=16):o.push(a)}function hB(n,o){switch(n.tag){case 5:var a=n.type;return o=o.nodeType!==1||a.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(n.stateNode=o,Lo=n,No=Il(o.firstChild),!0):!1;case 6:return o=n.pendingProps===""||o.nodeType!==3?null:o,o!==null?(n.stateNode=o,Lo=n,No=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(a=Bd!==null?{id:pc,overflow:fc}:null,n.memoizedState={dehydrated:o,treeContext:a,retryLane:1073741824},a=Ss(18,null,null,0),a.stateNode=o,a.return=n,n.child=a,Lo=n,No=null,!0):!1;default:return!1}}function zI(n){return(n.mode&1)!==0&&(n.flags&128)===0}function qI(n){if(ln){var o=No;if(o){var a=o;if(!hB(n,o)){if(zI(n))throw Error(De(418));o=Il(a.nextSibling);var d=Lo;o&&hB(n,o)?T4(d,a):(n.flags=n.flags&-4097|2,ln=!1,Lo=n)}}else{if(zI(n))throw Error(De(418));n.flags=n.flags&-4097|2,ln=!1,Lo=n}}}function pB(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Lo=n}function iS(n){if(n!==Lo)return!1;if(!ln)return pB(n),ln=!0,!1;var o;if((o=n.tag!==3)&&!(o=n.tag!==5)&&(o=n.type,o=o!=="head"&&o!=="body"&&!WI(n.type,n.memoizedProps)),o&&(o=No)){if(zI(n))throw C4(),Error(De(418));for(;o;)T4(n,o),o=Il(o.nextSibling)}if(pB(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(De(317));e:{for(n=n.nextSibling,o=0;n;){if(n.nodeType===8){var a=n.data;if(a==="/$"){if(o===0){No=Il(n.nextSibling);break e}o--}else a!=="$"&&a!=="$!"&&a!=="$?"||o++}n=n.nextSibling}No=null}}else No=Lo?Il(n.stateNode.nextSibling):null;return!0}function C4(){for(var n=No;n;)n=Il(n.nextSibling)}function Yh(){No=Lo=null,ln=!1}function iA(n){Qs===null?Qs=[n]:Qs.push(n)}var toe=Cc.ReactCurrentBatchConfig;function Xf(n,o,a){if(n=a.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(De(309));var d=a.stateNode}if(!d)throw Error(De(147,n));var p=d,_=""+n;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===_?o.ref:(o=function(g){var C=p.refs;g===null?delete C[_]:C[_]=g},o._stringRef=_,o)}if(typeof n!="string")throw Error(De(284));if(!a._owner)throw Error(De(290,n))}return n}function oS(n,o){throw n=Object.prototype.toString.call(o),Error(De(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n))}function fB(n){var o=n._init;return o(n._payload)}function R4(n){function o(G,B){if(n){var q=G.deletions;q===null?(G.deletions=[B],G.flags|=16):q.push(B)}}function a(G,B){if(!n)return null;for(;B!==null;)o(G,B),B=B.sibling;return null}function d(G,B){for(G=new Map;B!==null;)B.key!==null?G.set(B.key,B):G.set(B.index,B),B=B.sibling;return G}function p(G,B){return G=Nl(G,B),G.index=0,G.sibling=null,G}function _(G,B,q){return G.index=q,n?(q=G.alternate,q!==null?(q=q.index,q<B?(G.flags|=2,B):q):(G.flags|=2,B)):(G.flags|=1048576,B)}function g(G){return n&&G.alternate===null&&(G.flags|=2),G}function C(G,B,q,se){return B===null||B.tag!==6?(B=tI(q,G.mode,se),B.return=G,B):(B=p(B,q),B.return=G,B)}function R(G,B,q,se){var ue=q.type;return ue===Ih?L(G,B,q.props.children,se,q.key):B!==null&&(B.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===_l&&fB(ue)===B.type)?(se=p(B,q.props),se.ref=Xf(G,B,q),se.return=G,se):(se=PS(q.type,q.key,q.props,null,G.mode,se),se.ref=Xf(G,B,q),se.return=G,se)}function D(G,B,q,se){return B===null||B.tag!==4||B.stateNode.containerInfo!==q.containerInfo||B.stateNode.implementation!==q.implementation?(B=rI(q,G.mode,se),B.return=G,B):(B=p(B,q.children||[]),B.return=G,B)}function L(G,B,q,se,ue){return B===null||B.tag!==7?(B=Vd(q,G.mode,se,ue),B.return=G,B):(B=p(B,q),B.return=G,B)}function k(G,B,q){if(typeof B=="string"&&B!==""||typeof B=="number")return B=tI(""+B,G.mode,q),B.return=G,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case Yg:return q=PS(B.type,B.key,B.props,null,G.mode,q),q.ref=Xf(G,null,B),q.return=G,q;case wh:return B=rI(B,G.mode,q),B.return=G,B;case _l:var se=B._init;return k(G,se(B._payload),q)}if(am(B)||Kf(B))return B=Vd(B,G.mode,q,null),B.return=G,B;oS(G,B)}return null}function M(G,B,q,se){var ue=B!==null?B.key:null;if(typeof q=="string"&&q!==""||typeof q=="number")return ue!==null?null:C(G,B,""+q,se);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case Yg:return q.key===ue?R(G,B,q,se):null;case wh:return q.key===ue?D(G,B,q,se):null;case _l:return ue=q._init,M(G,B,ue(q._payload),se)}if(am(q)||Kf(q))return ue!==null?null:L(G,B,q,se,null);oS(G,q)}return null}function Y(G,B,q,se,ue){if(typeof se=="string"&&se!==""||typeof se=="number")return G=G.get(q)||null,C(B,G,""+se,ue);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case Yg:return G=G.get(se.key===null?q:se.key)||null,R(B,G,se,ue);case wh:return G=G.get(se.key===null?q:se.key)||null,D(B,G,se,ue);case _l:var $=se._init;return Y(G,B,q,$(se._payload),ue)}if(am(se)||Kf(se))return G=G.get(q)||null,L(B,G,se,ue,null);oS(B,se)}return null}function z(G,B,q,se){for(var ue=null,$=null,pe=B,Oe=B=0,xe=null;pe!==null&&Oe<q.length;Oe++){pe.index>Oe?(xe=pe,pe=null):xe=pe.sibling;var je=M(G,pe,q[Oe],se);if(je===null){pe===null&&(pe=xe);break}n&&pe&&je.alternate===null&&o(G,pe),B=_(je,B,Oe),$===null?ue=je:$.sibling=je,$=je,pe=xe}if(Oe===q.length)return a(G,pe),ln&&Ad(G,Oe),ue;if(pe===null){for(;Oe<q.length;Oe++)pe=k(G,q[Oe],se),pe!==null&&(B=_(pe,B,Oe),$===null?ue=pe:$.sibling=pe,$=pe);return ln&&Ad(G,Oe),ue}for(pe=d(G,pe);Oe<q.length;Oe++)xe=Y(pe,G,Oe,q[Oe],se),xe!==null&&(n&&xe.alternate!==null&&pe.delete(xe.key===null?Oe:xe.key),B=_(xe,B,Oe),$===null?ue=xe:$.sibling=xe,$=xe);return n&&pe.forEach(function(ze){return o(G,ze)}),ln&&Ad(G,Oe),ue}function V(G,B,q,se){var ue=Kf(q);if(typeof ue!="function")throw Error(De(150));if(q=ue.call(q),q==null)throw Error(De(151));for(var $=ue=null,pe=B,Oe=B=0,xe=null,je=q.next();pe!==null&&!je.done;Oe++,je=q.next()){pe.index>Oe?(xe=pe,pe=null):xe=pe.sibling;var ze=M(G,pe,je.value,se);if(ze===null){pe===null&&(pe=xe);break}n&&pe&&ze.alternate===null&&o(G,pe),B=_(ze,B,Oe),$===null?ue=ze:$.sibling=ze,$=ze,pe=xe}if(je.done)return a(G,pe),ln&&Ad(G,Oe),ue;if(pe===null){for(;!je.done;Oe++,je=q.next())je=k(G,je.value,se),je!==null&&(B=_(je,B,Oe),$===null?ue=je:$.sibling=je,$=je);return ln&&Ad(G,Oe),ue}for(pe=d(G,pe);!je.done;Oe++,je=q.next())je=Y(pe,G,Oe,je.value,se),je!==null&&(n&&je.alternate!==null&&pe.delete(je.key===null?Oe:je.key),B=_(je,B,Oe),$===null?ue=je:$.sibling=je,$=je);return n&&pe.forEach(function(St){return o(G,St)}),ln&&Ad(G,Oe),ue}function Q(G,B,q,se){if(typeof q=="object"&&q!==null&&q.type===Ih&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case Yg:e:{for(var ue=q.key,$=B;$!==null;){if($.key===ue){if(ue=q.type,ue===Ih){if($.tag===7){a(G,$.sibling),B=p($,q.props.children),B.return=G,G=B;break e}}else if($.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===_l&&fB(ue)===$.type){a(G,$.sibling),B=p($,q.props),B.ref=Xf(G,$,q),B.return=G,G=B;break e}a(G,$);break}else o(G,$);$=$.sibling}q.type===Ih?(B=Vd(q.props.children,G.mode,se,q.key),B.return=G,G=B):(se=PS(q.type,q.key,q.props,null,G.mode,se),se.ref=Xf(G,B,q),se.return=G,G=se)}return g(G);case wh:e:{for($=q.key;B!==null;){if(B.key===$)if(B.tag===4&&B.stateNode.containerInfo===q.containerInfo&&B.stateNode.implementation===q.implementation){a(G,B.sibling),B=p(B,q.children||[]),B.return=G,G=B;break e}else{a(G,B);break}else o(G,B);B=B.sibling}B=rI(q,G.mode,se),B.return=G,G=B}return g(G);case _l:return $=q._init,Q(G,B,$(q._payload),se)}if(am(q))return z(G,B,q,se);if(Kf(q))return V(G,B,q,se);oS(G,q)}return typeof q=="string"&&q!==""||typeof q=="number"?(q=""+q,B!==null&&B.tag===6?(a(G,B.sibling),B=p(B,q),B.return=G,G=B):(a(G,B),B=tI(q,G.mode,se),B.return=G,G=B),g(G)):a(G,B)}return Q}var Jh=R4(!0),w4=R4(!1),cy=Vl(null),ly=null,Lh=null,oA=null;function sA(){oA=Lh=ly=null}function aA(n){var o=cy.current;en(cy),n._currentValue=o}function YI(n,o,a){for(;n!==null;){var d=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,d!==null&&(d.childLanes|=o)):d!==null&&(d.childLanes&o)!==o&&(d.childLanes|=o),n===a)break;n=n.return}}function Bh(n,o){ly=n,oA=Lh=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&o&&(ao=!0),n.firstContext=null)}function Ts(n){var o=n._currentValue;if(oA!==n)if(n={context:n,memoizedValue:o,next:null},Lh===null){if(ly===null)throw Error(De(308));Lh=n,ly.dependencies={lanes:0,firstContext:n}}else Lh=Lh.next=n;return o}var kd=null;function cA(n){kd===null?kd=[n]:kd.push(n)}function I4(n,o,a,d){var p=o.interleaved;return p===null?(a.next=a,cA(o)):(a.next=p.next,p.next=a),o.interleaved=a,Sc(n,d)}function Sc(n,o){n.lanes|=o;var a=n.alternate;for(a!==null&&(a.lanes|=o),a=n,n=n.return;n!==null;)n.childLanes|=o,a=n.alternate,a!==null&&(a.childLanes|=o),a=n,n=n.return;return a.tag===3?a.stateNode:null}var El=!1;function lA(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function b4(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function _c(n,o){return{eventTime:n,lane:o,tag:0,payload:null,callback:null,next:null}}function bl(n,o,a){var d=n.updateQueue;if(d===null)return null;if(d=d.shared,cr&2){var p=d.pending;return p===null?o.next=o:(o.next=p.next,p.next=o),d.pending=o,Sc(n,a)}return p=d.interleaved,p===null?(o.next=o,cA(d)):(o.next=p.next,p.next=o),d.interleaved=o,Sc(n,a)}function IS(n,o,a){if(o=o.updateQueue,o!==null&&(o=o.shared,(a&4194240)!==0)){var d=o.lanes;d&=n.pendingLanes,a|=d,o.lanes=a,Yb(n,a)}}function mB(n,o){var a=n.updateQueue,d=n.alternate;if(d!==null&&(d=d.updateQueue,a===d)){var p=null,_=null;if(a=a.firstBaseUpdate,a!==null){do{var g={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};_===null?p=_=g:_=_.next=g,a=a.next}while(a!==null);_===null?p=_=o:_=_.next=o}else p=_=o;a={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:_,shared:d.shared,effects:d.effects},n.updateQueue=a;return}n=a.lastBaseUpdate,n===null?a.firstBaseUpdate=o:n.next=o,a.lastBaseUpdate=o}function dy(n,o,a,d){var p=n.updateQueue;El=!1;var _=p.firstBaseUpdate,g=p.lastBaseUpdate,C=p.shared.pending;if(C!==null){p.shared.pending=null;var R=C,D=R.next;R.next=null,g===null?_=D:g.next=D,g=R;var L=n.alternate;L!==null&&(L=L.updateQueue,C=L.lastBaseUpdate,C!==g&&(C===null?L.firstBaseUpdate=D:C.next=D,L.lastBaseUpdate=R))}if(_!==null){var k=p.baseState;g=0,L=D=R=null,C=_;do{var M=C.lane,Y=C.eventTime;if((d&M)===M){L!==null&&(L=L.next={eventTime:Y,lane:0,tag:C.tag,payload:C.payload,callback:C.callback,next:null});e:{var z=n,V=C;switch(M=o,Y=a,V.tag){case 1:if(z=V.payload,typeof z=="function"){k=z.call(Y,k,M);break e}k=z;break e;case 3:z.flags=z.flags&-65537|128;case 0:if(z=V.payload,M=typeof z=="function"?z.call(Y,k,M):z,M==null)break e;k=_n({},k,M);break e;case 2:El=!0}}C.callback!==null&&C.lane!==0&&(n.flags|=64,M=p.effects,M===null?p.effects=[C]:M.push(C))}else Y={eventTime:Y,lane:M,tag:C.tag,payload:C.payload,callback:C.callback,next:null},L===null?(D=L=Y,R=k):L=L.next=Y,g|=M;if(C=C.next,C===null){if(C=p.shared.pending,C===null)break;M=C,C=M.next,M.next=null,p.lastBaseUpdate=M,p.shared.pending=null}}while(!0);if(L===null&&(R=k),p.baseState=R,p.firstBaseUpdate=D,p.lastBaseUpdate=L,o=p.shared.interleaved,o!==null){p=o;do g|=p.lane,p=p.next;while(p!==o)}else _===null&&(p.shared.lanes=0);Gd|=g,n.lanes=g,n.memoizedState=k}}function _B(n,o,a){if(n=o.effects,o.effects=null,n!==null)for(o=0;o<n.length;o++){var d=n[o],p=d.callback;if(p!==null){if(d.callback=null,d=a,typeof p!="function")throw Error(De(191,p));p.call(d)}}}var n_={},Va=Vl(n_),Vm=Vl(n_),Fm=Vl(n_);function Ld(n){if(n===n_)throw Error(De(174));return n}function dA(n,o){switch(zr(Fm,o),zr(Vm,n),zr(Va,n_),n=o.nodeType,n){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:AI(null,"");break;default:n=n===8?o.parentNode:o,o=n.namespaceURI||null,n=n.tagName,o=AI(o,n)}en(Va),zr(Va,o)}function Xh(){en(Va),en(Vm),en(Fm)}function A4(n){Ld(Fm.current);var o=Ld(Va.current),a=AI(o,n.type);o!==a&&(zr(Vm,n),zr(Va,a))}function uA(n){Vm.current===n&&(en(Va),en(Vm))}var pn=Vl(0);function uy(n){for(var o=n;o!==null;){if(o.tag===13){var a=o.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var J0=[];function hA(){for(var n=0;n<J0.length;n++)J0[n]._workInProgressVersionPrimary=null;J0.length=0}var bS=Cc.ReactCurrentDispatcher,X0=Cc.ReactCurrentBatchConfig,Wd=0,mn=null,qn=null,ni=null,hy=!1,ym=!1,jm=0,roe=0;function bi(){throw Error(De(321))}function pA(n,o){if(o===null)return!1;for(var a=0;a<o.length&&a<n.length;a++)if(!ra(n[a],o[a]))return!1;return!0}function fA(n,o,a,d,p,_){if(Wd=_,mn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,bS.current=n===null||n.memoizedState===null?soe:aoe,n=a(d,p),ym){_=0;do{if(ym=!1,jm=0,25<=_)throw Error(De(301));_+=1,ni=qn=null,o.updateQueue=null,bS.current=coe,n=a(d,p)}while(ym)}if(bS.current=py,o=qn!==null&&qn.next!==null,Wd=0,ni=qn=mn=null,hy=!1,o)throw Error(De(300));return n}function mA(){var n=jm!==0;return jm=0,n}function ka(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ni===null?mn.memoizedState=ni=n:ni=ni.next=n,ni}function Cs(){if(qn===null){var n=mn.alternate;n=n!==null?n.memoizedState:null}else n=qn.next;var o=ni===null?mn.memoizedState:ni.next;if(o!==null)ni=o,qn=n;else{if(n===null)throw Error(De(310));qn=n,n={memoizedState:qn.memoizedState,baseState:qn.baseState,baseQueue:qn.baseQueue,queue:qn.queue,next:null},ni===null?mn.memoizedState=ni=n:ni=ni.next=n}return ni}function Bm(n,o){return typeof o=="function"?o(n):o}function $0(n){var o=Cs(),a=o.queue;if(a===null)throw Error(De(311));a.lastRenderedReducer=n;var d=qn,p=d.baseQueue,_=a.pending;if(_!==null){if(p!==null){var g=p.next;p.next=_.next,_.next=g}d.baseQueue=p=_,a.pending=null}if(p!==null){_=p.next,d=d.baseState;var C=g=null,R=null,D=_;do{var L=D.lane;if((Wd&L)===L)R!==null&&(R=R.next={lane:0,action:D.action,hasEagerState:D.hasEagerState,eagerState:D.eagerState,next:null}),d=D.hasEagerState?D.eagerState:n(d,D.action);else{var k={lane:L,action:D.action,hasEagerState:D.hasEagerState,eagerState:D.eagerState,next:null};R===null?(C=R=k,g=d):R=R.next=k,mn.lanes|=L,Gd|=L}D=D.next}while(D!==null&&D!==_);R===null?g=d:R.next=C,ra(d,o.memoizedState)||(ao=!0),o.memoizedState=d,o.baseState=g,o.baseQueue=R,a.lastRenderedState=d}if(n=a.interleaved,n!==null){p=n;do _=p.lane,mn.lanes|=_,Gd|=_,p=p.next;while(p!==n)}else p===null&&(a.lanes=0);return[o.memoizedState,a.dispatch]}function Q0(n){var o=Cs(),a=o.queue;if(a===null)throw Error(De(311));a.lastRenderedReducer=n;var d=a.dispatch,p=a.pending,_=o.memoizedState;if(p!==null){a.pending=null;var g=p=p.next;do _=n(_,g.action),g=g.next;while(g!==p);ra(_,o.memoizedState)||(ao=!0),o.memoizedState=_,o.baseQueue===null&&(o.baseState=_),a.lastRenderedState=_}return[_,d]}function O4(){}function N4(n,o){var a=mn,d=Cs(),p=o(),_=!ra(d.memoizedState,p);if(_&&(d.memoizedState=p,ao=!0),d=d.queue,_A(k4.bind(null,a,d,n),[n]),d.getSnapshot!==o||_||ni!==null&&ni.memoizedState.tag&1){if(a.flags|=2048,Wm(9,P4.bind(null,a,d,p,o),void 0,null),ii===null)throw Error(De(349));Wd&30||D4(a,o,p)}return p}function D4(n,o,a){n.flags|=16384,n={getSnapshot:o,value:a},o=mn.updateQueue,o===null?(o={lastEffect:null,stores:null},mn.updateQueue=o,o.stores=[n]):(a=o.stores,a===null?o.stores=[n]:a.push(n))}function P4(n,o,a,d){o.value=a,o.getSnapshot=d,L4(o)&&M4(n)}function k4(n,o,a){return a(function(){L4(o)&&M4(n)})}function L4(n){var o=n.getSnapshot;n=n.value;try{var a=o();return!ra(n,a)}catch{return!0}}function M4(n){var o=Sc(n,1);o!==null&&ta(o,n,1,-1)}function EB(n){var o=ka();return typeof n=="function"&&(n=n()),o.memoizedState=o.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bm,lastRenderedState:n},o.queue=n,n=n.dispatch=ooe.bind(null,mn,n),[o.memoizedState,n]}function Wm(n,o,a,d){return n={tag:n,create:o,destroy:a,deps:d,next:null},o=mn.updateQueue,o===null?(o={lastEffect:null,stores:null},mn.updateQueue=o,o.lastEffect=n.next=n):(a=o.lastEffect,a===null?o.lastEffect=n.next=n:(d=a.next,a.next=n,n.next=d,o.lastEffect=n)),n}function x4(){return Cs().memoizedState}function AS(n,o,a,d){var p=ka();mn.flags|=n,p.memoizedState=Wm(1|o,a,void 0,d===void 0?null:d)}function By(n,o,a,d){var p=Cs();d=d===void 0?null:d;var _=void 0;if(qn!==null){var g=qn.memoizedState;if(_=g.destroy,d!==null&&pA(d,g.deps)){p.memoizedState=Wm(o,a,_,d);return}}mn.flags|=n,p.memoizedState=Wm(1|o,a,_,d)}function gB(n,o){return AS(8390656,8,n,o)}function _A(n,o){return By(2048,8,n,o)}function U4(n,o){return By(4,2,n,o)}function V4(n,o){return By(4,4,n,o)}function F4(n,o){if(typeof o=="function")return n=n(),o(n),function(){o(null)};if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function j4(n,o,a){return a=a!=null?a.concat([n]):null,By(4,4,F4.bind(null,o,n),a)}function EA(){}function B4(n,o){var a=Cs();o=o===void 0?null:o;var d=a.memoizedState;return d!==null&&o!==null&&pA(o,d[1])?d[0]:(a.memoizedState=[n,o],n)}function W4(n,o){var a=Cs();o=o===void 0?null:o;var d=a.memoizedState;return d!==null&&o!==null&&pA(o,d[1])?d[0]:(n=n(),a.memoizedState=[n,o],n)}function G4(n,o,a){return Wd&21?(ra(a,o)||(a=Y5(),mn.lanes|=a,Gd|=a,n.baseState=!0),o):(n.baseState&&(n.baseState=!1,ao=!0),n.memoizedState=a)}function noe(n,o){var a=Ir;Ir=a!==0&&4>a?a:4,n(!0);var d=X0.transition;X0.transition={};try{n(!1),o()}finally{Ir=a,X0.transition=d}}function H4(){return Cs().memoizedState}function ioe(n,o,a){var d=Ol(n);if(a={lane:d,action:a,hasEagerState:!1,eagerState:null,next:null},K4(n))z4(o,a);else if(a=I4(n,o,a,d),a!==null){var p=Wi();ta(a,n,d,p),q4(a,o,d)}}function ooe(n,o,a){var d=Ol(n),p={lane:d,action:a,hasEagerState:!1,eagerState:null,next:null};if(K4(n))z4(o,p);else{var _=n.alternate;if(n.lanes===0&&(_===null||_.lanes===0)&&(_=o.lastRenderedReducer,_!==null))try{var g=o.lastRenderedState,C=_(g,a);if(p.hasEagerState=!0,p.eagerState=C,ra(C,g)){var R=o.interleaved;R===null?(p.next=p,cA(o)):(p.next=R.next,R.next=p),o.interleaved=p;return}}catch{}finally{}a=I4(n,o,p,d),a!==null&&(p=Wi(),ta(a,n,d,p),q4(a,o,d))}}function K4(n){var o=n.alternate;return n===mn||o!==null&&o===mn}function z4(n,o){ym=hy=!0;var a=n.pending;a===null?o.next=o:(o.next=a.next,a.next=o),n.pending=o}function q4(n,o,a){if(a&4194240){var d=o.lanes;d&=n.pendingLanes,a|=d,o.lanes=a,Yb(n,a)}}var py={readContext:Ts,useCallback:bi,useContext:bi,useEffect:bi,useImperativeHandle:bi,useInsertionEffect:bi,useLayoutEffect:bi,useMemo:bi,useReducer:bi,useRef:bi,useState:bi,useDebugValue:bi,useDeferredValue:bi,useTransition:bi,useMutableSource:bi,useSyncExternalStore:bi,useId:bi,unstable_isNewReconciler:!1},soe={readContext:Ts,useCallback:function(n,o){return ka().memoizedState=[n,o===void 0?null:o],n},useContext:Ts,useEffect:gB,useImperativeHandle:function(n,o,a){return a=a!=null?a.concat([n]):null,AS(4194308,4,F4.bind(null,o,n),a)},useLayoutEffect:function(n,o){return AS(4194308,4,n,o)},useInsertionEffect:function(n,o){return AS(4,2,n,o)},useMemo:function(n,o){var a=ka();return o=o===void 0?null:o,n=n(),a.memoizedState=[n,o],n},useReducer:function(n,o,a){var d=ka();return o=a!==void 0?a(o):o,d.memoizedState=d.baseState=o,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:o},d.queue=n,n=n.dispatch=ioe.bind(null,mn,n),[d.memoizedState,n]},useRef:function(n){var o=ka();return n={current:n},o.memoizedState=n},useState:EB,useDebugValue:EA,useDeferredValue:function(n){return ka().memoizedState=n},useTransition:function(){var n=EB(!1),o=n[0];return n=noe.bind(null,n[1]),ka().memoizedState=n,[o,n]},useMutableSource:function(){},useSyncExternalStore:function(n,o,a){var d=mn,p=ka();if(ln){if(a===void 0)throw Error(De(407));a=a()}else{if(a=o(),ii===null)throw Error(De(349));Wd&30||D4(d,o,a)}p.memoizedState=a;var _={value:a,getSnapshot:o};return p.queue=_,gB(k4.bind(null,d,_,n),[n]),d.flags|=2048,Wm(9,P4.bind(null,d,_,a,o),void 0,null),a},useId:function(){var n=ka(),o=ii.identifierPrefix;if(ln){var a=fc,d=pc;a=(d&~(1<<32-ea(d)-1)).toString(32)+a,o=":"+o+"R"+a,a=jm++,0<a&&(o+="H"+a.toString(32)),o+=":"}else a=roe++,o=":"+o+"r"+a.toString(32)+":";return n.memoizedState=o},unstable_isNewReconciler:!1},aoe={readContext:Ts,useCallback:B4,useContext:Ts,useEffect:_A,useImperativeHandle:j4,useInsertionEffect:U4,useLayoutEffect:V4,useMemo:W4,useReducer:$0,useRef:x4,useState:function(){return $0(Bm)},useDebugValue:EA,useDeferredValue:function(n){var o=Cs();return G4(o,qn.memoizedState,n)},useTransition:function(){var n=$0(Bm)[0],o=Cs().memoizedState;return[n,o]},useMutableSource:O4,useSyncExternalStore:N4,useId:H4,unstable_isNewReconciler:!1},coe={readContext:Ts,useCallback:B4,useContext:Ts,useEffect:_A,useImperativeHandle:j4,useInsertionEffect:U4,useLayoutEffect:V4,useMemo:W4,useReducer:Q0,useRef:x4,useState:function(){return Q0(Bm)},useDebugValue:EA,useDeferredValue:function(n){var o=Cs();return qn===null?o.memoizedState=n:G4(o,qn.memoizedState,n)},useTransition:function(){var n=Q0(Bm)[0],o=Cs().memoizedState;return[n,o]},useMutableSource:O4,useSyncExternalStore:N4,useId:H4,unstable_isNewReconciler:!1};function Ys(n,o){if(n&&n.defaultProps){o=_n({},o),n=n.defaultProps;for(var a in n)o[a]===void 0&&(o[a]=n[a]);return o}return o}function JI(n,o,a,d){o=n.memoizedState,a=a(d,o),a=a==null?o:_n({},o,a),n.memoizedState=a,n.lanes===0&&(n.updateQueue.baseState=a)}var Wy={isMounted:function(n){return(n=n._reactInternals)?Yd(n)===n:!1},enqueueSetState:function(n,o,a){n=n._reactInternals;var d=Wi(),p=Ol(n),_=_c(d,p);_.payload=o,a!=null&&(_.callback=a),o=bl(n,_,p),o!==null&&(ta(o,n,p,d),IS(o,n,p))},enqueueReplaceState:function(n,o,a){n=n._reactInternals;var d=Wi(),p=Ol(n),_=_c(d,p);_.tag=1,_.payload=o,a!=null&&(_.callback=a),o=bl(n,_,p),o!==null&&(ta(o,n,p,d),IS(o,n,p))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var a=Wi(),d=Ol(n),p=_c(a,d);p.tag=2,o!=null&&(p.callback=o),o=bl(n,p,d),o!==null&&(ta(o,n,d,a),IS(o,n,d))}};function SB(n,o,a,d,p,_,g){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(d,_,g):o.prototype&&o.prototype.isPureReactComponent?!Lm(a,d)||!Lm(p,_):!0}function Y4(n,o,a){var d=!1,p=kl,_=o.contextType;return typeof _=="object"&&_!==null?_=Ts(_):(p=lo(o)?jd:Pi.current,d=o.contextTypes,_=(d=d!=null)?qh(n,p):kl),o=new o(a,_),n.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Wy,n.stateNode=o,o._reactInternals=n,d&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=p,n.__reactInternalMemoizedMaskedChildContext=_),o}function yB(n,o,a,d){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(a,d),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(a,d),o.state!==n&&Wy.enqueueReplaceState(o,o.state,null)}function XI(n,o,a,d){var p=n.stateNode;p.props=a,p.state=n.memoizedState,p.refs={},lA(n);var _=o.contextType;typeof _=="object"&&_!==null?p.context=Ts(_):(_=lo(o)?jd:Pi.current,p.context=qh(n,_)),p.state=n.memoizedState,_=o.getDerivedStateFromProps,typeof _=="function"&&(JI(n,o,_,a),p.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(o=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),o!==p.state&&Wy.enqueueReplaceState(p,p.state,null),dy(n,a,p,d),p.state=n.memoizedState),typeof p.componentDidMount=="function"&&(n.flags|=4194308)}function $h(n,o){try{var a="",d=o;do a+=xne(d),d=d.return;while(d);var p=a}catch(_){p=`
Error generating stack: `+_.message+`
`+_.stack}return{value:n,source:o,stack:p,digest:null}}function Z0(n,o,a){return{value:n,source:null,stack:a??null,digest:o??null}}function $I(n,o){try{console.error(o.value)}catch(a){setTimeout(function(){throw a})}}var loe=typeof WeakMap=="function"?WeakMap:Map;function J4(n,o,a){a=_c(-1,a),a.tag=3,a.payload={element:null};var d=o.value;return a.callback=function(){my||(my=!0,ab=d),$I(n,o)},a}function X4(n,o,a){a=_c(-1,a),a.tag=3;var d=n.type.getDerivedStateFromError;if(typeof d=="function"){var p=o.value;a.payload=function(){return d(p)},a.callback=function(){$I(n,o)}}var _=n.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(a.callback=function(){$I(n,o),typeof d!="function"&&(Al===null?Al=new Set([this]):Al.add(this));var g=o.stack;this.componentDidCatch(o.value,{componentStack:g!==null?g:""})}),a}function vB(n,o,a){var d=n.pingCache;if(d===null){d=n.pingCache=new loe;var p=new Set;d.set(o,p)}else p=d.get(o),p===void 0&&(p=new Set,d.set(o,p));p.has(a)||(p.add(a),n=Coe.bind(null,n,o,a),o.then(n,n))}function TB(n){do{var o;if((o=n.tag===13)&&(o=n.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return n;n=n.return}while(n!==null);return null}function CB(n,o,a,d,p){return n.mode&1?(n.flags|=65536,n.lanes=p,n):(n===o?n.flags|=65536:(n.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(o=_c(-1,1),o.tag=2,bl(a,o,1))),a.lanes|=1),n)}var doe=Cc.ReactCurrentOwner,ao=!1;function Bi(n,o,a,d){o.child=n===null?w4(o,null,a,d):Jh(o,n.child,a,d)}function RB(n,o,a,d,p){a=a.render;var _=o.ref;return Bh(o,p),d=fA(n,o,a,d,_,p),a=mA(),n!==null&&!ao?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~p,yc(n,o,p)):(ln&&a&&rA(o),o.flags|=1,Bi(n,o,d,p),o.child)}function wB(n,o,a,d,p){if(n===null){var _=a.type;return typeof _=="function"&&!wA(_)&&_.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(o.tag=15,o.type=_,$4(n,o,_,d,p)):(n=PS(a.type,null,d,o,o.mode,p),n.ref=o.ref,n.return=o,o.child=n)}if(_=n.child,!(n.lanes&p)){var g=_.memoizedProps;if(a=a.compare,a=a!==null?a:Lm,a(g,d)&&n.ref===o.ref)return yc(n,o,p)}return o.flags|=1,n=Nl(_,d),n.ref=o.ref,n.return=o,o.child=n}function $4(n,o,a,d,p){if(n!==null){var _=n.memoizedProps;if(Lm(_,d)&&n.ref===o.ref)if(ao=!1,o.pendingProps=d=_,(n.lanes&p)!==0)n.flags&131072&&(ao=!0);else return o.lanes=n.lanes,yc(n,o,p)}return QI(n,o,a,d,p)}function Q4(n,o,a){var d=o.pendingProps,p=d.children,_=n!==null?n.memoizedState:null;if(d.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},zr(xh,bo),bo|=a;else{if(!(a&1073741824))return n=_!==null?_.baseLanes|a:a,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:n,cachePool:null,transitions:null},o.updateQueue=null,zr(xh,bo),bo|=n,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=_!==null?_.baseLanes:a,zr(xh,bo),bo|=d}else _!==null?(d=_.baseLanes|a,o.memoizedState=null):d=a,zr(xh,bo),bo|=d;return Bi(n,o,p,a),o.child}function Z4(n,o){var a=o.ref;(n===null&&a!==null||n!==null&&n.ref!==a)&&(o.flags|=512,o.flags|=2097152)}function QI(n,o,a,d,p){var _=lo(a)?jd:Pi.current;return _=qh(o,_),Bh(o,p),a=fA(n,o,a,d,_,p),d=mA(),n!==null&&!ao?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~p,yc(n,o,p)):(ln&&d&&rA(o),o.flags|=1,Bi(n,o,a,p),o.child)}function IB(n,o,a,d,p){if(lo(a)){var _=!0;oy(o)}else _=!1;if(Bh(o,p),o.stateNode===null)OS(n,o),Y4(o,a,d),XI(o,a,d,p),d=!0;else if(n===null){var g=o.stateNode,C=o.memoizedProps;g.props=C;var R=g.context,D=a.contextType;typeof D=="object"&&D!==null?D=Ts(D):(D=lo(a)?jd:Pi.current,D=qh(o,D));var L=a.getDerivedStateFromProps,k=typeof L=="function"||typeof g.getSnapshotBeforeUpdate=="function";k||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(C!==d||R!==D)&&yB(o,g,d,D),El=!1;var M=o.memoizedState;g.state=M,dy(o,d,g,p),R=o.memoizedState,C!==d||M!==R||co.current||El?(typeof L=="function"&&(JI(o,a,L,d),R=o.memoizedState),(C=El||SB(o,a,C,d,M,R,D))?(k||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(o.flags|=4194308)):(typeof g.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=d,o.memoizedState=R),g.props=d,g.state=R,g.context=D,d=C):(typeof g.componentDidMount=="function"&&(o.flags|=4194308),d=!1)}else{g=o.stateNode,b4(n,o),C=o.memoizedProps,D=o.type===o.elementType?C:Ys(o.type,C),g.props=D,k=o.pendingProps,M=g.context,R=a.contextType,typeof R=="object"&&R!==null?R=Ts(R):(R=lo(a)?jd:Pi.current,R=qh(o,R));var Y=a.getDerivedStateFromProps;(L=typeof Y=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(C!==k||M!==R)&&yB(o,g,d,R),El=!1,M=o.memoizedState,g.state=M,dy(o,d,g,p);var z=o.memoizedState;C!==k||M!==z||co.current||El?(typeof Y=="function"&&(JI(o,a,Y,d),z=o.memoizedState),(D=El||SB(o,a,D,d,M,z,R)||!1)?(L||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(d,z,R),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(d,z,R)),typeof g.componentDidUpdate=="function"&&(o.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof g.componentDidUpdate!="function"||C===n.memoizedProps&&M===n.memoizedState||(o.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||C===n.memoizedProps&&M===n.memoizedState||(o.flags|=1024),o.memoizedProps=d,o.memoizedState=z),g.props=d,g.state=z,g.context=R,d=D):(typeof g.componentDidUpdate!="function"||C===n.memoizedProps&&M===n.memoizedState||(o.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||C===n.memoizedProps&&M===n.memoizedState||(o.flags|=1024),d=!1)}return ZI(n,o,a,d,_,p)}function ZI(n,o,a,d,p,_){Z4(n,o);var g=(o.flags&128)!==0;if(!d&&!g)return p&&uB(o,a,!1),yc(n,o,_);d=o.stateNode,doe.current=o;var C=g&&typeof a.getDerivedStateFromError!="function"?null:d.render();return o.flags|=1,n!==null&&g?(o.child=Jh(o,n.child,null,_),o.child=Jh(o,null,C,_)):Bi(n,o,C,_),o.memoizedState=d.state,p&&uB(o,a,!0),o.child}function eW(n){var o=n.stateNode;o.pendingContext?dB(n,o.pendingContext,o.pendingContext!==o.context):o.context&&dB(n,o.context,!1),dA(n,o.containerInfo)}function bB(n,o,a,d,p){return Yh(),iA(p),o.flags|=256,Bi(n,o,a,d),o.child}var eb={dehydrated:null,treeContext:null,retryLane:0};function tb(n){return{baseLanes:n,cachePool:null,transitions:null}}function tW(n,o,a){var d=o.pendingProps,p=pn.current,_=!1,g=(o.flags&128)!==0,C;if((C=g)||(C=n!==null&&n.memoizedState===null?!1:(p&2)!==0),C?(_=!0,o.flags&=-129):(n===null||n.memoizedState!==null)&&(p|=1),zr(pn,p&1),n===null)return qI(o),n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(o.mode&1?n.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(g=d.children,n=d.fallback,_?(d=o.mode,_=o.child,g={mode:"hidden",children:g},!(d&1)&&_!==null?(_.childLanes=0,_.pendingProps=g):_=Ky(g,d,0,null),n=Vd(n,d,a,null),_.return=o,n.return=o,_.sibling=n,o.child=_,o.child.memoizedState=tb(a),o.memoizedState=eb,n):gA(o,g));if(p=n.memoizedState,p!==null&&(C=p.dehydrated,C!==null))return uoe(n,o,g,d,C,p,a);if(_){_=d.fallback,g=o.mode,p=n.child,C=p.sibling;var R={mode:"hidden",children:d.children};return!(g&1)&&o.child!==p?(d=o.child,d.childLanes=0,d.pendingProps=R,o.deletions=null):(d=Nl(p,R),d.subtreeFlags=p.subtreeFlags&14680064),C!==null?_=Nl(C,_):(_=Vd(_,g,a,null),_.flags|=2),_.return=o,d.return=o,d.sibling=_,o.child=d,d=_,_=o.child,g=n.child.memoizedState,g=g===null?tb(a):{baseLanes:g.baseLanes|a,cachePool:null,transitions:g.transitions},_.memoizedState=g,_.childLanes=n.childLanes&~a,o.memoizedState=eb,d}return _=n.child,n=_.sibling,d=Nl(_,{mode:"visible",children:d.children}),!(o.mode&1)&&(d.lanes=a),d.return=o,d.sibling=null,n!==null&&(a=o.deletions,a===null?(o.deletions=[n],o.flags|=16):a.push(n)),o.child=d,o.memoizedState=null,d}function gA(n,o){return o=Ky({mode:"visible",children:o},n.mode,0,null),o.return=n,n.child=o}function sS(n,o,a,d){return d!==null&&iA(d),Jh(o,n.child,null,a),n=gA(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function uoe(n,o,a,d,p,_,g){if(a)return o.flags&256?(o.flags&=-257,d=Z0(Error(De(422))),sS(n,o,g,d)):o.memoizedState!==null?(o.child=n.child,o.flags|=128,null):(_=d.fallback,p=o.mode,d=Ky({mode:"visible",children:d.children},p,0,null),_=Vd(_,p,g,null),_.flags|=2,d.return=o,_.return=o,d.sibling=_,o.child=d,o.mode&1&&Jh(o,n.child,null,g),o.child.memoizedState=tb(g),o.memoizedState=eb,_);if(!(o.mode&1))return sS(n,o,g,null);if(p.data==="$!"){if(d=p.nextSibling&&p.nextSibling.dataset,d)var C=d.dgst;return d=C,_=Error(De(419)),d=Z0(_,d,void 0),sS(n,o,g,d)}if(C=(g&n.childLanes)!==0,ao||C){if(d=ii,d!==null){switch(g&-g){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=p&(d.suspendedLanes|g)?0:p,p!==0&&p!==_.retryLane&&(_.retryLane=p,Sc(n,p),ta(d,n,p,-1))}return RA(),d=Z0(Error(De(421))),sS(n,o,g,d)}return p.data==="$?"?(o.flags|=128,o.child=n.child,o=Roe.bind(null,n),p._reactRetry=o,null):(n=_.treeContext,No=Il(p.nextSibling),Lo=o,ln=!0,Qs=null,n!==null&&(ms[_s++]=pc,ms[_s++]=fc,ms[_s++]=Bd,pc=n.id,fc=n.overflow,Bd=o),o=gA(o,d.children),o.flags|=4096,o)}function AB(n,o,a){n.lanes|=o;var d=n.alternate;d!==null&&(d.lanes|=o),YI(n.return,o,a)}function eI(n,o,a,d,p){var _=n.memoizedState;_===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:d,tail:a,tailMode:p}:(_.isBackwards=o,_.rendering=null,_.renderingStartTime=0,_.last=d,_.tail=a,_.tailMode=p)}function rW(n,o,a){var d=o.pendingProps,p=d.revealOrder,_=d.tail;if(Bi(n,o,d.children,a),d=pn.current,d&2)d=d&1|2,o.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&AB(n,a,o);else if(n.tag===19)AB(n,a,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}d&=1}if(zr(pn,d),!(o.mode&1))o.memoizedState=null;else switch(p){case"forwards":for(a=o.child,p=null;a!==null;)n=a.alternate,n!==null&&uy(n)===null&&(p=a),a=a.sibling;a=p,a===null?(p=o.child,o.child=null):(p=a.sibling,a.sibling=null),eI(o,!1,p,a,_);break;case"backwards":for(a=null,p=o.child,o.child=null;p!==null;){if(n=p.alternate,n!==null&&uy(n)===null){o.child=p;break}n=p.sibling,p.sibling=a,a=p,p=n}eI(o,!0,a,null,_);break;case"together":eI(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function OS(n,o){!(o.mode&1)&&n!==null&&(n.alternate=null,o.alternate=null,o.flags|=2)}function yc(n,o,a){if(n!==null&&(o.dependencies=n.dependencies),Gd|=o.lanes,!(a&o.childLanes))return null;if(n!==null&&o.child!==n.child)throw Error(De(153));if(o.child!==null){for(n=o.child,a=Nl(n,n.pendingProps),o.child=a,a.return=o;n.sibling!==null;)n=n.sibling,a=a.sibling=Nl(n,n.pendingProps),a.return=o;a.sibling=null}return o.child}function hoe(n,o,a){switch(o.tag){case 3:eW(o),Yh();break;case 5:A4(o);break;case 1:lo(o.type)&&oy(o);break;case 4:dA(o,o.stateNode.containerInfo);break;case 10:var d=o.type._context,p=o.memoizedProps.value;zr(cy,d._currentValue),d._currentValue=p;break;case 13:if(d=o.memoizedState,d!==null)return d.dehydrated!==null?(zr(pn,pn.current&1),o.flags|=128,null):a&o.child.childLanes?tW(n,o,a):(zr(pn,pn.current&1),n=yc(n,o,a),n!==null?n.sibling:null);zr(pn,pn.current&1);break;case 19:if(d=(a&o.childLanes)!==0,n.flags&128){if(d)return rW(n,o,a);o.flags|=128}if(p=o.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),zr(pn,pn.current),d)break;return null;case 22:case 23:return o.lanes=0,Q4(n,o,a)}return yc(n,o,a)}var nW,rb,iW,oW;nW=function(n,o){for(var a=o.child;a!==null;){if(a.tag===5||a.tag===6)n.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};rb=function(){};iW=function(n,o,a,d){var p=n.memoizedProps;if(p!==d){n=o.stateNode,Ld(Va.current);var _=null;switch(a){case"input":p=RI(n,p),d=RI(n,d),_=[];break;case"select":p=_n({},p,{value:void 0}),d=_n({},d,{value:void 0}),_=[];break;case"textarea":p=bI(n,p),d=bI(n,d),_=[];break;default:typeof p.onClick!="function"&&typeof d.onClick=="function"&&(n.onclick=ny)}OI(a,d);var g;a=null;for(D in p)if(!d.hasOwnProperty(D)&&p.hasOwnProperty(D)&&p[D]!=null)if(D==="style"){var C=p[D];for(g in C)C.hasOwnProperty(g)&&(a||(a={}),a[g]="")}else D!=="dangerouslySetInnerHTML"&&D!=="children"&&D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&D!=="autoFocus"&&(bm.hasOwnProperty(D)?_||(_=[]):(_=_||[]).push(D,null));for(D in d){var R=d[D];if(C=p!=null?p[D]:void 0,d.hasOwnProperty(D)&&R!==C&&(R!=null||C!=null))if(D==="style")if(C){for(g in C)!C.hasOwnProperty(g)||R&&R.hasOwnProperty(g)||(a||(a={}),a[g]="");for(g in R)R.hasOwnProperty(g)&&C[g]!==R[g]&&(a||(a={}),a[g]=R[g])}else a||(_||(_=[]),_.push(D,a)),a=R;else D==="dangerouslySetInnerHTML"?(R=R?R.__html:void 0,C=C?C.__html:void 0,R!=null&&C!==R&&(_=_||[]).push(D,R)):D==="children"?typeof R!="string"&&typeof R!="number"||(_=_||[]).push(D,""+R):D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&(bm.hasOwnProperty(D)?(R!=null&&D==="onScroll"&&Zr("scroll",n),_||C===R||(_=[])):(_=_||[]).push(D,R))}a&&(_=_||[]).push("style",a);var D=_;(o.updateQueue=D)&&(o.flags|=4)}};oW=function(n,o,a,d){a!==d&&(o.flags|=4)};function $f(n,o){if(!ln)switch(n.tailMode){case"hidden":o=n.tail;for(var a=null;o!==null;)o.alternate!==null&&(a=o),o=o.sibling;a===null?n.tail=null:a.sibling=null;break;case"collapsed":a=n.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:d.sibling=null}}function Ai(n){var o=n.alternate!==null&&n.alternate.child===n.child,a=0,d=0;if(o)for(var p=n.child;p!==null;)a|=p.lanes|p.childLanes,d|=p.subtreeFlags&14680064,d|=p.flags&14680064,p.return=n,p=p.sibling;else for(p=n.child;p!==null;)a|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=n,p=p.sibling;return n.subtreeFlags|=d,n.childLanes=a,o}function poe(n,o,a){var d=o.pendingProps;switch(nA(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ai(o),null;case 1:return lo(o.type)&&iy(),Ai(o),null;case 3:return d=o.stateNode,Xh(),en(co),en(Pi),hA(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(n===null||n.child===null)&&(iS(o)?o.flags|=4:n===null||n.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,Qs!==null&&(db(Qs),Qs=null))),rb(n,o),Ai(o),null;case 5:uA(o);var p=Ld(Fm.current);if(a=o.type,n!==null&&o.stateNode!=null)iW(n,o,a,d,p),n.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!d){if(o.stateNode===null)throw Error(De(166));return Ai(o),null}if(n=Ld(Va.current),iS(o)){d=o.stateNode,a=o.type;var _=o.memoizedProps;switch(d[xa]=o,d[Um]=_,n=(o.mode&1)!==0,a){case"dialog":Zr("cancel",d),Zr("close",d);break;case"iframe":case"object":case"embed":Zr("load",d);break;case"video":case"audio":for(p=0;p<lm.length;p++)Zr(lm[p],d);break;case"source":Zr("error",d);break;case"img":case"image":case"link":Zr("error",d),Zr("load",d);break;case"details":Zr("toggle",d);break;case"input":Uj(d,_),Zr("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!_.multiple},Zr("invalid",d);break;case"textarea":Fj(d,_),Zr("invalid",d)}OI(a,_),p=null;for(var g in _)if(_.hasOwnProperty(g)){var C=_[g];g==="children"?typeof C=="string"?d.textContent!==C&&(_.suppressHydrationWarning!==!0&&nS(d.textContent,C,n),p=["children",C]):typeof C=="number"&&d.textContent!==""+C&&(_.suppressHydrationWarning!==!0&&nS(d.textContent,C,n),p=["children",""+C]):bm.hasOwnProperty(g)&&C!=null&&g==="onScroll"&&Zr("scroll",d)}switch(a){case"input":Jg(d),Vj(d,_,!0);break;case"textarea":Jg(d),jj(d);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(d.onclick=ny)}d=p,o.updateQueue=d,d!==null&&(o.flags|=4)}else{g=p.nodeType===9?p:p.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=k5(a)),n==="http://www.w3.org/1999/xhtml"?a==="script"?(n=g.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof d.is=="string"?n=g.createElement(a,{is:d.is}):(n=g.createElement(a),a==="select"&&(g=n,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):n=g.createElementNS(n,a),n[xa]=o,n[Um]=d,nW(n,o,!1,!1),o.stateNode=n;e:{switch(g=NI(a,d),a){case"dialog":Zr("cancel",n),Zr("close",n),p=d;break;case"iframe":case"object":case"embed":Zr("load",n),p=d;break;case"video":case"audio":for(p=0;p<lm.length;p++)Zr(lm[p],n);p=d;break;case"source":Zr("error",n),p=d;break;case"img":case"image":case"link":Zr("error",n),Zr("load",n),p=d;break;case"details":Zr("toggle",n),p=d;break;case"input":Uj(n,d),p=RI(n,d),Zr("invalid",n);break;case"option":p=d;break;case"select":n._wrapperState={wasMultiple:!!d.multiple},p=_n({},d,{value:void 0}),Zr("invalid",n);break;case"textarea":Fj(n,d),p=bI(n,d),Zr("invalid",n);break;default:p=d}OI(a,p),C=p;for(_ in C)if(C.hasOwnProperty(_)){var R=C[_];_==="style"?x5(n,R):_==="dangerouslySetInnerHTML"?(R=R?R.__html:void 0,R!=null&&L5(n,R)):_==="children"?typeof R=="string"?(a!=="textarea"||R!=="")&&Am(n,R):typeof R=="number"&&Am(n,""+R):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(bm.hasOwnProperty(_)?R!=null&&_==="onScroll"&&Zr("scroll",n):R!=null&&Wb(n,_,R,g))}switch(a){case"input":Jg(n),Vj(n,d,!1);break;case"textarea":Jg(n),jj(n);break;case"option":d.value!=null&&n.setAttribute("value",""+Pl(d.value));break;case"select":n.multiple=!!d.multiple,_=d.value,_!=null?Uh(n,!!d.multiple,_,!1):d.defaultValue!=null&&Uh(n,!!d.multiple,d.defaultValue,!0);break;default:typeof p.onClick=="function"&&(n.onclick=ny)}switch(a){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return Ai(o),null;case 6:if(n&&o.stateNode!=null)oW(n,o,n.memoizedProps,d);else{if(typeof d!="string"&&o.stateNode===null)throw Error(De(166));if(a=Ld(Fm.current),Ld(Va.current),iS(o)){if(d=o.stateNode,a=o.memoizedProps,d[xa]=o,(_=d.nodeValue!==a)&&(n=Lo,n!==null))switch(n.tag){case 3:nS(d.nodeValue,a,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&nS(d.nodeValue,a,(n.mode&1)!==0)}_&&(o.flags|=4)}else d=(a.nodeType===9?a:a.ownerDocument).createTextNode(d),d[xa]=o,o.stateNode=d}return Ai(o),null;case 13:if(en(pn),d=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(ln&&No!==null&&o.mode&1&&!(o.flags&128))C4(),Yh(),o.flags|=98560,_=!1;else if(_=iS(o),d!==null&&d.dehydrated!==null){if(n===null){if(!_)throw Error(De(318));if(_=o.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(De(317));_[xa]=o}else Yh(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;Ai(o),_=!1}else Qs!==null&&(db(Qs),Qs=null),_=!0;if(!_)return o.flags&65536?o:null}return o.flags&128?(o.lanes=a,o):(d=d!==null,d!==(n!==null&&n.memoizedState!==null)&&d&&(o.child.flags|=8192,o.mode&1&&(n===null||pn.current&1?Yn===0&&(Yn=3):RA())),o.updateQueue!==null&&(o.flags|=4),Ai(o),null);case 4:return Xh(),rb(n,o),n===null&&Mm(o.stateNode.containerInfo),Ai(o),null;case 10:return aA(o.type._context),Ai(o),null;case 17:return lo(o.type)&&iy(),Ai(o),null;case 19:if(en(pn),_=o.memoizedState,_===null)return Ai(o),null;if(d=(o.flags&128)!==0,g=_.rendering,g===null)if(d)$f(_,!1);else{if(Yn!==0||n!==null&&n.flags&128)for(n=o.child;n!==null;){if(g=uy(n),g!==null){for(o.flags|=128,$f(_,!1),d=g.updateQueue,d!==null&&(o.updateQueue=d,o.flags|=4),o.subtreeFlags=0,d=a,a=o.child;a!==null;)_=a,n=d,_.flags&=14680066,g=_.alternate,g===null?(_.childLanes=0,_.lanes=n,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=g.childLanes,_.lanes=g.lanes,_.child=g.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=g.memoizedProps,_.memoizedState=g.memoizedState,_.updateQueue=g.updateQueue,_.type=g.type,n=g.dependencies,_.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),a=a.sibling;return zr(pn,pn.current&1|2),o.child}n=n.sibling}_.tail!==null&&Nn()>Qh&&(o.flags|=128,d=!0,$f(_,!1),o.lanes=4194304)}else{if(!d)if(n=uy(g),n!==null){if(o.flags|=128,d=!0,a=n.updateQueue,a!==null&&(o.updateQueue=a,o.flags|=4),$f(_,!0),_.tail===null&&_.tailMode==="hidden"&&!g.alternate&&!ln)return Ai(o),null}else 2*Nn()-_.renderingStartTime>Qh&&a!==1073741824&&(o.flags|=128,d=!0,$f(_,!1),o.lanes=4194304);_.isBackwards?(g.sibling=o.child,o.child=g):(a=_.last,a!==null?a.sibling=g:o.child=g,_.last=g)}return _.tail!==null?(o=_.tail,_.rendering=o,_.tail=o.sibling,_.renderingStartTime=Nn(),o.sibling=null,a=pn.current,zr(pn,d?a&1|2:a&1),o):(Ai(o),null);case 22:case 23:return CA(),d=o.memoizedState!==null,n!==null&&n.memoizedState!==null!==d&&(o.flags|=8192),d&&o.mode&1?bo&1073741824&&(Ai(o),o.subtreeFlags&6&&(o.flags|=8192)):Ai(o),null;case 24:return null;case 25:return null}throw Error(De(156,o.tag))}function foe(n,o){switch(nA(o),o.tag){case 1:return lo(o.type)&&iy(),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return Xh(),en(co),en(Pi),hA(),n=o.flags,n&65536&&!(n&128)?(o.flags=n&-65537|128,o):null;case 5:return uA(o),null;case 13:if(en(pn),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error(De(340));Yh()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return en(pn),null;case 4:return Xh(),null;case 10:return aA(o.type._context),null;case 22:case 23:return CA(),null;case 24:return null;default:return null}}var aS=!1,Ni=!1,moe=typeof WeakSet=="function"?WeakSet:Set,Ke=null;function Mh(n,o){var a=n.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(d){In(n,o,d)}else a.current=null}function nb(n,o,a){try{a()}catch(d){In(n,o,d)}}var OB=!1;function _oe(n,o){if(jI=ey,n=d4(),tA(n)){if("selectionStart"in n)var a={start:n.selectionStart,end:n.selectionEnd};else e:{a=(a=n.ownerDocument)&&a.defaultView||window;var d=a.getSelection&&a.getSelection();if(d&&d.rangeCount!==0){a=d.anchorNode;var p=d.anchorOffset,_=d.focusNode;d=d.focusOffset;try{a.nodeType,_.nodeType}catch{a=null;break e}var g=0,C=-1,R=-1,D=0,L=0,k=n,M=null;t:for(;;){for(var Y;k!==a||p!==0&&k.nodeType!==3||(C=g+p),k!==_||d!==0&&k.nodeType!==3||(R=g+d),k.nodeType===3&&(g+=k.nodeValue.length),(Y=k.firstChild)!==null;)M=k,k=Y;for(;;){if(k===n)break t;if(M===a&&++D===p&&(C=g),M===_&&++L===d&&(R=g),(Y=k.nextSibling)!==null)break;k=M,M=k.parentNode}k=Y}a=C===-1||R===-1?null:{start:C,end:R}}else a=null}a=a||{start:0,end:0}}else a=null;for(BI={focusedElem:n,selectionRange:a},ey=!1,Ke=o;Ke!==null;)if(o=Ke,n=o.child,(o.subtreeFlags&1028)!==0&&n!==null)n.return=o,Ke=n;else for(;Ke!==null;){o=Ke;try{var z=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(z!==null){var V=z.memoizedProps,Q=z.memoizedState,G=o.stateNode,B=G.getSnapshotBeforeUpdate(o.elementType===o.type?V:Ys(o.type,V),Q);G.__reactInternalSnapshotBeforeUpdate=B}break;case 3:var q=o.stateNode.containerInfo;q.nodeType===1?q.textContent="":q.nodeType===9&&q.documentElement&&q.removeChild(q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(De(163))}}catch(se){In(o,o.return,se)}if(n=o.sibling,n!==null){n.return=o.return,Ke=n;break}Ke=o.return}return z=OB,OB=!1,z}function vm(n,o,a){var d=o.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var p=d=d.next;do{if((p.tag&n)===n){var _=p.destroy;p.destroy=void 0,_!==void 0&&nb(o,a,_)}p=p.next}while(p!==d)}}function Gy(n,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var a=o=o.next;do{if((a.tag&n)===n){var d=a.create;a.destroy=d()}a=a.next}while(a!==o)}}function ib(n){var o=n.ref;if(o!==null){var a=n.stateNode;switch(n.tag){case 5:n=a;break;default:n=a}typeof o=="function"?o(n):o.current=n}}function sW(n){var o=n.alternate;o!==null&&(n.alternate=null,sW(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&(delete o[xa],delete o[Um],delete o[HI],delete o[Qie],delete o[Zie])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function aW(n){return n.tag===5||n.tag===3||n.tag===4}function NB(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||aW(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function ob(n,o,a){var d=n.tag;if(d===5||d===6)n=n.stateNode,o?a.nodeType===8?a.parentNode.insertBefore(n,o):a.insertBefore(n,o):(a.nodeType===8?(o=a.parentNode,o.insertBefore(n,a)):(o=a,o.appendChild(n)),a=a._reactRootContainer,a!=null||o.onclick!==null||(o.onclick=ny));else if(d!==4&&(n=n.child,n!==null))for(ob(n,o,a),n=n.sibling;n!==null;)ob(n,o,a),n=n.sibling}function sb(n,o,a){var d=n.tag;if(d===5||d===6)n=n.stateNode,o?a.insertBefore(n,o):a.appendChild(n);else if(d!==4&&(n=n.child,n!==null))for(sb(n,o,a),n=n.sibling;n!==null;)sb(n,o,a),n=n.sibling}var ui=null,Js=!1;function fl(n,o,a){for(a=a.child;a!==null;)cW(n,o,a),a=a.sibling}function cW(n,o,a){if(Ua&&typeof Ua.onCommitFiberUnmount=="function")try{Ua.onCommitFiberUnmount(My,a)}catch{}switch(a.tag){case 5:Ni||Mh(a,o);case 6:var d=ui,p=Js;ui=null,fl(n,o,a),ui=d,Js=p,ui!==null&&(Js?(n=ui,a=a.stateNode,n.nodeType===8?n.parentNode.removeChild(a):n.removeChild(a)):ui.removeChild(a.stateNode));break;case 18:ui!==null&&(Js?(n=ui,a=a.stateNode,n.nodeType===8?q0(n.parentNode,a):n.nodeType===1&&q0(n,a),Pm(n)):q0(ui,a.stateNode));break;case 4:d=ui,p=Js,ui=a.stateNode.containerInfo,Js=!0,fl(n,o,a),ui=d,Js=p;break;case 0:case 11:case 14:case 15:if(!Ni&&(d=a.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){p=d=d.next;do{var _=p,g=_.destroy;_=_.tag,g!==void 0&&(_&2||_&4)&&nb(a,o,g),p=p.next}while(p!==d)}fl(n,o,a);break;case 1:if(!Ni&&(Mh(a,o),d=a.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=a.memoizedProps,d.state=a.memoizedState,d.componentWillUnmount()}catch(C){In(a,o,C)}fl(n,o,a);break;case 21:fl(n,o,a);break;case 22:a.mode&1?(Ni=(d=Ni)||a.memoizedState!==null,fl(n,o,a),Ni=d):fl(n,o,a);break;default:fl(n,o,a)}}function DB(n){var o=n.updateQueue;if(o!==null){n.updateQueue=null;var a=n.stateNode;a===null&&(a=n.stateNode=new moe),o.forEach(function(d){var p=woe.bind(null,n,d);a.has(d)||(a.add(d),d.then(p,p))})}}function qs(n,o){var a=o.deletions;if(a!==null)for(var d=0;d<a.length;d++){var p=a[d];try{var _=n,g=o,C=g;e:for(;C!==null;){switch(C.tag){case 5:ui=C.stateNode,Js=!1;break e;case 3:ui=C.stateNode.containerInfo,Js=!0;break e;case 4:ui=C.stateNode.containerInfo,Js=!0;break e}C=C.return}if(ui===null)throw Error(De(160));cW(_,g,p),ui=null,Js=!1;var R=p.alternate;R!==null&&(R.return=null),p.return=null}catch(D){In(p,o,D)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)lW(o,n),o=o.sibling}function lW(n,o){var a=n.alternate,d=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(qs(o,n),Pa(n),d&4){try{vm(3,n,n.return),Gy(3,n)}catch(V){In(n,n.return,V)}try{vm(5,n,n.return)}catch(V){In(n,n.return,V)}}break;case 1:qs(o,n),Pa(n),d&512&&a!==null&&Mh(a,a.return);break;case 5:if(qs(o,n),Pa(n),d&512&&a!==null&&Mh(a,a.return),n.flags&32){var p=n.stateNode;try{Am(p,"")}catch(V){In(n,n.return,V)}}if(d&4&&(p=n.stateNode,p!=null)){var _=n.memoizedProps,g=a!==null?a.memoizedProps:_,C=n.type,R=n.updateQueue;if(n.updateQueue=null,R!==null)try{C==="input"&&_.type==="radio"&&_.name!=null&&D5(p,_),NI(C,g);var D=NI(C,_);for(g=0;g<R.length;g+=2){var L=R[g],k=R[g+1];L==="style"?x5(p,k):L==="dangerouslySetInnerHTML"?L5(p,k):L==="children"?Am(p,k):Wb(p,L,k,D)}switch(C){case"input":wI(p,_);break;case"textarea":P5(p,_);break;case"select":var M=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!_.multiple;var Y=_.value;Y!=null?Uh(p,!!_.multiple,Y,!1):M!==!!_.multiple&&(_.defaultValue!=null?Uh(p,!!_.multiple,_.defaultValue,!0):Uh(p,!!_.multiple,_.multiple?[]:"",!1))}p[Um]=_}catch(V){In(n,n.return,V)}}break;case 6:if(qs(o,n),Pa(n),d&4){if(n.stateNode===null)throw Error(De(162));p=n.stateNode,_=n.memoizedProps;try{p.nodeValue=_}catch(V){In(n,n.return,V)}}break;case 3:if(qs(o,n),Pa(n),d&4&&a!==null&&a.memoizedState.isDehydrated)try{Pm(o.containerInfo)}catch(V){In(n,n.return,V)}break;case 4:qs(o,n),Pa(n);break;case 13:qs(o,n),Pa(n),p=n.child,p.flags&8192&&(_=p.memoizedState!==null,p.stateNode.isHidden=_,!_||p.alternate!==null&&p.alternate.memoizedState!==null||(vA=Nn())),d&4&&DB(n);break;case 22:if(L=a!==null&&a.memoizedState!==null,n.mode&1?(Ni=(D=Ni)||L,qs(o,n),Ni=D):qs(o,n),Pa(n),d&8192){if(D=n.memoizedState!==null,(n.stateNode.isHidden=D)&&!L&&n.mode&1)for(Ke=n,L=n.child;L!==null;){for(k=Ke=L;Ke!==null;){switch(M=Ke,Y=M.child,M.tag){case 0:case 11:case 14:case 15:vm(4,M,M.return);break;case 1:Mh(M,M.return);var z=M.stateNode;if(typeof z.componentWillUnmount=="function"){d=M,a=M.return;try{o=d,z.props=o.memoizedProps,z.state=o.memoizedState,z.componentWillUnmount()}catch(V){In(d,a,V)}}break;case 5:Mh(M,M.return);break;case 22:if(M.memoizedState!==null){kB(k);continue}}Y!==null?(Y.return=M,Ke=Y):kB(k)}L=L.sibling}e:for(L=null,k=n;;){if(k.tag===5){if(L===null){L=k;try{p=k.stateNode,D?(_=p.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(C=k.stateNode,R=k.memoizedProps.style,g=R!=null&&R.hasOwnProperty("display")?R.display:null,C.style.display=M5("display",g))}catch(V){In(n,n.return,V)}}}else if(k.tag===6){if(L===null)try{k.stateNode.nodeValue=D?"":k.memoizedProps}catch(V){In(n,n.return,V)}}else if((k.tag!==22&&k.tag!==23||k.memoizedState===null||k===n)&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===n)break e;for(;k.sibling===null;){if(k.return===null||k.return===n)break e;L===k&&(L=null),k=k.return}L===k&&(L=null),k.sibling.return=k.return,k=k.sibling}}break;case 19:qs(o,n),Pa(n),d&4&&DB(n);break;case 21:break;default:qs(o,n),Pa(n)}}function Pa(n){var o=n.flags;if(o&2){try{e:{for(var a=n.return;a!==null;){if(aW(a)){var d=a;break e}a=a.return}throw Error(De(160))}switch(d.tag){case 5:var p=d.stateNode;d.flags&32&&(Am(p,""),d.flags&=-33);var _=NB(n);sb(n,_,p);break;case 3:case 4:var g=d.stateNode.containerInfo,C=NB(n);ob(n,C,g);break;default:throw Error(De(161))}}catch(R){In(n,n.return,R)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function Eoe(n,o,a){Ke=n,dW(n)}function dW(n,o,a){for(var d=(n.mode&1)!==0;Ke!==null;){var p=Ke,_=p.child;if(p.tag===22&&d){var g=p.memoizedState!==null||aS;if(!g){var C=p.alternate,R=C!==null&&C.memoizedState!==null||Ni;C=aS;var D=Ni;if(aS=g,(Ni=R)&&!D)for(Ke=p;Ke!==null;)g=Ke,R=g.child,g.tag===22&&g.memoizedState!==null?LB(p):R!==null?(R.return=g,Ke=R):LB(p);for(;_!==null;)Ke=_,dW(_),_=_.sibling;Ke=p,aS=C,Ni=D}PB(n)}else p.subtreeFlags&8772&&_!==null?(_.return=p,Ke=_):PB(n)}}function PB(n){for(;Ke!==null;){var o=Ke;if(o.flags&8772){var a=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Ni||Gy(5,o);break;case 1:var d=o.stateNode;if(o.flags&4&&!Ni)if(a===null)d.componentDidMount();else{var p=o.elementType===o.type?a.memoizedProps:Ys(o.type,a.memoizedProps);d.componentDidUpdate(p,a.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var _=o.updateQueue;_!==null&&_B(o,_,d);break;case 3:var g=o.updateQueue;if(g!==null){if(a=null,o.child!==null)switch(o.child.tag){case 5:a=o.child.stateNode;break;case 1:a=o.child.stateNode}_B(o,g,a)}break;case 5:var C=o.stateNode;if(a===null&&o.flags&4){a=C;var R=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":R.autoFocus&&a.focus();break;case"img":R.src&&(a.src=R.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var D=o.alternate;if(D!==null){var L=D.memoizedState;if(L!==null){var k=L.dehydrated;k!==null&&Pm(k)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(De(163))}Ni||o.flags&512&&ib(o)}catch(M){In(o,o.return,M)}}if(o===n){Ke=null;break}if(a=o.sibling,a!==null){a.return=o.return,Ke=a;break}Ke=o.return}}function kB(n){for(;Ke!==null;){var o=Ke;if(o===n){Ke=null;break}var a=o.sibling;if(a!==null){a.return=o.return,Ke=a;break}Ke=o.return}}function LB(n){for(;Ke!==null;){var o=Ke;try{switch(o.tag){case 0:case 11:case 15:var a=o.return;try{Gy(4,o)}catch(R){In(o,a,R)}break;case 1:var d=o.stateNode;if(typeof d.componentDidMount=="function"){var p=o.return;try{d.componentDidMount()}catch(R){In(o,p,R)}}var _=o.return;try{ib(o)}catch(R){In(o,_,R)}break;case 5:var g=o.return;try{ib(o)}catch(R){In(o,g,R)}}}catch(R){In(o,o.return,R)}if(o===n){Ke=null;break}var C=o.sibling;if(C!==null){C.return=o.return,Ke=C;break}Ke=o.return}}var goe=Math.ceil,fy=Cc.ReactCurrentDispatcher,SA=Cc.ReactCurrentOwner,ys=Cc.ReactCurrentBatchConfig,cr=0,ii=null,Vn=null,pi=0,bo=0,xh=Vl(0),Yn=0,Gm=null,Gd=0,Hy=0,yA=0,Tm=null,so=null,vA=0,Qh=1/0,dc=null,my=!1,ab=null,Al=null,cS=!1,Tl=null,_y=0,Cm=0,cb=null,NS=-1,DS=0;function Wi(){return cr&6?Nn():NS!==-1?NS:NS=Nn()}function Ol(n){return n.mode&1?cr&2&&pi!==0?pi&-pi:toe.transition!==null?(DS===0&&(DS=Y5()),DS):(n=Ir,n!==0||(n=window.event,n=n===void 0?16:t4(n.type)),n):1}function ta(n,o,a,d){if(50<Cm)throw Cm=0,cb=null,Error(De(185));e_(n,a,d),(!(cr&2)||n!==ii)&&(n===ii&&(!(cr&2)&&(Hy|=a),Yn===4&&Sl(n,pi)),uo(n,d),a===1&&cr===0&&!(o.mode&1)&&(Qh=Nn()+500,jy&&Fl()))}function uo(n,o){var a=n.callbackNode;tie(n,o);var d=ZS(n,n===ii?pi:0);if(d===0)a!==null&&Gj(a),n.callbackNode=null,n.callbackPriority=0;else if(o=d&-d,n.callbackPriority!==o){if(a!=null&&Gj(a),o===1)n.tag===0?eoe(MB.bind(null,n)):y4(MB.bind(null,n)),Xie(function(){!(cr&6)&&Fl()}),a=null;else{switch(J5(d)){case 1:a=qb;break;case 4:a=z5;break;case 16:a=QS;break;case 536870912:a=q5;break;default:a=QS}a=gW(a,uW.bind(null,n))}n.callbackPriority=o,n.callbackNode=a}}function uW(n,o){if(NS=-1,DS=0,cr&6)throw Error(De(327));var a=n.callbackNode;if(Wh()&&n.callbackNode!==a)return null;var d=ZS(n,n===ii?pi:0);if(d===0)return null;if(d&30||d&n.expiredLanes||o)o=Ey(n,d);else{o=d;var p=cr;cr|=2;var _=pW();(ii!==n||pi!==o)&&(dc=null,Qh=Nn()+500,Ud(n,o));do try{voe();break}catch(C){hW(n,C)}while(!0);sA(),fy.current=_,cr=p,Vn!==null?o=0:(ii=null,pi=0,o=Yn)}if(o!==0){if(o===2&&(p=MI(n),p!==0&&(d=p,o=lb(n,p))),o===1)throw a=Gm,Ud(n,0),Sl(n,d),uo(n,Nn()),a;if(o===6)Sl(n,d);else{if(p=n.current.alternate,!(d&30)&&!Soe(p)&&(o=Ey(n,d),o===2&&(_=MI(n),_!==0&&(d=_,o=lb(n,_))),o===1))throw a=Gm,Ud(n,0),Sl(n,d),uo(n,Nn()),a;switch(n.finishedWork=p,n.finishedLanes=d,o){case 0:case 1:throw Error(De(345));case 2:Od(n,so,dc);break;case 3:if(Sl(n,d),(d&130023424)===d&&(o=vA+500-Nn(),10<o)){if(ZS(n,0)!==0)break;if(p=n.suspendedLanes,(p&d)!==d){Wi(),n.pingedLanes|=n.suspendedLanes&p;break}n.timeoutHandle=GI(Od.bind(null,n,so,dc),o);break}Od(n,so,dc);break;case 4:if(Sl(n,d),(d&4194240)===d)break;for(o=n.eventTimes,p=-1;0<d;){var g=31-ea(d);_=1<<g,g=o[g],g>p&&(p=g),d&=~_}if(d=p,d=Nn()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*goe(d/1960))-d,10<d){n.timeoutHandle=GI(Od.bind(null,n,so,dc),d);break}Od(n,so,dc);break;case 5:Od(n,so,dc);break;default:throw Error(De(329))}}}return uo(n,Nn()),n.callbackNode===a?uW.bind(null,n):null}function lb(n,o){var a=Tm;return n.current.memoizedState.isDehydrated&&(Ud(n,o).flags|=256),n=Ey(n,o),n!==2&&(o=so,so=a,o!==null&&db(o)),n}function db(n){so===null?so=n:so.push.apply(so,n)}function Soe(n){for(var o=n;;){if(o.flags&16384){var a=o.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var d=0;d<a.length;d++){var p=a[d],_=p.getSnapshot;p=p.value;try{if(!ra(_(),p))return!1}catch{return!1}}}if(a=o.child,o.subtreeFlags&16384&&a!==null)a.return=o,o=a;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Sl(n,o){for(o&=~yA,o&=~Hy,n.suspendedLanes|=o,n.pingedLanes&=~o,n=n.expirationTimes;0<o;){var a=31-ea(o),d=1<<a;n[a]=-1,o&=~d}}function MB(n){if(cr&6)throw Error(De(327));Wh();var o=ZS(n,0);if(!(o&1))return uo(n,Nn()),null;var a=Ey(n,o);if(n.tag!==0&&a===2){var d=MI(n);d!==0&&(o=d,a=lb(n,d))}if(a===1)throw a=Gm,Ud(n,0),Sl(n,o),uo(n,Nn()),a;if(a===6)throw Error(De(345));return n.finishedWork=n.current.alternate,n.finishedLanes=o,Od(n,so,dc),uo(n,Nn()),null}function TA(n,o){var a=cr;cr|=1;try{return n(o)}finally{cr=a,cr===0&&(Qh=Nn()+500,jy&&Fl())}}function Hd(n){Tl!==null&&Tl.tag===0&&!(cr&6)&&Wh();var o=cr;cr|=1;var a=ys.transition,d=Ir;try{if(ys.transition=null,Ir=1,n)return n()}finally{Ir=d,ys.transition=a,cr=o,!(cr&6)&&Fl()}}function CA(){bo=xh.current,en(xh)}function Ud(n,o){n.finishedWork=null,n.finishedLanes=0;var a=n.timeoutHandle;if(a!==-1&&(n.timeoutHandle=-1,Jie(a)),Vn!==null)for(a=Vn.return;a!==null;){var d=a;switch(nA(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&iy();break;case 3:Xh(),en(co),en(Pi),hA();break;case 5:uA(d);break;case 4:Xh();break;case 13:en(pn);break;case 19:en(pn);break;case 10:aA(d.type._context);break;case 22:case 23:CA()}a=a.return}if(ii=n,Vn=n=Nl(n.current,null),pi=bo=o,Yn=0,Gm=null,yA=Hy=Gd=0,so=Tm=null,kd!==null){for(o=0;o<kd.length;o++)if(a=kd[o],d=a.interleaved,d!==null){a.interleaved=null;var p=d.next,_=a.pending;if(_!==null){var g=_.next;_.next=p,d.next=g}a.pending=d}kd=null}return n}function hW(n,o){do{var a=Vn;try{if(sA(),bS.current=py,hy){for(var d=mn.memoizedState;d!==null;){var p=d.queue;p!==null&&(p.pending=null),d=d.next}hy=!1}if(Wd=0,ni=qn=mn=null,ym=!1,jm=0,SA.current=null,a===null||a.return===null){Yn=1,Gm=o,Vn=null;break}e:{var _=n,g=a.return,C=a,R=o;if(o=pi,C.flags|=32768,R!==null&&typeof R=="object"&&typeof R.then=="function"){var D=R,L=C,k=L.tag;if(!(L.mode&1)&&(k===0||k===11||k===15)){var M=L.alternate;M?(L.updateQueue=M.updateQueue,L.memoizedState=M.memoizedState,L.lanes=M.lanes):(L.updateQueue=null,L.memoizedState=null)}var Y=TB(g);if(Y!==null){Y.flags&=-257,CB(Y,g,C,_,o),Y.mode&1&&vB(_,D,o),o=Y,R=D;var z=o.updateQueue;if(z===null){var V=new Set;V.add(R),o.updateQueue=V}else z.add(R);break e}else{if(!(o&1)){vB(_,D,o),RA();break e}R=Error(De(426))}}else if(ln&&C.mode&1){var Q=TB(g);if(Q!==null){!(Q.flags&65536)&&(Q.flags|=256),CB(Q,g,C,_,o),iA($h(R,C));break e}}_=R=$h(R,C),Yn!==4&&(Yn=2),Tm===null?Tm=[_]:Tm.push(_),_=g;do{switch(_.tag){case 3:_.flags|=65536,o&=-o,_.lanes|=o;var G=J4(_,R,o);mB(_,G);break e;case 1:C=R;var B=_.type,q=_.stateNode;if(!(_.flags&128)&&(typeof B.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Al===null||!Al.has(q)))){_.flags|=65536,o&=-o,_.lanes|=o;var se=X4(_,C,o);mB(_,se);break e}}_=_.return}while(_!==null)}mW(a)}catch(ue){o=ue,Vn===a&&a!==null&&(Vn=a=a.return);continue}break}while(!0)}function pW(){var n=fy.current;return fy.current=py,n===null?py:n}function RA(){(Yn===0||Yn===3||Yn===2)&&(Yn=4),ii===null||!(Gd&268435455)&&!(Hy&268435455)||Sl(ii,pi)}function Ey(n,o){var a=cr;cr|=2;var d=pW();(ii!==n||pi!==o)&&(dc=null,Ud(n,o));do try{yoe();break}catch(p){hW(n,p)}while(!0);if(sA(),cr=a,fy.current=d,Vn!==null)throw Error(De(261));return ii=null,pi=0,Yn}function yoe(){for(;Vn!==null;)fW(Vn)}function voe(){for(;Vn!==null&&!zne();)fW(Vn)}function fW(n){var o=EW(n.alternate,n,bo);n.memoizedProps=n.pendingProps,o===null?mW(n):Vn=o,SA.current=null}function mW(n){var o=n;do{var a=o.alternate;if(n=o.return,o.flags&32768){if(a=foe(a,o),a!==null){a.flags&=32767,Vn=a;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Yn=6,Vn=null;return}}else if(a=poe(a,o,bo),a!==null){Vn=a;return}if(o=o.sibling,o!==null){Vn=o;return}Vn=o=n}while(o!==null);Yn===0&&(Yn=5)}function Od(n,o,a){var d=Ir,p=ys.transition;try{ys.transition=null,Ir=1,Toe(n,o,a,d)}finally{ys.transition=p,Ir=d}return null}function Toe(n,o,a,d){do Wh();while(Tl!==null);if(cr&6)throw Error(De(327));a=n.finishedWork;var p=n.finishedLanes;if(a===null)return null;if(n.finishedWork=null,n.finishedLanes=0,a===n.current)throw Error(De(177));n.callbackNode=null,n.callbackPriority=0;var _=a.lanes|a.childLanes;if(rie(n,_),n===ii&&(Vn=ii=null,pi=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||cS||(cS=!0,gW(QS,function(){return Wh(),null})),_=(a.flags&15990)!==0,a.subtreeFlags&15990||_){_=ys.transition,ys.transition=null;var g=Ir;Ir=1;var C=cr;cr|=4,SA.current=null,_oe(n,a),lW(a,n),Wie(BI),ey=!!jI,BI=jI=null,n.current=a,Eoe(a),qne(),cr=C,Ir=g,ys.transition=_}else n.current=a;if(cS&&(cS=!1,Tl=n,_y=p),_=n.pendingLanes,_===0&&(Al=null),Xne(a.stateNode),uo(n,Nn()),o!==null)for(d=n.onRecoverableError,a=0;a<o.length;a++)p=o[a],d(p.value,{componentStack:p.stack,digest:p.digest});if(my)throw my=!1,n=ab,ab=null,n;return _y&1&&n.tag!==0&&Wh(),_=n.pendingLanes,_&1?n===cb?Cm++:(Cm=0,cb=n):Cm=0,Fl(),null}function Wh(){if(Tl!==null){var n=J5(_y),o=ys.transition,a=Ir;try{if(ys.transition=null,Ir=16>n?16:n,Tl===null)var d=!1;else{if(n=Tl,Tl=null,_y=0,cr&6)throw Error(De(331));var p=cr;for(cr|=4,Ke=n.current;Ke!==null;){var _=Ke,g=_.child;if(Ke.flags&16){var C=_.deletions;if(C!==null){for(var R=0;R<C.length;R++){var D=C[R];for(Ke=D;Ke!==null;){var L=Ke;switch(L.tag){case 0:case 11:case 15:vm(8,L,_)}var k=L.child;if(k!==null)k.return=L,Ke=k;else for(;Ke!==null;){L=Ke;var M=L.sibling,Y=L.return;if(sW(L),L===D){Ke=null;break}if(M!==null){M.return=Y,Ke=M;break}Ke=Y}}}var z=_.alternate;if(z!==null){var V=z.child;if(V!==null){z.child=null;do{var Q=V.sibling;V.sibling=null,V=Q}while(V!==null)}}Ke=_}}if(_.subtreeFlags&2064&&g!==null)g.return=_,Ke=g;else e:for(;Ke!==null;){if(_=Ke,_.flags&2048)switch(_.tag){case 0:case 11:case 15:vm(9,_,_.return)}var G=_.sibling;if(G!==null){G.return=_.return,Ke=G;break e}Ke=_.return}}var B=n.current;for(Ke=B;Ke!==null;){g=Ke;var q=g.child;if(g.subtreeFlags&2064&&q!==null)q.return=g,Ke=q;else e:for(g=B;Ke!==null;){if(C=Ke,C.flags&2048)try{switch(C.tag){case 0:case 11:case 15:Gy(9,C)}}catch(ue){In(C,C.return,ue)}if(C===g){Ke=null;break e}var se=C.sibling;if(se!==null){se.return=C.return,Ke=se;break e}Ke=C.return}}if(cr=p,Fl(),Ua&&typeof Ua.onPostCommitFiberRoot=="function")try{Ua.onPostCommitFiberRoot(My,n)}catch{}d=!0}return d}finally{Ir=a,ys.transition=o}}return!1}function xB(n,o,a){o=$h(a,o),o=J4(n,o,1),n=bl(n,o,1),o=Wi(),n!==null&&(e_(n,1,o),uo(n,o))}function In(n,o,a){if(n.tag===3)xB(n,n,a);else for(;o!==null;){if(o.tag===3){xB(o,n,a);break}else if(o.tag===1){var d=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Al===null||!Al.has(d))){n=$h(a,n),n=X4(o,n,1),o=bl(o,n,1),n=Wi(),o!==null&&(e_(o,1,n),uo(o,n));break}}o=o.return}}function Coe(n,o,a){var d=n.pingCache;d!==null&&d.delete(o),o=Wi(),n.pingedLanes|=n.suspendedLanes&a,ii===n&&(pi&a)===a&&(Yn===4||Yn===3&&(pi&130023424)===pi&&500>Nn()-vA?Ud(n,0):yA|=a),uo(n,o)}function _W(n,o){o===0&&(n.mode&1?(o=Qg,Qg<<=1,!(Qg&130023424)&&(Qg=4194304)):o=1);var a=Wi();n=Sc(n,o),n!==null&&(e_(n,o,a),uo(n,a))}function Roe(n){var o=n.memoizedState,a=0;o!==null&&(a=o.retryLane),_W(n,a)}function woe(n,o){var a=0;switch(n.tag){case 13:var d=n.stateNode,p=n.memoizedState;p!==null&&(a=p.retryLane);break;case 19:d=n.stateNode;break;default:throw Error(De(314))}d!==null&&d.delete(o),_W(n,a)}var EW;EW=function(n,o,a){if(n!==null)if(n.memoizedProps!==o.pendingProps||co.current)ao=!0;else{if(!(n.lanes&a)&&!(o.flags&128))return ao=!1,hoe(n,o,a);ao=!!(n.flags&131072)}else ao=!1,ln&&o.flags&1048576&&v4(o,ay,o.index);switch(o.lanes=0,o.tag){case 2:var d=o.type;OS(n,o),n=o.pendingProps;var p=qh(o,Pi.current);Bh(o,a),p=fA(null,o,d,n,p,a);var _=mA();return o.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,lo(d)?(_=!0,oy(o)):_=!1,o.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,lA(o),p.updater=Wy,o.stateNode=p,p._reactInternals=o,XI(o,d,n,a),o=ZI(null,o,d,!0,_,a)):(o.tag=0,ln&&_&&rA(o),Bi(null,o,p,a),o=o.child),o;case 16:d=o.elementType;e:{switch(OS(n,o),n=o.pendingProps,p=d._init,d=p(d._payload),o.type=d,p=o.tag=boe(d),n=Ys(d,n),p){case 0:o=QI(null,o,d,n,a);break e;case 1:o=IB(null,o,d,n,a);break e;case 11:o=RB(null,o,d,n,a);break e;case 14:o=wB(null,o,d,Ys(d.type,n),a);break e}throw Error(De(306,d,""))}return o;case 0:return d=o.type,p=o.pendingProps,p=o.elementType===d?p:Ys(d,p),QI(n,o,d,p,a);case 1:return d=o.type,p=o.pendingProps,p=o.elementType===d?p:Ys(d,p),IB(n,o,d,p,a);case 3:e:{if(eW(o),n===null)throw Error(De(387));d=o.pendingProps,_=o.memoizedState,p=_.element,b4(n,o),dy(o,d,null,a);var g=o.memoizedState;if(d=g.element,_.isDehydrated)if(_={element:d,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},o.updateQueue.baseState=_,o.memoizedState=_,o.flags&256){p=$h(Error(De(423)),o),o=bB(n,o,d,a,p);break e}else if(d!==p){p=$h(Error(De(424)),o),o=bB(n,o,d,a,p);break e}else for(No=Il(o.stateNode.containerInfo.firstChild),Lo=o,ln=!0,Qs=null,a=w4(o,null,d,a),o.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Yh(),d===p){o=yc(n,o,a);break e}Bi(n,o,d,a)}o=o.child}return o;case 5:return A4(o),n===null&&qI(o),d=o.type,p=o.pendingProps,_=n!==null?n.memoizedProps:null,g=p.children,WI(d,p)?g=null:_!==null&&WI(d,_)&&(o.flags|=32),Z4(n,o),Bi(n,o,g,a),o.child;case 6:return n===null&&qI(o),null;case 13:return tW(n,o,a);case 4:return dA(o,o.stateNode.containerInfo),d=o.pendingProps,n===null?o.child=Jh(o,null,d,a):Bi(n,o,d,a),o.child;case 11:return d=o.type,p=o.pendingProps,p=o.elementType===d?p:Ys(d,p),RB(n,o,d,p,a);case 7:return Bi(n,o,o.pendingProps,a),o.child;case 8:return Bi(n,o,o.pendingProps.children,a),o.child;case 12:return Bi(n,o,o.pendingProps.children,a),o.child;case 10:e:{if(d=o.type._context,p=o.pendingProps,_=o.memoizedProps,g=p.value,zr(cy,d._currentValue),d._currentValue=g,_!==null)if(ra(_.value,g)){if(_.children===p.children&&!co.current){o=yc(n,o,a);break e}}else for(_=o.child,_!==null&&(_.return=o);_!==null;){var C=_.dependencies;if(C!==null){g=_.child;for(var R=C.firstContext;R!==null;){if(R.context===d){if(_.tag===1){R=_c(-1,a&-a),R.tag=2;var D=_.updateQueue;if(D!==null){D=D.shared;var L=D.pending;L===null?R.next=R:(R.next=L.next,L.next=R),D.pending=R}}_.lanes|=a,R=_.alternate,R!==null&&(R.lanes|=a),YI(_.return,a,o),C.lanes|=a;break}R=R.next}}else if(_.tag===10)g=_.type===o.type?null:_.child;else if(_.tag===18){if(g=_.return,g===null)throw Error(De(341));g.lanes|=a,C=g.alternate,C!==null&&(C.lanes|=a),YI(g,a,o),g=_.sibling}else g=_.child;if(g!==null)g.return=_;else for(g=_;g!==null;){if(g===o){g=null;break}if(_=g.sibling,_!==null){_.return=g.return,g=_;break}g=g.return}_=g}Bi(n,o,p.children,a),o=o.child}return o;case 9:return p=o.type,d=o.pendingProps.children,Bh(o,a),p=Ts(p),d=d(p),o.flags|=1,Bi(n,o,d,a),o.child;case 14:return d=o.type,p=Ys(d,o.pendingProps),p=Ys(d.type,p),wB(n,o,d,p,a);case 15:return $4(n,o,o.type,o.pendingProps,a);case 17:return d=o.type,p=o.pendingProps,p=o.elementType===d?p:Ys(d,p),OS(n,o),o.tag=1,lo(d)?(n=!0,oy(o)):n=!1,Bh(o,a),Y4(o,d,p),XI(o,d,p,a),ZI(null,o,d,!0,n,a);case 19:return rW(n,o,a);case 22:return Q4(n,o,a)}throw Error(De(156,o.tag))};function gW(n,o){return K5(n,o)}function Ioe(n,o,a,d){this.tag=n,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ss(n,o,a,d){return new Ioe(n,o,a,d)}function wA(n){return n=n.prototype,!(!n||!n.isReactComponent)}function boe(n){if(typeof n=="function")return wA(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Hb)return 11;if(n===Kb)return 14}return 2}function Nl(n,o){var a=n.alternate;return a===null?(a=Ss(n.tag,o,n.key,n.mode),a.elementType=n.elementType,a.type=n.type,a.stateNode=n.stateNode,a.alternate=n,n.alternate=a):(a.pendingProps=o,a.type=n.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=n.flags&14680064,a.childLanes=n.childLanes,a.lanes=n.lanes,a.child=n.child,a.memoizedProps=n.memoizedProps,a.memoizedState=n.memoizedState,a.updateQueue=n.updateQueue,o=n.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},a.sibling=n.sibling,a.index=n.index,a.ref=n.ref,a}function PS(n,o,a,d,p,_){var g=2;if(d=n,typeof n=="function")wA(n)&&(g=1);else if(typeof n=="string")g=5;else e:switch(n){case Ih:return Vd(a.children,p,_,o);case Gb:g=8,p|=8;break;case yI:return n=Ss(12,a,o,p|2),n.elementType=yI,n.lanes=_,n;case vI:return n=Ss(13,a,o,p),n.elementType=vI,n.lanes=_,n;case TI:return n=Ss(19,a,o,p),n.elementType=TI,n.lanes=_,n;case A5:return Ky(a,p,_,o);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case I5:g=10;break e;case b5:g=9;break e;case Hb:g=11;break e;case Kb:g=14;break e;case _l:g=16,d=null;break e}throw Error(De(130,n==null?n:typeof n,""))}return o=Ss(g,a,o,p),o.elementType=n,o.type=d,o.lanes=_,o}function Vd(n,o,a,d){return n=Ss(7,n,d,o),n.lanes=a,n}function Ky(n,o,a,d){return n=Ss(22,n,d,o),n.elementType=A5,n.lanes=a,n.stateNode={isHidden:!1},n}function tI(n,o,a){return n=Ss(6,n,null,o),n.lanes=a,n}function rI(n,o,a){return o=Ss(4,n.children!==null?n.children:[],n.key,o),o.lanes=a,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}function Aoe(n,o,a,d,p){this.tag=o,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=x0(0),this.expirationTimes=x0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=x0(0),this.identifierPrefix=d,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function IA(n,o,a,d,p,_,g,C,R){return n=new Aoe(n,o,a,C,R),o===1?(o=1,_===!0&&(o|=8)):o=0,_=Ss(3,null,null,o),n.current=_,_.stateNode=n,_.memoizedState={element:d,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},lA(_),n}function Ooe(n,o,a){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wh,key:d==null?null:""+d,children:n,containerInfo:o,implementation:a}}function SW(n){if(!n)return kl;n=n._reactInternals;e:{if(Yd(n)!==n||n.tag!==1)throw Error(De(170));var o=n;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(lo(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(De(171))}if(n.tag===1){var a=n.type;if(lo(a))return S4(n,a,o)}return o}function yW(n,o,a,d,p,_,g,C,R){return n=IA(a,d,!0,n,p,_,g,C,R),n.context=SW(null),a=n.current,d=Wi(),p=Ol(a),_=_c(d,p),_.callback=o??null,bl(a,_,p),n.current.lanes=p,e_(n,p,d),uo(n,d),n}function zy(n,o,a,d){var p=o.current,_=Wi(),g=Ol(p);return a=SW(a),o.context===null?o.context=a:o.pendingContext=a,o=_c(_,g),o.payload={element:n},d=d===void 0?null:d,d!==null&&(o.callback=d),n=bl(p,o,g),n!==null&&(ta(n,p,g,_),IS(n,p,g)),g}function gy(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function UB(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var a=n.retryLane;n.retryLane=a!==0&&a<o?a:o}}function bA(n,o){UB(n,o),(n=n.alternate)&&UB(n,o)}function Noe(){return null}var vW=typeof reportError=="function"?reportError:function(n){console.error(n)};function AA(n){this._internalRoot=n}qy.prototype.render=AA.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error(De(409));zy(n,o,null,null)};qy.prototype.unmount=AA.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;Hd(function(){zy(null,n,null,null)}),o[gc]=null}};function qy(n){this._internalRoot=n}qy.prototype.unstable_scheduleHydration=function(n){if(n){var o=Q5();n={blockedOn:null,target:n,priority:o};for(var a=0;a<gl.length&&o!==0&&o<gl[a].priority;a++);gl.splice(a,0,n),a===0&&e4(n)}};function OA(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Yy(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function VB(){}function Doe(n,o,a,d,p){if(p){if(typeof d=="function"){var _=d;d=function(){var D=gy(g);_.call(D)}}var g=yW(o,d,n,0,null,!1,!1,"",VB);return n._reactRootContainer=g,n[gc]=g.current,Mm(n.nodeType===8?n.parentNode:n),Hd(),g}for(;p=n.lastChild;)n.removeChild(p);if(typeof d=="function"){var C=d;d=function(){var D=gy(R);C.call(D)}}var R=IA(n,0,!1,null,null,!1,!1,"",VB);return n._reactRootContainer=R,n[gc]=R.current,Mm(n.nodeType===8?n.parentNode:n),Hd(function(){zy(o,R,a,d)}),R}function Jy(n,o,a,d,p){var _=a._reactRootContainer;if(_){var g=_;if(typeof p=="function"){var C=p;p=function(){var R=gy(g);C.call(R)}}zy(o,g,n,p)}else g=Doe(a,o,n,p,d);return gy(g)}X5=function(n){switch(n.tag){case 3:var o=n.stateNode;if(o.current.memoizedState.isDehydrated){var a=cm(o.pendingLanes);a!==0&&(Yb(o,a|1),uo(o,Nn()),!(cr&6)&&(Qh=Nn()+500,Fl()))}break;case 13:Hd(function(){var d=Sc(n,1);if(d!==null){var p=Wi();ta(d,n,1,p)}}),bA(n,1)}};Jb=function(n){if(n.tag===13){var o=Sc(n,134217728);if(o!==null){var a=Wi();ta(o,n,134217728,a)}bA(n,134217728)}};$5=function(n){if(n.tag===13){var o=Ol(n),a=Sc(n,o);if(a!==null){var d=Wi();ta(a,n,o,d)}bA(n,o)}};Q5=function(){return Ir};Z5=function(n,o){var a=Ir;try{return Ir=n,o()}finally{Ir=a}};PI=function(n,o,a){switch(o){case"input":if(wI(n,a),o=a.name,a.type==="radio"&&o!=null){for(a=n;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<a.length;o++){var d=a[o];if(d!==n&&d.form===n.form){var p=Fy(d);if(!p)throw Error(De(90));N5(d),wI(d,p)}}}break;case"textarea":P5(n,a);break;case"select":o=a.value,o!=null&&Uh(n,!!a.multiple,o,!1)}};F5=TA;j5=Hd;var Poe={usingClientEntryPoint:!1,Events:[r_,Nh,Fy,U5,V5,TA]},Qf={findFiberByHostInstance:Pd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},koe={bundleType:Qf.bundleType,version:Qf.version,rendererPackageName:Qf.rendererPackageName,rendererConfig:Qf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Cc.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=G5(n),n===null?null:n.stateNode},findFiberByHostInstance:Qf.findFiberByHostInstance||Noe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lS=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lS.isDisabled&&lS.supportsFiber)try{My=lS.inject(koe),Ua=lS}catch{}}Fo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Poe;Fo.createPortal=function(n,o){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!OA(o))throw Error(De(200));return Ooe(n,o,null,a)};Fo.createRoot=function(n,o){if(!OA(n))throw Error(De(299));var a=!1,d="",p=vW;return o!=null&&(o.unstable_strictMode===!0&&(a=!0),o.identifierPrefix!==void 0&&(d=o.identifierPrefix),o.onRecoverableError!==void 0&&(p=o.onRecoverableError)),o=IA(n,1,!1,null,null,a,!1,d,p),n[gc]=o.current,Mm(n.nodeType===8?n.parentNode:n),new AA(o)};Fo.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error(De(188)):(n=Object.keys(n).join(","),Error(De(268,n)));return n=G5(o),n=n===null?null:n.stateNode,n};Fo.flushSync=function(n){return Hd(n)};Fo.hydrate=function(n,o,a){if(!Yy(o))throw Error(De(200));return Jy(null,n,o,!0,a)};Fo.hydrateRoot=function(n,o,a){if(!OA(n))throw Error(De(405));var d=a!=null&&a.hydratedSources||null,p=!1,_="",g=vW;if(a!=null&&(a.unstable_strictMode===!0&&(p=!0),a.identifierPrefix!==void 0&&(_=a.identifierPrefix),a.onRecoverableError!==void 0&&(g=a.onRecoverableError)),o=yW(o,null,n,1,a??null,p,!1,_,g),n[gc]=o.current,Mm(n),d)for(n=0;n<d.length;n++)a=d[n],p=a._getVersion,p=p(a._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[a,p]:o.mutableSourceEagerHydrationData.push(a,p);return new qy(o)};Fo.render=function(n,o,a){if(!Yy(o))throw Error(De(200));return Jy(null,n,o,!1,a)};Fo.unmountComponentAtNode=function(n){if(!Yy(n))throw Error(De(40));return n._reactRootContainer?(Hd(function(){Jy(null,null,n,!1,function(){n._reactRootContainer=null,n[gc]=null})}),!0):!1};Fo.unstable_batchedUpdates=TA;Fo.unstable_renderSubtreeIntoContainer=function(n,o,a,d){if(!Yy(a))throw Error(De(200));if(n==null||n._reactInternals===void 0)throw Error(De(38));return Jy(n,o,a,!1,d)};Fo.version="18.3.1-next-f1338f8080-20240426";function TW(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(TW)}catch(n){console.error(n)}}TW(),T5.exports=Fo;var NA=T5.exports;const Loe=Mb(NA),Moe=d5({__proto__:null,default:Loe},[NA]);var FB=NA;gI.createRoot=FB.createRoot,gI.hydrateRoot=FB.hydrateRoot;/**
 * @remix-run/router v1.17.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hn(){return hn=Object.assign?Object.assign.bind():function(n){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(n[d]=a[d])}return n},hn.apply(this,arguments)}var xn;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(xn||(xn={}));const jB="popstate";function xoe(n){n===void 0&&(n={});function o(d,p){let{pathname:_,search:g,hash:C}=d.location;return Hm("",{pathname:_,search:g,hash:C},p.state&&p.state.usr||null,p.state&&p.state.key||"default")}function a(d,p){return typeof p=="string"?p:i_(p)}return Voe(o,a,null,n)}function Ht(n,o){if(n===!1||n===null||typeof n>"u")throw new Error(o)}function Zh(n,o){if(!n){typeof console<"u"&&console.warn(o);try{throw new Error(o)}catch{}}}function Uoe(){return Math.random().toString(36).substr(2,8)}function BB(n,o){return{usr:n.state,key:n.key,idx:o}}function Hm(n,o,a,d){return a===void 0&&(a=null),hn({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof o=="string"?jl(o):o,{state:a,key:o&&o.key||d||Uoe()})}function i_(n){let{pathname:o="/",search:a="",hash:d=""}=n;return a&&a!=="?"&&(o+=a.charAt(0)==="?"?a:"?"+a),d&&d!=="#"&&(o+=d.charAt(0)==="#"?d:"#"+d),o}function jl(n){let o={};if(n){let a=n.indexOf("#");a>=0&&(o.hash=n.substr(a),n=n.substr(0,a));let d=n.indexOf("?");d>=0&&(o.search=n.substr(d),n=n.substr(0,d)),n&&(o.pathname=n)}return o}function Voe(n,o,a,d){d===void 0&&(d={});let{window:p=document.defaultView,v5Compat:_=!1}=d,g=p.history,C=xn.Pop,R=null,D=L();D==null&&(D=0,g.replaceState(hn({},g.state,{idx:D}),""));function L(){return(g.state||{idx:null}).idx}function k(){C=xn.Pop;let Q=L(),G=Q==null?null:Q-D;D=Q,R&&R({action:C,location:V.location,delta:G})}function M(Q,G){C=xn.Push;let B=Hm(V.location,Q,G);D=L()+1;let q=BB(B,D),se=V.createHref(B);try{g.pushState(q,"",se)}catch(ue){if(ue instanceof DOMException&&ue.name==="DataCloneError")throw ue;p.location.assign(se)}_&&R&&R({action:C,location:V.location,delta:1})}function Y(Q,G){C=xn.Replace;let B=Hm(V.location,Q,G);D=L();let q=BB(B,D),se=V.createHref(B);g.replaceState(q,"",se),_&&R&&R({action:C,location:V.location,delta:0})}function z(Q){let G=p.location.origin!=="null"?p.location.origin:p.location.href,B=typeof Q=="string"?Q:i_(Q);return B=B.replace(/ $/,"%20"),Ht(G,"No window.location.(origin|href) available to create URL for href: "+B),new URL(B,G)}let V={get action(){return C},get location(){return n(p,g)},listen(Q){if(R)throw new Error("A history only accepts one active listener");return p.addEventListener(jB,k),R=Q,()=>{p.removeEventListener(jB,k),R=null}},createHref(Q){return o(p,Q)},createURL:z,encodeLocation(Q){let G=z(Q);return{pathname:G.pathname,search:G.search,hash:G.hash}},push:M,replace:Y,go(Q){return g.go(Q)}};return V}var Kr;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Kr||(Kr={}));const Foe=new Set(["lazy","caseSensitive","path","id","index","children"]);function joe(n){return n.index===!0}function Km(n,o,a,d){return a===void 0&&(a=[]),d===void 0&&(d={}),n.map((p,_)=>{let g=[...a,String(_)],C=typeof p.id=="string"?p.id:g.join("-");if(Ht(p.index!==!0||!p.children,"Cannot specify children on an index route"),Ht(!d[C],'Found a route id collision on id "'+C+`".  Route id's must be globally unique within Data Router usages`),joe(p)){let R=hn({},p,o(p),{id:C});return d[C]=R,R}else{let R=hn({},p,o(p),{id:C,children:void 0});return d[C]=R,p.children&&(R.children=Km(p.children,o,g,d)),R}})}function Dd(n,o,a){return a===void 0&&(a="/"),kS(n,o,a,!1)}function kS(n,o,a,d){let p=typeof o=="string"?jl(o):o,_=o_(p.pathname||"/",a);if(_==null)return null;let g=CW(n);Woe(g);let C=null;for(let R=0;C==null&&R<g.length;++R){let D=Zoe(_);C=$oe(g[R],D,d)}return C}function Boe(n,o){let{route:a,pathname:d,params:p}=n;return{id:a.id,pathname:d,params:p,data:o[a.id],handle:a.handle}}function CW(n,o,a,d){o===void 0&&(o=[]),a===void 0&&(a=[]),d===void 0&&(d="");let p=(_,g,C)=>{let R={relativePath:C===void 0?_.path||"":C,caseSensitive:_.caseSensitive===!0,childrenIndex:g,route:_};R.relativePath.startsWith("/")&&(Ht(R.relativePath.startsWith(d),'Absolute route path "'+R.relativePath+'" nested under path '+('"'+d+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),R.relativePath=R.relativePath.slice(d.length));let D=Dl([d,R.relativePath]),L=a.concat(R);_.children&&_.children.length>0&&(Ht(_.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+D+'".')),CW(_.children,o,L,D)),!(_.path==null&&!_.index)&&o.push({path:D,score:Joe(D,_.index),routesMeta:L})};return n.forEach((_,g)=>{var C;if(_.path===""||!((C=_.path)!=null&&C.includes("?")))p(_,g);else for(let R of RW(_.path))p(_,g,R)}),o}function RW(n){let o=n.split("/");if(o.length===0)return[];let[a,...d]=o,p=a.endsWith("?"),_=a.replace(/\?$/,"");if(d.length===0)return p?[_,""]:[_];let g=RW(d.join("/")),C=[];return C.push(...g.map(R=>R===""?_:[_,R].join("/"))),p&&C.push(...g),C.map(R=>n.startsWith("/")&&R===""?"/":R)}function Woe(n){n.sort((o,a)=>o.score!==a.score?a.score-o.score:Xoe(o.routesMeta.map(d=>d.childrenIndex),a.routesMeta.map(d=>d.childrenIndex)))}const Goe=/^:[\w-]+$/,Hoe=3,Koe=2,zoe=1,qoe=10,Yoe=-2,WB=n=>n==="*";function Joe(n,o){let a=n.split("/"),d=a.length;return a.some(WB)&&(d+=Yoe),o&&(d+=Koe),a.filter(p=>!WB(p)).reduce((p,_)=>p+(Goe.test(_)?Hoe:_===""?zoe:qoe),d)}function Xoe(n,o){return n.length===o.length&&n.slice(0,-1).every((d,p)=>d===o[p])?n[n.length-1]-o[o.length-1]:0}function $oe(n,o,a){a===void 0&&(a=!1);let{routesMeta:d}=n,p={},_="/",g=[];for(let C=0;C<d.length;++C){let R=d[C],D=C===d.length-1,L=_==="/"?o:o.slice(_.length)||"/",k=GB({path:R.relativePath,caseSensitive:R.caseSensitive,end:D},L),M=R.route;if(!k&&D&&a&&!d[d.length-1].route.index&&(k=GB({path:R.relativePath,caseSensitive:R.caseSensitive,end:!1},L)),!k)return null;Object.assign(p,k.params),g.push({params:p,pathname:Dl([_,k.pathname]),pathnameBase:rse(Dl([_,k.pathnameBase])),route:M}),k.pathnameBase!=="/"&&(_=Dl([_,k.pathnameBase]))}return g}function GB(n,o){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[a,d]=Qoe(n.path,n.caseSensitive,n.end),p=o.match(a);if(!p)return null;let _=p[0],g=_.replace(/(.)\/+$/,"$1"),C=p.slice(1);return{params:d.reduce((D,L,k)=>{let{paramName:M,isOptional:Y}=L;if(M==="*"){let V=C[k]||"";g=_.slice(0,_.length-V.length).replace(/(.)\/+$/,"$1")}const z=C[k];return Y&&!z?D[M]=void 0:D[M]=(z||"").replace(/%2F/g,"/"),D},{}),pathname:_,pathnameBase:g,pattern:n}}function Qoe(n,o,a){o===void 0&&(o=!1),a===void 0&&(a=!0),Zh(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let d=[],p="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,C,R)=>(d.push({paramName:C,isOptional:R!=null}),R?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(d.push({paramName:"*"}),p+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?p+="\\/*$":n!==""&&n!=="/"&&(p+="(?:(?=\\/|$))"),[new RegExp(p,o?void 0:"i"),d]}function Zoe(n){try{return n.split("/").map(o=>decodeURIComponent(o).replace(/\//g,"%2F")).join("/")}catch(o){return Zh(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+o+").")),n}}function o_(n,o){if(o==="/")return n;if(!n.toLowerCase().startsWith(o.toLowerCase()))return null;let a=o.endsWith("/")?o.length-1:o.length,d=n.charAt(a);return d&&d!=="/"?null:n.slice(a)||"/"}function ese(n,o){o===void 0&&(o="/");let{pathname:a,search:d="",hash:p=""}=typeof n=="string"?jl(n):n;return{pathname:a?a.startsWith("/")?a:tse(a,o):o,search:nse(d),hash:ise(p)}}function tse(n,o){let a=o.replace(/\/+$/,"").split("/");return n.split("/").forEach(p=>{p===".."?a.length>1&&a.pop():p!=="."&&a.push(p)}),a.length>1?a.join("/"):"/"}function nI(n,o,a,d){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+o+"` field ["+JSON.stringify(d)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function wW(n){return n.filter((o,a)=>a===0||o.route.path&&o.route.path.length>0)}function IW(n,o){let a=wW(n);return o?a.map((d,p)=>p===a.length-1?d.pathname:d.pathnameBase):a.map(d=>d.pathnameBase)}function bW(n,o,a,d){d===void 0&&(d=!1);let p;typeof n=="string"?p=jl(n):(p=hn({},n),Ht(!p.pathname||!p.pathname.includes("?"),nI("?","pathname","search",p)),Ht(!p.pathname||!p.pathname.includes("#"),nI("#","pathname","hash",p)),Ht(!p.search||!p.search.includes("#"),nI("#","search","hash",p)));let _=n===""||p.pathname==="",g=_?"/":p.pathname,C;if(g==null)C=a;else{let k=o.length-1;if(!d&&g.startsWith("..")){let M=g.split("/");for(;M[0]==="..";)M.shift(),k-=1;p.pathname=M.join("/")}C=k>=0?o[k]:"/"}let R=ese(p,C),D=g&&g!=="/"&&g.endsWith("/"),L=(_||g===".")&&a.endsWith("/");return!R.pathname.endsWith("/")&&(D||L)&&(R.pathname+="/"),R}const Dl=n=>n.join("/").replace(/\/\/+/g,"/"),rse=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),nse=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,ise=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;class DA{constructor(o,a,d,p){p===void 0&&(p=!1),this.status=o,this.statusText=a||"",this.internal=p,d instanceof Error?(this.data=d.toString(),this.error=d):this.data=d}}function Xy(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const AW=["post","put","patch","delete"],ose=new Set(AW),sse=["get",...AW],ase=new Set(sse),cse=new Set([301,302,303,307,308]),lse=new Set([307,308]),iI={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},dse={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Zf={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},PA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,use=n=>({hasErrorBoundary:!!n.hasErrorBoundary}),OW="remix-router-transitions";function hse(n){const o=n.window?n.window:typeof window<"u"?window:void 0,a=typeof o<"u"&&typeof o.document<"u"&&typeof o.document.createElement<"u",d=!a;Ht(n.routes.length>0,"You must provide a non-empty routes array to createRouter");let p;if(n.mapRouteProperties)p=n.mapRouteProperties;else if(n.detectErrorBoundary){let re=n.detectErrorBoundary;p=oe=>({hasErrorBoundary:re(oe)})}else p=use;let _={},g=Km(n.routes,p,void 0,_),C,R=n.basename||"/",D=n.unstable_dataStrategy||Ese,L=n.unstable_patchRoutesOnMiss,k=hn({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,unstable_skipActionErrorRevalidation:!1},n.future),M=null,Y=new Set,z=null,V=null,Q=null,G=n.hydrationData!=null,B=Dd(g,n.history.location,R),q=null;if(B==null&&!L){let re=ji(404,{pathname:n.history.location.pathname}),{matches:oe,route:he}=ZB(g);B=oe,q={[he.id]:re}}B&&L&&yp(B,g,n.history.location.pathname).active&&(B=null);let se;if(!B)se=!1,B=[];else if(B.some(re=>re.route.lazy))se=!1;else if(!B.some(re=>re.route.loader))se=!0;else if(k.v7_partialHydration){let re=n.hydrationData?n.hydrationData.loaderData:null,oe=n.hydrationData?n.hydrationData.errors:null,he=ye=>ye.route.loader?typeof ye.route.loader=="function"&&ye.route.loader.hydrate===!0?!1:re&&re[ye.route.id]!==void 0||oe&&oe[ye.route.id]!==void 0:!0;if(oe){let ye=B.findIndex(Fe=>oe[Fe.route.id]!==void 0);se=B.slice(0,ye+1).every(he)}else se=B.every(he)}else se=n.hydrationData!=null;let ue,$={historyAction:n.history.action,location:n.history.location,matches:B,initialized:se,navigation:iI,restoreScrollPosition:n.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:n.hydrationData&&n.hydrationData.loaderData||{},actionData:n.hydrationData&&n.hydrationData.actionData||null,errors:n.hydrationData&&n.hydrationData.errors||q,fetchers:new Map,blockers:new Map},pe=xn.Pop,Oe=!1,xe,je=!1,ze=new Map,St=null,Bt=!1,st=!1,Jn=[],jr=[],Br=new Map,Ve=0,Ge=-1,ut=new Map,er=new Set,Or=new Map,Wo=new Map,Wr=new Set,mi=new Map,tn=new Map,Rc=new Map,dp=!1;function up(){if(M=n.history.listen(re=>{let{action:oe,location:he,delta:ye}=re;if(dp){dp=!1;return}Zh(tn.size===0||ye!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Fe=Ep({currentLocation:$.location,nextLocation:he,historyAction:oe});if(Fe&&ye!=null){dp=!0,n.history.go(ye*-1),Os(Fe,{state:"blocked",location:he,proceed(){Os(Fe,{state:"proceeding",proceed:void 0,reset:void 0,location:he}),n.history.go(ye)},reset(){let $e=new Map($.blockers);$e.set(Fe,Zf),En({blockers:$e})}});return}return Wa(oe,he)}),a){Nse(o,ze);let re=()=>Dse(o,ze);o.addEventListener("pagehide",re),St=()=>o.removeEventListener("pagehide",re)}return $.initialized||Wa(xn.Pop,$.location,{initialHydration:!0}),ue}function jv(){M&&M(),St&&St(),Y.clear(),xe&&xe.abort(),$.fetchers.forEach((re,oe)=>Hl(oe)),$.blockers.forEach((re,oe)=>E_(oe))}function tu(re){return Y.add(re),()=>Y.delete(re)}function En(re,oe){oe===void 0&&(oe={}),$=hn({},$,re);let he=[],ye=[];k.v7_fetcherPersist&&$.fetchers.forEach((Fe,$e)=>{Fe.state==="idle"&&(Wr.has($e)?ye.push($e):he.push($e))}),[...Y].forEach(Fe=>Fe($,{deletedFetchers:ye,unstable_viewTransitionOpts:oe.viewTransitionOpts,unstable_flushSync:oe.flushSync===!0})),k.v7_fetcherPersist&&(he.forEach(Fe=>$.fetchers.delete(Fe)),ye.forEach(Fe=>Hl(Fe)))}function wc(re,oe,he){var ye,Fe;let{flushSync:$e}=he===void 0?{}:he,ht=$.actionData!=null&&$.navigation.formMethod!=null&&Xs($.navigation.formMethod)&&$.navigation.state==="loading"&&((ye=re.state)==null?void 0:ye._isRedirect)!==!0,Me;oe.actionData?Object.keys(oe.actionData).length>0?Me=oe.actionData:Me=null:ht?Me=$.actionData:Me=null;let Tt=oe.loaderData?$B($.loaderData,oe.loaderData,oe.matches||[],oe.errors):$.loaderData,it=$.blockers;it.size>0&&(it=new Map(it),it.forEach((Yt,fr)=>it.set(fr,Zf)));let ot=Oe===!0||$.navigation.formMethod!=null&&Xs($.navigation.formMethod)&&((Fe=re.state)==null?void 0:Fe._isRedirect)!==!0;C&&(g=C,C=void 0),Bt||pe===xn.Pop||(pe===xn.Push?n.history.push(re,re.state):pe===xn.Replace&&n.history.replace(re,re.state));let dr;if(pe===xn.Pop){let Yt=ze.get($.location.pathname);Yt&&Yt.has(re.pathname)?dr={currentLocation:$.location,nextLocation:re}:ze.has(re.pathname)&&(dr={currentLocation:re,nextLocation:$.location})}else if(je){let Yt=ze.get($.location.pathname);Yt?Yt.add(re.pathname):(Yt=new Set([re.pathname]),ze.set($.location.pathname,Yt)),dr={currentLocation:$.location,nextLocation:re}}En(hn({},oe,{actionData:Me,loaderData:Tt,historyAction:pe,location:re,initialized:!0,navigation:iI,revalidation:"idle",restoreScrollPosition:Ha(re,oe.matches||$.matches),preventScrollReset:ot,blockers:it}),{viewTransitionOpts:dr,flushSync:$e===!0}),pe=xn.Pop,Oe=!1,je=!1,Bt=!1,st=!1,Jn=[],jr=[]}async function m_(re,oe){if(typeof re=="number"){n.history.go(re);return}let he=ub($.location,$.matches,R,k.v7_prependBasename,re,k.v7_relativeSplatPath,oe==null?void 0:oe.fromRouteId,oe==null?void 0:oe.relative),{path:ye,submission:Fe,error:$e}=HB(k.v7_normalizeFormMethod,!1,he,oe),ht=$.location,Me=Hm($.location,ye,oe&&oe.state);Me=hn({},Me,n.history.encodeLocation(Me));let Tt=oe&&oe.replace!=null?oe.replace:void 0,it=xn.Push;Tt===!0?it=xn.Replace:Tt===!1||Fe!=null&&Xs(Fe.formMethod)&&Fe.formAction===$.location.pathname+$.location.search&&(it=xn.Replace);let ot=oe&&"preventScrollReset"in oe?oe.preventScrollReset===!0:void 0,dr=(oe&&oe.unstable_flushSync)===!0,Yt=Ep({currentLocation:ht,nextLocation:Me,historyAction:it});if(Yt){Os(Yt,{state:"blocked",location:Me,proceed(){Os(Yt,{state:"proceeding",proceed:void 0,reset:void 0,location:Me}),m_(re,oe)},reset(){let fr=new Map($.blockers);fr.set(Yt,Zf),En({blockers:fr})}});return}return await Wa(it,Me,{submission:Fe,pendingError:$e,preventScrollReset:ot,replace:oe&&oe.replace,enableViewTransition:oe&&oe.unstable_viewTransition,flushSync:dr})}function Ic(){if(jn(),En({revalidation:"loading"}),$.navigation.state!=="submitting"){if($.navigation.state==="idle"){Wa($.historyAction,$.location,{startUninterruptedRevalidation:!0});return}Wa(pe||$.historyAction,$.navigation.location,{overrideNavigation:$.navigation})}}async function Wa(re,oe,he){xe&&xe.abort(),xe=null,pe=re,Bt=(he&&he.startUninterruptedRevalidation)===!0,Kv($.location,$.matches),Oe=(he&&he.preventScrollReset)===!0,je=(he&&he.enableViewTransition)===!0;let ye=C||g,Fe=he&&he.overrideNavigation,$e=Dd(ye,oe,R),ht=(he&&he.flushSync)===!0,Me=yp($e,ye,oe.pathname);if(Me.active&&Me.matches&&($e=Me.matches),!$e){let{error:Gt,notFoundMatches:Bn,route:gn}=gp(oe.pathname);wc(oe,{matches:Bn,loaderData:{},errors:{[gn.id]:Gt}},{flushSync:ht});return}if($.initialized&&!st&&Cse($.location,oe)&&!(he&&he.submission&&Xs(he.submission.formMethod))){wc(oe,{matches:$e},{flushSync:ht});return}xe=new AbortController;let Tt=Eh(n.history,oe,xe.signal,he&&he.submission),it;if(he&&he.pendingError)it=[Rm($e).route.id,{type:Kr.error,error:he.pendingError}];else if(he&&he.submission&&Xs(he.submission.formMethod)){let Gt=await Bv(Tt,oe,he.submission,$e,Me.active,{replace:he.replace,flushSync:ht});if(Gt.shortCircuited)return;if(Gt.pendingActionResult){let[Bn,gn]=Gt.pendingActionResult;if(Ao(gn)&&Xy(gn.error)&&gn.error.status===404){xe=null,wc(oe,{matches:Gt.matches,loaderData:{},errors:{[Bn]:gn.error}});return}}$e=Gt.matches||$e,it=Gt.pendingActionResult,Fe=oI(oe,he.submission),ht=!1,Me.active=!1,Tt=Eh(n.history,Tt.url,Tt.signal)}let{shortCircuited:ot,matches:dr,loaderData:Yt,errors:fr}=await sa(Tt,oe,$e,Me.active,Fe,he&&he.submission,he&&he.fetcherSubmission,he&&he.replace,he&&he.initialHydration===!0,ht,it);ot||(xe=null,wc(oe,hn({matches:dr||$e},QB(it),{loaderData:Yt,errors:fr})))}async function Bv(re,oe,he,ye,Fe,$e){$e===void 0&&($e={}),jn();let ht=Ase(oe,he);if(En({navigation:ht},{flushSync:$e.flushSync===!0}),Fe){let it=await iu(ye,oe.pathname,re.signal);if(it.type==="aborted")return{shortCircuited:!0};if(it.type==="error"){let{error:ot,notFoundMatches:dr,route:Yt}=nu(oe.pathname,it);return{matches:dr,pendingActionResult:[Yt.id,{type:Kr.error,error:ot}]}}else if(it.matches)ye=it.matches;else{let{notFoundMatches:ot,error:dr,route:Yt}=gp(oe.pathname);return{matches:ot,pendingActionResult:[Yt.id,{type:Kr.error,error:dr}]}}}let Me,Tt=dm(ye,oe);if(!Tt.route.action&&!Tt.route.lazy)Me={type:Kr.error,error:ji(405,{method:re.method,pathname:oe.pathname,routeId:Tt.route.id})};else if(Me=(await Gl("action",re,[Tt],ye))[0],re.signal.aborted)return{shortCircuited:!0};if(xd(Me)){let it;return $e&&$e.replace!=null?it=$e.replace:it=YB(Me.response.headers.get("Location"),new URL(re.url),R)===$.location.pathname+$.location.search,await Ga(re,Me,{submission:he,replace:it}),{shortCircuited:!0}}if(Md(Me))throw ji(400,{type:"defer-action"});if(Ao(Me)){let it=Rm(ye,Tt.route.id);return($e&&$e.replace)!==!0&&(pe=xn.Push),{matches:ye,pendingActionResult:[it.route.id,Me]}}return{matches:ye,pendingActionResult:[Tt.route.id,Me]}}async function sa(re,oe,he,ye,Fe,$e,ht,Me,Tt,it,ot){let dr=Fe||oI(oe,$e),Yt=$e||ht||r3(dr),fr=!Bt&&(!k.v7_partialHydration||!Tt);if(ye){if(fr){let qr=hp(ot);En(hn({navigation:dr},qr!==void 0?{actionData:qr}:{}),{flushSync:it})}let Nt=await iu(he,oe.pathname,re.signal);if(Nt.type==="aborted")return{shortCircuited:!0};if(Nt.type==="error"){let{error:qr,notFoundMatches:ki,route:Dr}=nu(oe.pathname,Nt);return{matches:ki,loaderData:{},errors:{[Dr.id]:qr}}}else if(Nt.matches)he=Nt.matches;else{let{error:qr,notFoundMatches:ki,route:Dr}=gp(oe.pathname);return{matches:ki,loaderData:{},errors:{[Dr.id]:qr}}}}let Gt=C||g,[Bn,gn]=KB(n.history,$,he,Yt,oe,k.v7_partialHydration&&Tt===!0,k.unstable_skipActionErrorRevalidation,st,Jn,jr,Wr,Or,er,Gt,R,ot);if(Sp(Nt=>!(he&&he.some(qr=>qr.route.id===Nt))||Bn&&Bn.some(qr=>qr.route.id===Nt)),Ge=++Ve,Bn.length===0&&gn.length===0){let Nt=aa();return wc(oe,hn({matches:he,loaderData:{},errors:ot&&Ao(ot[1])?{[ot[0]]:ot[1].error}:null},QB(ot),Nt?{fetchers:new Map($.fetchers)}:{}),{flushSync:it}),{shortCircuited:!0}}if(fr){let Nt={};if(!ye){Nt.navigation=dr;let qr=hp(ot);qr!==void 0&&(Nt.actionData=qr)}gn.length>0&&(Nt.fetchers=Wv(gn)),En(Nt,{flushSync:it})}gn.forEach(Nt=>{Br.has(Nt.key)&&As(Nt.key),Nt.controller&&Br.set(Nt.key,Nt.controller)});let gi=()=>gn.forEach(Nt=>As(Nt.key));xe&&xe.signal.addEventListener("abort",gi);let{loaderResults:ca,fetcherResults:Ac}=await fp($.matches,he,Bn,gn,re);if(re.signal.aborted)return{shortCircuited:!0};xe&&xe.signal.removeEventListener("abort",gi),gn.forEach(Nt=>Br.delete(Nt.key));let Nr=e3([...ca,...Ac]);if(Nr){if(Nr.idx>=Bn.length){let Nt=gn[Nr.idx-Bn.length].key;er.add(Nt)}return await Ga(re,Nr.result,{replace:Me}),{shortCircuited:!0}}let{loaderData:Oc,errors:Ho}=XB($,he,Bn,ca,ot,gn,Ac,mi);mi.forEach((Nt,qr)=>{Nt.subscribe(ki=>{(ki||Nt.done)&&mi.delete(qr)})}),k.v7_partialHydration&&Tt&&$.errors&&Object.entries($.errors).filter(Nt=>{let[qr]=Nt;return!Bn.some(ki=>ki.route.id===qr)}).forEach(Nt=>{let[qr,ki]=Nt;Ho=Object.assign(Ho||{},{[qr]:ki})});let ou=aa(),su=_p(Ge),Nc=ou||su||gn.length>0;return hn({matches:he,loaderData:Oc,errors:Ho},Nc?{fetchers:new Map($.fetchers)}:{})}function hp(re){if(re&&!Ao(re[1]))return{[re[0]]:re[1].data};if($.actionData)return Object.keys($.actionData).length===0?null:$.actionData}function Wv(re){return re.forEach(oe=>{let he=$.fetchers.get(oe.key),ye=em(void 0,he?he.data:void 0);$.fetchers.set(oe.key,ye)}),new Map($.fetchers)}function _i(re,oe,he,ye){if(d)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");Br.has(re)&&As(re);let Fe=(ye&&ye.unstable_flushSync)===!0,$e=C||g,ht=ub($.location,$.matches,R,k.v7_prependBasename,he,k.v7_relativeSplatPath,oe,ye==null?void 0:ye.relative),Me=Dd($e,ht,R),Tt=yp(Me,$e,ht);if(Tt.active&&Tt.matches&&(Me=Tt.matches),!Me){Go(re,oe,ji(404,{pathname:ht}),{flushSync:Fe});return}let{path:it,submission:ot,error:dr}=HB(k.v7_normalizeFormMethod,!0,ht,ye);if(dr){Go(re,oe,dr,{flushSync:Fe});return}let Yt=dm(Me,it);if(Oe=(ye&&ye.preventScrollReset)===!0,ot&&Xs(ot.formMethod)){fo(re,oe,it,Yt,Me,Tt.active,Fe,ot);return}Or.set(re,{routeId:oe,path:it}),pp(re,oe,it,Yt,Me,Tt.active,Fe,ot)}async function fo(re,oe,he,ye,Fe,$e,ht,Me){jn(),Or.delete(re);function Tt(Dr){if(!Dr.route.action&&!Dr.route.lazy){let Ns=ji(405,{method:Me.formMethod,pathname:he,routeId:oe});return Go(re,oe,Ns,{flushSync:ht}),!0}return!1}if(!$e&&Tt(ye))return;let it=$.fetchers.get(re);Ei(re,Ose(Me,it),{flushSync:ht});let ot=new AbortController,dr=Eh(n.history,he,ot.signal,Me);if($e){let Dr=await iu(Fe,he,dr.signal);if(Dr.type==="aborted")return;if(Dr.type==="error"){let{error:Ns}=nu(he,Dr);Go(re,oe,Ns,{flushSync:ht});return}else if(Dr.matches){if(Fe=Dr.matches,ye=dm(Fe,he),Tt(ye))return}else{Go(re,oe,ji(404,{pathname:he}),{flushSync:ht});return}}Br.set(re,ot);let Yt=Ve,Gt=(await Gl("action",dr,[ye],Fe))[0];if(dr.signal.aborted){Br.get(re)===ot&&Br.delete(re);return}if(k.v7_fetcherPersist&&Wr.has(re)){if(xd(Gt)||Ao(Gt)){Ei(re,ml(void 0));return}}else{if(xd(Gt))if(Br.delete(re),Ge>Yt){Ei(re,ml(void 0));return}else return er.add(re),Ei(re,em(Me)),Ga(dr,Gt,{fetcherSubmission:Me});if(Ao(Gt)){Go(re,oe,Gt.error);return}}if(Md(Gt))throw ji(400,{type:"defer-action"});let Bn=$.navigation.location||$.location,gn=Eh(n.history,Bn,ot.signal),gi=C||g,ca=$.navigation.state!=="idle"?Dd(gi,$.navigation.location,R):$.matches;Ht(ca,"Didn't find any matches after fetcher action");let Ac=++Ve;ut.set(re,Ac);let Nr=em(Me,Gt.data);$.fetchers.set(re,Nr);let[Oc,Ho]=KB(n.history,$,ca,Me,Bn,!1,k.unstable_skipActionErrorRevalidation,st,Jn,jr,Wr,Or,er,gi,R,[ye.route.id,Gt]);Ho.filter(Dr=>Dr.key!==re).forEach(Dr=>{let Ns=Dr.key,Ka=$.fetchers.get(Ns),vp=em(void 0,Ka?Ka.data:void 0);$.fetchers.set(Ns,vp),Br.has(Ns)&&As(Ns),Dr.controller&&Br.set(Ns,Dr.controller)}),En({fetchers:new Map($.fetchers)});let ou=()=>Ho.forEach(Dr=>As(Dr.key));ot.signal.addEventListener("abort",ou);let{loaderResults:su,fetcherResults:Nc}=await fp($.matches,ca,Oc,Ho,gn);if(ot.signal.aborted)return;ot.signal.removeEventListener("abort",ou),ut.delete(re),Br.delete(re),Ho.forEach(Dr=>Br.delete(Dr.key));let Nt=e3([...su,...Nc]);if(Nt){if(Nt.idx>=Oc.length){let Dr=Ho[Nt.idx-Oc.length].key;er.add(Dr)}return Ga(gn,Nt.result)}let{loaderData:qr,errors:ki}=XB($,$.matches,Oc,su,void 0,Ho,Nc,mi);if($.fetchers.has(re)){let Dr=ml(Gt.data);$.fetchers.set(re,Dr)}_p(Ac),$.navigation.state==="loading"&&Ac>Ge?(Ht(pe,"Expected pending action"),xe&&xe.abort(),wc($.navigation.location,{matches:ca,loaderData:qr,errors:ki,fetchers:new Map($.fetchers)})):(En({errors:ki,loaderData:$B($.loaderData,qr,ca,ki),fetchers:new Map($.fetchers)}),st=!1)}async function pp(re,oe,he,ye,Fe,$e,ht,Me){let Tt=$.fetchers.get(re);Ei(re,em(Me,Tt?Tt.data:void 0),{flushSync:ht});let it=new AbortController,ot=Eh(n.history,he,it.signal);if($e){let Gt=await iu(Fe,he,ot.signal);if(Gt.type==="aborted")return;if(Gt.type==="error"){let{error:Bn}=nu(he,Gt);Go(re,oe,Bn,{flushSync:ht});return}else if(Gt.matches)Fe=Gt.matches,ye=dm(Fe,he);else{Go(re,oe,ji(404,{pathname:he}),{flushSync:ht});return}}Br.set(re,it);let dr=Ve,fr=(await Gl("loader",ot,[ye],Fe))[0];if(Md(fr)&&(fr=await LW(fr,ot.signal,!0)||fr),Br.get(re)===it&&Br.delete(re),!ot.signal.aborted){if(Wr.has(re)){Ei(re,ml(void 0));return}if(xd(fr))if(Ge>dr){Ei(re,ml(void 0));return}else{er.add(re),await Ga(ot,fr);return}if(Ao(fr)){Go(re,oe,fr.error);return}Ht(!Md(fr),"Unhandled fetcher deferred data"),Ei(re,ml(fr.data))}}async function Ga(re,oe,he){let{submission:ye,fetcherSubmission:Fe,replace:$e}=he===void 0?{}:he;oe.response.headers.has("X-Remix-Revalidate")&&(st=!0);let ht=oe.response.headers.get("Location");Ht(ht,"Expected a Location header on the redirect Response"),ht=YB(ht,new URL(re.url),R);let Me=Hm($.location,ht,{_isRedirect:!0});if(a){let fr=!1;if(oe.response.headers.has("X-Remix-Reload-Document"))fr=!0;else if(PA.test(ht)){const Gt=n.history.createURL(ht);fr=Gt.origin!==o.location.origin||o_(Gt.pathname,R)==null}if(fr){$e?o.location.replace(ht):o.location.assign(ht);return}}xe=null;let Tt=$e===!0?xn.Replace:xn.Push,{formMethod:it,formAction:ot,formEncType:dr}=$.navigation;!ye&&!Fe&&it&&ot&&dr&&(ye=r3($.navigation));let Yt=ye||Fe;if(lse.has(oe.response.status)&&Yt&&Xs(Yt.formMethod))await Wa(Tt,Me,{submission:hn({},Yt,{formAction:ht}),preventScrollReset:Oe});else{let fr=oI(Me,ye);await Wa(Tt,Me,{overrideNavigation:fr,fetcherSubmission:Fe,preventScrollReset:Oe})}}async function Gl(re,oe,he,ye){try{let Fe=await gse(D,re,oe,he,ye,_,p);return await Promise.all(Fe.map(($e,ht)=>{if(wse($e)){let Me=$e.result;return{type:Kr.redirect,response:vse(Me,oe,he[ht].route.id,ye,R,k.v7_relativeSplatPath)}}return yse($e)}))}catch(Fe){return he.map(()=>({type:Kr.error,error:Fe}))}}async function fp(re,oe,he,ye,Fe){let[$e,...ht]=await Promise.all([he.length?Gl("loader",Fe,he,oe):[],...ye.map(Me=>{if(Me.matches&&Me.match&&Me.controller){let Tt=Eh(n.history,Me.path,Me.controller.signal);return Gl("loader",Tt,[Me.match],Me.matches).then(it=>it[0])}else return Promise.resolve({type:Kr.error,error:ji(404,{pathname:Me.path})})})]);return await Promise.all([t3(re,he,$e,$e.map(()=>Fe.signal),!1,$.loaderData),t3(re,ye.map(Me=>Me.match),ht,ye.map(Me=>Me.controller?Me.controller.signal:null),!0)]),{loaderResults:$e,fetcherResults:ht}}function jn(){st=!0,Jn.push(...Sp()),Or.forEach((re,oe)=>{Br.has(oe)&&(jr.push(oe),As(oe))})}function Ei(re,oe,he){he===void 0&&(he={}),$.fetchers.set(re,oe),En({fetchers:new Map($.fetchers)},{flushSync:(he&&he.flushSync)===!0})}function Go(re,oe,he,ye){ye===void 0&&(ye={});let Fe=Rm($.matches,oe);Hl(re),En({errors:{[Fe.route.id]:he},fetchers:new Map($.fetchers)},{flushSync:(ye&&ye.flushSync)===!0})}function ru(re){return k.v7_fetcherPersist&&(Wo.set(re,(Wo.get(re)||0)+1),Wr.has(re)&&Wr.delete(re)),$.fetchers.get(re)||dse}function Hl(re){let oe=$.fetchers.get(re);Br.has(re)&&!(oe&&oe.state==="loading"&&ut.has(re))&&As(re),Or.delete(re),ut.delete(re),er.delete(re),Wr.delete(re),$.fetchers.delete(re)}function __(re){if(k.v7_fetcherPersist){let oe=(Wo.get(re)||0)-1;oe<=0?(Wo.delete(re),Wr.add(re)):Wo.set(re,oe)}else Hl(re);En({fetchers:new Map($.fetchers)})}function As(re){let oe=Br.get(re);Ht(oe,"Expected fetch controller: "+re),oe.abort(),Br.delete(re)}function mp(re){for(let oe of re){let he=ru(oe),ye=ml(he.data);$.fetchers.set(oe,ye)}}function aa(){let re=[],oe=!1;for(let he of er){let ye=$.fetchers.get(he);Ht(ye,"Expected fetcher: "+he),ye.state==="loading"&&(er.delete(he),re.push(he),oe=!0)}return mp(re),oe}function _p(re){let oe=[];for(let[he,ye]of ut)if(ye<re){let Fe=$.fetchers.get(he);Ht(Fe,"Expected fetcher: "+he),Fe.state==="loading"&&(As(he),ut.delete(he),oe.push(he))}return mp(oe),oe.length>0}function Gv(re,oe){let he=$.blockers.get(re)||Zf;return tn.get(re)!==oe&&tn.set(re,oe),he}function E_(re){$.blockers.delete(re),tn.delete(re)}function Os(re,oe){let he=$.blockers.get(re)||Zf;Ht(he.state==="unblocked"&&oe.state==="blocked"||he.state==="blocked"&&oe.state==="blocked"||he.state==="blocked"&&oe.state==="proceeding"||he.state==="blocked"&&oe.state==="unblocked"||he.state==="proceeding"&&oe.state==="unblocked","Invalid blocker state transition: "+he.state+" -> "+oe.state);let ye=new Map($.blockers);ye.set(re,oe),En({blockers:ye})}function Ep(re){let{currentLocation:oe,nextLocation:he,historyAction:ye}=re;if(tn.size===0)return;tn.size>1&&Zh(!1,"A router only supports one blocker at a time");let Fe=Array.from(tn.entries()),[$e,ht]=Fe[Fe.length-1],Me=$.blockers.get($e);if(!(Me&&Me.state==="proceeding")&&ht({currentLocation:oe,nextLocation:he,historyAction:ye}))return $e}function gp(re){let oe=ji(404,{pathname:re}),he=C||g,{matches:ye,route:Fe}=ZB(he);return Sp(),{notFoundMatches:ye,route:Fe,error:oe}}function nu(re,oe){let he=oe.partialMatches,ye=he[he.length-1].route,Fe=ji(400,{type:"route-discovery",routeId:ye.id,pathname:re,message:oe.error!=null&&"message"in oe.error?oe.error:String(oe.error)});return{notFoundMatches:he,route:ye,error:Fe}}function Sp(re){let oe=[];return mi.forEach((he,ye)=>{(!re||re(ye))&&(he.cancel(),oe.push(ye),mi.delete(ye))}),oe}function Hv(re,oe,he){if(z=re,Q=oe,V=he||null,!G&&$.navigation===iI){G=!0;let ye=Ha($.location,$.matches);ye!=null&&En({restoreScrollPosition:ye})}return()=>{z=null,Q=null,V=null}}function bc(re,oe){return V&&V(re,oe.map(ye=>Boe(ye,$.loaderData)))||re.key}function Kv(re,oe){if(z&&Q){let he=bc(re,oe);z[he]=Q()}}function Ha(re,oe){if(z){let he=bc(re,oe),ye=z[he];if(typeof ye=="number")return ye}return null}function yp(re,oe,he){if(L)if(re){let ye=re[re.length-1].route;if(ye.path&&(ye.path==="*"||ye.path.endsWith("/*")))return{active:!0,matches:kS(oe,he,R,!0)}}else return{active:!0,matches:kS(oe,he,R,!0)||[]};return{active:!1,matches:null}}async function iu(re,oe,he){let ye=re,Fe=ye.length>0?ye[ye.length-1].route:null;for(;;){let $e=C==null,ht=C||g;try{await _se(L,oe,ye,ht,_,p,Rc,he)}catch(ot){return{type:"error",error:ot,partialMatches:ye}}finally{$e&&(g=[...g])}if(he.aborted)return{type:"aborted"};let Me=Dd(ht,oe,R),Tt=!1;if(Me){let ot=Me[Me.length-1].route;if(ot.index)return{type:"success",matches:Me};if(ot.path&&ot.path.length>0)if(ot.path==="*")Tt=!0;else return{type:"success",matches:Me}}let it=kS(ht,oe,R,!0);if(!it||ye.map(ot=>ot.route.id).join("-")===it.map(ot=>ot.route.id).join("-"))return{type:"success",matches:Tt?Me:null};if(ye=it,Fe=ye[ye.length-1].route,Fe.path==="*")return{type:"success",matches:ye}}}function zv(re){_={},C=Km(re,p,void 0,_)}function zi(re,oe){let he=C==null;DW(re,oe,C||g,_,p),he&&(g=[...g],En({}))}return ue={get basename(){return R},get future(){return k},get state(){return $},get routes(){return g},get window(){return o},initialize:up,subscribe:tu,enableScrollRestoration:Hv,navigate:m_,fetch:_i,revalidate:Ic,createHref:re=>n.history.createHref(re),encodeLocation:re=>n.history.encodeLocation(re),getFetcher:ru,deleteFetcher:__,dispose:jv,getBlocker:Gv,deleteBlocker:E_,patchRoutes:zi,_internalFetchControllers:Br,_internalActiveDeferreds:mi,_internalSetRoutes:zv},ue}function pse(n){return n!=null&&("formData"in n&&n.formData!=null||"body"in n&&n.body!==void 0)}function ub(n,o,a,d,p,_,g,C){let R,D;if(g){R=[];for(let k of o)if(R.push(k),k.route.id===g){D=k;break}}else R=o,D=o[o.length-1];let L=bW(p||".",IW(R,_),o_(n.pathname,a)||n.pathname,C==="path");return p==null&&(L.search=n.search,L.hash=n.hash),(p==null||p===""||p===".")&&D&&D.route.index&&!kA(L.search)&&(L.search=L.search?L.search.replace(/^\?/,"?index&"):"?index"),d&&a!=="/"&&(L.pathname=L.pathname==="/"?a:Dl([a,L.pathname])),i_(L)}function HB(n,o,a,d){if(!d||!pse(d))return{path:a};if(d.formMethod&&!bse(d.formMethod))return{path:a,error:ji(405,{method:d.formMethod})};let p=()=>({path:a,error:ji(400,{type:"invalid-body"})}),_=d.formMethod||"get",g=n?_.toUpperCase():_.toLowerCase(),C=PW(a);if(d.body!==void 0){if(d.formEncType==="text/plain"){if(!Xs(g))return p();let M=typeof d.body=="string"?d.body:d.body instanceof FormData||d.body instanceof URLSearchParams?Array.from(d.body.entries()).reduce((Y,z)=>{let[V,Q]=z;return""+Y+V+"="+Q+`
`},""):String(d.body);return{path:a,submission:{formMethod:g,formAction:C,formEncType:d.formEncType,formData:void 0,json:void 0,text:M}}}else if(d.formEncType==="application/json"){if(!Xs(g))return p();try{let M=typeof d.body=="string"?JSON.parse(d.body):d.body;return{path:a,submission:{formMethod:g,formAction:C,formEncType:d.formEncType,formData:void 0,json:M,text:void 0}}}catch{return p()}}}Ht(typeof FormData=="function","FormData is not available in this environment");let R,D;if(d.formData)R=hb(d.formData),D=d.formData;else if(d.body instanceof FormData)R=hb(d.body),D=d.body;else if(d.body instanceof URLSearchParams)R=d.body,D=JB(R);else if(d.body==null)R=new URLSearchParams,D=new FormData;else try{R=new URLSearchParams(d.body),D=JB(R)}catch{return p()}let L={formMethod:g,formAction:C,formEncType:d&&d.formEncType||"application/x-www-form-urlencoded",formData:D,json:void 0,text:void 0};if(Xs(L.formMethod))return{path:a,submission:L};let k=jl(a);return o&&k.search&&kA(k.search)&&R.append("index",""),k.search="?"+R,{path:i_(k),submission:L}}function fse(n,o){let a=n;if(o){let d=n.findIndex(p=>p.route.id===o);d>=0&&(a=n.slice(0,d))}return a}function KB(n,o,a,d,p,_,g,C,R,D,L,k,M,Y,z,V){let Q=V?Ao(V[1])?V[1].error:V[1].data:void 0,G=n.createURL(o.location),B=n.createURL(p),q=V&&Ao(V[1])?V[0]:void 0,se=q?fse(a,q):a,ue=V?V[1].statusCode:void 0,$=g&&ue&&ue>=400,pe=se.filter((xe,je)=>{let{route:ze}=xe;if(ze.lazy)return!0;if(ze.loader==null)return!1;if(_)return typeof ze.loader!="function"||ze.loader.hydrate?!0:o.loaderData[ze.id]===void 0&&(!o.errors||o.errors[ze.id]===void 0);if(mse(o.loaderData,o.matches[je],xe)||R.some(st=>st===xe.route.id))return!0;let St=o.matches[je],Bt=xe;return zB(xe,hn({currentUrl:G,currentParams:St.params,nextUrl:B,nextParams:Bt.params},d,{actionResult:Q,unstable_actionStatus:ue,defaultShouldRevalidate:$?!1:C||G.pathname+G.search===B.pathname+B.search||G.search!==B.search||NW(St,Bt)}))}),Oe=[];return k.forEach((xe,je)=>{if(_||!a.some(Jn=>Jn.route.id===xe.routeId)||L.has(je))return;let ze=Dd(Y,xe.path,z);if(!ze){Oe.push({key:je,routeId:xe.routeId,path:xe.path,matches:null,match:null,controller:null});return}let St=o.fetchers.get(je),Bt=dm(ze,xe.path),st=!1;M.has(je)?st=!1:D.includes(je)?st=!0:St&&St.state!=="idle"&&St.data===void 0?st=C:st=zB(Bt,hn({currentUrl:G,currentParams:o.matches[o.matches.length-1].params,nextUrl:B,nextParams:a[a.length-1].params},d,{actionResult:Q,unstable_actionStatus:ue,defaultShouldRevalidate:$?!1:C})),st&&Oe.push({key:je,routeId:xe.routeId,path:xe.path,matches:ze,match:Bt,controller:new AbortController})}),[pe,Oe]}function mse(n,o,a){let d=!o||a.route.id!==o.route.id,p=n[a.route.id]===void 0;return d||p}function NW(n,o){let a=n.route.path;return n.pathname!==o.pathname||a!=null&&a.endsWith("*")&&n.params["*"]!==o.params["*"]}function zB(n,o){if(n.route.shouldRevalidate){let a=n.route.shouldRevalidate(o);if(typeof a=="boolean")return a}return o.defaultShouldRevalidate}async function _se(n,o,a,d,p,_,g,C){let R=[o,...a.map(D=>D.route.id)].join("-");try{let D=g.get(R);D||(D=n({path:o,matches:a,patch:(L,k)=>{C.aborted||DW(L,k,d,p,_)}}),g.set(R,D)),D&&Rse(D)&&await D}finally{g.delete(R)}}function DW(n,o,a,d,p){if(n){var _;let g=d[n];Ht(g,"No route found to patch children into: routeId = "+n);let C=Km(o,p,[n,"patch",String(((_=g.children)==null?void 0:_.length)||"0")],d);g.children?g.children.push(...C):g.children=C}else{let g=Km(o,p,["patch",String(a.length||"0")],d);a.push(...g)}}async function qB(n,o,a){if(!n.lazy)return;let d=await n.lazy();if(!n.lazy)return;let p=a[n.id];Ht(p,"No route found in manifest");let _={};for(let g in d){let R=p[g]!==void 0&&g!=="hasErrorBoundary";Zh(!R,'Route "'+p.id+'" has a static property "'+g+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+g+'" will be ignored.')),!R&&!Foe.has(g)&&(_[g]=d[g])}Object.assign(p,_),Object.assign(p,hn({},o(p),{lazy:void 0}))}function Ese(n){return Promise.all(n.matches.map(o=>o.resolve()))}async function gse(n,o,a,d,p,_,g,C){let R=d.reduce((k,M)=>k.add(M.route.id),new Set),D=new Set,L=await n({matches:p.map(k=>{let M=R.has(k.route.id);return hn({},k,{shouldLoad:M,resolve:z=>(D.add(k.route.id),M?Sse(o,a,k,_,g,z,C):Promise.resolve({type:Kr.data,result:void 0}))})}),request:a,params:p[0].params,context:C});return p.forEach(k=>Ht(D.has(k.route.id),'`match.resolve()` was not called for route id "'+k.route.id+'". You must call `match.resolve()` on every match passed to `dataStrategy` to ensure all routes are properly loaded.')),L.filter((k,M)=>R.has(p[M].route.id))}async function Sse(n,o,a,d,p,_,g){let C,R,D=L=>{let k,M=new Promise((V,Q)=>k=Q);R=()=>k(),o.signal.addEventListener("abort",R);let Y=V=>typeof L!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+n+'" [routeId: '+a.route.id+"]"))):L({request:o,params:a.params,context:g},...V!==void 0?[V]:[]),z;return _?z=_(V=>Y(V)):z=(async()=>{try{return{type:"data",result:await Y()}}catch(V){return{type:"error",result:V}}})(),Promise.race([z,M])};try{let L=a.route[n];if(a.route.lazy)if(L){let k,[M]=await Promise.all([D(L).catch(Y=>{k=Y}),qB(a.route,p,d)]);if(k!==void 0)throw k;C=M}else if(await qB(a.route,p,d),L=a.route[n],L)C=await D(L);else if(n==="action"){let k=new URL(o.url),M=k.pathname+k.search;throw ji(405,{method:o.method,pathname:M,routeId:a.route.id})}else return{type:Kr.data,result:void 0};else if(L)C=await D(L);else{let k=new URL(o.url),M=k.pathname+k.search;throw ji(404,{pathname:M})}Ht(C.result!==void 0,"You defined "+(n==="action"?"an action":"a loader")+" for route "+('"'+a.route.id+"\" but didn't return anything from your `"+n+"` ")+"function. Please return a value or `null`.")}catch(L){return{type:Kr.error,result:L}}finally{R&&o.signal.removeEventListener("abort",R)}return C}async function yse(n){let{result:o,type:a,status:d}=n;if(kW(o)){let g;try{let C=o.headers.get("Content-Type");C&&/\bapplication\/json\b/.test(C)?o.body==null?g=null:g=await o.json():g=await o.text()}catch(C){return{type:Kr.error,error:C}}return a===Kr.error?{type:Kr.error,error:new DA(o.status,o.statusText,g),statusCode:o.status,headers:o.headers}:{type:Kr.data,data:g,statusCode:o.status,headers:o.headers}}if(a===Kr.error)return{type:Kr.error,error:o,statusCode:Xy(o)?o.status:d};if(Ise(o)){var p,_;return{type:Kr.deferred,deferredData:o,statusCode:(p=o.init)==null?void 0:p.status,headers:((_=o.init)==null?void 0:_.headers)&&new Headers(o.init.headers)}}return{type:Kr.data,data:o,statusCode:d}}function vse(n,o,a,d,p,_){let g=n.headers.get("Location");if(Ht(g,"Redirects returned/thrown from loaders/actions must have a Location header"),!PA.test(g)){let C=d.slice(0,d.findIndex(R=>R.route.id===a)+1);g=ub(new URL(o.url),C,p,!0,g,_),n.headers.set("Location",g)}return n}function YB(n,o,a){if(PA.test(n)){let d=n,p=d.startsWith("//")?new URL(o.protocol+d):new URL(d),_=o_(p.pathname,a)!=null;if(p.origin===o.origin&&_)return p.pathname+p.search+p.hash}return n}function Eh(n,o,a,d){let p=n.createURL(PW(o)).toString(),_={signal:a};if(d&&Xs(d.formMethod)){let{formMethod:g,formEncType:C}=d;_.method=g.toUpperCase(),C==="application/json"?(_.headers=new Headers({"Content-Type":C}),_.body=JSON.stringify(d.json)):C==="text/plain"?_.body=d.text:C==="application/x-www-form-urlencoded"&&d.formData?_.body=hb(d.formData):_.body=d.formData}return new Request(p,_)}function hb(n){let o=new URLSearchParams;for(let[a,d]of n.entries())o.append(a,typeof d=="string"?d:d.name);return o}function JB(n){let o=new FormData;for(let[a,d]of n.entries())o.append(a,d);return o}function Tse(n,o,a,d,p,_){let g={},C=null,R,D=!1,L={},k=d&&Ao(d[1])?d[1].error:void 0;return a.forEach((M,Y)=>{let z=o[Y].route.id;if(Ht(!xd(M),"Cannot handle redirect results in processLoaderData"),Ao(M)){let V=M.error;k!==void 0&&(V=k,k=void 0),C=C||{};{let Q=Rm(n,z);C[Q.route.id]==null&&(C[Q.route.id]=V)}g[z]=void 0,D||(D=!0,R=Xy(M.error)?M.error.status:500),M.headers&&(L[z]=M.headers)}else Md(M)?(p.set(z,M.deferredData),g[z]=M.deferredData.data,M.statusCode!=null&&M.statusCode!==200&&!D&&(R=M.statusCode),M.headers&&(L[z]=M.headers)):(g[z]=M.data,M.statusCode&&M.statusCode!==200&&!D&&(R=M.statusCode),M.headers&&(L[z]=M.headers))}),k!==void 0&&d&&(C={[d[0]]:k},g[d[0]]=void 0),{loaderData:g,errors:C,statusCode:R||200,loaderHeaders:L}}function XB(n,o,a,d,p,_,g,C){let{loaderData:R,errors:D}=Tse(o,a,d,p,C);for(let L=0;L<_.length;L++){let{key:k,match:M,controller:Y}=_[L];Ht(g!==void 0&&g[L]!==void 0,"Did not find corresponding fetcher result");let z=g[L];if(!(Y&&Y.signal.aborted))if(Ao(z)){let V=Rm(n.matches,M==null?void 0:M.route.id);D&&D[V.route.id]||(D=hn({},D,{[V.route.id]:z.error})),n.fetchers.delete(k)}else if(xd(z))Ht(!1,"Unhandled fetcher revalidation redirect");else if(Md(z))Ht(!1,"Unhandled fetcher deferred data");else{let V=ml(z.data);n.fetchers.set(k,V)}}return{loaderData:R,errors:D}}function $B(n,o,a,d){let p=hn({},o);for(let _ of a){let g=_.route.id;if(o.hasOwnProperty(g)?o[g]!==void 0&&(p[g]=o[g]):n[g]!==void 0&&_.route.loader&&(p[g]=n[g]),d&&d.hasOwnProperty(g))break}return p}function QB(n){return n?Ao(n[1])?{actionData:{}}:{actionData:{[n[0]]:n[1].data}}:{}}function Rm(n,o){return(o?n.slice(0,n.findIndex(d=>d.route.id===o)+1):[...n]).reverse().find(d=>d.route.hasErrorBoundary===!0)||n[0]}function ZB(n){let o=n.length===1?n[0]:n.find(a=>a.index||!a.path||a.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:o}],route:o}}function ji(n,o){let{pathname:a,routeId:d,method:p,type:_,message:g}=o===void 0?{}:o,C="Unknown Server Error",R="Unknown @remix-run/router error";return n===400?(C="Bad Request",_==="route-discovery"?R='Unable to match URL "'+a+'" - the `children()` function for '+("route `"+d+"` threw the following error:\n"+g):p&&a&&d?R="You made a "+p+' request to "'+a+'" but '+('did not provide a `loader` for route "'+d+'", ')+"so there is no way to handle the request.":_==="defer-action"?R="defer() is not supported in actions":_==="invalid-body"&&(R="Unable to encode submission body")):n===403?(C="Forbidden",R='Route "'+d+'" does not match URL "'+a+'"'):n===404?(C="Not Found",R='No route matches URL "'+a+'"'):n===405&&(C="Method Not Allowed",p&&a&&d?R="You made a "+p.toUpperCase()+' request to "'+a+'" but '+('did not provide an `action` for route "'+d+'", ')+"so there is no way to handle the request.":p&&(R='Invalid request method "'+p.toUpperCase()+'"')),new DA(n||500,C,new Error(R),!0)}function e3(n){for(let o=n.length-1;o>=0;o--){let a=n[o];if(xd(a))return{result:a,idx:o}}}function PW(n){let o=typeof n=="string"?jl(n):n;return i_(hn({},o,{hash:""}))}function Cse(n,o){return n.pathname!==o.pathname||n.search!==o.search?!1:n.hash===""?o.hash!=="":n.hash===o.hash?!0:o.hash!==""}function Rse(n){return typeof n=="object"&&n!=null&&"then"in n}function wse(n){return kW(n.result)&&cse.has(n.result.status)}function Md(n){return n.type===Kr.deferred}function Ao(n){return n.type===Kr.error}function xd(n){return(n&&n.type)===Kr.redirect}function Ise(n){let o=n;return o&&typeof o=="object"&&typeof o.data=="object"&&typeof o.subscribe=="function"&&typeof o.cancel=="function"&&typeof o.resolveData=="function"}function kW(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.headers=="object"&&typeof n.body<"u"}function bse(n){return ase.has(n.toLowerCase())}function Xs(n){return ose.has(n.toLowerCase())}async function t3(n,o,a,d,p,_){for(let g=0;g<a.length;g++){let C=a[g],R=o[g];if(!R)continue;let D=n.find(k=>k.route.id===R.route.id),L=D!=null&&!NW(D,R)&&(_&&_[R.route.id])!==void 0;if(Md(C)&&(p||L)){let k=d[g];Ht(k,"Expected an AbortSignal for revalidating fetcher deferred result"),await LW(C,k,p).then(M=>{M&&(a[g]=M||a[g])})}}}async function LW(n,o,a){if(a===void 0&&(a=!1),!await n.deferredData.resolveData(o)){if(a)try{return{type:Kr.data,data:n.deferredData.unwrappedData}}catch(p){return{type:Kr.error,error:p}}return{type:Kr.data,data:n.deferredData.data}}}function kA(n){return new URLSearchParams(n).getAll("index").some(o=>o==="")}function dm(n,o){let a=typeof o=="string"?jl(o).search:o.search;if(n[n.length-1].route.index&&kA(a||""))return n[n.length-1];let d=wW(n);return d[d.length-1]}function r3(n){let{formMethod:o,formAction:a,formEncType:d,text:p,formData:_,json:g}=n;if(!(!o||!a||!d)){if(p!=null)return{formMethod:o,formAction:a,formEncType:d,formData:void 0,json:void 0,text:p};if(_!=null)return{formMethod:o,formAction:a,formEncType:d,formData:_,json:void 0,text:void 0};if(g!==void 0)return{formMethod:o,formAction:a,formEncType:d,formData:void 0,json:g,text:void 0}}}function oI(n,o){return o?{state:"loading",location:n,formMethod:o.formMethod,formAction:o.formAction,formEncType:o.formEncType,formData:o.formData,json:o.json,text:o.text}:{state:"loading",location:n,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function Ase(n,o){return{state:"submitting",location:n,formMethod:o.formMethod,formAction:o.formAction,formEncType:o.formEncType,formData:o.formData,json:o.json,text:o.text}}function em(n,o){return n?{state:"loading",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:o}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:o}}function Ose(n,o){return{state:"submitting",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:o?o.data:void 0}}function ml(n){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function Nse(n,o){try{let a=n.sessionStorage.getItem(OW);if(a){let d=JSON.parse(a);for(let[p,_]of Object.entries(d||{}))_&&Array.isArray(_)&&o.set(p,new Set(_||[]))}}catch{}}function Dse(n,o){if(o.size>0){let a={};for(let[d,p]of o)a[d]=[...p];try{n.sessionStorage.setItem(OW,JSON.stringify(a))}catch(d){Zh(!1,"Failed to save applied view transitions in sessionStorage ("+d+").")}}}/**
 * React Router v6.24.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Sy(){return Sy=Object.assign?Object.assign.bind():function(n){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(n[d]=a[d])}return n},Sy.apply(this,arguments)}const $y=J.createContext(null),MW=J.createContext(null),Qy=J.createContext(null),LA=J.createContext(null),Jd=J.createContext({outlet:null,matches:[],isDataRoute:!1}),xW=J.createContext(null);function Zy(){return J.useContext(LA)!=null}function UW(){return Zy()||Ht(!1),J.useContext(LA).location}function VW(n){J.useContext(Qy).static||J.useLayoutEffect(n)}function MA(){let{isDataRoute:n}=J.useContext(Jd);return n?Kse():Pse()}function Pse(){Zy()||Ht(!1);let n=J.useContext($y),{basename:o,future:a,navigator:d}=J.useContext(Qy),{matches:p}=J.useContext(Jd),{pathname:_}=UW(),g=JSON.stringify(IW(p,a.v7_relativeSplatPath)),C=J.useRef(!1);return VW(()=>{C.current=!0}),J.useCallback(function(D,L){if(L===void 0&&(L={}),!C.current)return;if(typeof D=="number"){d.go(D);return}let k=bW(D,JSON.parse(g),_,L.relative==="path");n==null&&o!=="/"&&(k.pathname=k.pathname==="/"?o:Dl([o,k.pathname])),(L.replace?d.replace:d.push)(k,L.state,L)},[o,d,g,_,n])}const kse=J.createContext(null);function Lse(n){let o=J.useContext(Jd).outlet;return o&&J.createElement(kse.Provider,{value:n},o)}function Mse(n,o,a,d){Zy()||Ht(!1);let{navigator:p}=J.useContext(Qy),{matches:_}=J.useContext(Jd),g=_[_.length-1],C=g?g.params:{};g&&g.pathname;let R=g?g.pathnameBase:"/";g&&g.route;let D=UW(),L;L=D;let k=L.pathname||"/",M=k;if(R!=="/"){let V=R.replace(/^\//,"").split("/");M="/"+k.replace(/^\//,"").split("/").slice(V.length).join("/")}let Y=Dd(n,{pathname:M});return jse(Y&&Y.map(V=>Object.assign({},V,{params:Object.assign({},C,V.params),pathname:Dl([R,p.encodeLocation?p.encodeLocation(V.pathname).pathname:V.pathname]),pathnameBase:V.pathnameBase==="/"?R:Dl([R,p.encodeLocation?p.encodeLocation(V.pathnameBase).pathname:V.pathnameBase])})),_,a,d)}function xse(){let n=Hse(),o=Xy(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),a=n instanceof Error?n.stack:null,p={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return J.createElement(J.Fragment,null,J.createElement("h2",null,"Unexpected Application Error!"),J.createElement("h3",{style:{fontStyle:"italic"}},o),a?J.createElement("pre",{style:p},a):null,null)}const Use=J.createElement(xse,null);class Vse extends J.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,a){return a.location!==o.location||a.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:a.error,location:a.location,revalidation:o.revalidation||a.revalidation}}componentDidCatch(o,a){console.error("React Router caught the following error during render",o,a)}render(){return this.state.error!==void 0?J.createElement(Jd.Provider,{value:this.props.routeContext},J.createElement(xW.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Fse(n){let{routeContext:o,match:a,children:d}=n,p=J.useContext($y);return p&&p.static&&p.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(p.staticContext._deepestRenderedBoundaryId=a.route.id),J.createElement(Jd.Provider,{value:o},d)}function jse(n,o,a,d){var p;if(o===void 0&&(o=[]),a===void 0&&(a=null),d===void 0&&(d=null),n==null){var _;if((_=a)!=null&&_.errors)n=a.matches;else return null}let g=n,C=(p=a)==null?void 0:p.errors;if(C!=null){let L=g.findIndex(k=>k.route.id&&(C==null?void 0:C[k.route.id])!==void 0);L>=0||Ht(!1),g=g.slice(0,Math.min(g.length,L+1))}let R=!1,D=-1;if(a&&d&&d.v7_partialHydration)for(let L=0;L<g.length;L++){let k=g[L];if((k.route.HydrateFallback||k.route.hydrateFallbackElement)&&(D=L),k.route.id){let{loaderData:M,errors:Y}=a,z=k.route.loader&&M[k.route.id]===void 0&&(!Y||Y[k.route.id]===void 0);if(k.route.lazy||z){R=!0,D>=0?g=g.slice(0,D+1):g=[g[0]];break}}}return g.reduceRight((L,k,M)=>{let Y,z=!1,V=null,Q=null;a&&(Y=C&&k.route.id?C[k.route.id]:void 0,V=k.route.errorElement||Use,R&&(D<0&&M===0?(zse("route-fallback"),z=!0,Q=null):D===M&&(z=!0,Q=k.route.hydrateFallbackElement||null)));let G=o.concat(g.slice(0,M+1)),B=()=>{let q;return Y?q=V:z?q=Q:k.route.Component?q=J.createElement(k.route.Component,null):k.route.element?q=k.route.element:q=L,J.createElement(Fse,{match:k,routeContext:{outlet:L,matches:G,isDataRoute:a!=null},children:q})};return a&&(k.route.ErrorBoundary||k.route.errorElement||M===0)?J.createElement(Vse,{location:a.location,revalidation:a.revalidation,component:V,error:Y,children:B(),routeContext:{outlet:null,matches:G,isDataRoute:!0}}):B()},null)}var FW=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(FW||{}),yy=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(yy||{});function Bse(n){let o=J.useContext($y);return o||Ht(!1),o}function Wse(n){let o=J.useContext(MW);return o||Ht(!1),o}function Gse(n){let o=J.useContext(Jd);return o||Ht(!1),o}function jW(n){let o=Gse(),a=o.matches[o.matches.length-1];return a.route.id||Ht(!1),a.route.id}function Hse(){var n;let o=J.useContext(xW),a=Wse(yy.UseRouteError),d=jW(yy.UseRouteError);return o!==void 0?o:(n=a.errors)==null?void 0:n[d]}function Kse(){let{router:n}=Bse(FW.UseNavigateStable),o=jW(yy.UseNavigateStable),a=J.useRef(!1);return VW(()=>{a.current=!0}),J.useCallback(function(p,_){_===void 0&&(_={}),a.current&&(typeof p=="number"?n.navigate(p):n.navigate(p,Sy({fromRouteId:o},_)))},[n,o])}const n3={};function zse(n,o,a){n3[n]||(n3[n]=!0)}function qse(n){return Lse(n.context)}function Yse(n){let{basename:o="/",children:a=null,location:d,navigationType:p=xn.Pop,navigator:_,static:g=!1,future:C}=n;Zy()&&Ht(!1);let R=o.replace(/^\/*/,"/"),D=J.useMemo(()=>({basename:R,navigator:_,static:g,future:Sy({v7_relativeSplatPath:!1},C)}),[R,C,_,g]);typeof d=="string"&&(d=jl(d));let{pathname:L="/",search:k="",hash:M="",state:Y=null,key:z="default"}=d,V=J.useMemo(()=>{let Q=o_(L,R);return Q==null?null:{location:{pathname:Q,search:k,hash:M,state:Y,key:z},navigationType:p}},[R,L,k,M,Y,z,p]);return V==null?null:J.createElement(Qy.Provider,{value:D},J.createElement(LA.Provider,{children:a,value:V}))}new Promise(()=>{});function Jse(n){let o={hasErrorBoundary:n.ErrorBoundary!=null||n.errorElement!=null};return n.Component&&Object.assign(o,{element:J.createElement(n.Component),Component:void 0}),n.HydrateFallback&&Object.assign(o,{hydrateFallbackElement:J.createElement(n.HydrateFallback),HydrateFallback:void 0}),n.ErrorBoundary&&Object.assign(o,{errorElement:J.createElement(n.ErrorBoundary),ErrorBoundary:void 0}),o}/**
 * React Router DOM v6.24.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function vy(){return vy=Object.assign?Object.assign.bind():function(n){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(n[d]=a[d])}return n},vy.apply(this,arguments)}const Xse="6";try{window.__reactRouterVersion=Xse}catch{}function $se(n,o){return hse({basename:void 0,future:vy({},void 0,{v7_prependBasename:!0}),history:xoe({window:void 0}),hydrationData:Qse(),routes:n,mapRouteProperties:Jse,unstable_dataStrategy:void 0,unstable_patchRoutesOnMiss:void 0,window:void 0}).initialize()}function Qse(){var n;let o=(n=window)==null?void 0:n.__staticRouterHydrationData;return o&&o.errors&&(o=vy({},o,{errors:Zse(o.errors)})),o}function Zse(n){if(!n)return null;let o=Object.entries(n),a={};for(let[d,p]of o)if(p&&p.__type==="RouteErrorResponse")a[d]=new DA(p.status,p.statusText,p.data,p.internal===!0);else if(p&&p.__type==="Error"){if(p.__subType){let _=window[p.__subType];if(typeof _=="function")try{let g=new _(p.message);g.stack="",a[d]=g}catch{}}if(a[d]==null){let _=new Error(p.message);_.stack="",a[d]=_}}else a[d]=p;return a}const eae=J.createContext({isTransitioning:!1}),tae=J.createContext(new Map),rae="startTransition",i3=Im[rae],nae="flushSync",o3=Moe[nae];function iae(n){i3?i3(n):n()}function tm(n){o3?o3(n):n()}class oae{constructor(){this.status="pending",this.promise=new Promise((o,a)=>{this.resolve=d=>{this.status==="pending"&&(this.status="resolved",o(d))},this.reject=d=>{this.status==="pending"&&(this.status="rejected",a(d))}})}}function sae(n){let{fallbackElement:o,router:a,future:d}=n,[p,_]=J.useState(a.state),[g,C]=J.useState(),[R,D]=J.useState({isTransitioning:!1}),[L,k]=J.useState(),[M,Y]=J.useState(),[z,V]=J.useState(),Q=J.useRef(new Map),{v7_startTransition:G}=d||{},B=J.useCallback(pe=>{G?iae(pe):pe()},[G]),q=J.useCallback((pe,Oe)=>{let{deletedFetchers:xe,unstable_flushSync:je,unstable_viewTransitionOpts:ze}=Oe;xe.forEach(Bt=>Q.current.delete(Bt)),pe.fetchers.forEach((Bt,st)=>{Bt.data!==void 0&&Q.current.set(st,Bt.data)});let St=a.window==null||a.window.document==null||typeof a.window.document.startViewTransition!="function";if(!ze||St){je?tm(()=>_(pe)):B(()=>_(pe));return}if(je){tm(()=>{M&&(L&&L.resolve(),M.skipTransition()),D({isTransitioning:!0,flushSync:!0,currentLocation:ze.currentLocation,nextLocation:ze.nextLocation})});let Bt=a.window.document.startViewTransition(()=>{tm(()=>_(pe))});Bt.finished.finally(()=>{tm(()=>{k(void 0),Y(void 0),C(void 0),D({isTransitioning:!1})})}),tm(()=>Y(Bt));return}M?(L&&L.resolve(),M.skipTransition(),V({state:pe,currentLocation:ze.currentLocation,nextLocation:ze.nextLocation})):(C(pe),D({isTransitioning:!0,flushSync:!1,currentLocation:ze.currentLocation,nextLocation:ze.nextLocation}))},[a.window,M,L,Q,B]);J.useLayoutEffect(()=>a.subscribe(q),[a,q]),J.useEffect(()=>{R.isTransitioning&&!R.flushSync&&k(new oae)},[R]),J.useEffect(()=>{if(L&&g&&a.window){let pe=g,Oe=L.promise,xe=a.window.document.startViewTransition(async()=>{B(()=>_(pe)),await Oe});xe.finished.finally(()=>{k(void 0),Y(void 0),C(void 0),D({isTransitioning:!1})}),Y(xe)}},[B,g,L,a.window]),J.useEffect(()=>{L&&g&&p.location.key===g.location.key&&L.resolve()},[L,M,p.location,g]),J.useEffect(()=>{!R.isTransitioning&&z&&(C(z.state),D({isTransitioning:!0,flushSync:!1,currentLocation:z.currentLocation,nextLocation:z.nextLocation}),V(void 0))},[R.isTransitioning,z]),J.useEffect(()=>{},[]);let se=J.useMemo(()=>({createHref:a.createHref,encodeLocation:a.encodeLocation,go:pe=>a.navigate(pe),push:(pe,Oe,xe)=>a.navigate(pe,{state:Oe,preventScrollReset:xe==null?void 0:xe.preventScrollReset}),replace:(pe,Oe,xe)=>a.navigate(pe,{replace:!0,state:Oe,preventScrollReset:xe==null?void 0:xe.preventScrollReset})}),[a]),ue=a.basename||"/",$=J.useMemo(()=>({router:a,navigator:se,static:!1,basename:ue}),[a,se,ue]);return J.createElement(J.Fragment,null,J.createElement($y.Provider,{value:$},J.createElement(MW.Provider,{value:p},J.createElement(tae.Provider,{value:Q.current},J.createElement(eae.Provider,{value:R},J.createElement(Yse,{basename:ue,location:p.location,navigationType:p.historyAction,navigator:se,future:{v7_relativeSplatPath:a.future.v7_relativeSplatPath}},p.initialized||a.future.v7_partialHydration?J.createElement(aae,{routes:a.routes,future:a.future,state:p}):o))))),null)}function aae(n){let{routes:o,future:a,state:d}=n;return Mse(o,void 0,d,a)}var s3;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(s3||(s3={}));var a3;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(a3||(a3={}));let cae={data:""},lae=n=>typeof window=="object"?((n?n.querySelector("#_goober"):window._goober)||Object.assign((n||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:n||cae,dae=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,uae=/\/\*[^]*?\*\/|  +/g,c3=/\n+/g,yl=(n,o)=>{let a="",d="",p="";for(let _ in n){let g=n[_];_[0]=="@"?_[1]=="i"?a=_+" "+g+";":d+=_[1]=="f"?yl(g,_):_+"{"+yl(g,_[1]=="k"?"":o)+"}":typeof g=="object"?d+=yl(g,o?o.replace(/([^,])+/g,C=>_.replace(/(^:.*)|([^,])+/g,R=>/&/.test(R)?R.replace(/&/g,C):C?C+" "+R:R)):_):g!=null&&(_=/^--/.test(_)?_:_.replace(/[A-Z]/g,"-$&").toLowerCase(),p+=yl.p?yl.p(_,g):_+":"+g+";")}return a+(o&&p?o+"{"+p+"}":p)+d},lc={},BW=n=>{if(typeof n=="object"){let o="";for(let a in n)o+=a+BW(n[a]);return o}return n},hae=(n,o,a,d,p)=>{let _=BW(n),g=lc[_]||(lc[_]=(R=>{let D=0,L=11;for(;D<R.length;)L=101*L+R.charCodeAt(D++)>>>0;return"go"+L})(_));if(!lc[g]){let R=_!==n?n:(D=>{let L,k,M=[{}];for(;L=dae.exec(D.replace(uae,""));)L[4]?M.shift():L[3]?(k=L[3].replace(c3," ").trim(),M.unshift(M[0][k]=M[0][k]||{})):M[0][L[1]]=L[2].replace(c3," ").trim();return M[0]})(n);lc[g]=yl(p?{["@keyframes "+g]:R}:R,a?"":"."+g)}let C=a&&lc.g?lc.g:null;return a&&(lc.g=lc[g]),((R,D,L,k)=>{k?D.data=D.data.replace(k,R):D.data.indexOf(R)===-1&&(D.data=L?R+D.data:D.data+R)})(lc[g],o,d,C),g},pae=(n,o,a)=>n.reduce((d,p,_)=>{let g=o[_];if(g&&g.call){let C=g(a),R=C&&C.props&&C.props.className||/^go/.test(C)&&C;g=R?"."+R:C&&typeof C=="object"?C.props?"":yl(C,""):C===!1?"":C}return d+p+(g??"")},"");function ev(n){let o=this||{},a=n.call?n(o.p):n;return hae(a.unshift?a.raw?pae(a,[].slice.call(arguments,1),o.p):a.reduce((d,p)=>Object.assign(d,p&&p.call?p(o.p):p),{}):a,lae(o.target),o.g,o.o,o.k)}let WW,pb,fb;ev.bind({g:1});let vc=ev.bind({k:1});function fae(n,o,a,d){yl.p=o,WW=n,pb=a,fb=d}function Bl(n,o){let a=this||{};return function(){let d=arguments;function p(_,g){let C=Object.assign({},_),R=C.className||p.className;a.p=Object.assign({theme:pb&&pb()},C),a.o=/ *go\d+/.test(R),C.className=ev.apply(a,d)+(R?" "+R:"");let D=n;return n[0]&&(D=C.as||n,delete C.as),fb&&D[0]&&fb(C),WW(D,C)}return p}}var mae=n=>typeof n=="function",Ty=(n,o)=>mae(n)?n(o):n,_ae=(()=>{let n=0;return()=>(++n).toString()})(),GW=(()=>{let n;return()=>{if(n===void 0&&typeof window<"u"){let o=matchMedia("(prefers-reduced-motion: reduce)");n=!o||o.matches}return n}})(),Eae=20,LS=new Map,gae=1e3,l3=n=>{if(LS.has(n))return;let o=setTimeout(()=>{LS.delete(n),Xd({type:4,toastId:n})},gae);LS.set(n,o)},Sae=n=>{let o=LS.get(n);o&&clearTimeout(o)},mb=(n,o)=>{switch(o.type){case 0:return{...n,toasts:[o.toast,...n.toasts].slice(0,Eae)};case 1:return o.toast.id&&Sae(o.toast.id),{...n,toasts:n.toasts.map(_=>_.id===o.toast.id?{..._,...o.toast}:_)};case 2:let{toast:a}=o;return n.toasts.find(_=>_.id===a.id)?mb(n,{type:1,toast:a}):mb(n,{type:0,toast:a});case 3:let{toastId:d}=o;return d?l3(d):n.toasts.forEach(_=>{l3(_.id)}),{...n,toasts:n.toasts.map(_=>_.id===d||d===void 0?{..._,visible:!1}:_)};case 4:return o.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(_=>_.id!==o.toastId)};case 5:return{...n,pausedAt:o.time};case 6:let p=o.time-(n.pausedAt||0);return{...n,pausedAt:void 0,toasts:n.toasts.map(_=>({..._,pauseDuration:_.pauseDuration+p}))}}},MS=[],xS={toasts:[],pausedAt:void 0},Xd=n=>{xS=mb(xS,n),MS.forEach(o=>{o(xS)})},yae={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},vae=(n={})=>{let[o,a]=J.useState(xS);J.useEffect(()=>(MS.push(a),()=>{let p=MS.indexOf(a);p>-1&&MS.splice(p,1)}),[o]);let d=o.toasts.map(p=>{var _,g;return{...n,...n[p.type],...p,duration:p.duration||((_=n[p.type])==null?void 0:_.duration)||(n==null?void 0:n.duration)||yae[p.type],style:{...n.style,...(g=n[p.type])==null?void 0:g.style,...p.style}}});return{...o,toasts:d}},Tae=(n,o="blank",a)=>({createdAt:Date.now(),visible:!0,type:o,ariaProps:{role:"status","aria-live":"polite"},message:n,pauseDuration:0,...a,id:(a==null?void 0:a.id)||_ae()}),s_=n=>(o,a)=>{let d=Tae(o,n,a);return Xd({type:2,toast:d}),d.id},Do=(n,o)=>s_("blank")(n,o);Do.error=s_("error");Do.success=s_("success");Do.loading=s_("loading");Do.custom=s_("custom");Do.dismiss=n=>{Xd({type:3,toastId:n})};Do.remove=n=>Xd({type:4,toastId:n});Do.promise=(n,o,a)=>{let d=Do.loading(o.loading,{...a,...a==null?void 0:a.loading});return n.then(p=>(Do.success(Ty(o.success,p),{id:d,...a,...a==null?void 0:a.success}),p)).catch(p=>{Do.error(Ty(o.error,p),{id:d,...a,...a==null?void 0:a.error})}),n};var Cae=(n,o)=>{Xd({type:1,toast:{id:n,height:o}})},Rae=()=>{Xd({type:5,time:Date.now()})},wae=n=>{let{toasts:o,pausedAt:a}=vae(n);J.useEffect(()=>{if(a)return;let _=Date.now(),g=o.map(C=>{if(C.duration===1/0)return;let R=(C.duration||0)+C.pauseDuration-(_-C.createdAt);if(R<0){C.visible&&Do.dismiss(C.id);return}return setTimeout(()=>Do.dismiss(C.id),R)});return()=>{g.forEach(C=>C&&clearTimeout(C))}},[o,a]);let d=J.useCallback(()=>{a&&Xd({type:6,time:Date.now()})},[a]),p=J.useCallback((_,g)=>{let{reverseOrder:C=!1,gutter:R=8,defaultPosition:D}=g||{},L=o.filter(Y=>(Y.position||D)===(_.position||D)&&Y.height),k=L.findIndex(Y=>Y.id===_.id),M=L.filter((Y,z)=>z<k&&Y.visible).length;return L.filter(Y=>Y.visible).slice(...C?[M+1]:[0,M]).reduce((Y,z)=>Y+(z.height||0)+R,0)},[o]);return{toasts:o,handlers:{updateHeight:Cae,startPause:Rae,endPause:d,calculateOffset:p}}},Iae=vc`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,bae=vc`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Aae=vc`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Oae=Bl("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Iae} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${bae} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${n=>n.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Aae} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Nae=vc`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Dae=Bl("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${n=>n.secondary||"#e0e0e0"};
  border-right-color: ${n=>n.primary||"#616161"};
  animation: ${Nae} 1s linear infinite;
`,Pae=vc`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,kae=vc`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Lae=Bl("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Pae} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${kae} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${n=>n.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Mae=Bl("div")`
  position: absolute;
`,xae=Bl("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Uae=vc`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Vae=Bl("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Uae} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Fae=({toast:n})=>{let{icon:o,type:a,iconTheme:d}=n;return o!==void 0?typeof o=="string"?J.createElement(Vae,null,o):o:a==="blank"?null:J.createElement(xae,null,J.createElement(Dae,{...d}),a!=="loading"&&J.createElement(Mae,null,a==="error"?J.createElement(Oae,{...d}):J.createElement(Lae,{...d})))},jae=n=>`
0% {transform: translate3d(0,${n*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Bae=n=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${n*-150}%,-1px) scale(.6); opacity:0;}
`,Wae="0%{opacity:0;} 100%{opacity:1;}",Gae="0%{opacity:1;} 100%{opacity:0;}",Hae=Bl("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Kae=Bl("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,zae=(n,o)=>{let a=n.includes("top")?1:-1,[d,p]=GW()?[Wae,Gae]:[jae(a),Bae(a)];return{animation:o?`${vc(d)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${vc(p)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},qae=J.memo(({toast:n,position:o,style:a,children:d})=>{let p=n.height?zae(n.position||o||"top-center",n.visible):{opacity:0},_=J.createElement(Fae,{toast:n}),g=J.createElement(Kae,{...n.ariaProps},Ty(n.message,n));return J.createElement(Hae,{className:n.className,style:{...p,...a,...n.style}},typeof d=="function"?d({icon:_,message:g}):J.createElement(J.Fragment,null,_,g))});fae(J.createElement);var Yae=({id:n,className:o,style:a,onHeightUpdate:d,children:p})=>{let _=J.useCallback(g=>{if(g){let C=()=>{let R=g.getBoundingClientRect().height;d(n,R)};C(),new MutationObserver(C).observe(g,{subtree:!0,childList:!0,characterData:!0})}},[n,d]);return J.createElement("div",{ref:_,className:o,style:a},p)},Jae=(n,o)=>{let a=n.includes("top"),d=a?{top:0}:{bottom:0},p=n.includes("center")?{justifyContent:"center"}:n.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:GW()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${o*(a?1:-1)}px)`,...d,...p}},Xae=ev`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,dS=16,$ae=({reverseOrder:n,position:o="top-center",toastOptions:a,gutter:d,children:p,containerStyle:_,containerClassName:g})=>{let{toasts:C,handlers:R}=wae(a);return J.createElement("div",{style:{position:"fixed",zIndex:9999,top:dS,left:dS,right:dS,bottom:dS,pointerEvents:"none",..._},className:g,onMouseEnter:R.startPause,onMouseLeave:R.endPause},C.map(D=>{let L=D.position||o,k=R.calculateOffset(D,{reverseOrder:n,gutter:d,defaultPosition:o}),M=Jae(L,k);return J.createElement(Yae,{id:D.id,key:D.id,onHeightUpdate:R.updateHeight,className:D.visible?Xae:"",style:M},D.type==="custom"?Ty(D.message,D):p?p(D):J.createElement(qae,{toast:D,position:L}))}))},Fd=Do;function HW(){return Z.jsxs(Z.Fragment,{children:[Z.jsx($ae,{}),Z.jsx(qse,{})]})}const zm={black:"#000",white:"#fff"},gh={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},Sh={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},yh={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},vh={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},Th={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},rm={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Qae={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};function qm(n){let o="https://mui.com/production-error/?code="+n;for(let a=1;a<arguments.length;a+=1)o+="&args[]="+encodeURIComponent(arguments[a]);return"Minified MUI error #"+n+"; visit "+o+" for the full message."}const Zae=Object.freeze(Object.defineProperty({__proto__:null,default:qm},Symbol.toStringTag,{value:"Module"})),ece="$$material";function It(){return It=Object.assign?Object.assign.bind():function(n){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var d in a)({}).hasOwnProperty.call(a,d)&&(n[d]=a[d])}return n},It.apply(null,arguments)}function Rs(n,o){if(n==null)return{};var a={};for(var d in n)if({}.hasOwnProperty.call(n,d)){if(o.includes(d))continue;a[d]=n[d]}return a}function KW(n){var o=Object.create(null);return function(a){return o[a]===void 0&&(o[a]=n(a)),o[a]}}var tce=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,rce=KW(function(n){return tce.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91});function nce(n){if(n.sheet)return n.sheet;for(var o=0;o<document.styleSheets.length;o++)if(document.styleSheets[o].ownerNode===n)return document.styleSheets[o]}function ice(n){var o=document.createElement("style");return o.setAttribute("data-emotion",n.key),n.nonce!==void 0&&o.setAttribute("nonce",n.nonce),o.appendChild(document.createTextNode("")),o.setAttribute("data-s",""),o}var oce=function(){function n(a){var d=this;this._insertTag=function(p){var _;d.tags.length===0?d.insertionPoint?_=d.insertionPoint.nextSibling:d.prepend?_=d.container.firstChild:_=d.before:_=d.tags[d.tags.length-1].nextSibling,d.container.insertBefore(p,_),d.tags.push(p)},this.isSpeedy=a.speedy===void 0?!0:a.speedy,this.tags=[],this.ctr=0,this.nonce=a.nonce,this.key=a.key,this.container=a.container,this.prepend=a.prepend,this.insertionPoint=a.insertionPoint,this.before=null}var o=n.prototype;return o.hydrate=function(d){d.forEach(this._insertTag)},o.insert=function(d){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(ice(this));var p=this.tags[this.tags.length-1];if(this.isSpeedy){var _=nce(p);try{_.insertRule(d,_.cssRules.length)}catch{}}else p.appendChild(document.createTextNode(d));this.ctr++},o.flush=function(){this.tags.forEach(function(d){return d.parentNode&&d.parentNode.removeChild(d)}),this.tags=[],this.ctr=0},n}(),Oi="-ms-",Cy="-moz-",hr="-webkit-",zW="comm",xA="rule",UA="decl",sce="@import",qW="@keyframes",ace="@layer",cce=Math.abs,tv=String.fromCharCode,lce=Object.assign;function dce(n,o){return hi(n,0)^45?(((o<<2^hi(n,0))<<2^hi(n,1))<<2^hi(n,2))<<2^hi(n,3):0}function YW(n){return n.trim()}function uce(n,o){return(n=o.exec(n))?n[0]:n}function pr(n,o,a){return n.replace(o,a)}function _b(n,o){return n.indexOf(o)}function hi(n,o){return n.charCodeAt(o)|0}function Ym(n,o,a){return n.slice(o,a)}function La(n){return n.length}function VA(n){return n.length}function uS(n,o){return o.push(n),n}function hce(n,o){return n.map(o).join("")}var rv=1,ep=1,JW=0,po=0,Un=0,sp="";function nv(n,o,a,d,p,_,g){return{value:n,root:o,parent:a,type:d,props:p,children:_,line:rv,column:ep,length:g,return:""}}function nm(n,o){return lce(nv("",null,null,"",null,null,0),n,{length:-n.length},o)}function pce(){return Un}function fce(){return Un=po>0?hi(sp,--po):0,ep--,Un===10&&(ep=1,rv--),Un}function Mo(){return Un=po<JW?hi(sp,po++):0,ep++,Un===10&&(ep=1,rv++),Un}function Fa(){return hi(sp,po)}function US(){return po}function a_(n,o){return Ym(sp,n,o)}function Jm(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function XW(n){return rv=ep=1,JW=La(sp=n),po=0,[]}function $W(n){return sp="",n}function VS(n){return YW(a_(po-1,Eb(n===91?n+2:n===40?n+1:n)))}function mce(n){for(;(Un=Fa())&&Un<33;)Mo();return Jm(n)>2||Jm(Un)>3?"":" "}function _ce(n,o){for(;--o&&Mo()&&!(Un<48||Un>102||Un>57&&Un<65||Un>70&&Un<97););return a_(n,US()+(o<6&&Fa()==32&&Mo()==32))}function Eb(n){for(;Mo();)switch(Un){case n:return po;case 34:case 39:n!==34&&n!==39&&Eb(Un);break;case 40:n===41&&Eb(n);break;case 92:Mo();break}return po}function Ece(n,o){for(;Mo()&&n+Un!==57;)if(n+Un===84&&Fa()===47)break;return"/*"+a_(o,po-1)+"*"+tv(n===47?n:Mo())}function gce(n){for(;!Jm(Fa());)Mo();return a_(n,po)}function Sce(n){return $W(FS("",null,null,null,[""],n=XW(n),0,[0],n))}function FS(n,o,a,d,p,_,g,C,R){for(var D=0,L=0,k=g,M=0,Y=0,z=0,V=1,Q=1,G=1,B=0,q="",se=p,ue=_,$=d,pe=q;Q;)switch(z=B,B=Mo()){case 40:if(z!=108&&hi(pe,k-1)==58){_b(pe+=pr(VS(B),"&","&\f"),"&\f")!=-1&&(G=-1);break}case 34:case 39:case 91:pe+=VS(B);break;case 9:case 10:case 13:case 32:pe+=mce(z);break;case 92:pe+=_ce(US()-1,7);continue;case 47:switch(Fa()){case 42:case 47:uS(yce(Ece(Mo(),US()),o,a),R);break;default:pe+="/"}break;case 123*V:C[D++]=La(pe)*G;case 125*V:case 59:case 0:switch(B){case 0:case 125:Q=0;case 59+L:G==-1&&(pe=pr(pe,/\f/g,"")),Y>0&&La(pe)-k&&uS(Y>32?u3(pe+";",d,a,k-1):u3(pr(pe," ","")+";",d,a,k-2),R);break;case 59:pe+=";";default:if(uS($=d3(pe,o,a,D,L,p,C,q,se=[],ue=[],k),_),B===123)if(L===0)FS(pe,o,$,$,se,_,k,C,ue);else switch(M===99&&hi(pe,3)===110?100:M){case 100:case 108:case 109:case 115:FS(n,$,$,d&&uS(d3(n,$,$,0,0,p,C,q,p,se=[],k),ue),p,ue,k,C,d?se:ue);break;default:FS(pe,$,$,$,[""],ue,0,C,ue)}}D=L=Y=0,V=G=1,q=pe="",k=g;break;case 58:k=1+La(pe),Y=z;default:if(V<1){if(B==123)--V;else if(B==125&&V++==0&&fce()==125)continue}switch(pe+=tv(B),B*V){case 38:G=L>0?1:(pe+="\f",-1);break;case 44:C[D++]=(La(pe)-1)*G,G=1;break;case 64:Fa()===45&&(pe+=VS(Mo())),M=Fa(),L=k=La(q=pe+=gce(US())),B++;break;case 45:z===45&&La(pe)==2&&(V=0)}}return _}function d3(n,o,a,d,p,_,g,C,R,D,L){for(var k=p-1,M=p===0?_:[""],Y=VA(M),z=0,V=0,Q=0;z<d;++z)for(var G=0,B=Ym(n,k+1,k=cce(V=g[z])),q=n;G<Y;++G)(q=YW(V>0?M[G]+" "+B:pr(B,/&\f/g,M[G])))&&(R[Q++]=q);return nv(n,o,a,p===0?xA:C,R,D,L)}function yce(n,o,a){return nv(n,o,a,zW,tv(pce()),Ym(n,2,-2),0)}function u3(n,o,a,d){return nv(n,o,a,UA,Ym(n,0,d),Ym(n,d+1,-1),d)}function Gh(n,o){for(var a="",d=VA(n),p=0;p<d;p++)a+=o(n[p],p,n,o)||"";return a}function vce(n,o,a,d){switch(n.type){case ace:if(n.children.length)break;case sce:case UA:return n.return=n.return||n.value;case zW:return"";case qW:return n.return=n.value+"{"+Gh(n.children,d)+"}";case xA:n.value=n.props.join(",")}return La(a=Gh(n.children,d))?n.return=n.value+"{"+a+"}":""}function Tce(n){var o=VA(n);return function(a,d,p,_){for(var g="",C=0;C<o;C++)g+=n[C](a,d,p,_)||"";return g}}function Cce(n){return function(o){o.root||(o=o.return)&&n(o)}}var Rce=function(o,a,d){for(var p=0,_=0;p=_,_=Fa(),p===38&&_===12&&(a[d]=1),!Jm(_);)Mo();return a_(o,po)},wce=function(o,a){var d=-1,p=44;do switch(Jm(p)){case 0:p===38&&Fa()===12&&(a[d]=1),o[d]+=Rce(po-1,a,d);break;case 2:o[d]+=VS(p);break;case 4:if(p===44){o[++d]=Fa()===58?"&\f":"",a[d]=o[d].length;break}default:o[d]+=tv(p)}while(p=Mo());return o},Ice=function(o,a){return $W(wce(XW(o),a))},h3=new WeakMap,bce=function(o){if(!(o.type!=="rule"||!o.parent||o.length<1)){for(var a=o.value,d=o.parent,p=o.column===d.column&&o.line===d.line;d.type!=="rule";)if(d=d.parent,!d)return;if(!(o.props.length===1&&a.charCodeAt(0)!==58&&!h3.get(d))&&!p){h3.set(o,!0);for(var _=[],g=Ice(a,_),C=d.props,R=0,D=0;R<g.length;R++)for(var L=0;L<C.length;L++,D++)o.props[D]=_[R]?g[R].replace(/&\f/g,C[L]):C[L]+" "+g[R]}}},Ace=function(o){if(o.type==="decl"){var a=o.value;a.charCodeAt(0)===108&&a.charCodeAt(2)===98&&(o.return="",o.value="")}};function QW(n,o){switch(dce(n,o)){case 5103:return hr+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return hr+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return hr+n+Cy+n+Oi+n+n;case 6828:case 4268:return hr+n+Oi+n+n;case 6165:return hr+n+Oi+"flex-"+n+n;case 5187:return hr+n+pr(n,/(\w+).+(:[^]+)/,hr+"box-$1$2"+Oi+"flex-$1$2")+n;case 5443:return hr+n+Oi+"flex-item-"+pr(n,/flex-|-self/,"")+n;case 4675:return hr+n+Oi+"flex-line-pack"+pr(n,/align-content|flex-|-self/,"")+n;case 5548:return hr+n+Oi+pr(n,"shrink","negative")+n;case 5292:return hr+n+Oi+pr(n,"basis","preferred-size")+n;case 6060:return hr+"box-"+pr(n,"-grow","")+hr+n+Oi+pr(n,"grow","positive")+n;case 4554:return hr+pr(n,/([^-])(transform)/g,"$1"+hr+"$2")+n;case 6187:return pr(pr(pr(n,/(zoom-|grab)/,hr+"$1"),/(image-set)/,hr+"$1"),n,"")+n;case 5495:case 3959:return pr(n,/(image-set\([^]*)/,hr+"$1$`$1");case 4968:return pr(pr(n,/(.+:)(flex-)?(.*)/,hr+"box-pack:$3"+Oi+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+hr+n+n;case 4095:case 3583:case 4068:case 2532:return pr(n,/(.+)-inline(.+)/,hr+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(La(n)-1-o>6)switch(hi(n,o+1)){case 109:if(hi(n,o+4)!==45)break;case 102:return pr(n,/(.+:)(.+)-([^]+)/,"$1"+hr+"$2-$3$1"+Cy+(hi(n,o+3)==108?"$3":"$2-$3"))+n;case 115:return~_b(n,"stretch")?QW(pr(n,"stretch","fill-available"),o)+n:n}break;case 4949:if(hi(n,o+1)!==115)break;case 6444:switch(hi(n,La(n)-3-(~_b(n,"!important")&&10))){case 107:return pr(n,":",":"+hr)+n;case 101:return pr(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+hr+(hi(n,14)===45?"inline-":"")+"box$3$1"+hr+"$2$3$1"+Oi+"$2box$3")+n}break;case 5936:switch(hi(n,o+11)){case 114:return hr+n+Oi+pr(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return hr+n+Oi+pr(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return hr+n+Oi+pr(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return hr+n+Oi+n+n}return n}var Oce=function(o,a,d,p){if(o.length>-1&&!o.return)switch(o.type){case UA:o.return=QW(o.value,o.length);break;case qW:return Gh([nm(o,{value:pr(o.value,"@","@"+hr)})],p);case xA:if(o.length)return hce(o.props,function(_){switch(uce(_,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Gh([nm(o,{props:[pr(_,/:(read-\w+)/,":"+Cy+"$1")]})],p);case"::placeholder":return Gh([nm(o,{props:[pr(_,/:(plac\w+)/,":"+hr+"input-$1")]}),nm(o,{props:[pr(_,/:(plac\w+)/,":"+Cy+"$1")]}),nm(o,{props:[pr(_,/:(plac\w+)/,Oi+"input-$1")]})],p)}return""})}},Nce=[Oce],ZW=function(o){var a=o.key;if(a==="css"){var d=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(d,function(V){var Q=V.getAttribute("data-emotion");Q.indexOf(" ")!==-1&&(document.head.appendChild(V),V.setAttribute("data-s",""))})}var p=o.stylisPlugins||Nce,_={},g,C=[];g=o.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+a+' "]'),function(V){for(var Q=V.getAttribute("data-emotion").split(" "),G=1;G<Q.length;G++)_[Q[G]]=!0;C.push(V)});var R,D=[bce,Ace];{var L,k=[vce,Cce(function(V){L.insert(V)})],M=Tce(D.concat(p,k)),Y=function(Q){return Gh(Sce(Q),M)};R=function(Q,G,B,q){L=B,Y(Q?Q+"{"+G.styles+"}":G.styles),q&&(z.inserted[G.name]=!0)}}var z={key:a,sheet:new oce({key:a,container:g,nonce:o.nonce,speedy:o.speedy,prepend:o.prepend,insertionPoint:o.insertionPoint}),nonce:o.nonce,inserted:_,registered:{},insert:R};return z.sheet.hydrate(C),z},e6={exports:{}},br={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oi=typeof Symbol=="function"&&Symbol.for,FA=oi?Symbol.for("react.element"):60103,jA=oi?Symbol.for("react.portal"):60106,iv=oi?Symbol.for("react.fragment"):60107,ov=oi?Symbol.for("react.strict_mode"):60108,sv=oi?Symbol.for("react.profiler"):60114,av=oi?Symbol.for("react.provider"):60109,cv=oi?Symbol.for("react.context"):60110,BA=oi?Symbol.for("react.async_mode"):60111,lv=oi?Symbol.for("react.concurrent_mode"):60111,dv=oi?Symbol.for("react.forward_ref"):60112,uv=oi?Symbol.for("react.suspense"):60113,Dce=oi?Symbol.for("react.suspense_list"):60120,hv=oi?Symbol.for("react.memo"):60115,pv=oi?Symbol.for("react.lazy"):60116,Pce=oi?Symbol.for("react.block"):60121,kce=oi?Symbol.for("react.fundamental"):60117,Lce=oi?Symbol.for("react.responder"):60118,Mce=oi?Symbol.for("react.scope"):60119;function Bo(n){if(typeof n=="object"&&n!==null){var o=n.$$typeof;switch(o){case FA:switch(n=n.type,n){case BA:case lv:case iv:case sv:case ov:case uv:return n;default:switch(n=n&&n.$$typeof,n){case cv:case dv:case pv:case hv:case av:return n;default:return o}}case jA:return o}}}function t6(n){return Bo(n)===lv}br.AsyncMode=BA;br.ConcurrentMode=lv;br.ContextConsumer=cv;br.ContextProvider=av;br.Element=FA;br.ForwardRef=dv;br.Fragment=iv;br.Lazy=pv;br.Memo=hv;br.Portal=jA;br.Profiler=sv;br.StrictMode=ov;br.Suspense=uv;br.isAsyncMode=function(n){return t6(n)||Bo(n)===BA};br.isConcurrentMode=t6;br.isContextConsumer=function(n){return Bo(n)===cv};br.isContextProvider=function(n){return Bo(n)===av};br.isElement=function(n){return typeof n=="object"&&n!==null&&n.$$typeof===FA};br.isForwardRef=function(n){return Bo(n)===dv};br.isFragment=function(n){return Bo(n)===iv};br.isLazy=function(n){return Bo(n)===pv};br.isMemo=function(n){return Bo(n)===hv};br.isPortal=function(n){return Bo(n)===jA};br.isProfiler=function(n){return Bo(n)===sv};br.isStrictMode=function(n){return Bo(n)===ov};br.isSuspense=function(n){return Bo(n)===uv};br.isValidElementType=function(n){return typeof n=="string"||typeof n=="function"||n===iv||n===lv||n===sv||n===ov||n===uv||n===Dce||typeof n=="object"&&n!==null&&(n.$$typeof===pv||n.$$typeof===hv||n.$$typeof===av||n.$$typeof===cv||n.$$typeof===dv||n.$$typeof===kce||n.$$typeof===Lce||n.$$typeof===Mce||n.$$typeof===Pce)};br.typeOf=Bo;e6.exports=br;var xce=e6.exports,r6=xce,Uce={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Vce={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},n6={};n6[r6.ForwardRef]=Uce;n6[r6.Memo]=Vce;var Fce=!0;function jce(n,o,a){var d="";return a.split(" ").forEach(function(p){n[p]!==void 0?o.push(n[p]+";"):d+=p+" "}),d}var i6=function(o,a,d){var p=o.key+"-"+a.name;(d===!1||Fce===!1)&&o.registered[p]===void 0&&(o.registered[p]=a.styles)},o6=function(o,a,d){i6(o,a,d);var p=o.key+"-"+a.name;if(o.inserted[a.name]===void 0){var _=a;do o.insert(a===_?"."+p:"",_,o.sheet,!0),_=_.next;while(_!==void 0)}};function Bce(n){for(var o=0,a,d=0,p=n.length;p>=4;++d,p-=4)a=n.charCodeAt(d)&255|(n.charCodeAt(++d)&255)<<8|(n.charCodeAt(++d)&255)<<16|(n.charCodeAt(++d)&255)<<24,a=(a&65535)*1540483477+((a>>>16)*59797<<16),a^=a>>>24,o=(a&65535)*1540483477+((a>>>16)*59797<<16)^(o&65535)*1540483477+((o>>>16)*59797<<16);switch(p){case 3:o^=(n.charCodeAt(d+2)&255)<<16;case 2:o^=(n.charCodeAt(d+1)&255)<<8;case 1:o^=n.charCodeAt(d)&255,o=(o&65535)*1540483477+((o>>>16)*59797<<16)}return o^=o>>>13,o=(o&65535)*1540483477+((o>>>16)*59797<<16),((o^o>>>15)>>>0).toString(36)}var Wce={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Gce=/[A-Z]|^ms/g,Hce=/_EMO_([^_]+?)_([^]*?)_EMO_/g,s6=function(o){return o.charCodeAt(1)===45},p3=function(o){return o!=null&&typeof o!="boolean"},sI=KW(function(n){return s6(n)?n:n.replace(Gce,"-$&").toLowerCase()}),f3=function(o,a){switch(o){case"animation":case"animationName":if(typeof a=="string")return a.replace(Hce,function(d,p,_){return Ma={name:p,styles:_,next:Ma},p})}return Wce[o]!==1&&!s6(o)&&typeof a=="number"&&a!==0?a+"px":a};function Xm(n,o,a){if(a==null)return"";if(a.__emotion_styles!==void 0)return a;switch(typeof a){case"boolean":return"";case"object":{if(a.anim===1)return Ma={name:a.name,styles:a.styles,next:Ma},a.name;if(a.styles!==void 0){var d=a.next;if(d!==void 0)for(;d!==void 0;)Ma={name:d.name,styles:d.styles,next:Ma},d=d.next;var p=a.styles+";";return p}return Kce(n,o,a)}case"function":{if(n!==void 0){var _=Ma,g=a(n);return Ma=_,Xm(n,o,g)}break}}if(o==null)return a;var C=o[a];return C!==void 0?C:a}function Kce(n,o,a){var d="";if(Array.isArray(a))for(var p=0;p<a.length;p++)d+=Xm(n,o,a[p])+";";else for(var _ in a){var g=a[_];if(typeof g!="object")o!=null&&o[g]!==void 0?d+=_+"{"+o[g]+"}":p3(g)&&(d+=sI(_)+":"+f3(_,g)+";");else if(Array.isArray(g)&&typeof g[0]=="string"&&(o==null||o[g[0]]===void 0))for(var C=0;C<g.length;C++)p3(g[C])&&(d+=sI(_)+":"+f3(_,g[C])+";");else{var R=Xm(n,o,g);switch(_){case"animation":case"animationName":{d+=sI(_)+":"+R+";";break}default:d+=_+"{"+R+"}"}}}return d}var m3=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Ma,WA=function(o,a,d){if(o.length===1&&typeof o[0]=="object"&&o[0]!==null&&o[0].styles!==void 0)return o[0];var p=!0,_="";Ma=void 0;var g=o[0];g==null||g.raw===void 0?(p=!1,_+=Xm(d,a,g)):_+=g[0];for(var C=1;C<o.length;C++)_+=Xm(d,a,o[C]),p&&(_+=g[C]);m3.lastIndex=0;for(var R="",D;(D=m3.exec(_))!==null;)R+="-"+D[1];var L=Bce(_)+R;return{name:L,styles:_,next:Ma}},zce=function(o){return o()},a6=Im.useInsertionEffect?Im.useInsertionEffect:!1,qce=a6||zce,_3=a6||J.useLayoutEffect,c6=J.createContext(typeof HTMLElement<"u"?ZW({key:"css"}):null),Yce=c6.Provider,l6=function(o){return J.forwardRef(function(a,d){var p=J.useContext(c6);return o(a,p,d)})},fv=J.createContext({}),aI={exports:{}},E3;function d6(){return E3||(E3=1,function(n){function o(){return n.exports=o=Object.assign?Object.assign.bind():function(a){for(var d=1;d<arguments.length;d++){var p=arguments[d];for(var _ in p)({}).hasOwnProperty.call(p,_)&&(a[_]=p[_])}return a},n.exports.__esModule=!0,n.exports.default=n.exports,o.apply(null,arguments)}n.exports=o,n.exports.__esModule=!0,n.exports.default=n.exports}(aI)),aI.exports}d6();var Jce=l6(function(n,o){var a=n.styles,d=WA([a],void 0,J.useContext(fv)),p=J.useRef();return _3(function(){var _=o.key+"-global",g=new o.sheet.constructor({key:_,nonce:o.sheet.nonce,container:o.sheet.container,speedy:o.sheet.isSpeedy}),C=!1,R=document.querySelector('style[data-emotion="'+_+" "+d.name+'"]');return o.sheet.tags.length&&(g.before=o.sheet.tags[0]),R!==null&&(C=!0,R.setAttribute("data-emotion",_),g.hydrate([R])),p.current=[g,C],function(){g.flush()}},[o]),_3(function(){var _=p.current,g=_[0],C=_[1];if(C){_[1]=!1;return}if(d.next!==void 0&&o6(o,d.next,!0),g.tags.length){var R=g.tags[g.tags.length-1].nextElementSibling;g.before=R,g.flush()}o.insert("",d,g,!1)},[o,d.name]),null});function u6(){for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return WA(o)}var Xce=function(){var o=u6.apply(void 0,arguments),a="animation-"+o.name;return{name:a,styles:"@keyframes "+a+"{"+o.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},$ce=rce,Qce=function(o){return o!=="theme"},g3=function(o){return typeof o=="string"&&o.charCodeAt(0)>96?$ce:Qce},S3=function(o,a,d){var p;if(a){var _=a.shouldForwardProp;p=o.__emotion_forwardProp&&_?function(g){return o.__emotion_forwardProp(g)&&_(g)}:_}return typeof p!="function"&&d&&(p=o.__emotion_forwardProp),p},Zce=function(o){var a=o.cache,d=o.serialized,p=o.isStringTag;return i6(a,d,p),qce(function(){return o6(a,d,p)}),null},ele=function n(o,a){var d=o.__emotion_real===o,p=d&&o.__emotion_base||o,_,g;a!==void 0&&(_=a.label,g=a.target);var C=S3(o,a,d),R=C||g3(p),D=!R("as");return function(){var L=arguments,k=d&&o.__emotion_styles!==void 0?o.__emotion_styles.slice(0):[];if(_!==void 0&&k.push("label:"+_+";"),L[0]==null||L[0].raw===void 0)k.push.apply(k,L);else{k.push(L[0][0]);for(var M=L.length,Y=1;Y<M;Y++)k.push(L[Y],L[0][Y])}var z=l6(function(V,Q,G){var B=D&&V.as||p,q="",se=[],ue=V;if(V.theme==null){ue={};for(var $ in V)ue[$]=V[$];ue.theme=J.useContext(fv)}typeof V.className=="string"?q=jce(Q.registered,se,V.className):V.className!=null&&(q=V.className+" ");var pe=WA(k.concat(se),Q.registered,ue);q+=Q.key+"-"+pe.name,g!==void 0&&(q+=" "+g);var Oe=D&&C===void 0?g3(B):R,xe={};for(var je in V)D&&je==="as"||Oe(je)&&(xe[je]=V[je]);return xe.className=q,xe.ref=G,J.createElement(J.Fragment,null,J.createElement(Zce,{cache:Q,serialized:pe,isStringTag:typeof B=="string"}),J.createElement(B,xe))});return z.displayName=_!==void 0?_:"Styled("+(typeof p=="string"?p:p.displayName||p.name||"Component")+")",z.defaultProps=o.defaultProps,z.__emotion_real=z,z.__emotion_base=p,z.__emotion_styles=k,z.__emotion_forwardProp=C,Object.defineProperty(z,"toString",{value:function(){return"."+g}}),z.withComponent=function(V,Q){return n(V,It({},a,Q,{shouldForwardProp:S3(z,Q,!0)})).apply(void 0,k)},z}},tle=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],gb=ele.bind();tle.forEach(function(n){gb[n]=gb(n)});let Sb;typeof document=="object"&&(Sb=ZW({key:"css",prepend:!0}));function rle(n){const{injectFirst:o,children:a}=n;return o&&Sb?Z.jsx(Yce,{value:Sb,children:a}):a}function nle(n){return n==null||Object.keys(n).length===0}function ile(n){const{styles:o,defaultTheme:a={}}=n,d=typeof o=="function"?p=>o(nle(p)?a:p):o;return Z.jsx(Jce,{styles:d})}function h6(n,o){return gb(n,o)}const p6=(n,o)=>{Array.isArray(n.__emotion_styles)&&(n.__emotion_styles=o(n.__emotion_styles))},ole=Object.freeze(Object.defineProperty({__proto__:null,GlobalStyles:ile,StyledEngineProvider:rle,ThemeContext:fv,css:u6,default:h6,internal_processStyles:p6,keyframes:Xce},Symbol.toStringTag,{value:"Module"}));function hc(n){if(typeof n!="object"||n===null)return!1;const o=Object.getPrototypeOf(n);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)}function f6(n){if(!hc(n))return n;const o={};return Object.keys(n).forEach(a=>{o[a]=f6(n[a])}),o}function vs(n,o,a={clone:!0}){const d=a.clone?It({},n):n;return hc(n)&&hc(o)&&Object.keys(o).forEach(p=>{hc(o[p])&&Object.prototype.hasOwnProperty.call(n,p)&&hc(n[p])?d[p]=vs(n[p],o[p],a):a.clone?d[p]=hc(o[p])?f6(o[p]):o[p]:d[p]=o[p]}),d}const sle=Object.freeze(Object.defineProperty({__proto__:null,default:vs,isPlainObject:hc},Symbol.toStringTag,{value:"Module"})),ale=["values","unit","step"],cle=n=>{const o=Object.keys(n).map(a=>({key:a,val:n[a]}))||[];return o.sort((a,d)=>a.val-d.val),o.reduce((a,d)=>It({},a,{[d.key]:d.val}),{})};function m6(n){const{values:o={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:a="px",step:d=5}=n,p=Rs(n,ale),_=cle(o),g=Object.keys(_);function C(M){return`@media (min-width:${typeof o[M]=="number"?o[M]:M}${a})`}function R(M){return`@media (max-width:${(typeof o[M]=="number"?o[M]:M)-d/100}${a})`}function D(M,Y){const z=g.indexOf(Y);return`@media (min-width:${typeof o[M]=="number"?o[M]:M}${a}) and (max-width:${(z!==-1&&typeof o[g[z]]=="number"?o[g[z]]:Y)-d/100}${a})`}function L(M){return g.indexOf(M)+1<g.length?D(M,g[g.indexOf(M)+1]):C(M)}function k(M){const Y=g.indexOf(M);return Y===0?C(g[1]):Y===g.length-1?R(g[Y]):D(M,g[g.indexOf(M)+1]).replace("@media","@media not all and")}return It({keys:g,values:_,up:C,down:R,between:D,only:L,not:k,unit:a},p)}const lle={borderRadius:4};function wm(n,o){return o?vs(n,o,{clone:!1}):n}const GA={xs:0,sm:600,md:900,lg:1200,xl:1536},y3={keys:["xs","sm","md","lg","xl"],up:n=>`@media (min-width:${GA[n]}px)`};function na(n,o,a){const d=n.theme||{};if(Array.isArray(o)){const _=d.breakpoints||y3;return o.reduce((g,C,R)=>(g[_.up(_.keys[R])]=a(o[R]),g),{})}if(typeof o=="object"){const _=d.breakpoints||y3;return Object.keys(o).reduce((g,C)=>{if(Object.keys(_.values||GA).indexOf(C)!==-1){const R=_.up(C);g[R]=a(o[C],C)}else{const R=C;g[R]=o[R]}return g},{})}return a(o)}function _6(n={}){var o;return((o=n.keys)==null?void 0:o.reduce((d,p)=>{const _=n.up(p);return d[_]={},d},{}))||{}}function E6(n,o){return n.reduce((a,d)=>{const p=a[d];return(!p||Object.keys(p).length===0)&&delete a[d],a},o)}function dle(n,...o){const a=_6(n),d=[a,...o].reduce((p,_)=>vs(p,_),{});return E6(Object.keys(a),d)}function ule(n,o){if(typeof n!="object")return{};const a={},d=Object.keys(o);return Array.isArray(n)?d.forEach((p,_)=>{_<n.length&&(a[p]=!0)}):d.forEach(p=>{n[p]!=null&&(a[p]=!0)}),a}function cI({values:n,breakpoints:o,base:a}){const d=a||ule(n,o),p=Object.keys(d);if(p.length===0)return n;let _;return p.reduce((g,C,R)=>(Array.isArray(n)?(g[C]=n[R]!=null?n[R]:n[_],_=R):typeof n=="object"?(g[C]=n[C]!=null?n[C]:n[_],_=C):g[C]=n,g),{})}function c_(n){if(typeof n!="string")throw new Error(qm(7));return n.charAt(0).toUpperCase()+n.slice(1)}const hle=Object.freeze(Object.defineProperty({__proto__:null,default:c_},Symbol.toStringTag,{value:"Module"}));function mv(n,o,a=!0){if(!o||typeof o!="string")return null;if(n&&n.vars&&a){const d=`vars.${o}`.split(".").reduce((p,_)=>p&&p[_]?p[_]:null,n);if(d!=null)return d}return o.split(".").reduce((d,p)=>d&&d[p]!=null?d[p]:null,n)}function Ry(n,o,a,d=a){let p;return typeof n=="function"?p=n(a):Array.isArray(n)?p=n[a]||d:p=mv(n,a)||d,o&&(p=o(p,d,n)),p}function Dn(n){const{prop:o,cssProperty:a=n.prop,themeKey:d,transform:p}=n,_=g=>{if(g[o]==null)return null;const C=g[o],R=g.theme,D=mv(R,d)||{};return na(g,C,k=>{let M=Ry(D,p,k);return k===M&&typeof k=="string"&&(M=Ry(D,p,`${o}${k==="default"?"":c_(k)}`,k)),a===!1?M:{[a]:M}})};return _.propTypes={},_.filterProps=[o],_}function ple(n){const o={};return a=>(o[a]===void 0&&(o[a]=n(a)),o[a])}const fle={m:"margin",p:"padding"},mle={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},v3={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},_le=ple(n=>{if(n.length>2)if(v3[n])n=v3[n];else return[n];const[o,a]=n.split(""),d=fle[o],p=mle[a]||"";return Array.isArray(p)?p.map(_=>d+_):[d+p]}),HA=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],KA=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...HA,...KA];function l_(n,o,a,d){var p;const _=(p=mv(n,o,!1))!=null?p:a;return typeof _=="number"?g=>typeof g=="string"?g:_*g:Array.isArray(_)?g=>typeof g=="string"?g:_[g]:typeof _=="function"?_:()=>{}}function zA(n){return l_(n,"spacing",8)}function Kd(n,o){if(typeof o=="string"||o==null)return o;const a=Math.abs(o),d=n(a);return o>=0?d:typeof d=="number"?-d:`-${d}`}function Ele(n,o){return a=>n.reduce((d,p)=>(d[p]=Kd(o,a),d),{})}function gle(n,o,a,d){if(o.indexOf(a)===-1)return null;const p=_le(a),_=Ele(p,d),g=n[a];return na(n,g,_)}function g6(n,o){const a=zA(n.theme);return Object.keys(n).map(d=>gle(n,o,d,a)).reduce(wm,{})}function Rn(n){return g6(n,HA)}Rn.propTypes={};Rn.filterProps=HA;function wn(n){return g6(n,KA)}wn.propTypes={};wn.filterProps=KA;function Sle(n=8){if(n.mui)return n;const o=zA({spacing:n}),a=(...d)=>(d.length===0?[1]:d).map(_=>{const g=o(_);return typeof g=="number"?`${g}px`:g}).join(" ");return a.mui=!0,a}function _v(...n){const o=n.reduce((d,p)=>(p.filterProps.forEach(_=>{d[_]=p}),d),{}),a=d=>Object.keys(d).reduce((p,_)=>o[_]?wm(p,o[_](d)):p,{});return a.propTypes={},a.filterProps=n.reduce((d,p)=>d.concat(p.filterProps),[]),a}function Es(n){return typeof n!="number"?n:`${n}px solid`}function Is(n,o){return Dn({prop:n,themeKey:"borders",transform:o})}const yle=Is("border",Es),vle=Is("borderTop",Es),Tle=Is("borderRight",Es),Cle=Is("borderBottom",Es),Rle=Is("borderLeft",Es),wle=Is("borderColor"),Ile=Is("borderTopColor"),ble=Is("borderRightColor"),Ale=Is("borderBottomColor"),Ole=Is("borderLeftColor"),Nle=Is("outline",Es),Dle=Is("outlineColor"),Ev=n=>{if(n.borderRadius!==void 0&&n.borderRadius!==null){const o=l_(n.theme,"shape.borderRadius",4),a=d=>({borderRadius:Kd(o,d)});return na(n,n.borderRadius,a)}return null};Ev.propTypes={};Ev.filterProps=["borderRadius"];_v(yle,vle,Tle,Cle,Rle,wle,Ile,ble,Ale,Ole,Ev,Nle,Dle);const gv=n=>{if(n.gap!==void 0&&n.gap!==null){const o=l_(n.theme,"spacing",8),a=d=>({gap:Kd(o,d)});return na(n,n.gap,a)}return null};gv.propTypes={};gv.filterProps=["gap"];const Sv=n=>{if(n.columnGap!==void 0&&n.columnGap!==null){const o=l_(n.theme,"spacing",8),a=d=>({columnGap:Kd(o,d)});return na(n,n.columnGap,a)}return null};Sv.propTypes={};Sv.filterProps=["columnGap"];const yv=n=>{if(n.rowGap!==void 0&&n.rowGap!==null){const o=l_(n.theme,"spacing",8),a=d=>({rowGap:Kd(o,d)});return na(n,n.rowGap,a)}return null};yv.propTypes={};yv.filterProps=["rowGap"];const Ple=Dn({prop:"gridColumn"}),kle=Dn({prop:"gridRow"}),Lle=Dn({prop:"gridAutoFlow"}),Mle=Dn({prop:"gridAutoColumns"}),xle=Dn({prop:"gridAutoRows"}),Ule=Dn({prop:"gridTemplateColumns"}),Vle=Dn({prop:"gridTemplateRows"}),Fle=Dn({prop:"gridTemplateAreas"}),jle=Dn({prop:"gridArea"});_v(gv,Sv,yv,Ple,kle,Lle,Mle,xle,Ule,Vle,Fle,jle);function Hh(n,o){return o==="grey"?o:n}const Ble=Dn({prop:"color",themeKey:"palette",transform:Hh}),Wle=Dn({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:Hh}),Gle=Dn({prop:"backgroundColor",themeKey:"palette",transform:Hh});_v(Ble,Wle,Gle);function Oo(n){return n<=1&&n!==0?`${n*100}%`:n}const Hle=Dn({prop:"width",transform:Oo}),qA=n=>{if(n.maxWidth!==void 0&&n.maxWidth!==null){const o=a=>{var d,p;const _=((d=n.theme)==null||(d=d.breakpoints)==null||(d=d.values)==null?void 0:d[a])||GA[a];return _?((p=n.theme)==null||(p=p.breakpoints)==null?void 0:p.unit)!=="px"?{maxWidth:`${_}${n.theme.breakpoints.unit}`}:{maxWidth:_}:{maxWidth:Oo(a)}};return na(n,n.maxWidth,o)}return null};qA.filterProps=["maxWidth"];const Kle=Dn({prop:"minWidth",transform:Oo}),zle=Dn({prop:"height",transform:Oo}),qle=Dn({prop:"maxHeight",transform:Oo}),Yle=Dn({prop:"minHeight",transform:Oo});Dn({prop:"size",cssProperty:"width",transform:Oo});Dn({prop:"size",cssProperty:"height",transform:Oo});const Jle=Dn({prop:"boxSizing"});_v(Hle,qA,Kle,zle,qle,Yle,Jle);const d_={border:{themeKey:"borders",transform:Es},borderTop:{themeKey:"borders",transform:Es},borderRight:{themeKey:"borders",transform:Es},borderBottom:{themeKey:"borders",transform:Es},borderLeft:{themeKey:"borders",transform:Es},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:Es},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:Ev},color:{themeKey:"palette",transform:Hh},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:Hh},backgroundColor:{themeKey:"palette",transform:Hh},p:{style:wn},pt:{style:wn},pr:{style:wn},pb:{style:wn},pl:{style:wn},px:{style:wn},py:{style:wn},padding:{style:wn},paddingTop:{style:wn},paddingRight:{style:wn},paddingBottom:{style:wn},paddingLeft:{style:wn},paddingX:{style:wn},paddingY:{style:wn},paddingInline:{style:wn},paddingInlineStart:{style:wn},paddingInlineEnd:{style:wn},paddingBlock:{style:wn},paddingBlockStart:{style:wn},paddingBlockEnd:{style:wn},m:{style:Rn},mt:{style:Rn},mr:{style:Rn},mb:{style:Rn},ml:{style:Rn},mx:{style:Rn},my:{style:Rn},margin:{style:Rn},marginTop:{style:Rn},marginRight:{style:Rn},marginBottom:{style:Rn},marginLeft:{style:Rn},marginX:{style:Rn},marginY:{style:Rn},marginInline:{style:Rn},marginInlineStart:{style:Rn},marginInlineEnd:{style:Rn},marginBlock:{style:Rn},marginBlockStart:{style:Rn},marginBlockEnd:{style:Rn},displayPrint:{cssProperty:!1,transform:n=>({"@media print":{display:n}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:gv},rowGap:{style:yv},columnGap:{style:Sv},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:Oo},maxWidth:{style:qA},minWidth:{transform:Oo},height:{transform:Oo},maxHeight:{transform:Oo},minHeight:{transform:Oo},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function Xle(...n){const o=n.reduce((d,p)=>d.concat(Object.keys(p)),[]),a=new Set(o);return n.every(d=>a.size===Object.keys(d).length)}function $le(n,o){return typeof n=="function"?n(o):n}function S6(){function n(a,d,p,_){const g={[a]:d,theme:p},C=_[a];if(!C)return{[a]:d};const{cssProperty:R=a,themeKey:D,transform:L,style:k}=C;if(d==null)return null;if(D==="typography"&&d==="inherit")return{[a]:d};const M=mv(p,D)||{};return k?k(g):na(g,d,z=>{let V=Ry(M,L,z);return z===V&&typeof z=="string"&&(V=Ry(M,L,`${a}${z==="default"?"":c_(z)}`,z)),R===!1?V:{[R]:V}})}function o(a){var d;const{sx:p,theme:_={}}=a||{};if(!p)return null;const g=(d=_.unstable_sxConfig)!=null?d:d_;function C(R){let D=R;if(typeof R=="function")D=R(_);else if(typeof R!="object")return R;if(!D)return null;const L=_6(_.breakpoints),k=Object.keys(L);let M=L;return Object.keys(D).forEach(Y=>{const z=$le(D[Y],_);if(z!=null)if(typeof z=="object")if(g[Y])M=wm(M,n(Y,z,_,g));else{const V=na({theme:_},z,Q=>({[Y]:Q}));Xle(V,z)?M[Y]=o({sx:z,theme:_}):M=wm(M,V)}else M=wm(M,n(Y,z,_,g))}),E6(k,M)}return Array.isArray(p)?p.map(C):C(p)}return o}const u_=S6();u_.filterProps=["sx"];function y6(n,o){const a=this;return a.vars&&typeof a.getColorSchemeSelector=="function"?{[a.getColorSchemeSelector(n).replace(/(\[[^\]]+\])/,"*:where($1)")]:o}:a.palette.mode===n?o:{}}const Qle=["breakpoints","palette","spacing","shape"];function h_(n={},...o){const{breakpoints:a={},palette:d={},spacing:p,shape:_={}}=n,g=Rs(n,Qle),C=m6(a),R=Sle(p);let D=vs({breakpoints:C,direction:"ltr",components:{},palette:It({mode:"light"},d),spacing:R,shape:It({},lle,_)},g);return D.applyStyles=y6,D=o.reduce((L,k)=>vs(L,k),D),D.unstable_sxConfig=It({},d_,g==null?void 0:g.unstable_sxConfig),D.unstable_sx=function(k){return u_({sx:k,theme:this})},D}const Zle=Object.freeze(Object.defineProperty({__proto__:null,default:h_,private_createBreakpoints:m6,unstable_applyStyles:y6},Symbol.toStringTag,{value:"Module"}));function ede(n){return Object.keys(n).length===0}function tde(n=null){const o=J.useContext(fv);return!o||ede(o)?n:o}const rde=h_();function nde(n=rde){return tde(n)}const ide=["sx"],ode=n=>{var o,a;const d={systemProps:{},otherProps:{}},p=(o=n==null||(a=n.theme)==null?void 0:a.unstable_sxConfig)!=null?o:d_;return Object.keys(n).forEach(_=>{p[_]?d.systemProps[_]=n[_]:d.otherProps[_]=n[_]}),d};function YA(n){const{sx:o}=n,a=Rs(n,ide),{systemProps:d,otherProps:p}=ode(a);let _;return Array.isArray(o)?_=[d,...o]:typeof o=="function"?_=(...g)=>{const C=o(...g);return hc(C)?It({},d,C):d}:_=It({},d,o),It({},p,{sx:_})}const sde=Object.freeze(Object.defineProperty({__proto__:null,default:u_,extendSxProp:YA,unstable_createStyleFunctionSx:S6,unstable_defaultSxConfig:d_},Symbol.toStringTag,{value:"Module"})),T3=n=>n,ade=()=>{let n=T3;return{configure(o){n=o},generate(o){return n(o)},reset(){n=T3}}},cde=ade();function v6(n){var o,a,d="";if(typeof n=="string"||typeof n=="number")d+=n;else if(typeof n=="object")if(Array.isArray(n)){var p=n.length;for(o=0;o<p;o++)n[o]&&(a=v6(n[o]))&&(d&&(d+=" "),d+=a)}else for(a in n)n[a]&&(d&&(d+=" "),d+=a);return d}function T6(){for(var n,o,a=0,d="",p=arguments.length;a<p;a++)(n=arguments[a])&&(o=v6(n))&&(d&&(d+=" "),d+=o);return d}const lde={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function JA(n,o,a="Mui"){const d=lde[o];return d?`${a}-${d}`:`${cde.generate(n)}-${o}`}function dde(n,o,a="Mui"){const d={};return o.forEach(p=>{d[p]=JA(n,p,a)}),d}var C6={exports:{}},Ar={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XA=Symbol.for("react.element"),$A=Symbol.for("react.portal"),vv=Symbol.for("react.fragment"),Tv=Symbol.for("react.strict_mode"),Cv=Symbol.for("react.profiler"),Rv=Symbol.for("react.provider"),wv=Symbol.for("react.context"),ude=Symbol.for("react.server_context"),Iv=Symbol.for("react.forward_ref"),bv=Symbol.for("react.suspense"),Av=Symbol.for("react.suspense_list"),Ov=Symbol.for("react.memo"),Nv=Symbol.for("react.lazy"),hde=Symbol.for("react.offscreen"),R6;R6=Symbol.for("react.module.reference");function bs(n){if(typeof n=="object"&&n!==null){var o=n.$$typeof;switch(o){case XA:switch(n=n.type,n){case vv:case Cv:case Tv:case bv:case Av:return n;default:switch(n=n&&n.$$typeof,n){case ude:case wv:case Iv:case Nv:case Ov:case Rv:return n;default:return o}}case $A:return o}}}Ar.ContextConsumer=wv;Ar.ContextProvider=Rv;Ar.Element=XA;Ar.ForwardRef=Iv;Ar.Fragment=vv;Ar.Lazy=Nv;Ar.Memo=Ov;Ar.Portal=$A;Ar.Profiler=Cv;Ar.StrictMode=Tv;Ar.Suspense=bv;Ar.SuspenseList=Av;Ar.isAsyncMode=function(){return!1};Ar.isConcurrentMode=function(){return!1};Ar.isContextConsumer=function(n){return bs(n)===wv};Ar.isContextProvider=function(n){return bs(n)===Rv};Ar.isElement=function(n){return typeof n=="object"&&n!==null&&n.$$typeof===XA};Ar.isForwardRef=function(n){return bs(n)===Iv};Ar.isFragment=function(n){return bs(n)===vv};Ar.isLazy=function(n){return bs(n)===Nv};Ar.isMemo=function(n){return bs(n)===Ov};Ar.isPortal=function(n){return bs(n)===$A};Ar.isProfiler=function(n){return bs(n)===Cv};Ar.isStrictMode=function(n){return bs(n)===Tv};Ar.isSuspense=function(n){return bs(n)===bv};Ar.isSuspenseList=function(n){return bs(n)===Av};Ar.isValidElementType=function(n){return typeof n=="string"||typeof n=="function"||n===vv||n===Cv||n===Tv||n===bv||n===Av||n===hde||typeof n=="object"&&n!==null&&(n.$$typeof===Nv||n.$$typeof===Ov||n.$$typeof===Rv||n.$$typeof===wv||n.$$typeof===Iv||n.$$typeof===R6||n.getModuleId!==void 0)};Ar.typeOf=bs;C6.exports=Ar;var C3=C6.exports;const pde=/^\s*function(?:\s|\s*\/\*.*\*\/\s*)+([^(\s/]*)\s*/;function w6(n){const o=`${n}`.match(pde);return o&&o[1]||""}function I6(n,o=""){return n.displayName||n.name||w6(n)||o}function R3(n,o,a){const d=I6(o);return n.displayName||(d!==""?`${a}(${d})`:a)}function fde(n){if(n!=null){if(typeof n=="string")return n;if(typeof n=="function")return I6(n,"Component");if(typeof n=="object")switch(n.$$typeof){case C3.ForwardRef:return R3(n,n.render,"ForwardRef");case C3.Memo:return R3(n,n.type,"memo");default:return}}}const mde=Object.freeze(Object.defineProperty({__proto__:null,default:fde,getFunctionName:w6},Symbol.toStringTag,{value:"Module"})),_de=["ownerState"],Ede=["variants"],gde=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function Sde(n){return Object.keys(n).length===0}function yde(n){return typeof n=="string"&&n.charCodeAt(0)>96}function lI(n){return n!=="ownerState"&&n!=="theme"&&n!=="sx"&&n!=="as"}const vde=h_(),Tde=n=>n&&n.charAt(0).toLowerCase()+n.slice(1);function hS({defaultTheme:n,theme:o,themeId:a}){return Sde(o)?n:o[a]||o}function Cde(n){return n?(o,a)=>a[n]:null}function jS(n,o){let{ownerState:a}=o,d=Rs(o,_de);const p=typeof n=="function"?n(It({ownerState:a},d)):n;if(Array.isArray(p))return p.flatMap(_=>jS(_,It({ownerState:a},d)));if(p&&typeof p=="object"&&Array.isArray(p.variants)){const{variants:_=[]}=p;let C=Rs(p,Ede);return _.forEach(R=>{let D=!0;typeof R.props=="function"?D=R.props(It({ownerState:a},d,a)):Object.keys(R.props).forEach(L=>{(a==null?void 0:a[L])!==R.props[L]&&d[L]!==R.props[L]&&(D=!1)}),D&&(Array.isArray(C)||(C=[C]),C.push(typeof R.style=="function"?R.style(It({ownerState:a},d,a)):R.style))}),C}return p}function Rde(n={}){const{themeId:o,defaultTheme:a=vde,rootShouldForwardProp:d=lI,slotShouldForwardProp:p=lI}=n,_=g=>u_(It({},g,{theme:hS(It({},g,{defaultTheme:a,themeId:o}))}));return _.__mui_systemSx=!0,(g,C={})=>{p6(g,ue=>ue.filter($=>!($!=null&&$.__mui_systemSx)));const{name:R,slot:D,skipVariantsResolver:L,skipSx:k,overridesResolver:M=Cde(Tde(D))}=C,Y=Rs(C,gde),z=L!==void 0?L:D&&D!=="Root"&&D!=="root"||!1,V=k||!1;let Q,G=lI;D==="Root"||D==="root"?G=d:D?G=p:yde(g)&&(G=void 0);const B=h6(g,It({shouldForwardProp:G,label:Q},Y)),q=ue=>typeof ue=="function"&&ue.__emotion_real!==ue||hc(ue)?$=>jS(ue,It({},$,{theme:hS({theme:$.theme,defaultTheme:a,themeId:o})})):ue,se=(ue,...$)=>{let pe=q(ue);const Oe=$?$.map(q):[];R&&M&&Oe.push(ze=>{const St=hS(It({},ze,{defaultTheme:a,themeId:o}));if(!St.components||!St.components[R]||!St.components[R].styleOverrides)return null;const Bt=St.components[R].styleOverrides,st={};return Object.entries(Bt).forEach(([Jn,jr])=>{st[Jn]=jS(jr,It({},ze,{theme:St}))}),M(ze,st)}),R&&!z&&Oe.push(ze=>{var St;const Bt=hS(It({},ze,{defaultTheme:a,themeId:o})),st=Bt==null||(St=Bt.components)==null||(St=St[R])==null?void 0:St.variants;return jS({variants:st},It({},ze,{theme:Bt}))}),V||Oe.push(_);const xe=Oe.length-$.length;if(Array.isArray(ue)&&xe>0){const ze=new Array(xe).fill("");pe=[...ue,...ze],pe.raw=[...ue.raw,...ze]}const je=B(pe,...Oe);return g.muiName&&(je.muiName=g.muiName),je};return B.withConfig&&(se.withConfig=B.withConfig),se}}const wde=Rde();function wy(n,o){const a=It({},o);return Object.keys(n).forEach(d=>{if(d.toString().match(/^(components|slots)$/))a[d]=It({},n[d],a[d]);else if(d.toString().match(/^(componentsProps|slotProps)$/)){const p=n[d]||{},_=o[d];a[d]={},!_||!Object.keys(_)?a[d]=p:!p||!Object.keys(p)?a[d]=_:(a[d]=It({},_),Object.keys(p).forEach(g=>{a[d][g]=wy(p[g],_[g])}))}else a[d]===void 0&&(a[d]=n[d])}),a}function Ide(n){const{theme:o,name:a,props:d}=n;return!o||!o.components||!o.components[a]||!o.components[a].defaultProps?d:wy(o.components[a].defaultProps,d)}function bde({props:n,name:o,defaultTheme:a,themeId:d}){let p=nde(a);return d&&(p=p[d]||p),Ide({theme:p,name:o,props:n})}function Ade(n,o=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER){return Math.max(o,Math.min(n,a))}const Ode=Object.freeze(Object.defineProperty({__proto__:null,default:Ade},Symbol.toStringTag,{value:"Module"}));function b6(n,o,a=void 0){const d={};return Object.keys(n).forEach(p=>{d[p]=n[p].reduce((_,g)=>{if(g){const C=o(g);C!==""&&_.push(C),a&&a[g]&&_.push(a[g])}return _},[]).join(" ")}),d}const Nde=J.createContext(void 0);function Dde(n){const{theme:o,name:a,props:d}=n;if(!o||!o.components||!o.components[a])return d;const p=o.components[a];return p.defaultProps?wy(p.defaultProps,d):!p.styleOverrides&&!p.variants?wy(p,d):d}function Pde({props:n,name:o}){const a=J.useContext(Nde);return Dde({props:n,name:o,theme:{components:a}})}const kde=["component","direction","spacing","divider","children","className","useFlexGap"],Lde=h_(),Mde=wde("div",{name:"MuiStack",slot:"Root",overridesResolver:(n,o)=>o.root});function xde(n){return bde({props:n,name:"MuiStack",defaultTheme:Lde})}function Ude(n,o){const a=J.Children.toArray(n).filter(Boolean);return a.reduce((d,p,_)=>(d.push(p),_<a.length-1&&d.push(J.cloneElement(o,{key:`separator-${_}`})),d),[])}const Vde=n=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[n],Fde=({ownerState:n,theme:o})=>{let a=It({display:"flex",flexDirection:"column"},na({theme:o},cI({values:n.direction,breakpoints:o.breakpoints.values}),d=>({flexDirection:d})));if(n.spacing){const d=zA(o),p=Object.keys(o.breakpoints.values).reduce((R,D)=>((typeof n.spacing=="object"&&n.spacing[D]!=null||typeof n.direction=="object"&&n.direction[D]!=null)&&(R[D]=!0),R),{}),_=cI({values:n.direction,base:p}),g=cI({values:n.spacing,base:p});typeof _=="object"&&Object.keys(_).forEach((R,D,L)=>{if(!_[R]){const M=D>0?_[L[D-1]]:"column";_[R]=M}}),a=vs(a,na({theme:o},g,(R,D)=>n.useFlexGap?{gap:Kd(d,R)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Vde(D?_[D]:n.direction)}`]:Kd(d,R)}}))}return a=dle(o.breakpoints,a),a};function jde(n={}){const{createStyledComponent:o=Mde,useThemeProps:a=xde,componentName:d="MuiStack"}=n,p=()=>b6({root:["root"]},R=>JA(d,R),{}),_=o(Fde);return J.forwardRef(function(R,D){const L=a(R),k=YA(L),{component:M="div",direction:Y="column",spacing:z=0,divider:V,children:Q,className:G,useFlexGap:B=!1}=k,q=Rs(k,kde),se={direction:Y,spacing:z,useFlexGap:B},ue=p();return Z.jsx(_,It({as:M,ownerState:se,ref:D,className:T6(ue.root,G)},q,{children:V?Ude(Q,V):Q}))})}function Bde(n,o){return It({toolbar:{minHeight:56,[n.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[n.up("sm")]:{minHeight:64}}},o)}var Pn={},A6={exports:{}};(function(n){function o(a){return a&&a.__esModule?a:{default:a}}n.exports=o,n.exports.__esModule=!0,n.exports.default=n.exports})(A6);var O6=A6.exports;const Wde=xl(Zae),Gde=xl(Ode);var N6=O6;Object.defineProperty(Pn,"__esModule",{value:!0});Pn.alpha=L6;Pn.blend=rue;Pn.colorChannel=void 0;var Hde=Pn.darken=ZA;Pn.decomposeColor=ws;Pn.emphasize=M6;var Kde=Pn.getContrastRatio=$de;Pn.getLuminance=Iy;Pn.hexToRgb=D6;Pn.hslToRgb=k6;var zde=Pn.lighten=eO;Pn.private_safeAlpha=Qde;Pn.private_safeColorChannel=void 0;Pn.private_safeDarken=Zde;Pn.private_safeEmphasize=tue;Pn.private_safeLighten=eue;Pn.recomposeColor=ap;Pn.rgbToHex=Xde;var w3=N6(Wde),qde=N6(Gde);function QA(n,o=0,a=1){return(0,qde.default)(n,o,a)}function D6(n){n=n.slice(1);const o=new RegExp(`.{1,${n.length>=6?2:1}}`,"g");let a=n.match(o);return a&&a[0].length===1&&(a=a.map(d=>d+d)),a?`rgb${a.length===4?"a":""}(${a.map((d,p)=>p<3?parseInt(d,16):Math.round(parseInt(d,16)/255*1e3)/1e3).join(", ")})`:""}function Yde(n){const o=n.toString(16);return o.length===1?`0${o}`:o}function ws(n){if(n.type)return n;if(n.charAt(0)==="#")return ws(D6(n));const o=n.indexOf("("),a=n.substring(0,o);if(["rgb","rgba","hsl","hsla","color"].indexOf(a)===-1)throw new Error((0,w3.default)(9,n));let d=n.substring(o+1,n.length-1),p;if(a==="color"){if(d=d.split(" "),p=d.shift(),d.length===4&&d[3].charAt(0)==="/"&&(d[3]=d[3].slice(1)),["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(p)===-1)throw new Error((0,w3.default)(10,p))}else d=d.split(",");return d=d.map(_=>parseFloat(_)),{type:a,values:d,colorSpace:p}}const P6=n=>{const o=ws(n);return o.values.slice(0,3).map((a,d)=>o.type.indexOf("hsl")!==-1&&d!==0?`${a}%`:a).join(" ")};Pn.colorChannel=P6;const Jde=(n,o)=>{try{return P6(n)}catch{return n}};Pn.private_safeColorChannel=Jde;function ap(n){const{type:o,colorSpace:a}=n;let{values:d}=n;return o.indexOf("rgb")!==-1?d=d.map((p,_)=>_<3?parseInt(p,10):p):o.indexOf("hsl")!==-1&&(d[1]=`${d[1]}%`,d[2]=`${d[2]}%`),o.indexOf("color")!==-1?d=`${a} ${d.join(" ")}`:d=`${d.join(", ")}`,`${o}(${d})`}function Xde(n){if(n.indexOf("#")===0)return n;const{values:o}=ws(n);return`#${o.map((a,d)=>Yde(d===3?Math.round(255*a):a)).join("")}`}function k6(n){n=ws(n);const{values:o}=n,a=o[0],d=o[1]/100,p=o[2]/100,_=d*Math.min(p,1-p),g=(D,L=(D+a/30)%12)=>p-_*Math.max(Math.min(L-3,9-L,1),-1);let C="rgb";const R=[Math.round(g(0)*255),Math.round(g(8)*255),Math.round(g(4)*255)];return n.type==="hsla"&&(C+="a",R.push(o[3])),ap({type:C,values:R})}function Iy(n){n=ws(n);let o=n.type==="hsl"||n.type==="hsla"?ws(k6(n)).values:n.values;return o=o.map(a=>(n.type!=="color"&&(a/=255),a<=.03928?a/12.92:((a+.055)/1.055)**2.4)),Number((.2126*o[0]+.7152*o[1]+.0722*o[2]).toFixed(3))}function $de(n,o){const a=Iy(n),d=Iy(o);return(Math.max(a,d)+.05)/(Math.min(a,d)+.05)}function L6(n,o){return n=ws(n),o=QA(o),(n.type==="rgb"||n.type==="hsl")&&(n.type+="a"),n.type==="color"?n.values[3]=`/${o}`:n.values[3]=o,ap(n)}function Qde(n,o,a){try{return L6(n,o)}catch{return n}}function ZA(n,o){if(n=ws(n),o=QA(o),n.type.indexOf("hsl")!==-1)n.values[2]*=1-o;else if(n.type.indexOf("rgb")!==-1||n.type.indexOf("color")!==-1)for(let a=0;a<3;a+=1)n.values[a]*=1-o;return ap(n)}function Zde(n,o,a){try{return ZA(n,o)}catch{return n}}function eO(n,o){if(n=ws(n),o=QA(o),n.type.indexOf("hsl")!==-1)n.values[2]+=(100-n.values[2])*o;else if(n.type.indexOf("rgb")!==-1)for(let a=0;a<3;a+=1)n.values[a]+=(255-n.values[a])*o;else if(n.type.indexOf("color")!==-1)for(let a=0;a<3;a+=1)n.values[a]+=(1-n.values[a])*o;return ap(n)}function eue(n,o,a){try{return eO(n,o)}catch{return n}}function M6(n,o=.15){return Iy(n)>.5?ZA(n,o):eO(n,o)}function tue(n,o,a){try{return M6(n,o)}catch{return n}}function rue(n,o,a,d=1){const p=(R,D)=>Math.round((R**(1/d)*(1-a)+D**(1/d)*a)**d),_=ws(n),g=ws(o),C=[p(_.values[0],g.values[0]),p(_.values[1],g.values[1]),p(_.values[2],g.values[2])];return ap({type:"rgb",values:C})}const nue=["mode","contrastThreshold","tonalOffset"],I3={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:zm.white,default:zm.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},dI={text:{primary:zm.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:zm.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function b3(n,o,a,d){const p=d.light||d,_=d.dark||d*1.5;n[o]||(n.hasOwnProperty(a)?n[o]=n[a]:o==="light"?n.light=zde(n.main,p):o==="dark"&&(n.dark=Hde(n.main,_)))}function iue(n="light"){return n==="dark"?{main:yh[200],light:yh[50],dark:yh[400]}:{main:yh[700],light:yh[400],dark:yh[800]}}function oue(n="light"){return n==="dark"?{main:Sh[200],light:Sh[50],dark:Sh[400]}:{main:Sh[500],light:Sh[300],dark:Sh[700]}}function sue(n="light"){return n==="dark"?{main:gh[500],light:gh[300],dark:gh[700]}:{main:gh[700],light:gh[400],dark:gh[800]}}function aue(n="light"){return n==="dark"?{main:vh[400],light:vh[300],dark:vh[700]}:{main:vh[700],light:vh[500],dark:vh[900]}}function cue(n="light"){return n==="dark"?{main:Th[400],light:Th[300],dark:Th[700]}:{main:Th[800],light:Th[500],dark:Th[900]}}function lue(n="light"){return n==="dark"?{main:rm[400],light:rm[300],dark:rm[700]}:{main:"#ed6c02",light:rm[500],dark:rm[900]}}function due(n){const{mode:o="light",contrastThreshold:a=3,tonalOffset:d=.2}=n,p=Rs(n,nue),_=n.primary||iue(o),g=n.secondary||oue(o),C=n.error||sue(o),R=n.info||aue(o),D=n.success||cue(o),L=n.warning||lue(o);function k(V){return Kde(V,dI.text.primary)>=a?dI.text.primary:I3.text.primary}const M=({color:V,name:Q,mainShade:G=500,lightShade:B=300,darkShade:q=700})=>{if(V=It({},V),!V.main&&V[G]&&(V.main=V[G]),!V.hasOwnProperty("main"))throw new Error(qm(11,Q?` (${Q})`:"",G));if(typeof V.main!="string")throw new Error(qm(12,Q?` (${Q})`:"",JSON.stringify(V.main)));return b3(V,"light",B,d),b3(V,"dark",q,d),V.contrastText||(V.contrastText=k(V.main)),V},Y={dark:dI,light:I3};return vs(It({common:It({},zm),mode:o,primary:M({color:_,name:"primary"}),secondary:M({color:g,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:M({color:C,name:"error"}),warning:M({color:L,name:"warning"}),info:M({color:R,name:"info"}),success:M({color:D,name:"success"}),grey:Qae,contrastThreshold:a,getContrastText:k,augmentColor:M,tonalOffset:d},Y[o]),p)}const uue=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];function hue(n){return Math.round(n*1e5)/1e5}const A3={textTransform:"uppercase"},O3='"Roboto", "Helvetica", "Arial", sans-serif';function pue(n,o){const a=typeof o=="function"?o(n):o,{fontFamily:d=O3,fontSize:p=14,fontWeightLight:_=300,fontWeightRegular:g=400,fontWeightMedium:C=500,fontWeightBold:R=700,htmlFontSize:D=16,allVariants:L,pxToRem:k}=a,M=Rs(a,uue),Y=p/14,z=k||(G=>`${G/D*Y}rem`),V=(G,B,q,se,ue)=>It({fontFamily:d,fontWeight:G,fontSize:z(B),lineHeight:q},d===O3?{letterSpacing:`${hue(se/B)}em`}:{},ue,L),Q={h1:V(_,96,1.167,-1.5),h2:V(_,60,1.2,-.5),h3:V(g,48,1.167,0),h4:V(g,34,1.235,.25),h5:V(g,24,1.334,0),h6:V(C,20,1.6,.15),subtitle1:V(g,16,1.75,.15),subtitle2:V(C,14,1.57,.1),body1:V(g,16,1.5,.15),body2:V(g,14,1.43,.15),button:V(C,14,1.75,.4,A3),caption:V(g,12,1.66,.4),overline:V(g,12,2.66,1,A3),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return vs(It({htmlFontSize:D,pxToRem:z,fontFamily:d,fontSize:p,fontWeightLight:_,fontWeightRegular:g,fontWeightMedium:C,fontWeightBold:R},Q),M,{clone:!1})}const fue=.2,mue=.14,_ue=.12;function cn(...n){return[`${n[0]}px ${n[1]}px ${n[2]}px ${n[3]}px rgba(0,0,0,${fue})`,`${n[4]}px ${n[5]}px ${n[6]}px ${n[7]}px rgba(0,0,0,${mue})`,`${n[8]}px ${n[9]}px ${n[10]}px ${n[11]}px rgba(0,0,0,${_ue})`].join(",")}const Eue=["none",cn(0,2,1,-1,0,1,1,0,0,1,3,0),cn(0,3,1,-2,0,2,2,0,0,1,5,0),cn(0,3,3,-2,0,3,4,0,0,1,8,0),cn(0,2,4,-1,0,4,5,0,0,1,10,0),cn(0,3,5,-1,0,5,8,0,0,1,14,0),cn(0,3,5,-1,0,6,10,0,0,1,18,0),cn(0,4,5,-2,0,7,10,1,0,2,16,1),cn(0,5,5,-3,0,8,10,1,0,3,14,2),cn(0,5,6,-3,0,9,12,1,0,3,16,2),cn(0,6,6,-3,0,10,14,1,0,4,18,3),cn(0,6,7,-4,0,11,15,1,0,4,20,3),cn(0,7,8,-4,0,12,17,2,0,5,22,4),cn(0,7,8,-4,0,13,19,2,0,5,24,4),cn(0,7,9,-4,0,14,21,2,0,5,26,4),cn(0,8,9,-5,0,15,22,2,0,6,28,5),cn(0,8,10,-5,0,16,24,2,0,6,30,5),cn(0,8,11,-5,0,17,26,2,0,6,32,5),cn(0,9,11,-5,0,18,28,2,0,7,34,6),cn(0,9,12,-6,0,19,29,2,0,7,36,6),cn(0,10,13,-6,0,20,31,3,0,8,38,7),cn(0,10,13,-6,0,21,33,3,0,8,40,7),cn(0,10,14,-6,0,22,35,3,0,8,42,7),cn(0,11,14,-7,0,23,36,3,0,9,44,8),cn(0,11,15,-7,0,24,38,3,0,9,46,8)],gue=["duration","easing","delay"],Sue={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},yue={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function N3(n){return`${Math.round(n)}ms`}function vue(n){if(!n)return 0;const o=n/36;return Math.round((4+15*o**.25+o/5)*10)}function Tue(n){const o=It({},Sue,n.easing),a=It({},yue,n.duration);return It({getAutoHeightDuration:vue,create:(p=["all"],_={})=>{const{duration:g=a.standard,easing:C=o.easeInOut,delay:R=0}=_;return Rs(_,gue),(Array.isArray(p)?p:[p]).map(D=>`${D} ${typeof g=="string"?g:N3(g)} ${C} ${typeof R=="string"?R:N3(R)}`).join(",")}},n,{easing:o,duration:a})}const Cue={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},Rue=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function wue(n={},...o){const{mixins:a={},palette:d={},transitions:p={},typography:_={}}=n,g=Rs(n,Rue);if(n.vars)throw new Error(qm(18));const C=due(d),R=h_(n);let D=vs(R,{mixins:Bde(R.breakpoints,a),palette:C,shadows:Eue.slice(),typography:pue(C,_),transitions:Tue(p),zIndex:It({},Cue)});return D=vs(D,g),D=o.reduce((L,k)=>vs(L,k),D),D.unstable_sxConfig=It({},d_,g==null?void 0:g.unstable_sxConfig),D.unstable_sx=function(k){return u_({sx:k,theme:this})},D}const Iue=wue();var p_={},uI={exports:{}},D3;function bue(){return D3||(D3=1,function(n){function o(a,d){if(a==null)return{};var p={};for(var _ in a)if({}.hasOwnProperty.call(a,_)){if(d.includes(_))continue;p[_]=a[_]}return p}n.exports=o,n.exports.__esModule=!0,n.exports.default=n.exports}(uI)),uI.exports}const Aue=xl(ole),Oue=xl(sle),Nue=xl(hle),Due=xl(mde),Pue=xl(Zle),kue=xl(sde);var cp=O6;Object.defineProperty(p_,"__esModule",{value:!0});var Lue=p_.default=que;p_.shouldForwardProp=BS;p_.systemDefaultTheme=void 0;var fs=cp(d6()),yb=cp(bue()),P3=Bue(Aue),Mue=Oue;cp(Nue);cp(Due);var xue=cp(Pue),Uue=cp(kue);const Vue=["ownerState"],Fue=["variants"],jue=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function x6(n){if(typeof WeakMap!="function")return null;var o=new WeakMap,a=new WeakMap;return(x6=function(d){return d?a:o})(n)}function Bue(n,o){if(n&&n.__esModule)return n;if(n===null||typeof n!="object"&&typeof n!="function")return{default:n};var a=x6(o);if(a&&a.has(n))return a.get(n);var d={__proto__:null},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in n)if(_!=="default"&&Object.prototype.hasOwnProperty.call(n,_)){var g=p?Object.getOwnPropertyDescriptor(n,_):null;g&&(g.get||g.set)?Object.defineProperty(d,_,g):d[_]=n[_]}return d.default=n,a&&a.set(n,d),d}function Wue(n){return Object.keys(n).length===0}function Gue(n){return typeof n=="string"&&n.charCodeAt(0)>96}function BS(n){return n!=="ownerState"&&n!=="theme"&&n!=="sx"&&n!=="as"}const Hue=p_.systemDefaultTheme=(0,xue.default)(),Kue=n=>n&&n.charAt(0).toLowerCase()+n.slice(1);function pS({defaultTheme:n,theme:o,themeId:a}){return Wue(o)?n:o[a]||o}function zue(n){return n?(o,a)=>a[n]:null}function WS(n,o){let{ownerState:a}=o,d=(0,yb.default)(o,Vue);const p=typeof n=="function"?n((0,fs.default)({ownerState:a},d)):n;if(Array.isArray(p))return p.flatMap(_=>WS(_,(0,fs.default)({ownerState:a},d)));if(p&&typeof p=="object"&&Array.isArray(p.variants)){const{variants:_=[]}=p;let C=(0,yb.default)(p,Fue);return _.forEach(R=>{let D=!0;typeof R.props=="function"?D=R.props((0,fs.default)({ownerState:a},d,a)):Object.keys(R.props).forEach(L=>{(a==null?void 0:a[L])!==R.props[L]&&d[L]!==R.props[L]&&(D=!1)}),D&&(Array.isArray(C)||(C=[C]),C.push(typeof R.style=="function"?R.style((0,fs.default)({ownerState:a},d,a)):R.style))}),C}return p}function que(n={}){const{themeId:o,defaultTheme:a=Hue,rootShouldForwardProp:d=BS,slotShouldForwardProp:p=BS}=n,_=g=>(0,Uue.default)((0,fs.default)({},g,{theme:pS((0,fs.default)({},g,{defaultTheme:a,themeId:o}))}));return _.__mui_systemSx=!0,(g,C={})=>{(0,P3.internal_processStyles)(g,ue=>ue.filter($=>!($!=null&&$.__mui_systemSx)));const{name:R,slot:D,skipVariantsResolver:L,skipSx:k,overridesResolver:M=zue(Kue(D))}=C,Y=(0,yb.default)(C,jue),z=L!==void 0?L:D&&D!=="Root"&&D!=="root"||!1,V=k||!1;let Q,G=BS;D==="Root"||D==="root"?G=d:D?G=p:Gue(g)&&(G=void 0);const B=(0,P3.default)(g,(0,fs.default)({shouldForwardProp:G,label:Q},Y)),q=ue=>typeof ue=="function"&&ue.__emotion_real!==ue||(0,Mue.isPlainObject)(ue)?$=>WS(ue,(0,fs.default)({},$,{theme:pS({theme:$.theme,defaultTheme:a,themeId:o})})):ue,se=(ue,...$)=>{let pe=q(ue);const Oe=$?$.map(q):[];R&&M&&Oe.push(ze=>{const St=pS((0,fs.default)({},ze,{defaultTheme:a,themeId:o}));if(!St.components||!St.components[R]||!St.components[R].styleOverrides)return null;const Bt=St.components[R].styleOverrides,st={};return Object.entries(Bt).forEach(([Jn,jr])=>{st[Jn]=WS(jr,(0,fs.default)({},ze,{theme:St}))}),M(ze,st)}),R&&!z&&Oe.push(ze=>{var St;const Bt=pS((0,fs.default)({},ze,{defaultTheme:a,themeId:o})),st=Bt==null||(St=Bt.components)==null||(St=St[R])==null?void 0:St.variants;return WS({variants:st},(0,fs.default)({},ze,{theme:Bt}))}),V||Oe.push(_);const xe=Oe.length-$.length;if(Array.isArray(ue)&&xe>0){const ze=new Array(xe).fill("");pe=[...ue,...ze],pe.raw=[...ue.raw,...ze]}const je=B(pe,...Oe);return g.muiName&&(je.muiName=g.muiName),je};return B.withConfig&&(se.withConfig=B.withConfig),se}}function Yue(n){return n!=="ownerState"&&n!=="theme"&&n!=="sx"&&n!=="as"}const Jue=n=>Yue(n)&&n!=="classes",U6=Lue({themeId:ece,defaultTheme:Iue,rootShouldForwardProp:Jue});function V6(n){return Pde(n)}function Xue(n){return JA("MuiTypography",n)}dde("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const $ue=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],Que=n=>{const{align:o,gutterBottom:a,noWrap:d,paragraph:p,variant:_,classes:g}=n,C={root:["root",_,n.align!=="inherit"&&`align${c_(o)}`,a&&"gutterBottom",d&&"noWrap",p&&"paragraph"]};return b6(C,Xue,g)},Zue=U6("span",{name:"MuiTypography",slot:"Root",overridesResolver:(n,o)=>{const{ownerState:a}=n;return[o.root,a.variant&&o[a.variant],a.align!=="inherit"&&o[`align${c_(a.align)}`],a.noWrap&&o.noWrap,a.gutterBottom&&o.gutterBottom,a.paragraph&&o.paragraph]}})(({theme:n,ownerState:o})=>It({margin:0},o.variant==="inherit"&&{font:"inherit"},o.variant!=="inherit"&&n.typography[o.variant],o.align!=="inherit"&&{textAlign:o.align},o.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},o.gutterBottom&&{marginBottom:"0.35em"},o.paragraph&&{marginBottom:16})),k3={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},ehe={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},the=n=>ehe[n]||n,rhe=J.forwardRef(function(o,a){const d=V6({props:o,name:"MuiTypography"}),p=the(d.color),_=YA(It({},d,{color:p})),{align:g="inherit",className:C,component:R,gutterBottom:D=!1,noWrap:L=!1,paragraph:k=!1,variant:M="body1",variantMapping:Y=k3}=_,z=Rs(_,$ue),V=It({},_,{align:g,color:p,className:C,component:R,gutterBottom:D,noWrap:L,paragraph:k,variant:M,variantMapping:Y}),Q=R||(k?"p":Y[M]||k3[M])||"span",G=Que(V);return Z.jsx(Zue,It({as:Q,ref:a,ownerState:V,className:T6(G.root,C)},z))}),Po=jde({createStyledComponent:U6("div",{name:"MuiStack",slot:"Root",overridesResolver:(n,o)=>o.root}),useThemeProps:n=>V6({props:n,name:"MuiStack"})});var F6={exports:{}},j6={};/**
 * @license React
 * use-sync-external-store-with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f_=J;function nhe(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var ihe=typeof Object.is=="function"?Object.is:nhe,ohe=f_.useSyncExternalStore,she=f_.useRef,ahe=f_.useEffect,che=f_.useMemo,lhe=f_.useDebugValue;j6.useSyncExternalStoreWithSelector=function(n,o,a,d,p){var _=she(null);if(_.current===null){var g={hasValue:!1,value:null};_.current=g}else g=_.current;_=che(function(){function R(Y){if(!D){if(D=!0,L=Y,Y=d(Y),p!==void 0&&g.hasValue){var z=g.value;if(p(z,Y))return k=z}return k=Y}if(z=k,ihe(L,Y))return z;var V=d(Y);return p!==void 0&&p(z,V)?z:(L=Y,k=V)}var D=!1,L,k,M=a===void 0?null:a;return[function(){return R(o())},M===null?void 0:function(){return R(M())}]},[o,a,d,p]);var C=ohe(n,_[0],_[1]);return ahe(function(){g.hasValue=!0,g.value=C},[C]),lhe(C),C};F6.exports=j6;var dhe=F6.exports,ko="default"in Im?mc:Im,L3=Symbol.for("react-redux-context"),M3=typeof globalThis<"u"?globalThis:{};function uhe(){if(!ko.createContext)return{};const n=M3[L3]??(M3[L3]=new Map);let o=n.get(ko.createContext);return o||(o=ko.createContext(null),n.set(ko.createContext,o)),o}var Ll=uhe(),hhe=()=>{throw new Error("uSES not initialized!")};function tO(n=Ll){return function(){return ko.useContext(n)}}var B6=tO(),W6=hhe,phe=n=>{W6=n},fhe=(n,o)=>n===o;function mhe(n=Ll){const o=n===Ll?B6:tO(n),a=(d,p={})=>{const{equalityFn:_=fhe,devModeChecks:g={}}=typeof p=="function"?{equalityFn:p}:p,{store:C,subscription:R,getServerState:D,stabilityCheck:L,identityFunctionCheck:k}=o();ko.useRef(!0);const M=ko.useCallback({[d.name](z){return d(z)}}[d.name],[d,L,g.stabilityCheck]),Y=W6(R.addNestedSub,C.getState,D||C.getState,M,_);return ko.useDebugValue(Y),Y};return Object.assign(a,{withTypes:()=>a}),a}var fn=mhe();function _he(n){n()}function Ehe(){let n=null,o=null;return{clear(){n=null,o=null},notify(){_he(()=>{let a=n;for(;a;)a.callback(),a=a.next})},get(){const a=[];let d=n;for(;d;)a.push(d),d=d.next;return a},subscribe(a){let d=!0;const p=o={callback:a,next:null,prev:o};return p.prev?p.prev.next=p:n=p,function(){!d||n===null||(d=!1,p.next?p.next.prev=p.prev:o=p.prev,p.prev?p.prev.next=p.next:n=p.next)}}}}var x3={notify(){},get:()=>[]};function ghe(n,o){let a,d=x3,p=0,_=!1;function g(V){L();const Q=d.subscribe(V);let G=!1;return()=>{G||(G=!0,Q(),k())}}function C(){d.notify()}function R(){z.onStateChange&&z.onStateChange()}function D(){return _}function L(){p++,a||(a=n.subscribe(R),d=Ehe())}function k(){p--,a&&p===0&&(a(),a=void 0,d.clear(),d=x3)}function M(){_||(_=!0,L())}function Y(){_&&(_=!1,k())}const z={addNestedSub:g,notifyNestedSubs:C,handleChangeWrapper:R,isSubscribed:D,trySubscribe:M,tryUnsubscribe:Y,getListeners:()=>d};return z}var She=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",yhe=typeof navigator<"u"&&navigator.product==="ReactNative",vhe=She||yhe?ko.useLayoutEffect:ko.useEffect;function The({store:n,context:o,children:a,serverState:d,stabilityCheck:p="once",identityFunctionCheck:_="once"}){const g=ko.useMemo(()=>{const D=ghe(n);return{store:n,subscription:D,getServerState:d?()=>d:void 0,stabilityCheck:p,identityFunctionCheck:_}},[n,d,p,_]),C=ko.useMemo(()=>n.getState(),[n]);vhe(()=>{const{subscription:D}=g;return D.onStateChange=D.notifyNestedSubs,D.trySubscribe(),C!==n.getState()&&D.notifyNestedSubs(),()=>{D.tryUnsubscribe(),D.onStateChange=void 0}},[g,C]);const R=o||Ll;return ko.createElement(R.Provider,{value:g},a)}var Che=The;function G6(n=Ll){const o=n===Ll?B6:tO(n),a=()=>{const{store:d}=o();return d};return Object.assign(a,{withTypes:()=>a}),a}var Rhe=G6();function whe(n=Ll){const o=n===Ll?Rhe:G6(n),a=()=>o().dispatch;return Object.assign(a,{withTypes:()=>a}),a}var Dv=whe();phe(dhe.useSyncExternalStoreWithSelector);function Ihe(n){return Math.floor(Math.random()*n).toString()}function U3(n,o){let a=o;return n.forEach(d=>{a=a.replace(d,"")}),a}function bhe(n,o){let a="";for(let d=0;d<o;d+=1)a+=n[Ihe(n.length)];return a}function Ahe({length:n=20,useLetters:o=!0,useNumbers:a=!0,includeSymbols:d=[],excludeSymbols:p=[]}={}){let _="abcdefghijklmnopqrstuvwxyz",g="0123456789",C=[],R=[],D=[];return o&&(p.length&&(_=U3(p,_)),R=_.split("")),a&&(p.length&&(g=U3(p,g)),D=g.split("")),C=[...R,...D,...d],bhe(C,n)}var Ohe=Ahe;const Nhe=Mb(Ohe),ja=Object.create(null);ja.open="0";ja.close="1";ja.ping="2";ja.pong="3";ja.message="4";ja.upgrade="5";ja.noop="6";const GS=Object.create(null);Object.keys(ja).forEach(n=>{GS[ja[n]]=n});const vb={type:"error",data:"parser error"},H6=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",K6=typeof ArrayBuffer=="function",z6=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,rO=({type:n,data:o},a,d)=>H6&&o instanceof Blob?a?d(o):V3(o,d):K6&&(o instanceof ArrayBuffer||z6(o))?a?d(o):V3(new Blob([o]),d):d(ja[n]+(o||"")),V3=(n,o)=>{const a=new FileReader;return a.onload=function(){const d=a.result.split(",")[1];o("b"+(d||""))},a.readAsDataURL(n)};function F3(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let hI;function Dhe(n,o){if(H6&&n.data instanceof Blob)return n.data.arrayBuffer().then(F3).then(o);if(K6&&(n.data instanceof ArrayBuffer||z6(n.data)))return o(F3(n.data));rO(n,!1,a=>{hI||(hI=new TextEncoder),o(hI.encode(a))})}const j3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",um=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<j3.length;n++)um[j3.charCodeAt(n)]=n;const Phe=n=>{let o=n.length*.75,a=n.length,d,p=0,_,g,C,R;n[n.length-1]==="="&&(o--,n[n.length-2]==="="&&o--);const D=new ArrayBuffer(o),L=new Uint8Array(D);for(d=0;d<a;d+=4)_=um[n.charCodeAt(d)],g=um[n.charCodeAt(d+1)],C=um[n.charCodeAt(d+2)],R=um[n.charCodeAt(d+3)],L[p++]=_<<2|g>>4,L[p++]=(g&15)<<4|C>>2,L[p++]=(C&3)<<6|R&63;return D},khe=typeof ArrayBuffer=="function",nO=(n,o)=>{if(typeof n!="string")return{type:"message",data:q6(n,o)};const a=n.charAt(0);return a==="b"?{type:"message",data:Lhe(n.substring(1),o)}:GS[a]?n.length>1?{type:GS[a],data:n.substring(1)}:{type:GS[a]}:vb},Lhe=(n,o)=>{if(khe){const a=Phe(n);return q6(a,o)}else return{base64:!0,data:n}},q6=(n,o)=>{switch(o){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},Y6="",Mhe=(n,o)=>{const a=n.length,d=new Array(a);let p=0;n.forEach((_,g)=>{rO(_,!1,C=>{d[g]=C,++p===a&&o(d.join(Y6))})})},xhe=(n,o)=>{const a=n.split(Y6),d=[];for(let p=0;p<a.length;p++){const _=nO(a[p],o);if(d.push(_),_.type==="error")break}return d};function Uhe(){return new TransformStream({transform(n,o){Dhe(n,a=>{const d=a.length;let p;if(d<126)p=new Uint8Array(1),new DataView(p.buffer).setUint8(0,d);else if(d<65536){p=new Uint8Array(3);const _=new DataView(p.buffer);_.setUint8(0,126),_.setUint16(1,d)}else{p=new Uint8Array(9);const _=new DataView(p.buffer);_.setUint8(0,127),_.setBigUint64(1,BigInt(d))}n.data&&typeof n.data!="string"&&(p[0]|=128),o.enqueue(p),o.enqueue(a)})}})}let pI;function fS(n){return n.reduce((o,a)=>o+a.length,0)}function mS(n,o){if(n[0].length===o)return n.shift();const a=new Uint8Array(o);let d=0;for(let p=0;p<o;p++)a[p]=n[0][d++],d===n[0].length&&(n.shift(),d=0);return n.length&&d<n[0].length&&(n[0]=n[0].slice(d)),a}function Vhe(n,o){pI||(pI=new TextDecoder);const a=[];let d=0,p=-1,_=!1;return new TransformStream({transform(g,C){for(a.push(g);;){if(d===0){if(fS(a)<1)break;const R=mS(a,1);_=(R[0]&128)===128,p=R[0]&127,p<126?d=3:p===126?d=1:d=2}else if(d===1){if(fS(a)<2)break;const R=mS(a,2);p=new DataView(R.buffer,R.byteOffset,R.length).getUint16(0),d=3}else if(d===2){if(fS(a)<8)break;const R=mS(a,8),D=new DataView(R.buffer,R.byteOffset,R.length),L=D.getUint32(0);if(L>Math.pow(2,21)-1){C.enqueue(vb);break}p=L*Math.pow(2,32)+D.getUint32(4),d=3}else{if(fS(a)<p)break;const R=mS(a,p);C.enqueue(nO(_?R:pI.decode(R),o)),d=0}if(p===0||p>n){C.enqueue(vb);break}}}})}const J6=4;function Fn(n){if(n)return Fhe(n)}function Fhe(n){for(var o in Fn.prototype)n[o]=Fn.prototype[o];return n}Fn.prototype.on=Fn.prototype.addEventListener=function(n,o){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(o),this};Fn.prototype.once=function(n,o){function a(){this.off(n,a),o.apply(this,arguments)}return a.fn=o,this.on(n,a),this};Fn.prototype.off=Fn.prototype.removeListener=Fn.prototype.removeAllListeners=Fn.prototype.removeEventListener=function(n,o){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks["$"+n];if(!a)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var d,p=0;p<a.length;p++)if(d=a[p],d===o||d.fn===o){a.splice(p,1);break}return a.length===0&&delete this._callbacks["$"+n],this};Fn.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var o=new Array(arguments.length-1),a=this._callbacks["$"+n],d=1;d<arguments.length;d++)o[d-1]=arguments[d];if(a){a=a.slice(0);for(var d=0,p=a.length;d<p;++d)a[d].apply(this,o)}return this};Fn.prototype.emitReserved=Fn.prototype.emit;Fn.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};Fn.prototype.hasListeners=function(n){return!!this.listeners(n).length};const gs=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function X6(n,...o){return o.reduce((a,d)=>(n.hasOwnProperty(d)&&(a[d]=n[d]),a),{})}const jhe=gs.setTimeout,Bhe=gs.clearTimeout;function Pv(n,o){o.useNativeTimers?(n.setTimeoutFn=jhe.bind(gs),n.clearTimeoutFn=Bhe.bind(gs)):(n.setTimeoutFn=gs.setTimeout.bind(gs),n.clearTimeoutFn=gs.clearTimeout.bind(gs))}const Whe=1.33;function Ghe(n){return typeof n=="string"?Hhe(n):Math.ceil((n.byteLength||n.size)*Whe)}function Hhe(n){let o=0,a=0;for(let d=0,p=n.length;d<p;d++)o=n.charCodeAt(d),o<128?a+=1:o<2048?a+=2:o<55296||o>=57344?a+=3:(d++,a+=4);return a}function Khe(n){let o="";for(let a in n)n.hasOwnProperty(a)&&(o.length&&(o+="&"),o+=encodeURIComponent(a)+"="+encodeURIComponent(n[a]));return o}function zhe(n){let o={},a=n.split("&");for(let d=0,p=a.length;d<p;d++){let _=a[d].split("=");o[decodeURIComponent(_[0])]=decodeURIComponent(_[1])}return o}class qhe extends Error{constructor(o,a,d){super(o),this.description=a,this.context=d,this.type="TransportError"}}class iO extends Fn{constructor(o){super(),this.writable=!1,Pv(this,o),this.opts=o,this.query=o.query,this.socket=o.socket}onError(o,a,d){return super.emitReserved("error",new qhe(o,a,d)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(o){this.readyState==="open"&&this.write(o)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(o){const a=nO(o,this.socket.binaryType);this.onPacket(a)}onPacket(o){super.emitReserved("packet",o)}onClose(o){this.readyState="closed",super.emitReserved("close",o)}pause(o){}createUri(o,a={}){return o+"://"+this._hostname()+this._port()+this.opts.path+this._query(a)}_hostname(){const o=this.opts.hostname;return o.indexOf(":")===-1?o:"["+o+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(o){const a=Khe(o);return a.length?"?"+a:""}}const $6="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Tb=64,Yhe={};let B3=0,_S=0,W3;function G3(n){let o="";do o=$6[n%Tb]+o,n=Math.floor(n/Tb);while(n>0);return o}function Q6(){const n=G3(+new Date);return n!==W3?(B3=0,W3=n):n+"."+G3(B3++)}for(;_S<Tb;_S++)Yhe[$6[_S]]=_S;let Z6=!1;try{Z6=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Jhe=Z6;function eG(n){const o=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!o||Jhe))return new XMLHttpRequest}catch{}if(!o)try{return new gs[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Xhe(){}const $he=function(){return new eG({xdomain:!1}).responseType!=null}();class Qhe extends iO{constructor(o){if(super(o),this.polling=!1,typeof location<"u"){const d=location.protocol==="https:";let p=location.port;p||(p=d?"443":"80"),this.xd=typeof location<"u"&&o.hostname!==location.hostname||p!==o.port}const a=o&&o.forceBase64;this.supportsBinary=$he&&!a,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(o){this.readyState="pausing";const a=()=>{this.readyState="paused",o()};if(this.polling||!this.writable){let d=0;this.polling&&(d++,this.once("pollComplete",function(){--d||a()})),this.writable||(d++,this.once("drain",function(){--d||a()}))}else a()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(o){const a=d=>{if(this.readyState==="opening"&&d.type==="open"&&this.onOpen(),d.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(d)};xhe(o,this.socket.binaryType).forEach(a),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const o=()=>{this.write([{type:"close"}])};this.readyState==="open"?o():this.once("open",o)}write(o){this.writable=!1,Mhe(o,a=>{this.doWrite(a,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const o=this.opts.secure?"https":"http",a=this.query||{};return this.opts.timestampRequests!==!1&&(a[this.opts.timestampParam]=Q6()),!this.supportsBinary&&!a.sid&&(a.b64=1),this.createUri(o,a)}request(o={}){return Object.assign(o,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Kh(this.uri(),o)}doWrite(o,a){const d=this.request({method:"POST",data:o});d.on("success",a),d.on("error",(p,_)=>{this.onError("xhr post error",p,_)})}doPoll(){const o=this.request();o.on("data",this.onData.bind(this)),o.on("error",(a,d)=>{this.onError("xhr poll error",a,d)}),this.pollXhr=o}}let Kh=class HS extends Fn{constructor(o,a){super(),Pv(this,a),this.opts=a,this.method=a.method||"GET",this.uri=o,this.data=a.data!==void 0?a.data:null,this.create()}create(){var o;const a=X6(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");a.xdomain=!!this.opts.xd;const d=this.xhr=new eG(a);try{d.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){d.setDisableHeaderCheck&&d.setDisableHeaderCheck(!0);for(let p in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(p)&&d.setRequestHeader(p,this.opts.extraHeaders[p])}}catch{}if(this.method==="POST")try{d.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{d.setRequestHeader("Accept","*/*")}catch{}(o=this.opts.cookieJar)===null||o===void 0||o.addCookies(d),"withCredentials"in d&&(d.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(d.timeout=this.opts.requestTimeout),d.onreadystatechange=()=>{var p;d.readyState===3&&((p=this.opts.cookieJar)===null||p===void 0||p.parseCookies(d)),d.readyState===4&&(d.status===200||d.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof d.status=="number"?d.status:0)},0))},d.send(this.data)}catch(p){this.setTimeoutFn(()=>{this.onError(p)},0);return}typeof document<"u"&&(this.index=HS.requestsCount++,HS.requests[this.index]=this)}onError(o){this.emitReserved("error",o,this.xhr),this.cleanup(!0)}cleanup(o){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Xhe,o)try{this.xhr.abort()}catch{}typeof document<"u"&&delete HS.requests[this.index],this.xhr=null}}onLoad(){const o=this.xhr.responseText;o!==null&&(this.emitReserved("data",o),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};Kh.requestsCount=0;Kh.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",H3);else if(typeof addEventListener=="function"){const n="onpagehide"in gs?"pagehide":"unload";addEventListener(n,H3,!1)}}function H3(){for(let n in Kh.requests)Kh.requests.hasOwnProperty(n)&&Kh.requests[n].abort()}const oO=typeof Promise=="function"&&typeof Promise.resolve=="function"?o=>Promise.resolve().then(o):(o,a)=>a(o,0),ES=gs.WebSocket||gs.MozWebSocket,K3=!0,Zhe="arraybuffer",z3=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class epe extends iO{constructor(o){super(o),this.supportsBinary=!o.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const o=this.uri(),a=this.opts.protocols,d=z3?{}:X6(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(d.headers=this.opts.extraHeaders);try{this.ws=K3&&!z3?a?new ES(o,a):new ES(o):new ES(o,a,d)}catch(p){return this.emitReserved("error",p)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=o=>this.onClose({description:"websocket connection closed",context:o}),this.ws.onmessage=o=>this.onData(o.data),this.ws.onerror=o=>this.onError("websocket error",o)}write(o){this.writable=!1;for(let a=0;a<o.length;a++){const d=o[a],p=a===o.length-1;rO(d,this.supportsBinary,_=>{const g={};try{K3&&this.ws.send(_)}catch{}p&&oO(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const o=this.opts.secure?"wss":"ws",a=this.query||{};return this.opts.timestampRequests&&(a[this.opts.timestampParam]=Q6()),this.supportsBinary||(a.b64=1),this.createUri(o,a)}check(){return!!ES}}class tpe extends iO{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(o=>{this.onError("webtransport error",o)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(o=>{const a=Vhe(Number.MAX_SAFE_INTEGER,this.socket.binaryType),d=o.readable.pipeThrough(a).getReader(),p=Uhe();p.readable.pipeTo(o.writable),this.writer=p.writable.getWriter();const _=()=>{d.read().then(({done:C,value:R})=>{C||(this.onPacket(R),_())}).catch(C=>{})};_();const g={type:"open"};this.query.sid&&(g.data=`{"sid":"${this.query.sid}"}`),this.writer.write(g).then(()=>this.onOpen())})}))}write(o){this.writable=!1;for(let a=0;a<o.length;a++){const d=o[a],p=a===o.length-1;this.writer.write(d).then(()=>{p&&oO(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var o;(o=this.transport)===null||o===void 0||o.close()}}const rpe={websocket:epe,webtransport:tpe,polling:Qhe},npe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ipe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Cb(n){if(n.length>2e3)throw"URI too long";const o=n,a=n.indexOf("["),d=n.indexOf("]");a!=-1&&d!=-1&&(n=n.substring(0,a)+n.substring(a,d).replace(/:/g,";")+n.substring(d,n.length));let p=npe.exec(n||""),_={},g=14;for(;g--;)_[ipe[g]]=p[g]||"";return a!=-1&&d!=-1&&(_.source=o,_.host=_.host.substring(1,_.host.length-1).replace(/;/g,":"),_.authority=_.authority.replace("[","").replace("]","").replace(/;/g,":"),_.ipv6uri=!0),_.pathNames=ope(_,_.path),_.queryKey=spe(_,_.query),_}function ope(n,o){const a=/\/{2,9}/g,d=o.replace(a,"/").split("/");return(o.slice(0,1)=="/"||o.length===0)&&d.splice(0,1),o.slice(-1)=="/"&&d.splice(d.length-1,1),d}function spe(n,o){const a={};return o.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(d,p,_){p&&(a[p]=_)}),a}let tG=class Ch extends Fn{constructor(o,a={}){super(),this.binaryType=Zhe,this.writeBuffer=[],o&&typeof o=="object"&&(a=o,o=null),o?(o=Cb(o),a.hostname=o.host,a.secure=o.protocol==="https"||o.protocol==="wss",a.port=o.port,o.query&&(a.query=o.query)):a.host&&(a.hostname=Cb(a.host).host),Pv(this,a),this.secure=a.secure!=null?a.secure:typeof location<"u"&&location.protocol==="https:",a.hostname&&!a.port&&(a.port=this.secure?"443":"80"),this.hostname=a.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=a.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=a.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},a),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=zhe(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(o){const a=Object.assign({},this.opts.query);a.EIO=J6,a.transport=o,this.id&&(a.sid=this.id);const d=Object.assign({},this.opts,{query:a,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[o]);return new rpe[o](d)}open(){let o;if(this.opts.rememberUpgrade&&Ch.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)o="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else o=this.transports[0];this.readyState="opening";try{o=this.createTransport(o)}catch{this.transports.shift(),this.open();return}o.open(),this.setTransport(o)}setTransport(o){this.transport&&this.transport.removeAllListeners(),this.transport=o,o.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",a=>this.onClose("transport close",a))}probe(o){let a=this.createTransport(o),d=!1;Ch.priorWebsocketSuccess=!1;const p=()=>{d||(a.send([{type:"ping",data:"probe"}]),a.once("packet",k=>{if(!d)if(k.type==="pong"&&k.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",a),!a)return;Ch.priorWebsocketSuccess=a.name==="websocket",this.transport.pause(()=>{d||this.readyState!=="closed"&&(L(),this.setTransport(a),a.send([{type:"upgrade"}]),this.emitReserved("upgrade",a),a=null,this.upgrading=!1,this.flush())})}else{const M=new Error("probe error");M.transport=a.name,this.emitReserved("upgradeError",M)}}))};function _(){d||(d=!0,L(),a.close(),a=null)}const g=k=>{const M=new Error("probe error: "+k);M.transport=a.name,_(),this.emitReserved("upgradeError",M)};function C(){g("transport closed")}function R(){g("socket closed")}function D(k){a&&k.name!==a.name&&_()}const L=()=>{a.removeListener("open",p),a.removeListener("error",g),a.removeListener("close",C),this.off("close",R),this.off("upgrading",D)};a.once("open",p),a.once("error",g),a.once("close",C),this.once("close",R),this.once("upgrading",D),this.upgrades.indexOf("webtransport")!==-1&&o!=="webtransport"?this.setTimeoutFn(()=>{d||a.open()},200):a.open()}onOpen(){if(this.readyState="open",Ch.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let o=0;const a=this.upgrades.length;for(;o<a;o++)this.probe(this.upgrades[o])}}onPacket(o){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",o),this.emitReserved("heartbeat"),this.resetPingTimeout(),o.type){case"open":this.onHandshake(JSON.parse(o.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const a=new Error("server error");a.code=o.data,this.onError(a);break;case"message":this.emitReserved("data",o.data),this.emitReserved("message",o.data);break}}onHandshake(o){this.emitReserved("handshake",o),this.id=o.sid,this.transport.query.sid=o.sid,this.upgrades=this.filterUpgrades(o.upgrades),this.pingInterval=o.pingInterval,this.pingTimeout=o.pingTimeout,this.maxPayload=o.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const o=this.getWritablePackets();this.transport.send(o),this.prevBufferLen=o.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let a=1;for(let d=0;d<this.writeBuffer.length;d++){const p=this.writeBuffer[d].data;if(p&&(a+=Ghe(p)),d>0&&a>this.maxPayload)return this.writeBuffer.slice(0,d);a+=2}return this.writeBuffer}write(o,a,d){return this.sendPacket("message",o,a,d),this}send(o,a,d){return this.sendPacket("message",o,a,d),this}sendPacket(o,a,d,p){if(typeof a=="function"&&(p=a,a=void 0),typeof d=="function"&&(p=d,d=null),this.readyState==="closing"||this.readyState==="closed")return;d=d||{},d.compress=d.compress!==!1;const _={type:o,data:a,options:d};this.emitReserved("packetCreate",_),this.writeBuffer.push(_),p&&this.once("flush",p),this.flush()}close(){const o=()=>{this.onClose("forced close"),this.transport.close()},a=()=>{this.off("upgrade",a),this.off("upgradeError",a),o()},d=()=>{this.once("upgrade",a),this.once("upgradeError",a)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?d():o()}):this.upgrading?d():o()),this}onError(o){Ch.priorWebsocketSuccess=!1,this.emitReserved("error",o),this.onClose("transport error",o)}onClose(o,a){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",o,a),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(o){const a=[];let d=0;const p=o.length;for(;d<p;d++)~this.transports.indexOf(o[d])&&a.push(o[d]);return a}};tG.protocol=J6;function ape(n,o="",a){let d=n;a=a||typeof location<"u"&&location,n==null&&(n=a.protocol+"//"+a.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=a.protocol+n:n=a.host+n),/^(https?|wss?):\/\//.test(n)||(typeof a<"u"?n=a.protocol+"//"+n:n="https://"+n),d=Cb(n)),d.port||(/^(http|ws)$/.test(d.protocol)?d.port="80":/^(http|ws)s$/.test(d.protocol)&&(d.port="443")),d.path=d.path||"/";const _=d.host.indexOf(":")!==-1?"["+d.host+"]":d.host;return d.id=d.protocol+"://"+_+":"+d.port+o,d.href=d.protocol+"://"+_+(a&&a.port===d.port?"":":"+d.port),d}const cpe=typeof ArrayBuffer=="function",lpe=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,rG=Object.prototype.toString,dpe=typeof Blob=="function"||typeof Blob<"u"&&rG.call(Blob)==="[object BlobConstructor]",upe=typeof File=="function"||typeof File<"u"&&rG.call(File)==="[object FileConstructor]";function sO(n){return cpe&&(n instanceof ArrayBuffer||lpe(n))||dpe&&n instanceof Blob||upe&&n instanceof File}function KS(n,o){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let a=0,d=n.length;a<d;a++)if(KS(n[a]))return!0;return!1}if(sO(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return KS(n.toJSON(),!0);for(const a in n)if(Object.prototype.hasOwnProperty.call(n,a)&&KS(n[a]))return!0;return!1}function hpe(n){const o=[],a=n.data,d=n;return d.data=Rb(a,o),d.attachments=o.length,{packet:d,buffers:o}}function Rb(n,o){if(!n)return n;if(sO(n)){const a={_placeholder:!0,num:o.length};return o.push(n),a}else if(Array.isArray(n)){const a=new Array(n.length);for(let d=0;d<n.length;d++)a[d]=Rb(n[d],o);return a}else if(typeof n=="object"&&!(n instanceof Date)){const a={};for(const d in n)Object.prototype.hasOwnProperty.call(n,d)&&(a[d]=Rb(n[d],o));return a}return n}function ppe(n,o){return n.data=wb(n.data,o),delete n.attachments,n}function wb(n,o){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<o.length)return o[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let a=0;a<n.length;a++)n[a]=wb(n[a],o);else if(typeof n=="object")for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&(n[a]=wb(n[a],o));return n}const fpe=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],mpe=5;var Zt;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(Zt||(Zt={}));class _pe{constructor(o){this.replacer=o}encode(o){return(o.type===Zt.EVENT||o.type===Zt.ACK)&&KS(o)?this.encodeAsBinary({type:o.type===Zt.EVENT?Zt.BINARY_EVENT:Zt.BINARY_ACK,nsp:o.nsp,data:o.data,id:o.id}):[this.encodeAsString(o)]}encodeAsString(o){let a=""+o.type;return(o.type===Zt.BINARY_EVENT||o.type===Zt.BINARY_ACK)&&(a+=o.attachments+"-"),o.nsp&&o.nsp!=="/"&&(a+=o.nsp+","),o.id!=null&&(a+=o.id),o.data!=null&&(a+=JSON.stringify(o.data,this.replacer)),a}encodeAsBinary(o){const a=hpe(o),d=this.encodeAsString(a.packet),p=a.buffers;return p.unshift(d),p}}function q3(n){return Object.prototype.toString.call(n)==="[object Object]"}class aO extends Fn{constructor(o){super(),this.reviver=o}add(o){let a;if(typeof o=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");a=this.decodeString(o);const d=a.type===Zt.BINARY_EVENT;d||a.type===Zt.BINARY_ACK?(a.type=d?Zt.EVENT:Zt.ACK,this.reconstructor=new Epe(a),a.attachments===0&&super.emitReserved("decoded",a)):super.emitReserved("decoded",a)}else if(sO(o)||o.base64)if(this.reconstructor)a=this.reconstructor.takeBinaryData(o),a&&(this.reconstructor=null,super.emitReserved("decoded",a));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+o)}decodeString(o){let a=0;const d={type:Number(o.charAt(0))};if(Zt[d.type]===void 0)throw new Error("unknown packet type "+d.type);if(d.type===Zt.BINARY_EVENT||d.type===Zt.BINARY_ACK){const _=a+1;for(;o.charAt(++a)!=="-"&&a!=o.length;);const g=o.substring(_,a);if(g!=Number(g)||o.charAt(a)!=="-")throw new Error("Illegal attachments");d.attachments=Number(g)}if(o.charAt(a+1)==="/"){const _=a+1;for(;++a&&!(o.charAt(a)===","||a===o.length););d.nsp=o.substring(_,a)}else d.nsp="/";const p=o.charAt(a+1);if(p!==""&&Number(p)==p){const _=a+1;for(;++a;){const g=o.charAt(a);if(g==null||Number(g)!=g){--a;break}if(a===o.length)break}d.id=Number(o.substring(_,a+1))}if(o.charAt(++a)){const _=this.tryParse(o.substr(a));if(aO.isPayloadValid(d.type,_))d.data=_;else throw new Error("invalid payload")}return d}tryParse(o){try{return JSON.parse(o,this.reviver)}catch{return!1}}static isPayloadValid(o,a){switch(o){case Zt.CONNECT:return q3(a);case Zt.DISCONNECT:return a===void 0;case Zt.CONNECT_ERROR:return typeof a=="string"||q3(a);case Zt.EVENT:case Zt.BINARY_EVENT:return Array.isArray(a)&&(typeof a[0]=="number"||typeof a[0]=="string"&&fpe.indexOf(a[0])===-1);case Zt.ACK:case Zt.BINARY_ACK:return Array.isArray(a)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Epe{constructor(o){this.packet=o,this.buffers=[],this.reconPack=o}takeBinaryData(o){if(this.buffers.push(o),this.buffers.length===this.reconPack.attachments){const a=ppe(this.reconPack,this.buffers);return this.finishedReconstruction(),a}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const gpe=Object.freeze(Object.defineProperty({__proto__:null,Decoder:aO,Encoder:_pe,get PacketType(){return Zt},protocol:mpe},Symbol.toStringTag,{value:"Module"}));function $s(n,o,a){return n.on(o,a),function(){n.off(o,a)}}const Spe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class nG extends Fn{constructor(o,a,d){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=o,this.nsp=a,d&&d.auth&&(this.auth=d.auth),this._opts=Object.assign({},d),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const o=this.io;this.subs=[$s(o,"open",this.onopen.bind(this)),$s(o,"packet",this.onpacket.bind(this)),$s(o,"error",this.onerror.bind(this)),$s(o,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...o){return o.unshift("message"),this.emit.apply(this,o),this}emit(o,...a){if(Spe.hasOwnProperty(o))throw new Error('"'+o.toString()+'" is a reserved event name');if(a.unshift(o),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(a),this;const d={type:Zt.EVENT,data:a};if(d.options={},d.options.compress=this.flags.compress!==!1,typeof a[a.length-1]=="function"){const g=this.ids++,C=a.pop();this._registerAckCallback(g,C),d.id=g}const p=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!p||!this.connected)||(this.connected?(this.notifyOutgoingListeners(d),this.packet(d)):this.sendBuffer.push(d)),this.flags={},this}_registerAckCallback(o,a){var d;const p=(d=this.flags.timeout)!==null&&d!==void 0?d:this._opts.ackTimeout;if(p===void 0){this.acks[o]=a;return}const _=this.io.setTimeoutFn(()=>{delete this.acks[o];for(let C=0;C<this.sendBuffer.length;C++)this.sendBuffer[C].id===o&&this.sendBuffer.splice(C,1);a.call(this,new Error("operation has timed out"))},p),g=(...C)=>{this.io.clearTimeoutFn(_),a.apply(this,C)};g.withError=!0,this.acks[o]=g}emitWithAck(o,...a){return new Promise((d,p)=>{const _=(g,C)=>g?p(g):d(C);_.withError=!0,a.push(_),this.emit(o,...a)})}_addToQueue(o){let a;typeof o[o.length-1]=="function"&&(a=o.pop());const d={id:this._queueSeq++,tryCount:0,pending:!1,args:o,flags:Object.assign({fromQueue:!0},this.flags)};o.push((p,..._)=>d!==this._queue[0]?void 0:(p!==null?d.tryCount>this._opts.retries&&(this._queue.shift(),a&&a(p)):(this._queue.shift(),a&&a(null,..._)),d.pending=!1,this._drainQueue())),this._queue.push(d),this._drainQueue()}_drainQueue(o=!1){if(!this.connected||this._queue.length===0)return;const a=this._queue[0];a.pending&&!o||(a.pending=!0,a.tryCount++,this.flags=a.flags,this.emit.apply(this,a.args))}packet(o){o.nsp=this.nsp,this.io._packet(o)}onopen(){typeof this.auth=="function"?this.auth(o=>{this._sendConnectPacket(o)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(o){this.packet({type:Zt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},o):o})}onerror(o){this.connected||this.emitReserved("connect_error",o)}onclose(o,a){this.connected=!1,delete this.id,this.emitReserved("disconnect",o,a),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(o=>{if(!this.sendBuffer.some(d=>String(d.id)===o)){const d=this.acks[o];delete this.acks[o],d.withError&&d.call(this,new Error("socket has been disconnected"))}})}onpacket(o){if(o.nsp===this.nsp)switch(o.type){case Zt.CONNECT:o.data&&o.data.sid?this.onconnect(o.data.sid,o.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Zt.EVENT:case Zt.BINARY_EVENT:this.onevent(o);break;case Zt.ACK:case Zt.BINARY_ACK:this.onack(o);break;case Zt.DISCONNECT:this.ondisconnect();break;case Zt.CONNECT_ERROR:this.destroy();const d=new Error(o.data.message);d.data=o.data.data,this.emitReserved("connect_error",d);break}}onevent(o){const a=o.data||[];o.id!=null&&a.push(this.ack(o.id)),this.connected?this.emitEvent(a):this.receiveBuffer.push(Object.freeze(a))}emitEvent(o){if(this._anyListeners&&this._anyListeners.length){const a=this._anyListeners.slice();for(const d of a)d.apply(this,o)}super.emit.apply(this,o),this._pid&&o.length&&typeof o[o.length-1]=="string"&&(this._lastOffset=o[o.length-1])}ack(o){const a=this;let d=!1;return function(...p){d||(d=!0,a.packet({type:Zt.ACK,id:o,data:p}))}}onack(o){const a=this.acks[o.id];typeof a=="function"&&(delete this.acks[o.id],a.withError&&o.data.unshift(null),a.apply(this,o.data))}onconnect(o,a){this.id=o,this.recovered=a&&this._pid===a,this._pid=a,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(o=>this.emitEvent(o)),this.receiveBuffer=[],this.sendBuffer.forEach(o=>{this.notifyOutgoingListeners(o),this.packet(o)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(o=>o()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Zt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(o){return this.flags.compress=o,this}get volatile(){return this.flags.volatile=!0,this}timeout(o){return this.flags.timeout=o,this}onAny(o){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(o),this}prependAny(o){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(o),this}offAny(o){if(!this._anyListeners)return this;if(o){const a=this._anyListeners;for(let d=0;d<a.length;d++)if(o===a[d])return a.splice(d,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(o){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(o),this}prependAnyOutgoing(o){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(o),this}offAnyOutgoing(o){if(!this._anyOutgoingListeners)return this;if(o){const a=this._anyOutgoingListeners;for(let d=0;d<a.length;d++)if(o===a[d])return a.splice(d,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(o){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const a=this._anyOutgoingListeners.slice();for(const d of a)d.apply(this,o.data)}}}function lp(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}lp.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var o=Math.random(),a=Math.floor(o*this.jitter*n);n=Math.floor(o*10)&1?n+a:n-a}return Math.min(n,this.max)|0};lp.prototype.reset=function(){this.attempts=0};lp.prototype.setMin=function(n){this.ms=n};lp.prototype.setMax=function(n){this.max=n};lp.prototype.setJitter=function(n){this.jitter=n};class Ib extends Fn{constructor(o,a){var d;super(),this.nsps={},this.subs=[],o&&typeof o=="object"&&(a=o,o=void 0),a=a||{},a.path=a.path||"/socket.io",this.opts=a,Pv(this,a),this.reconnection(a.reconnection!==!1),this.reconnectionAttempts(a.reconnectionAttempts||1/0),this.reconnectionDelay(a.reconnectionDelay||1e3),this.reconnectionDelayMax(a.reconnectionDelayMax||5e3),this.randomizationFactor((d=a.randomizationFactor)!==null&&d!==void 0?d:.5),this.backoff=new lp({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(a.timeout==null?2e4:a.timeout),this._readyState="closed",this.uri=o;const p=a.parser||gpe;this.encoder=new p.Encoder,this.decoder=new p.Decoder,this._autoConnect=a.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(o){return arguments.length?(this._reconnection=!!o,this):this._reconnection}reconnectionAttempts(o){return o===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=o,this)}reconnectionDelay(o){var a;return o===void 0?this._reconnectionDelay:(this._reconnectionDelay=o,(a=this.backoff)===null||a===void 0||a.setMin(o),this)}randomizationFactor(o){var a;return o===void 0?this._randomizationFactor:(this._randomizationFactor=o,(a=this.backoff)===null||a===void 0||a.setJitter(o),this)}reconnectionDelayMax(o){var a;return o===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=o,(a=this.backoff)===null||a===void 0||a.setMax(o),this)}timeout(o){return arguments.length?(this._timeout=o,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(o){if(~this._readyState.indexOf("open"))return this;this.engine=new tG(this.uri,this.opts);const a=this.engine,d=this;this._readyState="opening",this.skipReconnect=!1;const p=$s(a,"open",function(){d.onopen(),o&&o()}),_=C=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",C),o?o(C):this.maybeReconnectOnOpen()},g=$s(a,"error",_);if(this._timeout!==!1){const C=this._timeout,R=this.setTimeoutFn(()=>{p(),_(new Error("timeout")),a.close()},C);this.opts.autoUnref&&R.unref(),this.subs.push(()=>{this.clearTimeoutFn(R)})}return this.subs.push(p),this.subs.push(g),this}connect(o){return this.open(o)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const o=this.engine;this.subs.push($s(o,"ping",this.onping.bind(this)),$s(o,"data",this.ondata.bind(this)),$s(o,"error",this.onerror.bind(this)),$s(o,"close",this.onclose.bind(this)),$s(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(o){try{this.decoder.add(o)}catch(a){this.onclose("parse error",a)}}ondecoded(o){oO(()=>{this.emitReserved("packet",o)},this.setTimeoutFn)}onerror(o){this.emitReserved("error",o)}socket(o,a){let d=this.nsps[o];return d?this._autoConnect&&!d.active&&d.connect():(d=new nG(this,o,a),this.nsps[o]=d),d}_destroy(o){const a=Object.keys(this.nsps);for(const d of a)if(this.nsps[d].active)return;this._close()}_packet(o){const a=this.encoder.encode(o);for(let d=0;d<a.length;d++)this.engine.write(a[d],o.options)}cleanup(){this.subs.forEach(o=>o()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(o,a){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",o,a),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const o=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const a=this.backoff.duration();this._reconnecting=!0;const d=this.setTimeoutFn(()=>{o.skipReconnect||(this.emitReserved("reconnect_attempt",o.backoff.attempts),!o.skipReconnect&&o.open(p=>{p?(o._reconnecting=!1,o.reconnect(),this.emitReserved("reconnect_error",p)):o.onreconnect()}))},a);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}}onreconnect(){const o=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",o)}}const im={};function zS(n,o){typeof n=="object"&&(o=n,n=void 0),o=o||{};const a=ape(n,o.path||"/socket.io"),d=a.source,p=a.id,_=a.path,g=im[p]&&_ in im[p].nsps,C=o.forceNew||o["force new connection"]||o.multiplex===!1||g;let R;return C?R=new Ib(d,o):(im[p]||(im[p]=new Ib(d,o)),R=im[p]),a.query&&!o.query&&(o.query=a.queryKey),R.socket(a.path,o)}Object.assign(zS,{Manager:Ib,Socket:nG,io:zS,connect:zS});const ype="http://65.1.226.158:4000",vpe=ype;class Tpe{constructor(){this.socket=null,this.isConnected=!1}connect(){this.socket||(this.socket=zS(vpe),this.socket.on("connect",()=>{this.isConnected=!0}),this.socket.on("disconnect",()=>{this.isConnected=!1}))}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.isConnected=!1)}on(o,a){this.socket&&this.socket.on(o,a)}emit(o,a){this.socket&&this.socket.emit(o,a)}getConnectionStatus(){return this.isConnected}}const om=new Tpe,ia=J.createContext(),Cpe=({children:n})=>{const[o,a]=J.useState(!1);return J.useEffect(()=>{var p;om.connect();const d=()=>{a(!0)};return(p=om.socket)==null||p.on("connect",d),()=>{var _;(_=om.socket)==null||_.off("connect",d),om.disconnect()}},[]),Z.jsx(ia.Provider,{value:om,children:n})},fI=()=>{const n=["ThunderQuasar","EternalJourney","LunarPulse","VortexWhisper","NovaVoyager","SpectralKnight","EclipseOracle","InfinityScribe","NebulaNomad","AstralGuardian","QuantumWanderer","CelestialPhoenix","GalacticSeraph","ChronoCatalyst","StellarDreamer","RadiantReverie","MysticWhisper","AetherChronicle","NebulaNinja","QuantumQuintessence","LuminousLabyrinth","CelestialCrescent","GalacticGlider","ChronoNomad","AstraAegis","RadiantRonin","NebulaNova","QuantumQuasar","LuminousLancer","CelestialCipher","StellarScribe","MysticMarauder","AetherAdventurer","NebulaNimbus","QuantumQuester","GalacticGlimmer","ChronoChampion","CelestialCustodian","AstraAcolyte","RadiantRanger","NebulaNavigator","QuantumQuill","LuminousLuminary","CelestialSeeker","StellarSentinel","MysticMaverick","AetherArtisan","NebulaNebula","QuantumQuirk","GalacticGladiator","ChronoChallenger","CelestialConjurer","AstraArchitect","RadiantRevenant","NebulaNurturer","QuantumQuandary","LuminousLibrarian","CelestialStargazer","StellarStrider","MysticMentor","AetherAcolyte","NebulaNinja","QuantumQuarry","GalacticGuardian","ChronoCrusader","CelestialCaretaker","AstraAdventurer","RadiantRogue","NebulaNebula","QuantumQuill","LuminousLegend","CosmicVoyager","EternalEcho","LunarLuminary","AstralEcho","NebulaNavigator","StellarSentinel","EclipseEmissary","QuantumQuasar","CelestialCaster","GalacticGuardian","SpectralShade","RadiantRanger","MysticMarauder","AetherAdventurer","NebulaNebula","StellarScribe","QuantumQuester","LuminousLancer","CelestialCipher","AstralArcanist","GalacticGlimmer","ChronoChampion","RadiantRonin","NebulaNomad","QuantumQuintessence","LuminousLabyrinth","CelestialCrescent","AstraAegis","MysticMaverick","StellarStrider","NebulaNimbus","QuantumQuirk","GalacticGladiator","ChronoChallenger","CelestialConjurer","AetherArchitect","RadiantRevenant","NebulaNurturer","QuantumQuandary","LuminousLibrarian","CelestialStargazer","AstraArtisan","StellarSorcerer","MysticMentor","NebulaNavigator","QuantumQuill","GalacticGuardian","ChronoCrusader","CelestialCaretaker","AetherAcolyte","RadiantRaider","NebulaNebula","QuantumQuarry","LuminousLegend","CosmicCatalyst","EternalEssence","LunarLancer","AstralArbiter","NebulaNomad","StellarSpecter","EclipseEmperor","QuantumQuintessence","CelestialCipher","GalacticGazer","SpectralSorcerer","RadiantRogue","MysticMinstrel","AetherAdventurer","NebulaNimbus","StellarScribe","QuantumQuester","LuminousLore","CelestialCaster","AstralArcanist","GalacticGladiator","ChronoChampion","RadiantRanger","NebulaNavigator","QuantumQuasar","LuminousLancer","CelestialConjurer","AstraArtisan","MysticMarauder","StellarStrider","NebulaNebula","QuantumQuirk","GalacticGuardian","ChronoCrusader","CelestialCaretaker","AetherAcolyte","RadiantRaider","NebulaNebula","QuantumQuill","LuminousLegend","CosmicCatalyst","EternalEssence","LunarLancer","AstralArbiter","NebulaNomad","StellarSpecter","EclipseEmperor","QuantumQuintessence","CelestialCipher","GalacticGazer","SpectralSorcerer","RadiantRogue","MysticMinstrel","AetherAdventurer","NebulaNimbus","StellarScribe","QuantumQuester","LuminousLore","CelestialCaster","AstralArcanist","GalacticGladiator","ChronoChampion","RadiantRanger","NebulaNavigator","QuantumQuasar","LuminousLancer","CelestialConjurer","AstraArtisan","MysticMarauder","StellarStrider","NebulaNebula","QuantumQuirk","GalacticGuardian","ChronoCrusader","CelestialCaretaker","AetherAcolyte","RadiantRaider","NebulaNebula","QuantumQuill","LuminousLegend","CosmicCatalyst","EternalEssence","LunarLancer","AstralArbiter","NebulaNomad","StellarSpecter","EclipseEmperor","QuantumQuintessence","CelestialCipher","GalacticGazer","SpectralSorcerer","RadiantRogue","MysticMinstrel","AetherAdventurer","NebulaNimbus","StellarScribe","QuantumQuester","LuminousLore","CelestialCaster","AstralArcanist","GalacticGladiator","ChronoChampion","RadiantRanger","NebulaNavigator","QuantumQuasar","LuminousLancer","CelestialConjurer","AstraArtisan","MysticMarauder","StellarStrider","NebulaNebula","QuantumQuirk","GalacticGuardian","ChronoCrusader","CelestialCaretaker","AetherAcolyte","RadiantRaider","NebulaNebula","QuantumQuill","LuminousLegend","CosmicCatalyst","EternalEssence","LunarLancer","AstralArbiter","NebulaNomad","StellarSpecter","EclipseEmperor","QuantumQuintessence","CelestialCipher","GalacticGazer","SpectralSorcerer","RadiantRogue","MysticMinstrel","AetherAdventurer","NebulaNimbus","StellarScribe","QuantumQuester","LuminousLore","CelestialCaster","AstralArcanist","GalacticGladiator","ChronoChampion","RadiantRanger","NebulaNavigator","QuantumQuasar","LuminousLancer","CelestialConjurer","AstraArtisan","MysticMarauder","StellarStrider","NebulaNebula","QuantumQuirk","GalacticGuardian","ChronoCrusader","CelestialCaretaker","AetherAcolyte","RadiantRaider","NebulaNebula","QuantumQuill","LuminousLegend"],o=Math.floor(Math.random()*n.length);return n[o]};function di(n){return`Minified Redux error #${n}; visit https://redux.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}var Rpe=typeof Symbol=="function"&&Symbol.observable||"@@observable",Y3=Rpe,mI=()=>Math.random().toString(36).substring(7).split("").join("."),wpe={INIT:`@@redux/INIT${mI()}`,REPLACE:`@@redux/REPLACE${mI()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${mI()}`},by=wpe;function cO(n){if(typeof n!="object"||n===null)return!1;let o=n;for(;Object.getPrototypeOf(o)!==null;)o=Object.getPrototypeOf(o);return Object.getPrototypeOf(n)===o||Object.getPrototypeOf(n)===null}function iG(n,o,a){if(typeof n!="function")throw new Error(di(2));if(typeof o=="function"&&typeof a=="function"||typeof a=="function"&&typeof arguments[3]=="function")throw new Error(di(0));if(typeof o=="function"&&typeof a>"u"&&(a=o,o=void 0),typeof a<"u"){if(typeof a!="function")throw new Error(di(1));return a(iG)(n,o)}let d=n,p=o,_=new Map,g=_,C=0,R=!1;function D(){g===_&&(g=new Map,_.forEach((Q,G)=>{g.set(G,Q)}))}function L(){if(R)throw new Error(di(3));return p}function k(Q){if(typeof Q!="function")throw new Error(di(4));if(R)throw new Error(di(5));let G=!0;D();const B=C++;return g.set(B,Q),function(){if(G){if(R)throw new Error(di(6));G=!1,D(),g.delete(B),_=null}}}function M(Q){if(!cO(Q))throw new Error(di(7));if(typeof Q.type>"u")throw new Error(di(8));if(typeof Q.type!="string")throw new Error(di(17));if(R)throw new Error(di(9));try{R=!0,p=d(p,Q)}finally{R=!1}return(_=g).forEach(B=>{B()}),Q}function Y(Q){if(typeof Q!="function")throw new Error(di(10));d=Q,M({type:by.REPLACE})}function z(){const Q=k;return{subscribe(G){if(typeof G!="object"||G===null)throw new Error(di(11));function B(){const se=G;se.next&&se.next(L())}return B(),{unsubscribe:Q(B)}},[Y3](){return this}}}return M({type:by.INIT}),{dispatch:M,subscribe:k,getState:L,replaceReducer:Y,[Y3]:z}}function Ipe(n){Object.keys(n).forEach(o=>{const a=n[o];if(typeof a(void 0,{type:by.INIT})>"u")throw new Error(di(12));if(typeof a(void 0,{type:by.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(di(13))})}function bpe(n){const o=Object.keys(n),a={};for(let _=0;_<o.length;_++){const g=o[_];typeof n[g]=="function"&&(a[g]=n[g])}const d=Object.keys(a);let p;try{Ipe(a)}catch(_){p=_}return function(g={},C){if(p)throw p;let R=!1;const D={};for(let L=0;L<d.length;L++){const k=d[L],M=a[k],Y=g[k],z=M(Y,C);if(typeof z>"u")throw C&&C.type,new Error(di(14));D[k]=z,R=R||z!==Y}return R=R||d.length!==Object.keys(g).length,R?D:g}}function Ay(...n){return n.length===0?o=>o:n.length===1?n[0]:n.reduce((o,a)=>(...d)=>o(a(...d)))}function Ape(...n){return o=>(a,d)=>{const p=o(a,d);let _=()=>{throw new Error(di(15))};const g={getState:p.getState,dispatch:(R,...D)=>_(R,...D)},C=n.map(R=>R(g));return _=Ay(...C)(p.dispatch),{...p,dispatch:_}}}function Ope(n){return cO(n)&&"type"in n&&typeof n.type=="string"}var oG=Symbol.for("immer-nothing"),J3=Symbol.for("immer-draftable"),Uo=Symbol.for("immer-state");function Zs(n,...o){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var tp=Object.getPrototypeOf;function Ml(n){return!!n&&!!n[Uo]}function Tc(n){var o;return n?sG(n)||Array.isArray(n)||!!n[J3]||!!((o=n.constructor)!=null&&o[J3])||Lv(n)||Mv(n):!1}var Npe=Object.prototype.constructor.toString();function sG(n){if(!n||typeof n!="object")return!1;const o=tp(n);if(o===null)return!0;const a=Object.hasOwnProperty.call(o,"constructor")&&o.constructor;return a===Object?!0:typeof a=="function"&&Function.toString.call(a)===Npe}function Oy(n,o){kv(n)===0?Reflect.ownKeys(n).forEach(a=>{o(a,n[a],n)}):n.forEach((a,d)=>o(d,a,n))}function kv(n){const o=n[Uo];return o?o.type_:Array.isArray(n)?1:Lv(n)?2:Mv(n)?3:0}function bb(n,o){return kv(n)===2?n.has(o):Object.prototype.hasOwnProperty.call(n,o)}function aG(n,o,a){const d=kv(n);d===2?n.set(o,a):d===3?n.add(a):n[o]=a}function Dpe(n,o){return n===o?n!==0||1/n===1/o:n!==n&&o!==o}function Lv(n){return n instanceof Map}function Mv(n){return n instanceof Set}function Nd(n){return n.copy_||n.base_}function Ab(n,o){if(Lv(n))return new Map(n);if(Mv(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const a=sG(n);if(o===!0||o==="class_only"&&!a){const d=Object.getOwnPropertyDescriptors(n);delete d[Uo];let p=Reflect.ownKeys(d);for(let _=0;_<p.length;_++){const g=p[_],C=d[g];C.writable===!1&&(C.writable=!0,C.configurable=!0),(C.get||C.set)&&(d[g]={configurable:!0,writable:!0,enumerable:C.enumerable,value:n[g]})}return Object.create(tp(n),d)}else{const d=tp(n);if(d!==null&&a)return{...n};const p=Object.create(d);return Object.assign(p,n)}}function lO(n,o=!1){return xv(n)||Ml(n)||!Tc(n)||(kv(n)>1&&(n.set=n.add=n.clear=n.delete=Ppe),Object.freeze(n),o&&Object.entries(n).forEach(([a,d])=>lO(d,!0))),n}function Ppe(){Zs(2)}function xv(n){return Object.isFrozen(n)}var kpe={};function zd(n){const o=kpe[n];return o||Zs(0,n),o}var $m;function cG(){return $m}function Lpe(n,o){return{drafts_:[],parent_:n,immer_:o,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function X3(n,o){o&&(zd("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=o)}function Ob(n){Nb(n),n.drafts_.forEach(Mpe),n.drafts_=null}function Nb(n){n===$m&&($m=n.parent_)}function $3(n){return $m=Lpe($m,n)}function Mpe(n){const o=n[Uo];o.type_===0||o.type_===1?o.revoke_():o.revoked_=!0}function Q3(n,o){o.unfinalizedDrafts_=o.drafts_.length;const a=o.drafts_[0];return n!==void 0&&n!==a?(a[Uo].modified_&&(Ob(o),Zs(4)),Tc(n)&&(n=Ny(o,n),o.parent_||Dy(o,n)),o.patches_&&zd("Patches").generateReplacementPatches_(a[Uo].base_,n,o.patches_,o.inversePatches_)):n=Ny(o,a,[]),Ob(o),o.patches_&&o.patchListener_(o.patches_,o.inversePatches_),n!==oG?n:void 0}function Ny(n,o,a){if(xv(o))return o;const d=o[Uo];if(!d)return Oy(o,(p,_)=>Z3(n,d,o,p,_,a)),o;if(d.scope_!==n)return o;if(!d.modified_)return Dy(n,d.base_,!0),d.base_;if(!d.finalized_){d.finalized_=!0,d.scope_.unfinalizedDrafts_--;const p=d.copy_;let _=p,g=!1;d.type_===3&&(_=new Set(p),p.clear(),g=!0),Oy(_,(C,R)=>Z3(n,d,p,C,R,a,g)),Dy(n,p,!1),a&&n.patches_&&zd("Patches").generatePatches_(d,a,n.patches_,n.inversePatches_)}return d.copy_}function Z3(n,o,a,d,p,_,g){if(Ml(p)){const C=_&&o&&o.type_!==3&&!bb(o.assigned_,d)?_.concat(d):void 0,R=Ny(n,p,C);if(aG(a,d,R),Ml(R))n.canAutoFreeze_=!1;else return}else g&&a.add(p);if(Tc(p)&&!xv(p)){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1)return;Ny(n,p),(!o||!o.scope_.parent_)&&typeof d!="symbol"&&Object.prototype.propertyIsEnumerable.call(a,d)&&Dy(n,p)}}function Dy(n,o,a=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&lO(o,a)}function xpe(n,o){const a=Array.isArray(n),d={type_:a?1:0,scope_:o?o.scope_:cG(),modified_:!1,finalized_:!1,assigned_:{},parent_:o,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let p=d,_=dO;a&&(p=[d],_=Qm);const{revoke:g,proxy:C}=Proxy.revocable(p,_);return d.draft_=C,d.revoke_=g,C}var dO={get(n,o){if(o===Uo)return n;const a=Nd(n);if(!bb(a,o))return Upe(n,a,o);const d=a[o];return n.finalized_||!Tc(d)?d:d===_I(n.base_,o)?(EI(n),n.copy_[o]=Pb(d,n)):d},has(n,o){return o in Nd(n)},ownKeys(n){return Reflect.ownKeys(Nd(n))},set(n,o,a){const d=lG(Nd(n),o);if(d!=null&&d.set)return d.set.call(n.draft_,a),!0;if(!n.modified_){const p=_I(Nd(n),o),_=p==null?void 0:p[Uo];if(_&&_.base_===a)return n.copy_[o]=a,n.assigned_[o]=!1,!0;if(Dpe(a,p)&&(a!==void 0||bb(n.base_,o)))return!0;EI(n),Db(n)}return n.copy_[o]===a&&(a!==void 0||o in n.copy_)||Number.isNaN(a)&&Number.isNaN(n.copy_[o])||(n.copy_[o]=a,n.assigned_[o]=!0),!0},deleteProperty(n,o){return _I(n.base_,o)!==void 0||o in n.base_?(n.assigned_[o]=!1,EI(n),Db(n)):delete n.assigned_[o],n.copy_&&delete n.copy_[o],!0},getOwnPropertyDescriptor(n,o){const a=Nd(n),d=Reflect.getOwnPropertyDescriptor(a,o);return d&&{writable:!0,configurable:n.type_!==1||o!=="length",enumerable:d.enumerable,value:a[o]}},defineProperty(){Zs(11)},getPrototypeOf(n){return tp(n.base_)},setPrototypeOf(){Zs(12)}},Qm={};Oy(dO,(n,o)=>{Qm[n]=function(){return arguments[0]=arguments[0][0],o.apply(this,arguments)}});Qm.deleteProperty=function(n,o){return Qm.set.call(this,n,o,void 0)};Qm.set=function(n,o,a){return dO.set.call(this,n[0],o,a,n[0])};function _I(n,o){const a=n[Uo];return(a?Nd(a):n)[o]}function Upe(n,o,a){var p;const d=lG(o,a);return d?"value"in d?d.value:(p=d.get)==null?void 0:p.call(n.draft_):void 0}function lG(n,o){if(!(o in n))return;let a=tp(n);for(;a;){const d=Object.getOwnPropertyDescriptor(a,o);if(d)return d;a=tp(a)}}function Db(n){n.modified_||(n.modified_=!0,n.parent_&&Db(n.parent_))}function EI(n){n.copy_||(n.copy_=Ab(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var Vpe=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(o,a,d)=>{if(typeof o=="function"&&typeof a!="function"){const _=a;a=o;const g=this;return function(R=_,...D){return g.produce(R,L=>a.call(this,L,...D))}}typeof a!="function"&&Zs(6),d!==void 0&&typeof d!="function"&&Zs(7);let p;if(Tc(o)){const _=$3(this),g=Pb(o,void 0);let C=!0;try{p=a(g),C=!1}finally{C?Ob(_):Nb(_)}return X3(_,d),Q3(p,_)}else if(!o||typeof o!="object"){if(p=a(o),p===void 0&&(p=o),p===oG&&(p=void 0),this.autoFreeze_&&lO(p,!0),d){const _=[],g=[];zd("Patches").generateReplacementPatches_(o,p,_,g),d(_,g)}return p}else Zs(1,o)},this.produceWithPatches=(o,a)=>{if(typeof o=="function")return(g,...C)=>this.produceWithPatches(g,R=>o(R,...C));let d,p;return[this.produce(o,a,(g,C)=>{d=g,p=C}),d,p]},typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof(n==null?void 0:n.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy)}createDraft(n){Tc(n)||Zs(8),Ml(n)&&(n=dG(n));const o=$3(this),a=Pb(n,void 0);return a[Uo].isManual_=!0,Nb(o),a}finishDraft(n,o){const a=n&&n[Uo];(!a||!a.isManual_)&&Zs(9);const{scope_:d}=a;return X3(d,o),Q3(void 0,d)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}applyPatches(n,o){let a;for(a=o.length-1;a>=0;a--){const p=o[a];if(p.path.length===0&&p.op==="replace"){n=p.value;break}}a>-1&&(o=o.slice(a+1));const d=zd("Patches").applyPatches_;return Ml(n)?d(n,o):this.produce(n,p=>d(p,o))}};function Pb(n,o){const a=Lv(n)?zd("MapSet").proxyMap_(n,o):Mv(n)?zd("MapSet").proxySet_(n,o):xpe(n,o);return(o?o.scope_:cG()).drafts_.push(a),a}function dG(n){return Ml(n)||Zs(10,n),uG(n)}function uG(n){if(!Tc(n)||xv(n))return n;const o=n[Uo];let a;if(o){if(!o.modified_)return o.base_;o.finalized_=!0,a=Ab(n,o.scope_.immer_.useStrictShallowCopy_)}else a=Ab(n,!0);return Oy(a,(d,p)=>{aG(a,d,uG(p))}),o&&(o.finalized_=!1),a}var Vo=new Vpe,hG=Vo.produce;Vo.produceWithPatches.bind(Vo);Vo.setAutoFreeze.bind(Vo);Vo.setUseStrictShallowCopy.bind(Vo);Vo.applyPatches.bind(Vo);Vo.createDraft.bind(Vo);Vo.finishDraft.bind(Vo);function Fpe(n,o=`expected a function, instead received ${typeof n}`){if(typeof n!="function")throw new TypeError(o)}function jpe(n,o=`expected an object, instead received ${typeof n}`){if(typeof n!="object")throw new TypeError(o)}function Bpe(n,o="expected all items to be functions, instead received the following types: "){if(!n.every(a=>typeof a=="function")){const a=n.map(d=>typeof d=="function"?`function ${d.name||"unnamed"}()`:typeof d).join(", ");throw new TypeError(`${o}[${a}]`)}}var e5=n=>Array.isArray(n)?n:[n];function Wpe(n){const o=Array.isArray(n[0])?n[0]:n;return Bpe(o,"createSelector expects all input-selectors to be functions, but received the following types: "),o}function Gpe(n,o){const a=[],{length:d}=n;for(let p=0;p<d;p++)a.push(n[p].apply(null,o));return a}var Hpe=class{constructor(n){this.value=n}deref(){return this.value}},Kpe=typeof WeakRef<"u"?WeakRef:Hpe,zpe=0,t5=1;function gS(){return{s:zpe,v:void 0,o:null,p:null}}function uO(n,o={}){let a=gS();const{resultEqualityCheck:d}=o;let p,_=0;function g(){var k;let C=a;const{length:R}=arguments;for(let M=0,Y=R;M<Y;M++){const z=arguments[M];if(typeof z=="function"||typeof z=="object"&&z!==null){let V=C.o;V===null&&(C.o=V=new WeakMap);const Q=V.get(z);Q===void 0?(C=gS(),V.set(z,C)):C=Q}else{let V=C.p;V===null&&(C.p=V=new Map);const Q=V.get(z);Q===void 0?(C=gS(),V.set(z,C)):C=Q}}const D=C;let L;if(C.s===t5)L=C.v;else if(L=n.apply(null,arguments),_++,d){const M=((k=p==null?void 0:p.deref)==null?void 0:k.call(p))??p;M!=null&&d(M,L)&&(L=M,_!==0&&_--),p=typeof L=="object"&&L!==null||typeof L=="function"?new Kpe(L):L}return D.s=t5,D.v=L,L}return g.clearCache=()=>{a=gS(),g.resetResultsCount()},g.resultsCount=()=>_,g.resetResultsCount=()=>{_=0},g}function pG(n,...o){const a=typeof n=="function"?{memoize:n,memoizeOptions:o}:n,d=(...p)=>{let _=0,g=0,C,R={},D=p.pop();typeof D=="object"&&(R=D,D=p.pop()),Fpe(D,`createSelector expects an output function after the inputs, but received: [${typeof D}]`);const L={...a,...R},{memoize:k,memoizeOptions:M=[],argsMemoize:Y=uO,argsMemoizeOptions:z=[],devModeChecks:V={}}=L,Q=e5(M),G=e5(z),B=Wpe(p),q=k(function(){return _++,D.apply(null,arguments)},...Q),se=Y(function(){g++;const $=Gpe(B,arguments);return C=q.apply(null,$),C},...G);return Object.assign(se,{resultFunc:D,memoizedResultFunc:q,dependencies:B,dependencyRecomputations:()=>g,resetDependencyRecomputations:()=>{g=0},lastResult:()=>C,recomputations:()=>_,resetRecomputations:()=>{_=0},memoize:k,argsMemoize:Y})};return Object.assign(d,{withTypes:()=>d}),d}var qpe=pG(uO),Ype=Object.assign((n,o=qpe)=>{jpe(n,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof n}`);const a=Object.keys(n),d=a.map(_=>n[_]);return o(d,(..._)=>_.reduce((g,C,R)=>(g[a[R]]=C,g),{}))},{withTypes:()=>Ype});function fG(n){return({dispatch:a,getState:d})=>p=>_=>typeof _=="function"?_(a,d,n):p(_)}var Jpe=fG(),Xpe=fG,$pe=(...n)=>{const o=pG(...n),a=Object.assign((...d)=>{const p=o(...d),_=(g,...C)=>p(Ml(g)?dG(g):g,...C);return Object.assign(_,p),_},{withTypes:()=>a});return a};$pe(uO);var Qpe=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Ay:Ay.apply(null,arguments)};function rp(n,o){function a(...d){if(o){let p=o(...d);if(!p)throw new Error(ho(0));return{type:n,payload:p.payload,..."meta"in p&&{meta:p.meta},..."error"in p&&{error:p.error}}}return{type:n,payload:d[0]}}return a.toString=()=>`${n}`,a.type=n,a.match=d=>Ope(d)&&d.type===n,a}var mG=class hm extends Array{constructor(...o){super(...o),Object.setPrototypeOf(this,hm.prototype)}static get[Symbol.species](){return hm}concat(...o){return super.concat.apply(this,o)}prepend(...o){return o.length===1&&Array.isArray(o[0])?new hm(...o[0].concat(this)):new hm(...o.concat(this))}};function r5(n){return Tc(n)?hG(n,()=>{}):n}function n5(n,o,a){if(n.has(o)){let p=n.get(o);return a.update&&(p=a.update(p,o,n),n.set(o,p)),p}if(!a.insert)throw new Error(ho(10));const d=a.insert(o,n);return n.set(o,d),d}function Zpe(n){return typeof n=="boolean"}var efe=()=>function(o){const{thunk:a=!0,immutableCheck:d=!0,serializableCheck:p=!0,actionCreatorCheck:_=!0}=o??{};let g=new mG;return a&&(Zpe(a)?g.push(Jpe):g.push(Xpe(a.extraArgument))),g},tfe="RTK_autoBatch",_G=n=>o=>{setTimeout(o,n)},rfe=typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:_G(10),nfe=(n={type:"raf"})=>o=>(...a)=>{const d=o(...a);let p=!0,_=!1,g=!1;const C=new Set,R=n.type==="tick"?queueMicrotask:n.type==="raf"?rfe:n.type==="callback"?n.queueNotification:_G(n.timeout),D=()=>{g=!1,_&&(_=!1,C.forEach(L=>L()))};return Object.assign({},d,{subscribe(L){const k=()=>p&&L(),M=d.subscribe(k);return C.add(L),()=>{M(),C.delete(L)}},dispatch(L){var k;try{return p=!((k=L==null?void 0:L.meta)!=null&&k[tfe]),_=!p,_&&(g||(g=!0,R(D))),d.dispatch(L)}finally{p=!0}}})},ife=n=>function(a){const{autoBatch:d=!0}=a??{};let p=new mG(n);return d&&p.push(nfe(typeof d=="object"?d:void 0)),p},ofe=!0;function sfe(n){const o=efe(),{reducer:a=void 0,middleware:d,devTools:p=!0,preloadedState:_=void 0,enhancers:g=void 0}=n||{};let C;if(typeof a=="function")C=a;else if(cO(a))C=bpe(a);else throw new Error(ho(1));let R;typeof d=="function"?R=d(o):R=o();let D=Ay;p&&(D=Qpe({trace:!ofe,...typeof p=="object"&&p}));const L=Ape(...R),k=ife(L);let M=typeof g=="function"?g(k):k();const Y=D(...M);return iG(C,_,Y)}function EG(n){const o={},a=[];let d;const p={addCase(_,g){const C=typeof _=="string"?_:_.type;if(!C)throw new Error(ho(28));if(C in o)throw new Error(ho(29));return o[C]=g,p},addMatcher(_,g){return a.push({matcher:_,reducer:g}),p},addDefaultCase(_){return d=_,p}};return n(p),[o,a,d]}function afe(n){return typeof n=="function"}function cfe(n,o){let[a,d,p]=EG(o),_;if(afe(n))_=()=>r5(n());else{const C=r5(n);_=()=>C}function g(C=_(),R){let D=[a[R.type],...d.filter(({matcher:L})=>L(R)).map(({reducer:L})=>L)];return D.filter(L=>!!L).length===0&&(D=[p]),D.reduce((L,k)=>{if(k)if(Ml(L)){const Y=k(L,R);return Y===void 0?L:Y}else{if(Tc(L))return hG(L,M=>k(M,R));{const M=k(L,R);if(M===void 0){if(L===null)return L;throw new Error(ho(9))}return M}}return L},C)}return g.getInitialState=_,g}var lfe="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",dfe=(n=21)=>{let o="",a=n;for(;a--;)o+=lfe[Math.random()*64|0];return o},ufe=Symbol.for("rtk-slice-createasyncthunk");function hfe(n,o){return`${n}/${o}`}function pfe({creators:n}={}){var a;const o=(a=n==null?void 0:n.asyncThunk)==null?void 0:a[ufe];return function(p){const{name:_,reducerPath:g=_}=p;if(!_)throw new Error(ho(11));typeof process<"u";const C=(typeof p.reducers=="function"?p.reducers(mfe()):p.reducers)||{},R=Object.keys(C),D={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},L={addCase(q,se){const ue=typeof q=="string"?q:q.type;if(!ue)throw new Error(ho(12));if(ue in D.sliceCaseReducersByType)throw new Error(ho(13));return D.sliceCaseReducersByType[ue]=se,L},addMatcher(q,se){return D.sliceMatchers.push({matcher:q,reducer:se}),L},exposeAction(q,se){return D.actionCreators[q]=se,L},exposeCaseReducer(q,se){return D.sliceCaseReducersByName[q]=se,L}};R.forEach(q=>{const se=C[q],ue={reducerName:q,type:hfe(_,q),createNotation:typeof p.reducers=="function"};Efe(se)?Sfe(ue,se,L,o):_fe(ue,se,L)});function k(){const[q={},se=[],ue=void 0]=typeof p.extraReducers=="function"?EG(p.extraReducers):[p.extraReducers],$={...q,...D.sliceCaseReducersByType};return cfe(p.initialState,pe=>{for(let Oe in $)pe.addCase(Oe,$[Oe]);for(let Oe of D.sliceMatchers)pe.addMatcher(Oe.matcher,Oe.reducer);for(let Oe of se)pe.addMatcher(Oe.matcher,Oe.reducer);ue&&pe.addDefaultCase(ue)})}const M=q=>q,Y=new Map;let z;function V(q,se){return z||(z=k()),z(q,se)}function Q(){return z||(z=k()),z.getInitialState()}function G(q,se=!1){function ue(pe){let Oe=pe[q];return typeof Oe>"u"&&se&&(Oe=Q()),Oe}function $(pe=M){const Oe=n5(Y,se,{insert:()=>new WeakMap});return n5(Oe,pe,{insert:()=>{const xe={};for(const[je,ze]of Object.entries(p.selectors??{}))xe[je]=ffe(ze,pe,Q,se);return xe}})}return{reducerPath:q,getSelectors:$,get selectors(){return $(ue)},selectSlice:ue}}const B={name:_,reducer:V,actions:D.actionCreators,caseReducers:D.sliceCaseReducersByName,getInitialState:Q,...G(g),injectInto(q,{reducerPath:se,...ue}={}){const $=se??g;return q.inject({reducerPath:$,reducer:V},ue),{...B,...G($,!0)}}};return B}}function ffe(n,o,a,d){function p(_,...g){let C=o(_);return typeof C>"u"&&d&&(C=a()),n(C,...g)}return p.unwrapped=n,p}var gG=pfe();function mfe(){function n(o,a){return{_reducerDefinitionType:"asyncThunk",payloadCreator:o,...a}}return n.withTypes=()=>n,{reducer(o){return Object.assign({[o.name](...a){return o(...a)}}[o.name],{_reducerDefinitionType:"reducer"})},preparedReducer(o,a){return{_reducerDefinitionType:"reducerWithPrepare",prepare:o,reducer:a}},asyncThunk:n}}function _fe({type:n,reducerName:o,createNotation:a},d,p){let _,g;if("reducer"in d){if(a&&!gfe(d))throw new Error(ho(17));_=d.reducer,g=d.prepare}else _=d;p.addCase(n,_).exposeCaseReducer(o,_).exposeAction(o,g?rp(n,g):rp(n))}function Efe(n){return n._reducerDefinitionType==="asyncThunk"}function gfe(n){return n._reducerDefinitionType==="reducerWithPrepare"}function Sfe({type:n,reducerName:o},a,d,p){if(!p)throw new Error(ho(18));const{payloadCreator:_,fulfilled:g,pending:C,rejected:R,settled:D,options:L}=a,k=p(n,_,L);d.exposeAction(o,k),g&&d.addCase(k.fulfilled,g),C&&d.addCase(k.pending,C),R&&d.addCase(k.rejected,R),D&&d.addMatcher(k.settled,D),d.exposeCaseReducer(o,{fulfilled:g||SS,pending:C||SS,rejected:R||SS,settled:D||SS})}function SS(){}var yfe=(n,o)=>{if(typeof n!="function")throw new Error(ho(32))},hO="listenerMiddleware",vfe=n=>{let{type:o,actionCreator:a,matcher:d,predicate:p,effect:_}=n;if(o)p=rp(o).match;else if(a)o=a.type,p=a.match;else if(d)p=d;else if(!p)throw new Error(ho(21));return yfe(_),{predicate:p,type:o,effect:_}},Tfe=Object.assign(n=>{const{type:o,predicate:a,effect:d}=vfe(n);return{id:dfe(),effect:d,type:o,predicate:a,pending:new Set,unsubscribe:()=>{throw new Error(ho(22))}}},{withTypes:()=>Tfe}),Cfe=Object.assign(rp(`${hO}/add`),{withTypes:()=>Cfe});rp(`${hO}/removeAll`);var Rfe=Object.assign(rp(`${hO}/remove`),{withTypes:()=>Rfe});function ho(n){return`Minified Redux Toolkit error #${n}; visit https://redux-toolkit.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}const wfe={totalRounds:null,wordChosen:!1,currentlyDrawing:null,totalDrawTime:null,currentRound:null,currentWordLength:null,hints:[],roomOwner:null,isGameStarted:!1,showWaitingScreen:!1,showResults:!1},SG=gG({name:"gameCondition",initialState:wfe,reducers:{setWordChosen:(n,o)=>{n.wordChosen=o.payload},setTotalRounds:(n,o)=>{n.totalRounds=o.payload},setCurrentlyDrawing:(n,o)=>{n.currentlyDrawing=o.payload},setTotalDrawTime:(n,o)=>{n.totalDrawTime=o.payload},setCurrentRound:(n,o)=>{n.currentRound=o.payload},setCurrentWordLength:(n,o)=>{n.currentWordLength=o.payload},addHints:(n,o)=>{n.hints.push(o.payload)},setRoomOwner:(n,o)=>{n.roomOwner=o.payload},setIsGameStarted:(n,o)=>{n.isGameStarted=o.payload},setShowWaitingScreen:(n,o)=>{n.showWaitingScreen=o.payload},setShowResults:(n,o)=>{n.showResults=o.payload},resetGameConditions:(n,o)=>({totalRounds:null,wordChosen:!1,currentlyDrawing:null,totalDrawTime:null,currentRound:null,currentWordLength:null,hints:[]})}}),{setTotalRounds:yG,setWordChosen:Ife,setCurrentRound:bfe,setCurrentlyDrawing:Afe,setCurrentWordLength:Ofe,setTotalDrawTime:Nfe,addHints:Zme,setRoomOwner:kb,resetGameConditions:e_e,setIsGameStarted:vG,setShowWaitingScreen:Dfe,setShowResults:i5}=SG.actions,Pfe=SG.reducer,kfe={id:null,room:null,name:null},TG=gG({name:"user",initialState:kfe,reducers:{addRoom:(n,o)=>{n.room=o.payload},addName:(n,o)=>{n.name=o.payload},addId:(n,o)=>{n.id=o.payload}}}),{addRoom:o5,addName:yS,addId:s5}=TG.actions,Lfe=TG.reducer;var CG={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a5=mc.createContext&&mc.createContext(CG),Mfe=["attr","size","title"];function xfe(n,o){if(n==null)return{};var a=Ufe(n,o),d,p;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(n);for(p=0;p<_.length;p++)d=_[p],!(o.indexOf(d)>=0)&&Object.prototype.propertyIsEnumerable.call(n,d)&&(a[d]=n[d])}return a}function Ufe(n,o){if(n==null)return{};var a={};for(var d in n)if(Object.prototype.hasOwnProperty.call(n,d)){if(o.indexOf(d)>=0)continue;a[d]=n[d]}return a}function Py(){return Py=Object.assign?Object.assign.bind():function(n){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(n[d]=a[d])}return n},Py.apply(this,arguments)}function c5(n,o){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);o&&(d=d.filter(function(p){return Object.getOwnPropertyDescriptor(n,p).enumerable})),a.push.apply(a,d)}return a}function ky(n){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?c5(Object(a),!0).forEach(function(d){Vfe(n,d,a[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):c5(Object(a)).forEach(function(d){Object.defineProperty(n,d,Object.getOwnPropertyDescriptor(a,d))})}return n}function Vfe(n,o,a){return o=Ffe(o),o in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a,n}function Ffe(n){var o=jfe(n,"string");return typeof o=="symbol"?o:o+""}function jfe(n,o){if(typeof n!="object"||!n)return n;var a=n[Symbol.toPrimitive];if(a!==void 0){var d=a.call(n,o||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(n)}function RG(n){return n&&n.map((o,a)=>mc.createElement(o.tag,ky({key:a},o.attr),RG(o.child)))}function wG(n){return o=>mc.createElement(Bfe,Py({attr:ky({},n.attr)},o),RG(n.child))}function Bfe(n){var o=a=>{var{attr:d,size:p,title:_}=n,g=xfe(n,Mfe),C=p||a.size||"1em",R;return a.className&&(R=a.className),n.className&&(R=(R?R+" ":"")+n.className),mc.createElement("svg",Py({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,d,g,{className:R,style:ky(ky({color:n.color||a.color},a.style),n.style),height:C,width:C,xmlns:"http://www.w3.org/2000/svg"}),_&&mc.createElement("title",null,_),n.children)};return a5!==void 0?mc.createElement(a5.Consumer,null,a=>o(a)):o(CG)}function Wfe(n){return wG({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M255.76 44.764c-6.176 0-12.353 1.384-17.137 4.152L85.87 137.276c-9.57 5.536-9.57 14.29 0 19.826l152.753 88.36c9.57 5.536 24.703 5.536 34.272 0l152.753-88.36c9.57-5.535 9.57-14.29 0-19.825l-152.753-88.36c-4.785-2.77-10.96-4.153-17.135-4.153zm-.824 53.11c9.013.097 17.117 2.162 24.31 6.192 4.92 2.758 8.143 5.903 9.666 9.438 1.473 3.507 1.56 8.13.26 13.865l-1.6 5.706c-1.06 4.083-1.28 7.02-.66 8.81.57 1.764 1.983 3.278 4.242 4.544l3.39 1.898-33.235 18.62-3.693-2.067c-4.118-2.306-6.744-4.912-7.883-7.82-1.188-2.935-.99-7.603.594-14.005l1.524-5.748c.887-3.423.973-6.23.26-8.418-.653-2.224-2.134-3.983-4.444-5.277-3.515-1.97-7.726-2.676-12.63-2.123-4.956.526-10.072 2.268-15.35 5.225-4.972 2.785-9.487 6.272-13.55 10.46-4.112 4.162-7.64 8.924-10.587 14.288L171.9 138.21c5.318-5.34 10.543-10.01 15.676-14.013 5.134-4 10.554-7.6 16.262-10.8 14.976-8.39 28.903-13.38 41.78-14.967 3.208-.404 6.315-.59 9.32-.557zm50.757 56.7l26.815 15.024-33.235 18.62-26.816-15.023 33.236-18.62zM75.67 173.84c-5.753-.155-9.664 4.336-9.664 12.28v157.696c0 11.052 7.57 24.163 17.14 29.69l146.93 84.848c9.57 5.526 17.14 1.156 17.14-9.895V290.76c0-11.052-7.57-24.16-17.14-29.688l-146.93-84.847c-2.69-1.555-5.225-2.327-7.476-2.387zm360.773.002c-2.25.06-4.783.83-7.474 2.385l-146.935 84.847c-9.57 5.527-17.14 18.638-17.14 29.69v157.7c0 11.05 7.57 15.418 17.14 9.89L428.97 373.51c9.57-5.527 17.137-18.636 17.137-29.688v-157.7c0-7.942-3.91-12.432-9.664-12.278zm-321.545 63.752c6.553 1.366 12.538 3.038 17.954 5.013 5.415 1.976 10.643 4.417 15.68 7.325 13.213 7.63 23.286 16.324 30.218 26.082 6.932 9.7 10.398 20.046 10.398 31.04 0 5.64-1.055 10.094-3.168 13.364-2.112 3.212-5.714 5.91-10.804 8.094l-5.2 1.92c-3.682 1.442-6.093 2.928-7.23 4.46-1.137 1.472-1.705 3.502-1.705 6.092v3.885l-29.325-16.933v-4.23c0-4.72.892-8.376 2.68-10.97 1.787-2.652 5.552-5.14 11.292-7.467l5.2-2.006c3.087-1.21 5.334-2.732 6.742-4.567 1.46-1.803 2.192-4.028 2.192-6.676 0-4.027-1.3-7.915-3.9-11.66-2.6-3.804-6.227-7.05-10.885-9.74-4.387-2.532-9.126-4.29-14.217-5.272-5.09-1.04-10.398-1.254-15.922-.645v-27.11zm269.54 8.607c1.522 0 2.932.165 4.232.493 6.932 1.696 10.398 8.04 10.398 19.034 0 5.64-1.056 11.314-3.168 17.023-2.112 5.65-5.714 12.507-10.804 20.568l-5.2 7.924c-3.682 5.695-6.093 9.963-7.23 12.807-1.137 2.785-1.705 5.473-1.705 8.063v3.885l-29.325 16.932v-4.23c0-4.72.894-9.41 2.68-14.067 1.79-4.715 5.552-11.55 11.292-20.504l5.2-8.01c3.087-4.776 5.334-8.894 6.742-12.354 1.46-3.492 2.192-6.562 2.192-9.21 0-4.028-1.3-6.414-3.898-7.158-2.6-.8-6.23.142-10.887 2.83-4.387 2.533-9.124 6.25-14.215 11.145-5.09 4.84-10.398 10.752-15.922 17.74v-27.11c6.553-6.2 12.536-11.44 17.95-15.718 5.417-4.278 10.645-7.87 15.68-10.777 10.738-6.2 19.4-9.302 25.99-9.307zm-252.723 94.515l29.326 16.93v30.736l-29.325-16.93v-30.735zm239.246 8.06v30.735l-29.325 16.93v-30.733l29.326-16.932z"},child:[]}]})(n)}const Gfe=()=>{const n=()=>Nhe({length:8,useLetters:!0}),o=Dv(),a=J.useContext(ia);J.useEffect(()=>{var M;if(!a.getConnectionStatus()){const Y=()=>{};return(M=a.socket)==null||M.on("connect",Y),()=>{var z;(z=a.socket)==null||z.off("connect",Y)}}},[a]);const d=MA(),[p,_]=J.useState(""),[g,C]=J.useState(""),R=()=>{_(fI())},D=M=>{C(M.target.value)},L=()=>{const M=n();if(!a){Fd.error("Connection not established");return}if(p==""){const Y=fI();a.emit("create-room",{name:Y,room:M}),o(yS(Y)),o(kb(a.socket.id))}else a.emit("create-room",{name:p,room:M}),o(yS(p)),o(kb(a.socket.id));o(o5(M)),o(s5(a.socket.id)),d("/create-game")},k=()=>{if(g===""){Fd.error("Enter Room Id to join room");return}if(!a){Fd.error("Connection not established");return}if(p==""){const M=fI();a.emit("join-room",{name:M,room:g}),o(yS(M))}else a.emit("join-room",{name:p,room:g}),o(yS(p));o(o5(g)),o(s5(a.socket.id)),d("/create-game/")};return Z.jsx(Po,{className:"homepage",sx:{width:"100vw",height:"100vh"},children:Z.jsxs("div",{className:"user-info",children:[Z.jsxs("div",{className:"name-input-box",children:[Z.jsx("input",{type:"text",placeholder:"Enter your name",className:"name-input",value:p,onChange:M=>{_(M.target.value)}}),Z.jsx("button",{className:"random-name-btn",onClick:R,children:Z.jsx(Wfe,{size:24})})]}),Z.jsx("button",{className:"pvt-room-btn",onClick:L,children:"Create Private Room"}),Z.jsxs("div",{className:"room-input-box",children:[Z.jsx("input",{value:g,type:"text",placeholder:"Enter Room id",className:"room-input",onChange:D}),Z.jsx("button",{className:"room-join-btn",onClick:k,children:"Join!"})]})]})})},IG=({allowChange:n})=>{const o=MA(),a=Dv(),d=fn(M=>M.user.room);fn(M=>M.user.name);const p=J.useContext(ia),[_,g]=J.useState("");J.useEffect(()=>{d===null&&o("/")},[d,o]);const C=M=>{g(M.target.value)},[R,D]=J.useState({Players:2,DrawTime:20,Rounds:1,WordCount:3,Hints:0}),L=M=>{D(Y=>{const{name:z,value:V}=M.target;return{...Y,[z]:V}})},k=()=>{let M=_.split(",");(M.length<10||M.length>100)&&(M=[],M.length!=0&&Fd.error("Custom words not sent as the words do not follow length constraints")),p?(p.emit("set-game-rules",{room:d,userChosenWords:M,gameRules:R}),a(yG(R.Rounds)),a(vG(!0))):(Fd.error("CreateGame:Connection not established."),Fd.error("CreateGame:Please Try again."))};return Z.jsxs("div",{className:`create-game-container ${n?"":"disabled"}`,children:[Z.jsxs("div",{className:"container-item",children:[Z.jsx("label",{htmlFor:"Players",children:"Players:"}),Z.jsxs("select",{id:"Players",name:"Players",className:"selector",onChange:L,disabled:!n,children:[Z.jsx("option",{value:"2",children:"2"}),Z.jsx("option",{value:"3",children:"3"}),Z.jsx("option",{value:"4",children:"4"}),Z.jsx("option",{value:"5",children:"5"}),Z.jsx("option",{value:"6",children:"6"}),Z.jsx("option",{value:"7",children:"7"}),Z.jsx("option",{value:"8",children:"8"}),Z.jsx("option",{value:"9",children:"9"}),Z.jsx("option",{value:"10",children:"10"})]})]}),Z.jsxs("div",{className:"container-item",children:[Z.jsx("label",{htmlFor:"DrawTime",children:"Draw Time:"}),Z.jsxs("select",{id:"DrawTime",name:"DrawTime",className:"selector",onChange:L,disabled:!n,children:[Z.jsx("option",{value:"20",children:"20"}),Z.jsx("option",{value:"40",children:"40"}),Z.jsx("option",{value:"60",children:"60"}),Z.jsx("option",{value:"80",children:"80"}),Z.jsx("option",{value:"100",children:"100"}),Z.jsx("option",{value:"120",children:"120"}),Z.jsx("option",{value:"150",children:"150"}),Z.jsx("option",{value:"180",children:"180"}),Z.jsx("option",{value:"240",children:"240"})]})]}),Z.jsxs("div",{className:"container-item",children:[Z.jsx("label",{htmlFor:"Rounds",children:"Rounds:"}),Z.jsxs("select",{id:"Rounds",name:"Rounds",className:"selector",onChange:L,disabled:!n,children:[Z.jsx("option",{value:"1",children:"1"}),Z.jsx("option",{value:"2",children:"2"}),Z.jsx("option",{value:"3",children:"3"}),Z.jsx("option",{value:"4",children:"4"}),Z.jsx("option",{value:"5",children:"5"}),Z.jsx("option",{value:"6",children:"6"}),Z.jsx("option",{value:"7",children:"7"}),Z.jsx("option",{value:"8",children:"8"}),Z.jsx("option",{value:"9",children:"9"}),Z.jsx("option",{value:"10",children:"10"})]})]}),Z.jsxs("div",{className:"container-item",children:[Z.jsx("label",{htmlFor:"WordCount",children:"Word Count:"}),Z.jsxs("select",{id:"WordCount",name:"WordCount",className:"selector",onChange:L,disabled:!n,children:[Z.jsx("option",{value:"3",children:"3"}),Z.jsx("option",{value:"4",children:"4"}),Z.jsx("option",{value:"5",children:"5"})]})]}),Z.jsxs("div",{className:`custom-words-contaienr ${n?"":"disabled"}`,disabled:!n,children:[Z.jsx("span",{children:"Enter custom words you want to add in the game"}),Z.jsx("textarea",{onChange:C,value:_,className:"custom-words-input",placeholder:"Enter minimum 10 word to maximum 100 words seperated by commas(,)"})]}),Z.jsx("button",{className:`room-join-btn ${n?"":"disabled"}`,onClick:k,disabled:!n,children:"Create Game!"})]})},Hfe=({name:n,id:o,message:a,category:d})=>Z.jsx("div",{className:`chat chat-message ${d}`,children:Z.jsxs("span",{children:[Z.jsx("span",{style:{fontWeight:"bold",maxWidth:"100%"},children:n},o)," ",": ",a]})}),Kfe=()=>{const n=fn(D=>D.user.room),o=fn(D=>D.user.name),a=J.useContext(ia),[d,p]=J.useState([]);J.useEffect(()=>{a!==null&&a.on("recieve-message",D=>{p(L=>[...L,D])})},[a]);const[_,g]=J.useState(""),C=D=>{g(D.target.value)},R=D=>{D.preventDefault(),D.stopPropagation(),a.emit("message",{data:_,room:n,name:o}),g("")};return Z.jsxs("div",{className:"chat-box",children:[Z.jsx("div",{className:"chat-section",children:d.map((D,L)=>Z.jsx(Hfe,{id:L,name:D.name,message:D.message,category:D.category},L))}),Z.jsx("div",{className:"message-section",children:Z.jsx("form",{onSubmit:R,children:Z.jsx("input",{placeholder:"What have you guessed?",className:"input-tag",type:"text",value:_,maxLength:100,onChange:C})})})]})},zfe=({name:n,points:o,guessedCorrectly:a})=>Z.jsxs("div",{className:`user ${a==!0?"correct-guessed":""}`,children:[Z.jsx("span",{children:Z.jsx("span",{style:{fontWeight:"bold",maxWidth:"100%"},children:n})}),Z.jsxs("span",{children:["Points : ",o]})]}),qfe=()=>{const n=fn(p=>p.user.room),[o,a]=J.useState([]),d=J.useContext(ia);return J.useEffect(()=>{d&&(d.emit("get-connected-users",n),d.on("recieve-connected-users",p=>{a(p)}))},[d]),Z.jsx("div",{className:"user-box",children:Z.jsx("div",{className:"user-section",children:o==null?void 0:o.map((p,_)=>Z.jsx(zfe,{name:p.name,points:p.points,guessedCorrectly:p.guessedCorrectAns},_))})})},Yfe=()=>{const n=fn(o=>o.gameCondition.currentlyDrawing);return Z.jsx(Po,{className:"other-choosing-word",children:Z.jsxs(rhe,{sx:{fontSize:"x-large"},children:[n==null?void 0:n.name," is Choosing a Word!"]})})},Jfe=()=>{const[n,o]=J.useState([]),a=J.useContext(ia),d=fn(_=>_.user.room);J.useEffect(()=>{a.emit("give-words",{room:d}),a.on("send-words",_=>{o(_)})},[]);const p=_=>{a?a.emit("send-answer",{word:_.target.textContent,room:d}):toast.error("Retry")};return Z.jsx(Po,{direction:"row",alignItems:"center",justifyContent:"center",gap:2,className:"choosing-word-container",sx:{width:"650px",height:"500px",color:"white",fontSize:"x-large"},children:n.map((_,g)=>Z.jsx("div",{"data-value":_,className:"word-item",onClick:p,children:_},g))})},Xfe=({category:n})=>Z.jsx(Po,{sx:{width:"100%",height:"100%"},alignItems:"center",children:(()=>{switch(n){case"choosing-word":return Z.jsx(Jfe,{});case"drawer-choosing-word":return Z.jsx(Yfe,{});default:return Z.jsx("div",{children:"Waiting"})}})()});function $fe(n){return wG({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"},child:[]}]})(n)}const Qfe=({brushState:n,setBrushState:o,room:a,canvasCtx:d})=>{const p=[2,4,8,12,16],[_,g]=J.useState({width:5,height:5}),C=J.useContext(ia),R=k=>{const M=k.target.getAttribute("data-value");o(Y=>({...Y,strokeStyle:M})),C&&C.emit("update-brush-state",{data:{lineWidth:n.lineWidth,strokeStyle:M},room:a})},D=k=>{const Y=(p.indexOf(n.lineWidth)+1)%p.length;g({width:5*(Y+1),height:5*(Y+1)}),o(z=>({...z,lineWidth:p[Y]})),C&&C.emit("update-brush-state",{data:{lineWidth:p[Y],strokeStyle:n.strokeStyle},room:a})},L=()=>{C.emit("clear-clicked",{room:a}),d.clearRect(0,0,d.canvas.width||1024,d.canvas.height||1024)};return Z.jsxs("div",{className:"color-pallete",children:[Z.jsx("div",{className:"selected-color-box",style:{backgroundColor:`${n.strokeStyle}`}}),Z.jsxs("div",{className:"color-selection-box",children:[Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(255, 255, 255)",style:{backgroundColor:"rgb(255, 255, 255)",borderRadius:"4px 0px 0px 0px"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(193, 193, 193)",style:{backgroundColor:"rgb(193, 193, 193)"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(239, 19, 11)",style:{backgroundColor:"rgb(239, 19, 11)"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(255, 113, 0)",style:{backgroundColor:"rgb(255, 113, 0)"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(255, 228, 0)",style:{backgroundColor:"rgb(255, 228, 0)"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(0, 204, 0)",style:{backgroundColor:"rgb(0, 204, 0)"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(0, 255, 145)",style:{backgroundColor:"rgb(0, 255, 145)"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(0, 178, 255)",style:{backgroundColor:"rgb(0, 178, 255)"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(35, 31, 211)",style:{backgroundColor:"rgb(35, 31, 211)"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(163, 0, 186)",style:{backgroundColor:"rgb(163, 0, 186)"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(223, 105, 167)",style:{backgroundColor:"rgb(223, 105, 167)"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(255, 172, 142)",style:{backgroundColor:"rgb(255, 172, 142)"}}),Z.jsx("div",{onClick:R,className:"grid-item-top","data-value":"rgb(160, 82, 45)",style:{backgroundColor:"rgb(160, 82, 45)",borderRadius:"0px 4px 0px 0px"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(0, 0, 0)",style:{backgroundColor:"rgb(0, 0, 0)",borderRadius:"0px 0px 0px 4px"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(80, 80, 80)",style:{backgroundColor:"rgb(80, 80, 80)"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(116, 11, 7)",style:{backgroundColor:"rgb(116, 11, 7)"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(194, 56, 0)",style:{backgroundColor:"rgb(194, 56, 0)"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(232, 162, 0)",style:{backgroundColor:"rgb(232, 162, 0)"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(0, 70, 25)",style:{backgroundColor:"rgb(0, 70, 25)"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(0, 120, 93)",style:{backgroundColor:"rgb(0, 120, 93)"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(0, 86, 158)",style:{backgroundColor:"rgb(0, 86, 158)"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(14, 8, 101)",style:{backgroundColor:"rgb(14, 8, 101)"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(85, 0, 105)",style:{backgroundColor:"rgb(85, 0, 105)"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(135, 53, 84)",style:{backgroundColor:"rgb(135, 53, 84)"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(204, 119, 77)",style:{backgroundColor:"rgb(204, 119, 77)"}}),Z.jsx("div",{onClick:R,className:"grid-item-bottom","data-value":"rgb(99, 48, 13)",style:{backgroundColor:"rgb(99, 48, 13)",borderRadius:"0px 0px 4px 0px"}})]}),Z.jsx("div",{className:"selected-color-box",onClick:D,children:Z.jsx("div",{style:{backgroundColor:"black",borderRadius:"50%",..._}})}),Z.jsx("div",{className:"delete-drawing-box",children:Z.jsx("button",{onClick:L,className:"delete-drawing-btn",style:{},children:Z.jsx($fe,{size:32})})})]})},Zfe=()=>{var G;const n=fn(B=>B.user.room),o=fn(B=>B.user.id),a=fn(B=>B.gameCondition),d=J.useContext(ia),p=J.useRef(null),_=o===a.currentlyDrawing.id,[g,C]=J.useState(null),[R,D]=J.useState(!1),[L,k]=J.useState({lineWidth:2,strokeStyle:"black"});J.useEffect(()=>{d&&d.on("recieve-updated-brush-state",B=>{k(B)})},[]),J.useEffect(()=>{if(p.current!==null){const B=p.current.getContext("2d");C(B)}},[p.current]),J.useEffect(()=>{g&&(g.lineWidth=L.lineWidth,g.strokeStyle=L.strokeStyle)},[g,L]),J.useEffect(()=>{g&&d&&(d.on("draw-on-screen",({x:B,y:q})=>{Q(B,q)}),d.on("clear",()=>{g.clearRect(0,0,g.canvas.width||1024,g.canvas.height||1024),g.closePath()}),d.on("handle-mouse-down",({x:B,y:q})=>{g.beginPath(),g.moveTo(B,q)}),d.on("handle-mouse-up",()=>{g.closePath()}))},[g,d]);const M=B=>{const q=p.current.getBoundingClientRect();return{clientX:B.clientX-q.left,clientY:B.clientY-q.top}},Y=B=>{if(_&&g){const{clientX:q,clientY:se}=M(B);g.beginPath(),g.moveTo(q,se),D(!0),d.emit("mouse-down",{x:q,y:se,room:n})}},z=B=>{if(R&&_&&g){const{clientX:q,clientY:se}=M(B);g.lineTo(q,se),g.stroke(),d.emit("drawing-data",{x:q,y:se,room:n})}},V=()=>{_&&g&&(g.closePath(),d.emit("mouse-up",{room:n}),D(!1))},Q=(B,q)=>{g.lineTo(B,q),g.stroke()};return Z.jsxs("div",{className:"canvas-container",children:[Z.jsx("canvas",{className:"canvas",onMouseDown:Y,onMouseMove:z,onMouseUp:V,ref:p,width:650,height:550}),((G=a==null?void 0:a.currentlyDrawing)==null?void 0:G.id)!==o?Z.jsx(Z.Fragment,{}):Z.jsx(Z.Fragment,{children:Z.jsx(Qfe,{className:"color-pallete",brushState:L,setBrushState:k,room:n,canvasCtx:g})})]})},eme=()=>{Dv(),J.useContext(ia);const n=fn(_=>_.user.id),o=fn(_=>_.gameCondition.currentlyDrawing),a=fn(_=>_.gameCondition.showWaitingScreen),[d,p]=J.useState("");return J.useEffect(()=>{a&&(!o||o.id!=n?p("drawer-choosing-word"):p("choosing-word"))},[o]),Z.jsx(Po,{children:a?Z.jsx(Xfe,{category:d}):Z.jsx(Zfe,{})})},tme=({children:n})=>{const o=fn(R=>R.user.room),a=fn(R=>R.gameCondition.currentWordLength),d=J.useRef(null),p=J.useRef(null),_=J.useContext(ia),g=fn(R=>R.gameCondition.totalDrawTime),C=fn(R=>R.gameCondition);return J.useEffect(()=>{if(_&&d.current){const R=M=>{p.current&&clearInterval(p.current);let Y=M;d.current.innerHTML=Y,p.current=setInterval(()=>{Y--,d.current.innerHTML=Y,Y<=0&&(clearInterval(p.current),p.current=null)},1e3)},D=()=>{R(g)},L=M=>{R(Math.floor(M))},k=()=>{p.current&&(clearInterval(p.current),p.current=null),d.current.innerHTML=0};return _.on("start-timer",D),_.on("start-timer-late",L),_.on("clear-timeout",k),()=>{p.current&&clearInterval(p.current)}}},[_,g]),Z.jsxs("div",{className:"header",children:[Z.jsxs(Po,{direction:"row",alignItems:"center",gap:2,children:[Z.jsx("div",{ref:d,className:"timer",children:"0"}),Z.jsxs("span",{className:"display-round",children:[Z.jsxs("span",{className:"responsive-round-text",children:["Round "," "]}),C.currentRound," of ",C.totalRounds]})]}),n,Z.jsxs("div",{className:"guess-box",children:[Z.jsx("span",{className:"responsive-guess-text",children:"GUESS THIS"}),Z.jsxs("div",{className:"word-length-guess",children:[Array.from({length:a}).map((R,D)=>Z.jsx("span",{children:"_ "},D)),Z.jsx("sup",{children:a})]})]}),Z.jsxs("div",{style:{fontWeight:"bold"},children:["Room : ",o]})]})},rme=({users:n})=>Z.jsxs("div",{className:"screen",children:[Z.jsx("span",{className:"result-header",children:"Results"}),n.sort((o,a)=>a.points-o.points).map((o,a)=>Z.jsx("div",{className:"individual-result",children:Z.jsxs("span",{className:"r-span",children:[Z.jsxs("span",{children:[o.name," "]}),Z.jsxs("span",{children:[o.points," Points"]})]},a)},a))]});/**
 * @license agora-rtc-react
 * @version 2.2.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */var nme=Object.create,pO=Object.defineProperty,ime=Object.getOwnPropertyDescriptor,ome=Object.getOwnPropertyNames,sme=Object.getPrototypeOf,ame=Object.prototype.hasOwnProperty,cme=(n,o)=>()=>(o||n((o={exports:{}}).exports,o),o.exports),lme=(n,o)=>{for(var a in o)pO(n,a,{get:o[a],enumerable:!0})},bG=(n,o,a,d)=>{if(o&&typeof o=="object"||typeof o=="function")for(let p of ome(o))!ame.call(n,p)&&p!==a&&pO(n,p,{get:()=>o[p],enumerable:!(d=ime(o,p))||d.enumerable});return n},dme=(n,o,a)=>(bG(n,o,"default"),a),$d=(n,o,a)=>(a=n!=null?nme(sme(n)):{},bG(!n||!n.__esModule?pO(a,"default",{value:n,enumerable:!0}):a,n)),Qd=cme((n,o)=>{(function(a,d){typeof n=="object"&&typeof o<"u"?o.exports=d():typeof define=="function"&&define.amd?define(d):(a=typeof globalThis<"u"?globalThis:a||self).AgoraRTC=d()})(n,function(){function a(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(i){if(i!=="default"&&!(i in e)){var s=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return r[i]}})}})}),Object.freeze(e)}var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _=function(e){try{return!!e()}catch{return!0}},g=!_(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),C=g,R=Function.prototype,D=R.call,L=C&&R.bind.bind(D,D),k=C?L:function(e){return function(){return D.apply(e,arguments)}},M=k({}.isPrototypeOf),Y=function(e){return e&&e.Math==Math&&e},z=Y(typeof globalThis=="object"&&globalThis)||Y(typeof window=="object"&&window)||Y(typeof self=="object"&&self)||Y(typeof d=="object"&&d)||function(){return this}()||d||Function("return this")(),V=g,Q=Function.prototype,G=Q.apply,B=Q.call,q=typeof Reflect=="object"&&Reflect.apply||(V?B.bind(G):function(){return B.apply(G,arguments)}),se=k,ue=se({}.toString),$=se("".slice),pe=function(e){return $(ue(e),8,-1)},Oe=pe,xe=k,je=function(e){if(Oe(e)==="Function")return xe(e)},ze=typeof document=="object"&&document.all,St={all:ze,IS_HTMLDDA:ze===void 0&&ze!==void 0},Bt=St.all,st=St.IS_HTMLDDA?function(e){return typeof e=="function"||e===Bt}:function(e){return typeof e=="function"},Jn={},jr=!_(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Br=g,Ve=Function.prototype.call,Ge=Br?Ve.bind(Ve):function(){return Ve.apply(Ve,arguments)},ut={},er={}.propertyIsEnumerable,Or=Object.getOwnPropertyDescriptor,Wo=Or&&!er.call({1:2},1);ut.f=Wo?function(e){var t=Or(this,e);return!!t&&t.enumerable}:er;var Wr,mi,tn=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Rc=_,dp=pe,up=Object,jv=k("".split),tu=Rc(function(){return!up("z").propertyIsEnumerable(0)})?function(e){return dp(e)=="String"?jv(e,""):up(e)}:up,En=function(e){return e==null},wc=En,m_=TypeError,Ic=function(e){if(wc(e))throw m_("Can't call method on "+e);return e},Wa=tu,Bv=Ic,sa=function(e){return Wa(Bv(e))},hp=st,Wv=St.all,_i=St.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:hp(e)||e===Wv}:function(e){return typeof e=="object"?e!==null:hp(e)},fo={},pp=fo,Ga=z,Gl=st,fp=function(e){return Gl(e)?e:void 0},jn=function(e,t){return arguments.length<2?fp(pp[e])||fp(Ga[e]):pp[e]&&pp[e][t]||Ga[e]&&Ga[e][t]},Ei=typeof navigator<"u"&&String(navigator.userAgent)||"",Go=z,ru=Ei,Hl=Go.process,__=Go.Deno,As=Hl&&Hl.versions||__&&__.version,mp=As&&As.v8;mp&&(mi=(Wr=mp.split("."))[0]>0&&Wr[0]<4?1:+(Wr[0]+Wr[1])),!mi&&ru&&(!(Wr=ru.match(/Edge\/(\d+)/))||Wr[1]>=74)&&(Wr=ru.match(/Chrome\/(\d+)/))&&(mi=+Wr[1]);var aa=mi,_p=aa,Gv=_,E_=z.String,Os=!!Object.getOwnPropertySymbols&&!Gv(function(){var e=Symbol();return!E_(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&_p&&_p<41}),Ep=Os&&!Symbol.sham&&typeof Symbol.iterator=="symbol",gp=jn,nu=st,Sp=M,Hv=Object,bc=Ep?function(e){return typeof e=="symbol"}:function(e){var t=gp("Symbol");return nu(t)&&Sp(t.prototype,Hv(e))},Kv=String,Ha=function(e){try{return Kv(e)}catch{return"Object"}},yp=st,iu=Ha,zv=TypeError,zi=function(e){if(yp(e))return e;throw zv(iu(e)+" is not a function")},re=zi,oe=En,he=function(e,t){var r=e[t];return oe(r)?void 0:re(r)},ye=Ge,Fe=st,$e=_i,ht=TypeError,Me={exports:{}},Tt=z,it=Object.defineProperty,ot=function(e,t){try{it(Tt,e,{value:t,configurable:!0,writable:!0})}catch{Tt[e]=t}return t},dr="__core-js_shared__",Yt=z[dr]||ot(dr,{}),fr=Yt;(Me.exports=function(e,t){return fr[e]||(fr[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Gt=Me.exports,Bn=Ic,gn=Object,gi=function(e){return gn(Bn(e))},ca=gi,Ac=k({}.hasOwnProperty),Nr=Object.hasOwn||function(e,t){return Ac(ca(e),t)},Oc=k,Ho=0,ou=Math.random(),su=Oc(1 .toString),Nc=function(e){return"Symbol("+(e===void 0?"":e)+")_"+su(++Ho+ou,36)},Nt=Gt,qr=Nr,ki=Nc,Dr=Os,Ns=Ep,Ka=z.Symbol,vp=Nt("wks"),$G=Ns?Ka.for||Ka:Ka&&Ka.withoutSetter||ki,vr=function(e){return qr(vp,e)||(vp[e]=Dr&&qr(Ka,e)?Ka[e]:$G("Symbol."+e)),vp[e]},QG=Ge,SO=_i,yO=bc,ZG=he,eH=function(e,t){var r,i;if(Fe(r=e.toString)&&!$e(i=ye(r,e))||Fe(r=e.valueOf)&&!$e(i=ye(r,e))||t!=="string")return i;throw ht("Can't convert object to primitive value")},tH=TypeError,rH=vr("toPrimitive"),nH=function(e,t){if(!SO(e)||yO(e))return e;var r,i=ZG(e,rH);if(i){if(r=QG(i,e,t),!SO(r)||yO(r))return r;throw tH("Can't convert object to primitive value")}return eH(e,t)},iH=bc,g_=function(e){var t=nH(e,"string");return iH(t)?t:t+""},vO=_i,qv=z.document,oH=vO(qv)&&vO(qv.createElement),Yv=function(e){return oH?qv.createElement(e):{}},sH=Yv,TO=!jr&&!_(function(){return Object.defineProperty(sH("div"),"a",{get:function(){return 7}}).a!=7}),aH=jr,cH=Ge,lH=ut,dH=tn,uH=sa,hH=g_,pH=Nr,fH=TO,CO=Object.getOwnPropertyDescriptor;Jn.f=aH?CO:function(e,t){if(e=uH(e),t=hH(t),fH)try{return CO(e,t)}catch{}if(pH(e,t))return dH(!cH(lH.f,e,t),e[t])};var mH=_,_H=st,EH=/#|\.prototype\./,Tp=function(e,t){var r=SH[gH(e)];return r==vH||r!=yH&&(_H(t)?mH(t):!!t)},gH=Tp.normalize=function(e){return String(e).replace(EH,".").toLowerCase()},SH=Tp.data={},yH=Tp.NATIVE="N",vH=Tp.POLYFILL="P",RO=Tp,TH=zi,CH=g,RH=je(je.bind),Dc=function(e,t){return TH(e),t===void 0?e:CH?RH(e,t):function(){return e.apply(t,arguments)}},Ko={},wO=jr&&_(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),wH=_i,IH=String,bH=TypeError,Si=function(e){if(wH(e))return e;throw bH(IH(e)+" is not an object")},AH=jr,OH=TO,NH=wO,S_=Si,IO=g_,DH=TypeError,Jv=Object.defineProperty,PH=Object.getOwnPropertyDescriptor,Xv="enumerable",$v="configurable",Qv="writable";Ko.f=AH?NH?function(e,t,r){if(S_(e),t=IO(t),S_(r),typeof e=="function"&&t==="prototype"&&"value"in r&&Qv in r&&!r[Qv]){var i=PH(e,t);i&&i[Qv]&&(e[t]=r.value,r={configurable:$v in r?r[$v]:i[$v],enumerable:Xv in r?r[Xv]:i[Xv],writable:!1})}return Jv(e,t,r)}:Jv:function(e,t,r){if(S_(e),t=IO(t),S_(r),OH)try{return Jv(e,t,r)}catch{}if("get"in r||"set"in r)throw DH("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var kH=Ko,LH=tn,Pc=jr?function(e,t,r){return kH.f(e,t,LH(1,r))}:function(e,t,r){return e[t]=r,e},y_=z,MH=q,xH=je,UH=st,VH=Jn.f,FH=RO,au=fo,jH=Dc,cu=Pc,bO=Nr,BH=function(e){var t=function(r,i,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,i)}return new e(r,i,s)}return MH(e,this,arguments)};return t.prototype=e.prototype,t},Ut=function(e,t){var r,i,s,c,l,u,h,f,m,E=e.target,S=e.global,y=e.stat,A=e.proto,T=S?y_:y?y_[E]:(y_[E]||{}).prototype,w=S?au:au[E]||cu(au,E,{})[E],O=w.prototype;for(c in t)i=!(r=FH(S?c:E+(y?".":"#")+c,e.forced))&&T&&bO(T,c),u=w[c],i&&(h=e.dontCallGetSet?(m=VH(T,c))&&m.value:T[c]),l=i&&h?h:t[c],i&&typeof u==typeof l||(f=e.bind&&i?jH(l,y_):e.wrap&&i?BH(l):A&&UH(l)?xH(l):l,(e.sham||l&&l.sham||u&&u.sham)&&cu(f,"sham",!0),cu(w,c,f),A&&(bO(au,s=E+"Prototype")||cu(au,s,{}),cu(au[s],c,l),e.real&&O&&(r||!O[c])&&cu(O,c,l)))},WH=Math.ceil,GH=Math.floor,HH=Math.trunc||function(e){var t=+e;return(t>0?GH:WH)(t)},KH=HH,Zv=function(e){var t=+e;return t!=t||t===0?0:KH(t)},zH=Zv,qH=Math.max,YH=Math.min,eT=function(e,t){var r=zH(e);return r<0?qH(r+t,0):YH(r,t)},JH=Zv,XH=Math.min,AO=function(e){return e>0?XH(JH(e),9007199254740991):0},$H=AO,za=function(e){return $H(e.length)},QH=sa,ZH=eT,e8=za,OO=function(e){return function(t,r,i){var s,c=QH(t),l=e8(c),u=ZH(i,l);if(e&&r!=r){for(;l>u;)if((s=c[u++])!=s)return!0}else for(;l>u;u++)if((e||u in c)&&c[u]===r)return e||u||0;return!e&&-1}},tT={includes:OO(!0),indexOf:OO(!1)},t8=tT.includes;Ut({target:"Array",proto:!0,forced:_(function(){return!Array(1).includes()})},{includes:function(e){return t8(this,e,arguments.length>1?arguments[1]:void 0)}});var r8=fo,zo=function(e){return r8[e+"Prototype"]},n8=zo("Array").includes,i8=_i,o8=pe,s8=vr("match"),NO=function(e){var t;return i8(e)&&((t=e[s8])!==void 0?!!t:o8(e)=="RegExp")},a8=NO,c8=TypeError,DO={};DO[vr("toStringTag")]="z";var rT=String(DO)==="[object z]",l8=rT,d8=st,v_=pe,u8=vr("toStringTag"),h8=Object,p8=v_(function(){return arguments}())=="Arguments",la=l8?v_:function(e){var t,r,i;return e===void 0?"Undefined":e===null?"Null":typeof(r=function(s,c){try{return s[c]}catch{}}(t=h8(e),u8))=="string"?r:p8?v_(t):(i=v_(t))=="Object"&&d8(t.callee)?"Arguments":i},f8=la,m8=String,mo=function(e){if(f8(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return m8(e)},_8=vr("match"),E8=Ut,g8=function(e){if(a8(e))throw c8("The method doesn't accept regular expressions");return e},S8=Ic,PO=mo,y8=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[_8]=!1,"/./"[e](t)}catch{}}return!1},v8=k("".indexOf);E8({target:"String",proto:!0,forced:!y8("includes")},{includes:function(e){return!!~v8(PO(S8(this)),PO(g8(e)),arguments.length>1?arguments[1]:void 0)}});var T8=zo("String").includes,kO=M,C8=n8,R8=T8,nT=Array.prototype,iT=String.prototype,w8=function(e){var t=e.includes;return e===nT||kO(nT,e)&&t===nT.includes?C8:typeof e=="string"||e===iT||kO(iT,e)&&t===iT.includes?R8:t},ge=p(w8),I8=zi,b8=gi,A8=tu,O8=za,N8=TypeError,LO=function(e){return function(t,r,i,s){I8(r);var c=b8(t),l=A8(c),u=O8(c),h=e?u-1:0,f=e?-1:1;if(i<2)for(;;){if(h in l){s=l[h],h+=f;break}if(h+=f,e?h<0:u<=h)throw N8("Reduce of empty array with no initial value")}for(;e?h>=0:u>h;h+=f)h in l&&(s=r(s,l[h],h,c));return s}},D8={left:LO(!1),right:LO(!0)},P8=_,T_=function(e,t){var r=[][e];return!!r&&P8(function(){r.call(null,t||function(){return 1},1)})},Cp=typeof process<"u"&&pe(process)=="process",k8=D8.left;Ut({target:"Array",proto:!0,forced:!Cp&&aa>79&&aa<83||!T_("reduce")},{reduce:function(e){var t=arguments.length;return k8(this,e,t,t>1?arguments[1]:void 0)}});var L8=zo("Array").reduce,M8=M,x8=L8,oT=Array.prototype,U8=function(e){var t=e.reduce;return e===oT||M8(oT,e)&&t===oT.reduce?x8:t},MO=U8,Ds=p(MO);let xO=!0,UO=!0;function C_(e,t,r){let i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function Kl(e,t,r){if(!e.RTCPeerConnection)return;let i=e.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(l,u){if(l!==t)return s.apply(this,arguments);let h=f=>{let m=r(f);m&&(u.handleEvent?u.handleEvent(m):u(m))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,h),s.apply(this,[l,h])};let c=i.removeEventListener;i.removeEventListener=function(l,u){if(l!==t||!this._eventMap||!this._eventMap[t])return c.apply(this,arguments);if(!this._eventMap[t].has(u))return c.apply(this,arguments);let h=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[l,h])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(l){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),l&&this.addEventListener(t,this["_on"+t]=l)},enumerable:!0,configurable:!0})}function V8(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(xO=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function F8(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(UO=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function VO(){if(typeof window=="object"){if(xO)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function sT(e,t){UO&&console.warn(e+" is deprecated, please use "+t+" instead.")}function FO(e){return Object.prototype.toString.call(e)==="[object Object]"}function jO(e){var t;return FO(e)?Ds(t=Object.keys(e)).call(t,function(r,i){let s=FO(e[i]),c=s?jO(e[i]):e[i],l=s&&!Object.keys(c).length;return c===void 0||l?r:Object.assign(r,{[i]:c})},{}):e}function aT(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?aT(e,e.get(t[i]),r):i.endsWith("Ids")&&t[i].forEach(s=>{aT(e,e.get(s),r)})}))}function BO(e,t,r){let i=r?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;let c=[];return e.forEach(l=>{l.type==="track"&&l.trackIdentifier===t.id&&c.push(l)}),c.forEach(l=>{e.forEach(u=>{u.type===i&&u.trackId===l.id&&aT(e,u,s)})}),s}var j8=Nc,WO=Gt("keys"),R_=function(e){return WO[e]||(WO[e]=j8(e))},B8=!_(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),W8=Nr,G8=st,H8=gi,K8=B8,GO=R_("IE_PROTO"),cT=Object,z8=cT.prototype,lT=K8?cT.getPrototypeOf:function(e){var t=H8(e);if(W8(t,GO))return t[GO];var r=t.constructor;return G8(r)&&t instanceof r?r.prototype:t instanceof cT?z8:null},q8=k,Y8=zi,J8=st,X8=String,$8=TypeError,Q8=function(e,t,r){try{return q8(Y8(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},Z8=Si,eK=function(e){if(typeof e=="object"||J8(e))return e;throw $8("Can't set "+X8(e)+" as a prototype")},tK=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Q8(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(i,s){return Z8(i),eK(s),t?e(i,s):i.__proto__=s,i}}():void 0),w_={},I_={},dT=Nr,rK=sa,nK=tT.indexOf,iK=I_,HO=k([].push),KO=function(e,t){var r,i=rK(e),s=0,c=[];for(r in i)!dT(iK,r)&&dT(i,r)&&HO(c,r);for(;t.length>s;)dT(i,r=t[s++])&&(~nK(c,r)||HO(c,r));return c},uT=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],oK=KO,sK=uT.concat("length","prototype");w_.f=Object.getOwnPropertyNames||function(e){return oK(e,sK)};var Rp={};Rp.f=Object.getOwnPropertySymbols;var aK=jn,cK=w_,lK=Rp,dK=Si,uK=k([].concat),hK=aK("Reflect","ownKeys")||function(e){var t=cK.f(dK(e)),r=lK.f;return r?uK(t,r(e)):t},zO=Nr,pK=hK,fK=Jn,mK=Ko,hT={},_K=KO,EK=uT,b_=Object.keys||function(e){return _K(e,EK)},gK=jr,SK=wO,yK=Ko,vK=Si,TK=sa,CK=b_;hT.f=gK&&!SK?Object.defineProperties:function(e,t){vK(e);for(var r,i=TK(t),s=CK(t),c=s.length,l=0;c>l;)yK.f(e,r=s[l++],i[r]);return e};var A_,qO=jn("document","documentElement"),RK=Si,wK=hT,YO=uT,IK=I_,bK=qO,AK=Yv,pT="prototype",fT="script",JO=R_("IE_PROTO"),mT=function(){},XO=function(e){return"<"+fT+">"+e+"</"+fT+">"},$O=function(e){e.write(XO("")),e.close();var t=e.parentWindow.Object;return e=null,t},O_=function(){try{A_=new ActiveXObject("htmlfile")}catch{}var e,t,r;O_=typeof document<"u"?document.domain&&A_?$O(A_):(t=AK("iframe"),r="java"+fT+":",t.style.display="none",bK.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(XO("document.F=Object")),e.close(),e.F):$O(A_);for(var i=YO.length;i--;)delete O_[pT][YO[i]];return O_()};IK[JO]=!0;var wp=Object.create||function(e,t){var r;return e!==null?(mT[pT]=RK(e),r=new mT,mT[pT]=null,r[JO]=e):r=O_(),t===void 0?r:wK.f(r,t)},OK=_i,NK=Pc,QO=Error,DK=k("".replace),PK=String(QO("zxcasd").stack),ZO=/\n\s*at [^:]*:[^\n]*/,kK=ZO.test(PK),LK=tn,MK=!_(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",LK(1,7)),e.stack!==7)}),xK=Pc,UK=function(e,t){if(kK&&typeof e=="string"&&!QO.prepareStackTrace)for(;t--;)e=DK(e,ZO,"");return e},VK=MK,eN=Error.captureStackTrace,zl={},FK=zl,jK=vr("iterator"),BK=Array.prototype,tN=function(e){return e!==void 0&&(FK.Array===e||BK[jK]===e)},WK=la,rN=he,GK=En,HK=zl,KK=vr("iterator"),N_=function(e){if(!GK(e))return rN(e,KK)||rN(e,"@@iterator")||HK[WK(e)]},zK=Ge,qK=zi,YK=Si,JK=Ha,XK=N_,$K=TypeError,_T=function(e,t){var r=arguments.length<2?XK(e):t;if(qK(r))return YK(zK(r,e));throw $K(JK(e)+" is not iterable")},QK=Ge,nN=Si,ZK=he,iN=function(e,t,r){var i,s;nN(e);try{if(!(i=ZK(e,"return"))){if(t==="throw")throw r;return r}i=QK(i,e)}catch(c){s=!0,i=c}if(t==="throw")throw r;if(s)throw i;return nN(i),r},ez=Dc,tz=Ge,rz=Si,nz=Ha,iz=tN,oz=za,oN=M,sz=_T,az=N_,sN=iN,cz=TypeError,D_=function(e,t){this.stopped=e,this.result=t},aN=D_.prototype,Ip=function(e,t,r){var i,s,c,l,u,h,f,m=r&&r.that,E=!(!r||!r.AS_ENTRIES),S=!(!r||!r.IS_RECORD),y=!(!r||!r.IS_ITERATOR),A=!(!r||!r.INTERRUPTED),T=ez(t,m),w=function(P){return i&&sN(i,"normal",P),new D_(!0,P)},O=function(P){return E?(rz(P),A?T(P[0],P[1],w):T(P[0],P[1])):A?T(P,w):T(P)};if(S)i=e.iterator;else if(y)i=e;else{if(!(s=az(e)))throw cz(nz(e)+" is not iterable");if(iz(s)){for(c=0,l=oz(e);l>c;c++)if((u=O(e[c]))&&oN(aN,u))return u;return new D_(!1)}i=sz(e,s)}for(h=S?e.next:i.next;!(f=tz(h,i)).done;){try{u=O(f.value)}catch(P){sN(i,"throw",P)}if(typeof u=="object"&&u&&oN(aN,u))return u}return new D_(!1)},lz=mo,dz=Ut,uz=M,hz=lT,P_=tK,pz=function(e,t,r){for(var i=pK(t),s=mK.f,c=fK.f,l=0;l<i.length;l++){var u=i[l];zO(e,u)||r&&zO(r,u)||s(e,u,c(t,u))}},cN=wp,ET=Pc,gT=tn,fz=function(e,t){OK(t)&&"cause"in t&&NK(e,"cause",t.cause)},mz=function(e,t,r,i){VK&&(eN?eN(e,t):xK(e,"stack",UK(r,i)))},_z=Ip,Ez=function(e,t){return e===void 0?arguments.length<2?"":t:lz(e)},gz=vr("toStringTag"),k_=Error,Sz=[].push,lu=function(e,t){var r,i=uz(ST,this);P_?r=P_(k_(),i?hz(this):ST):(r=i?this:cN(ST),ET(r,gz,"Error")),t!==void 0&&ET(r,"message",Ez(t)),mz(r,lu,r.stack,1),arguments.length>2&&fz(r,arguments[2]);var s=[];return _z(e,Sz,{that:s}),ET(r,"errors",s),r};P_?P_(lu,k_):pz(lu,k_,{name:!0});var ST=lu.prototype=cN(k_.prototype,{constructor:gT(1,lu),message:gT(1,""),name:gT(1,"AggregateError")});dz({global:!0,constructor:!0,arity:2},{AggregateError:lu});var L_,bp,M_,yz=st,lN=z.WeakMap,vz=yz(lN)&&/native code/.test(String(lN)),dN=z,Tz=_i,Cz=Pc,yT=Nr,vT=Yt,Rz=R_,wz=I_,uN="Object already initialized",TT=dN.TypeError,Iz=dN.WeakMap;if(vz||vT.state){var da=vT.state||(vT.state=new Iz);da.get=da.get,da.has=da.has,da.set=da.set,L_=function(e,t){if(da.has(e))throw TT(uN);return t.facade=e,da.set(e,t),t},bp=function(e){return da.get(e)||{}},M_=function(e){return da.has(e)}}else{var du=Rz("state");wz[du]=!0,L_=function(e,t){if(yT(e,du))throw TT(uN);return t.facade=e,Cz(e,du,t),t},bp=function(e){return yT(e,du)?e[du]:{}},M_=function(e){return yT(e,du)}}var ql,hN,pN,Yl={set:L_,get:bp,has:M_,enforce:function(e){return M_(e)?bp(e):L_(e,{})},getterFor:function(e){return function(t){var r;if(!Tz(t)||(r=bp(t)).type!==e)throw TT("Incompatible receiver, "+e+" required");return r}}},CT=jr,bz=Nr,fN=Function.prototype,Az=CT&&Object.getOwnPropertyDescriptor,RT=bz(fN,"name"),mN={EXISTS:RT,PROPER:RT&&(function(){}).name==="something",CONFIGURABLE:RT&&(!CT||CT&&Az(fN,"name").configurable)},Oz=Pc,kc=function(e,t,r,i){return i&&i.enumerable?e[t]=r:Oz(e,t,r),e},Nz=_,Dz=st,Pz=_i,kz=wp,_N=lT,Lz=kc,wT=vr("iterator"),EN=!1;[].keys&&("next"in(pN=[].keys())?(hN=_N(_N(pN)))!==Object.prototype&&(ql=hN):EN=!0);var Mz=!Pz(ql)||Nz(function(){var e={};return ql[wT].call(e)!==e});Dz((ql=Mz?{}:kz(ql))[wT])||Lz(ql,wT,function(){return this});var gN={IteratorPrototype:ql,BUGGY_SAFARI_ITERATORS:EN},xz=la,Uz=rT?{}.toString:function(){return"[object "+xz(this)+"]"},Vz=rT,Fz=Ko.f,jz=Pc,Bz=Nr,Wz=Uz,SN=vr("toStringTag"),Lc=function(e,t,r,i){if(e){var s=r?e:e.prototype;Bz(s,SN)||Fz(s,SN,{configurable:!0,value:t}),i&&!Vz&&jz(s,"toString",Wz)}},Gz=gN.IteratorPrototype,Hz=wp,Kz=tn,zz=Lc,qz=zl,Yz=function(){return this},IT=function(e,t,r,i){var s=t+" Iterator";return e.prototype=Hz(Gz,{next:Kz(+!i,r)}),zz(e,s,!1,!0),qz[s]=Yz,e},Jz=Ut,Xz=Ge,$z=mN,Qz=IT,Zz=lT,e7=Lc,yN=kc,vN=zl,t7=gN,r7=$z.PROPER,x_=t7.BUGGY_SAFARI_ITERATORS,bT=vr("iterator"),TN="keys",U_="values",CN="entries",n7=function(){return this},RN=function(e,t,r,i,s,c,l){Qz(r,t,i);var u,h,f,m=function(O){if(O===s&&T)return T;if(!x_&&O in y)return y[O];switch(O){case TN:case U_:case CN:return function(){return new r(this,O)}}return function(){return new r(this)}},E=t+" Iterator",S=!1,y=e.prototype,A=y[bT]||y["@@iterator"]||s&&y[s],T=!x_&&A||m(s),w=t=="Array"&&y.entries||A;if(w&&(u=Zz(w.call(new e)))!==Object.prototype&&u.next&&(e7(u,E,!0,!0),vN[E]=n7),r7&&s==U_&&A&&A.name!==U_&&(S=!0,T=function(){return Xz(A,this)}),s)if(h={values:m(U_),keys:c?T:m(TN),entries:m(CN)},l)for(f in h)(x_||S||!(f in y))&&yN(y,f,h[f]);else Jz({target:t,proto:!0,forced:x_||S},h);return l&&y[bT]!==T&&yN(y,bT,T,{name:s}),vN[t]=T,h},AT=function(e,t){return{value:e,done:t}},i7=sa,wN=zl,IN=Yl;Ko.f;var o7=RN,bN=AT,AN="Array Iterator",s7=IN.set,a7=IN.getterFor(AN);o7(Array,"Array",function(e,t){s7(this,{type:AN,target:i7(e),index:0,kind:t})},function(){var e=a7(this),t=e.target,r=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,bN(void 0,!0)):bN(r=="keys"?i:r=="values"?t[i]:[i,t[i]],!1)},"values"),wN.Arguments=wN.Array;var c7=Ko,V_=function(e,t,r){return c7.f(e,t,r)},l7=jn,d7=V_,u7=jr,ON=vr("species"),h7=M,p7=TypeError,OT=function(e,t){if(h7(t,e))return e;throw p7("Incorrect invocation")},f7=st,NT=Yt,m7=k(Function.toString);f7(NT.inspectSource)||(NT.inspectSource=function(e){return m7(e)});var NN=NT.inspectSource,_7=k,E7=_,DN=st,g7=la,S7=NN,PN=function(){},y7=[],kN=jn("Reflect","construct"),DT=/^\s*(?:class|function)\b/,v7=_7(DT.exec),T7=!DT.exec(PN),Ap=function(e){if(!DN(e))return!1;try{return kN(PN,y7,e),!0}catch{return!1}},LN=function(e){if(!DN(e))return!1;switch(g7(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return T7||!!v7(DT,S7(e))}catch{return!0}};LN.sham=!0;var Op,uu,MN,PT,F_=!kN||E7(function(){var e;return Ap(Ap.call)||!Ap(Object)||!Ap(function(){e=!0})||e})?LN:Ap,C7=F_,R7=Ha,w7=TypeError,xN=Si,I7=function(e){if(C7(e))return e;throw w7(R7(e)+" is not a constructor")},b7=En,A7=vr("species"),kT=function(e,t){var r,i=xN(e).constructor;return i===void 0||b7(r=xN(i)[A7])?t:I7(r)},LT=k([].slice),O7=TypeError,j_=function(e,t){if(e<t)throw O7("Not enough arguments");return e},UN=/(?:ipad|iphone|ipod).*applewebkit/i.test(Ei),_o=z,N7=q,D7=Dc,VN=st,P7=Nr,FN=_,jN=qO,k7=LT,BN=Yv,L7=j_,M7=UN,x7=Cp,MT=_o.setImmediate,xT=_o.clearImmediate,U7=_o.process,UT=_o.Dispatch,V7=_o.Function,WN=_o.MessageChannel,F7=_o.String,VT=0,Np={},GN="onreadystatechange";FN(function(){Op=_o.location});var FT=function(e){if(P7(Np,e)){var t=Np[e];delete Np[e],t()}},jT=function(e){return function(){FT(e)}},HN=function(e){FT(e.data)},KN=function(e){_o.postMessage(F7(e),Op.protocol+"//"+Op.host)};MT&&xT||(MT=function(e){L7(arguments.length,1);var t=VN(e)?e:V7(e),r=k7(arguments,1);return Np[++VT]=function(){N7(t,void 0,r)},uu(VT),VT},xT=function(e){delete Np[e]},x7?uu=function(e){U7.nextTick(jT(e))}:UT&&UT.now?uu=function(e){UT.now(jT(e))}:WN&&!M7?(PT=(MN=new WN).port2,MN.port1.onmessage=HN,uu=D7(PT.postMessage,PT)):_o.addEventListener&&VN(_o.postMessage)&&!_o.importScripts&&Op&&Op.protocol!=="file:"&&!FN(KN)?(uu=KN,_o.addEventListener("message",HN,!1)):uu=GN in BN("script")?function(e){jN.appendChild(BN("script"))[GN]=function(){jN.removeChild(this),FT(e)}}:function(e){setTimeout(jT(e),0)});var zN={set:MT,clear:xT},qN=function(){this.head=null,this.tail=null};qN.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var hu,BT,WT,GT,YN,JN=qN,j7=/ipad|iphone|ipod/i.test(Ei)&&typeof Pebble<"u",B7=/web0s(?!.*chrome)/i.test(Ei),Jl=z,XN=Dc,W7=Jn.f,HT=zN.set,G7=JN,H7=UN,K7=j7,z7=B7,KT=Cp,$N=Jl.MutationObserver||Jl.WebKitMutationObserver,QN=Jl.document,ZN=Jl.process,B_=Jl.Promise,eD=W7(Jl,"queueMicrotask"),zT=eD&&eD.value;if(!zT){var W_=new G7,G_=function(){var e,t;for(KT&&(e=ZN.domain)&&e.exit();t=W_.get();)try{t()}catch(r){throw W_.head&&hu(),r}e&&e.enter()};H7||KT||z7||!$N||!QN?!K7&&B_&&B_.resolve?((GT=B_.resolve(void 0)).constructor=B_,YN=XN(GT.then,GT),hu=function(){YN(G_)}):KT?hu=function(){ZN.nextTick(G_)}:(HT=XN(HT,Jl),hu=function(){HT(G_)}):(BT=!0,WT=QN.createTextNode(""),new $N(G_).observe(WT,{characterData:!0}),hu=function(){WT.data=BT=!BT}),zT=function(e){W_.head||hu(),W_.add(e)}}var q7=zT,pu=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Xl=z.Promise,tD=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Y7=!tD&&!Cp&&typeof window=="object"&&typeof document=="object",J7=z,Dp=Xl,X7=st,$7=RO,Q7=NN,Z7=vr,e9=Y7,t9=tD,qT=aa,rD=Dp&&Dp.prototype,r9=Z7("species"),nD=!1,iD=X7(J7.PromiseRejectionEvent),n9=$7("Promise",function(){var e=Q7(Dp),t=e!==String(Dp);if(!t&&qT===66||!rD.catch||!rD.finally)return!0;if(!qT||qT<51||!/native code/.test(e)){var r=new Dp(function(s){s(1)}),i=function(s){s(function(){},function(){})};if((r.constructor={})[r9]=i,!(nD=r.then(function(){})instanceof i))return!0}return!t&&(e9||t9)&&!iD}),Pp={CONSTRUCTOR:n9,REJECTION_EVENT:iD,SUBCLASSING:nD},ua={},oD=zi,i9=TypeError,o9=function(e){var t,r;this.promise=new e(function(i,s){if(t!==void 0||r!==void 0)throw i9("Bad Promise constructor");t=i,r=s}),this.resolve=oD(t),this.reject=oD(r)};ua.f=function(e){return new o9(e)};var YT,sD,s9=Ut,H_=Cp,Mc=z,kp=Ge,a9=kc,c9=Lc,l9=function(e){var t=l7(e);u7&&t&&!t[ON]&&d7(t,ON,{configurable:!0,get:function(){return this}})},d9=zi,JT=st,u9=_i,h9=OT,p9=kT,aD=zN.set,XT=q7,f9=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},m9=pu,_9=JN,cD=Yl,$T=Xl,lD=Pp,dD=ua,K_="Promise",uD=lD.CONSTRUCTOR,E9=lD.REJECTION_EVENT,QT=cD.getterFor(K_),g9=cD.set,S9=$T&&$T.prototype,Lp=$T,ZT=S9,hD=Mc.TypeError,eC=Mc.document,tC=Mc.process,rC=dD.f,y9=rC,v9=!!(eC&&eC.createEvent&&Mc.dispatchEvent),pD="unhandledrejection",fD=function(e){var t;return!(!u9(e)||!JT(t=e.then))&&t},mD=function(e,t){var r,i,s,c=t.value,l=t.state==1,u=l?e.ok:e.fail,h=e.resolve,f=e.reject,m=e.domain;try{u?(l||(t.rejection===2&&C9(t),t.rejection=1),u===!0?r=c:(m&&m.enter(),r=u(c),m&&(m.exit(),s=!0)),r===e.promise?f(hD("Promise-chain cycle")):(i=fD(r))?kp(i,r,h,f):h(r)):f(c)}catch(E){m&&!s&&m.exit(),f(E)}},_D=function(e,t){e.notified||(e.notified=!0,XT(function(){for(var r,i=e.reactions;r=i.get();)mD(r,e);e.notified=!1,t&&!e.rejection&&T9(e)}))},ED=function(e,t,r){var i,s;v9?((i=eC.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),Mc.dispatchEvent(i)):i={promise:t,reason:r},!E9&&(s=Mc["on"+e])?s(i):e===pD&&f9("Unhandled promise rejection",r)},T9=function(e){kp(aD,Mc,function(){var t,r=e.facade,i=e.value;if(gD(e)&&(t=m9(function(){H_?tC.emit("unhandledRejection",i,r):ED(pD,r,i)}),e.rejection=H_||gD(e)?2:1,t.error))throw t.value})},gD=function(e){return e.rejection!==1&&!e.parent},C9=function(e){kp(aD,Mc,function(){var t=e.facade;H_?tC.emit("rejectionHandled",t):ED("rejectionhandled",t,e.value)})},fu=function(e,t,r){return function(i){e(t,i,r)}},mu=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,_D(e,!0))},nC=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw hD("Promise can't be resolved itself");var i=fD(t);i?XT(function(){var s={done:!1};try{kp(i,t,fu(nC,s,e),fu(mu,s,e))}catch(c){mu(s,c,e)}}):(e.value=t,e.state=1,_D(e,!1))}catch(s){mu({done:!1},s,e)}}};uD&&(ZT=(Lp=function(e){h9(this,ZT),d9(e),kp(YT,this);var t=QT(this);try{e(fu(nC,t),fu(mu,t))}catch(r){mu(t,r)}}).prototype,(YT=function(e){g9(this,{type:K_,done:!1,notified:!1,parent:!1,reactions:new _9,rejection:!1,state:0,value:void 0})}).prototype=a9(ZT,"then",function(e,t){var r=QT(this),i=rC(p9(this,Lp));return r.parent=!0,i.ok=!JT(e)||e,i.fail=JT(t)&&t,i.domain=H_?tC.domain:void 0,r.state==0?r.reactions.add(i):XT(function(){mD(i,r)}),i.promise}),sD=function(){var e=new YT,t=QT(e);this.promise=e,this.resolve=fu(nC,t),this.reject=fu(mu,t)},dD.f=rC=function(e){return e===Lp||e===void 0?new sD(e):y9(e)}),s9({global:!0,constructor:!0,wrap:!0,forced:uD},{Promise:Lp}),c9(Lp,K_,!1,!0),l9(K_);var SD=vr("iterator"),yD=!1;try{var R9=0,vD={next:function(){return{done:!!R9++}},return:function(){yD=!0}};vD[SD]=function(){return this},Array.from(vD,function(){throw 2})}catch{}var w9=Xl,I9=function(e,t){if(!yD)return!1;var r=!1;try{var i={};i[SD]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch{}return r},z_=Pp.CONSTRUCTOR||!I9(function(e){w9.all(e).then(void 0,function(){})}),b9=Ge,A9=zi,O9=ua,N9=pu,D9=Ip;Ut({target:"Promise",stat:!0,forced:z_},{all:function(e){var t=this,r=O9.f(t),i=r.resolve,s=r.reject,c=N9(function(){var l=A9(t.resolve),u=[],h=0,f=1;D9(e,function(m){var E=h++,S=!1;f++,b9(l,t,m).then(function(y){S||(S=!0,u[E]=y,--f||i(u))},s)}),--f||i(u)});return c.error&&s(c.value),r.promise}});var P9=Ut,k9=Pp.CONSTRUCTOR;Xl&&Xl.prototype,P9({target:"Promise",proto:!0,forced:k9,real:!0},{catch:function(e){return this.then(void 0,e)}});var L9=Ge,M9=zi,x9=ua,U9=pu,V9=Ip;Ut({target:"Promise",stat:!0,forced:z_},{race:function(e){var t=this,r=x9.f(t),i=r.reject,s=U9(function(){var c=M9(t.resolve);V9(e,function(l){L9(c,t,l).then(r.resolve,i)})});return s.error&&i(s.value),r.promise}});var F9=Ge,j9=ua;Ut({target:"Promise",stat:!0,forced:Pp.CONSTRUCTOR},{reject:function(e){var t=j9.f(this);return F9(t.reject,void 0,e),t.promise}});var B9=Si,W9=_i,G9=ua,TD=function(e,t){if(B9(e),W9(t)&&t.constructor===e)return t;var r=G9.f(e);return(0,r.resolve)(t),r.promise},H9=Ut,K9=Xl,z9=Pp.CONSTRUCTOR,q9=TD,Y9=jn("Promise"),J9=!z9;H9({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return q9(J9&&this===Y9?K9:this,e)}});var X9=Ge,$9=zi,Q9=ua,Z9=pu,eq=Ip;Ut({target:"Promise",stat:!0,forced:z_},{allSettled:function(e){var t=this,r=Q9.f(t),i=r.resolve,s=r.reject,c=Z9(function(){var l=$9(t.resolve),u=[],h=0,f=1;eq(e,function(m){var E=h++,S=!1;f++,X9(l,t,m).then(function(y){S||(S=!0,u[E]={status:"fulfilled",value:y},--f||i(u))},function(y){S||(S=!0,u[E]={status:"rejected",reason:y},--f||i(u))})}),--f||i(u)});return c.error&&s(c.value),r.promise}});var tq=Ge,rq=zi,nq=jn,iq=ua,oq=pu,sq=Ip,CD="No one promise resolved";Ut({target:"Promise",stat:!0,forced:z_},{any:function(e){var t=this,r=nq("AggregateError"),i=iq.f(t),s=i.resolve,c=i.reject,l=oq(function(){var u=rq(t.resolve),h=[],f=0,m=1,E=!1;sq(e,function(S){var y=f++,A=!1;m++,tq(u,t,S).then(function(T){A||E||(E=!0,s(T))},function(T){A||E||(A=!0,h[y]=T,--m||c(new r(h,CD)))})}),--m||c(new r(h,CD))});return l.error&&c(l.value),i.promise}});var aq=Ut,iC=Xl,cq=_,lq=jn,dq=st,uq=kT,RD=TD,hq=iC&&iC.prototype;aq({target:"Promise",proto:!0,real:!0,forced:!!iC&&cq(function(){hq.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=uq(this,lq("Promise")),r=dq(e);return this.then(r?function(i){return RD(t,e()).then(function(){return i})}:e,r?function(i){return RD(t,e()).then(function(){throw i})}:e)}});var oC=k,pq=Zv,fq=mo,mq=Ic,_q=oC("".charAt),wD=oC("".charCodeAt),Eq=oC("".slice),ID=function(e){return function(t,r){var i,s,c=fq(mq(t)),l=pq(r),u=c.length;return l<0||l>=u?e?"":void 0:(i=wD(c,l))<55296||i>56319||l+1===u||(s=wD(c,l+1))<56320||s>57343?e?_q(c,l):i:e?Eq(c,l,l+2):s-56320+(i-55296<<10)+65536}},sC={codeAt:ID(!1),charAt:ID(!0)},gq=sC.charAt,Sq=mo,bD=Yl,yq=RN,AD=AT,OD="String Iterator",vq=bD.set,Tq=bD.getterFor(OD);yq(String,"String",function(e){vq(this,{type:OD,string:Sq(e),index:0})},function(){var e,t=Tq(this),r=t.string,i=t.index;return i>=r.length?AD(void 0,!0):(e=gq(r,i),t.index+=e.length,AD(e,!1))});var Cq=fo.Promise,Rq={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},wq=z,Iq=la,bq=Pc,ND=zl,DD=vr("toStringTag");for(var aC in Rq){var PD=wq[aC],cC=PD&&PD.prototype;cC&&Iq(cC)!==DD&&bq(cC,DD,aC),ND[aC]=ND.Array}var kD=Cq,_e=p(kD);let LD=VO;function MD(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let i=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;let u={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;let f=typeof l[h]=="object"?l[h]:{ideal:l[h]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);let m=function(E,S){return E?E+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(f.ideal!==void 0){u.optional=u.optional||[];let E={};typeof f.ideal=="number"?(E[m("min",h)]=f.ideal,u.optional.push(E),E={},E[m("max",h)]=f.ideal,u.optional.push(E)):(E[m("",h)]=f.ideal,u.optional.push(E))}f.exact!==void 0&&typeof f.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[m("",h)]=f.exact):["min","max"].forEach(E=>{f[E]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[m(E,h)]=f[E])})}),l.advanced&&(u.optional=(u.optional||[]).concat(l.advanced)),u},s=function(l,u){if(t.version>=61)return u(l);if((l=JSON.parse(JSON.stringify(l)))&&typeof l.audio=="object"){let h=function(f,m,E){m in f&&!(E in f)&&(f[E]=f[m],delete f[m])};h((l=JSON.parse(JSON.stringify(l))).audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=i(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});let f=t.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||f)){let m;if(delete l.video.facingMode,h.exact==="environment"||h.ideal==="environment"?m=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(m=["front"]),m)return r.mediaDevices.enumerateDevices().then(E=>{let S=(E=E.filter(y=>y.kind==="videoinput")).find(y=>m.some(A=>{var T;return ge(T=y.label.toLowerCase()).call(T,A)}));return!S&&E.length&&ge(m).call(m,"back")&&(S=E[E.length-1]),S&&(l.video.deviceId=h.exact?{exact:S.deviceId}:{ideal:S.deviceId}),l.video=i(l.video),LD("chrome: "+JSON.stringify(l)),u(l)})}l.video=i(l.video)}return LD("chrome: "+JSON.stringify(l)),u(l)},c=function(l){return t.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(l,u,h){s(l,f=>{r.webkitGetUserMedia(f,u,m=>{h&&h(c(m))})})}).bind(r),r.mediaDevices.getUserMedia){let l=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(u){return s(u,h=>l(h).then(f=>{if(h.audio&&!f.getAudioTracks().length||h.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return f},f=>_e.reject(c(f))))}}}function xD(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function UD(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===i.track.id):{track:i.track};let c=new Event("track");c.track=i.track,c.receiver=s,c.transceiver={receiver:s},c.streams=[r.stream],this.dispatchEvent(c)}),r.stream.getTracks().forEach(i=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===i.id):{track:i};let c=new Event("track");c.track=i,c.receiver=s,c.transceiver={receiver:s},c.streams=[r.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Kl(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function VD(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(s,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=s.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,u){let h=s.apply(this,arguments);return h||(h=t(this,l),this._senders.push(h)),h};let c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){c.apply(this,arguments);let u=this._senders.indexOf(l);u!==-1&&this._senders.splice(u,1)}}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(c=>{this._senders.push(t(this,c))})};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(c=>{let l=this._senders.find(u=>u.track===c);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function FD(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[r,i,s]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);let c=function(u){let h={};return u.result().forEach(f=>{let m={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(E=>{m[E]=f.stat(E)}),h[m.id]=m}),h},l=function(u){return new Map(Object.keys(u).map(h=>[h,u[h]]))};if(arguments.length>=2){let u=function(h){i(l(c(h)))};return t.apply(this,[u,r])}return new _e((u,h)=>{t.apply(this,[function(f){u(l(c(f)))},h])}).then(i,s)}}function jD(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){let s=r.apply(this,[]);return s.forEach(c=>c._pc=this),s});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let s=i.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){let s=this;return this._pc.getStats().then(c=>BO(c,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){let i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Kl(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){let i=this;return this._pc.getStats().then(s=>BO(s,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let r=arguments[0],i,s,c;return this.getSenders().forEach(l=>{l.track===r&&(i?c=!0:i=l)}),this.getReceivers().forEach(l=>(l.track===r&&(s?c=!0:s=l),l.track===r)),c||i&&s?_e.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():_e.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function BD(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,l){if(!l)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let u=t.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(u)===-1&&this._shimmedLocalStreams[l.id].push(u):this._shimmedLocalStreams[l.id]=[l,u],u};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(h=>{if(this.getSenders().find(f=>f.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});let l=this.getSenders();r.apply(this,arguments);let u=this.getSenders().filter(h=>l.indexOf(h)===-1);this._shimmedLocalStreams[c.id]=[c].concat(u)};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],i.apply(this,arguments)};let s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(l=>{let u=this._shimmedLocalStreams[l].indexOf(c);u!==-1&&this._shimmedLocalStreams[l].splice(u,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),s.apply(this,arguments)}}function WD(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return BD(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let h=r.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(f=>this._reverseStreams[f.id])};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(f=>{if(this.getSenders().find(m=>m.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){let f=new e.MediaStream(h.getTracks());this._streams[h.id]=f,this._reverseStreams[f.id]=h,h=f}i.apply(this,[h])};let s=e.RTCPeerConnection.prototype.removeStream;function c(h,f){let m=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(E=>{let S=h._reverseStreams[E],y=h._streams[S.id];m=m.replace(new RegExp(y.id,"g"),S.id)}),new RTCSessionDescription({type:f.type,sdp:m})}e.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},e.RTCPeerConnection.prototype.addTrack=function(h,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(S=>S===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let E=this._streams[f.id];if(E)E.addTrack(h),_e.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let S=new e.MediaStream([h]);this._streams[f.id]=S,this._reverseStreams[S.id]=f,this.addStream(S)}return this.getSenders().find(S=>S.track===h)},["createOffer","createAnswer"].forEach(function(h){let f=e.RTCPeerConnection.prototype[h],m={[h](){let E=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[S=>{let y=c(this,S);E[0].apply(null,[y])},S=>{E[1]&&E[1].apply(null,S)},arguments[2]]):f.apply(this,arguments).then(S=>c(this,S))}};e.RTCPeerConnection.prototype[h]=m[h]});let l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(h,f){let m=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(E=>{let S=h._reverseStreams[E],y=h._streams[S.id];m=m.replace(new RegExp(S.id,"g"),y.id)}),new RTCSessionDescription({type:f.type,sdp:m})}(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};let u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let h=u.get.apply(this);return h.type===""?h:c(this,h)}}),e.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(E=>h.track===E)&&(f=this._streams[m])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function lC(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let i=e.RTCPeerConnection.prototype[r],s={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=s[r]})}function GD(e,t){Kl(e,"negotiationneeded",r=>{let i=r.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return r})}var HD=Object.freeze({__proto__:null,fixNegotiationNeeded:GD,shimAddTrackRemoveTrack:WD,shimAddTrackRemoveTrackWithNative:BD,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(i=>{let s=r.video&&r.video.width,c=r.video&&r.video.height,l=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:l||3}},s&&(r.video.mandatory.maxWidth=s),c&&(r.video.mandatory.maxHeight=c),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:VD,shimGetStats:FD,shimGetUserMedia:MD,shimMediaStream:xD,shimOnTrack:UD,shimPeerConnection:lC,shimSenderReceiverGetStats:jD});function KD(e,t){let r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(s,c,l){sT("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(s).then(c,l)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let s=function(l,u,h){u in l&&!(h in l)&&(l[h]=l[u],delete l[u])},c=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l.audio,"autoGainControl","mozAutoGainControl"),s(l.audio,"noiseSuppression","mozNoiseSuppression")),c(l)},i&&i.prototype.getSettings){let l=i.prototype.getSettings;i.prototype.getSettings=function(){let u=l.apply(this,arguments);return s(u,"mozAutoGainControl","autoGainControl"),s(u,"mozNoiseSuppression","noiseSuppression"),u}}if(i&&i.prototype.applyConstraints){let l=i.prototype.applyConstraints;i.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),s(u,"autoGainControl","mozAutoGainControl"),s(u,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[u])}}}}function zD(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dC(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){let c=e.RTCPeerConnection.prototype[s],l={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=l[s]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[s,c,l]=arguments;return i.apply(this,[s||null]).then(u=>{if(t.version<53&&!c)try{u.forEach(h=>{h.type=r[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;u.forEach((f,m)=>{u.set(m,Object.assign({},f,{type:r[f.type]||f.type}))})}return u}).then(c,l)}}function qD(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):_e.resolve(new Map)}}function YD(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Kl(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function JD(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){sT("removeStream","removeTrack"),this.getSenders().forEach(r=>{var i;r.track&&ge(i=t.getTracks()).call(i,r.track)&&this.removeTrack(r)})})}function XD(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function $D(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];let i=r.length>0;i&&r.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let s=t.apply(this,arguments);if(i){let{sender:c}=s,l=c.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,c.sendEncodings=r,this.setParametersPromises.push(c.setParameters(l).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return s})}function QD(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function ZD(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?_e.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function eP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?_e.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var tP=Object.freeze({__proto__:null,shimAddTransceiver:$D,shimCreateAnswer:eP,shimCreateOffer:ZD,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){let i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,_e.reject(i)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:QD,shimGetUserMedia:KD,shimOnTrack:zD,shimPeerConnection:dC,shimRTCDataChannel:XD,shimReceiverGetStats:YD,shimRemoveStream:JD,shimSenderGetStats:qD});function rP(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var i;this._localStreams||(this._localStreams=[]),ge(i=this._localStreams).call(i,r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>t.call(this,s,r)),r.getVideoTracks().forEach(s=>t.call(this,s,r))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];return s&&s.forEach(l=>{var u;this._localStreams?ge(u=this._localStreams).call(u,l)||this._localStreams.push(l):this._localStreams=[l]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);let i=t.getTracks();this.getSenders().forEach(s=>{ge(i).call(i,s.track)&&this.removeTrack(s)})})}}function nP(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{var c;if(this._remoteStreams||(this._remoteStreams=[]),ge(c=this._remoteStreams).call(c,s))return;this._remoteStreams.push(s);let l=new Event("addstream");l.stream=s,this.dispatchEvent(l)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);let c=new Event("addstream");c.stream=s,r.dispatchEvent(c)})}),t.apply(r,arguments)}}}function iP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,c=t.setRemoteDescription,l=t.addIceCandidate;t.createOffer=function(h,f){let m=arguments.length>=2?arguments[2]:arguments[0],E=r.apply(this,[m]);return f?(E.then(h,f),_e.resolve()):E},t.createAnswer=function(h,f){let m=arguments.length>=2?arguments[2]:arguments[0],E=i.apply(this,[m]);return f?(E.then(h,f),_e.resolve()):E};let u=function(h,f,m){let E=s.apply(this,[h]);return m?(E.then(f,m),_e.resolve()):E};t.setLocalDescription=u,u=function(h,f,m){let E=c.apply(this,[h]);return m?(E.then(f,m),_e.resolve()):E},t.setRemoteDescription=u,u=function(h,f,m){let E=l.apply(this,[h]);return m?(E.then(f,m),_e.resolve()):E},t.addIceCandidate=u}function oP(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let r=t.mediaDevices,i=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=s=>i(sP(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,i,s){t.mediaDevices.getUserMedia(r).then(i,s)}).bind(t))}function sP(e){return e&&e.video!==void 0?Object.assign({},e,{video:jO(e.video)}):e}function aP(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,i){if(r&&r.iceServers){let s=[];for(let c=0;c<r.iceServers.length;c++){let l=r.iceServers[c];!l.hasOwnProperty("urls")&&l.hasOwnProperty("url")?(sT("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,s.push(l)):s.push(r.iceServers[c])}r.iceServers=s}return new t(r,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function cP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function lP(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);let i=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);let s=this.getTransceivers().find(c=>c.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function dP(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var uP=Object.freeze({__proto__:null,shimAudioContext:dP,shimCallbacksAPI:iP,shimConstraints:sP,shimCreateOfferLegacy:lP,shimGetUserMedia:oP,shimLocalStreamsAPI:rP,shimRTCIceServerUrls:aP,shimRemoteStreamsAPI:nP,shimTrackEventTransceiver:cP}),hP=`	
\v\f\r                　\u2028\u2029\uFEFF`,Aq=Ic,Oq=mo,uC=hP,pP=k("".replace),Nq=RegExp("^["+uC+"]+"),Dq=RegExp("(^|[^"+uC+"])["+uC+"]+$"),hC=function(e){return function(t){var r=Oq(Aq(t));return 1&e&&(r=pP(r,Nq,"")),2&e&&(r=pP(r,Dq,"$1")),r}},Pq={start:hC(1),end:hC(2),trim:hC(3)},kq=mN.PROPER,Lq=_,fP=hP,Mq=Pq.trim;Ut({target:"String",proto:!0,forced:function(e){return Lq(function(){return!!fP[e]()||"​᠎"[e]()!=="​᠎"||kq&&fP[e].name!==e})}("trim")},{trim:function(){return Mq(this)}});var xq=zo("String").trim,Uq=M,Vq=xq,pC=String.prototype,Fq=function(e){var t=e.trim;return typeof e=="string"||e===pC||Uq(pC,e)&&t===pC.trim?Vq:t},Wn=p(Fq),mP={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(r){return r.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(r){let i=t.splitSections(r);return i&&i[0]},t.getMediaSections=function(r){let i=t.splitSections(r);return i.shift(),i},t.matchPrefix=function(r,i){return t.splitLines(r).filter(s=>s.indexOf(i)===0)},t.parseCandidate=function(r){let i;i=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");let s={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let c=8;c<i.length;c+=2)switch(i[c]){case"raddr":s.relatedAddress=i[c+1];break;case"rport":s.relatedPort=parseInt(i[c+1],10);break;case"tcptype":s.tcpType=i[c+1];break;case"ufrag":s.ufrag=i[c+1],s.usernameFragment=i[c+1];break;default:s[i[c]]===void 0&&(s[i[c]]=i[c+1])}return s},t.writeCandidate=function(r){let i=[];i.push(r.foundation);let s=r.component;s==="rtp"?i.push(1):s==="rtcp"?i.push(2):i.push(s),i.push(r.protocol.toUpperCase()),i.push(r.priority),i.push(r.address||r.ip),i.push(r.port);let c=r.type;return i.push("typ"),i.push(c),c!=="host"&&r.relatedAddress&&r.relatedPort&&(i.push("raddr"),i.push(r.relatedAddress),i.push("rport"),i.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(i.push("ufrag"),i.push(r.usernameFragment||r.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let i=r.substring(9).split(" "),s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(r){let i=r.payloadType;r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType);let s=r.channels||r.numChannels||1;return"a=rtpmap:"+i+" "+r.name+"/"+r.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(r){let i=r.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){let i={},s,c=r.substring(r.indexOf(" ")+1).split(";");for(let l=0;l<c.length;l++)s=c[l].trim().split("="),i[s[0].trim()]=s[1];return i},t.writeFmtp=function(r){let i="",s=r.payloadType;if(r.preferredPayloadType!==void 0&&(s=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){let c=[];Object.keys(r.parameters).forEach(l=>{r.parameters[l]!==void 0?c.push(l+"="+r.parameters[l]):c.push(l)}),i+="a=fmtp:"+s+" "+c.join(";")+`\r
`}return i},t.parseRtcpFb=function(r){let i=r.substring(r.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(r){let i="",s=r.payloadType;return r.preferredPayloadType!==void 0&&(s=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(c=>{i+="a=rtcp-fb:"+s+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(r){let i=r.indexOf(" "),s={ssrc:parseInt(r.substring(7,i),10)},c=r.indexOf(":",i);return c>-1?(s.attribute=r.substring(i+1,c),s.value=r.substring(c+1)):s.attribute=r.substring(i+1),s},t.parseSsrcGroup=function(r){let i=r.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(s=>parseInt(s,10))}},t.getMid=function(r){let i=t.matchPrefix(r,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(r){let i=r.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(r,i){return{role:"auto",fingerprints:t.matchPrefix(r+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,i){let s="a=setup:"+i+`\r
`;return r.fingerprints.forEach(c=>{s+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),s},t.parseCryptoLine=function(r){let i=r.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;let i=r.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,i){return t.matchPrefix(r+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,i){let s=t.matchPrefix(r+i,"a=ice-ufrag:")[0],c=t.matchPrefix(r+i,"a=ice-pwd:")[0];return s&&c?{usernameFragment:s.substring(12),password:c.substring(10)}:null},t.writeIceParameters=function(r){let i="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(r){let i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(r)[0].split(" ");i.profile=s[2];for(let l=3;l<s.length;l++){let u=s[l],h=t.matchPrefix(r,"a=rtpmap:"+u+" ")[0];if(h){let f=t.parseRtpMap(h),m=t.matchPrefix(r,"a=fmtp:"+u+" ");switch(f.parameters=m.length?t.parseFmtp(m[0]):{},f.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),i.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(f.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach(l=>{i.headerExtensions.push(t.parseExtmap(l))});let c=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(l=>{c.forEach(u=>{l.rtcpFeedback.find(h=>h.type===u.type&&h.parameter===u.parameter)||l.rtcpFeedback.push(u)})}),i},t.writeRtpDescription=function(r,i){let s="";s+="m="+r+" ",s+=i.codecs.length>0?"9":"0",s+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=i.codecs.map(l=>l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(l=>{s+=t.writeRtpMap(l),s+=t.writeFmtp(l),s+=t.writeRtcpFb(l)});let c=0;return i.codecs.forEach(l=>{l.maxptime>c&&(c=l.maxptime)}),c>0&&(s+="a=maxptime:"+c+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(l=>{s+=t.writeExtmap(l)}),s},t.parseRtpEncodingParameters=function(r){let i=[],s=t.parseRtpParameters(r),c=s.fecMechanisms.indexOf("RED")!==-1,l=s.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(r,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),h=u.length>0&&u[0].ssrc,f,m=t.matchPrefix(r,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(y=>parseInt(y,10)));m.length>0&&m[0].length>1&&m[0][0]===h&&(f=m[0][1]),s.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let y={ssrc:h,codecPayloadType:parseInt(S.parameters.apt,10)};h&&f&&(y.rtx={ssrc:f}),i.push(y),c&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:h,mechanism:l?"red+ulpfec":"red"},i.push(y))}}),i.length===0&&h&&i.push({ssrc:h});let E=t.matchPrefix(r,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,i.forEach(S=>{S.maxBitrate=E})),i},t.parseRtcpParameters=function(r){let i={},s=t.matchPrefix(r,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);let c=t.matchPrefix(r,"a=rtcp-rsize");i.reducedSize=c.length>0,i.compound=c.length===0;let l=t.matchPrefix(r,"a=rtcp-mux");return i.mux=l.length>0,i},t.writeRtcpParameters=function(r){let i="";return r.reducedSize&&(i+=`a=rtcp-rsize\r
`),r.mux&&(i+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(i+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),i},t.parseMsid=function(r){let i,s=t.matchPrefix(r,"a=msid:");if(s.length===1)return i=s[0].substring(7).split(" "),{stream:i[0],track:i[1]};let c=t.matchPrefix(r,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="msid");return c.length>0?(i=c[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(r){let i=t.parseMLine(r),s=t.matchPrefix(r,"a=max-message-size:"),c;s.length>0&&(c=parseInt(s[0].substring(19),10)),isNaN(c)&&(c=65536);let l=t.matchPrefix(r,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substring(12),10),protocol:i.fmt,maxMessageSize:c};let u=t.matchPrefix(r,"a=sctpmap:");if(u.length>0){let h=u[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:c}}},t.writeSctpDescription=function(r,i){let s=[];return s=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,i,s){let c,l=i!==void 0?i:2;return c=r||t.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+c+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,i){let s=t.splitLines(r);for(let c=0;c<s.length;c++)switch(s[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[c].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){let i=t.splitLines(r)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(r){let i=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;let i=t.splitLines(r);for(let s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},e.exports=t})(mP);var _P=mP.exports,_u=p(_P),jq=a({__proto__:null,default:_u},[_P]);function q_(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){let i=new t(r),s=_u.parseCandidate(r.candidate),c=Object.assign(i,s);return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Kl(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function fC(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Kl(e,"icecandidate",t=>{if(t.candidate){let r=_u.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function Y_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let r=function(u){if(!u||!u.sdp)return!1;let h=_u.splitSections(u.sdp);return h.shift(),h.some(f=>{let m=_u.parseMLine(f);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},i=function(u){let h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;let f=parseInt(h[1],10);return f!=f?-1:f},s=function(u){let h=65536;return t.browser==="firefox"&&(h=t.version<57?u===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),h},c=function(u,h){let f=65536;t.browser==="firefox"&&t.version===57&&(f=65535);let m=_u.matchPrefix(u.sdp,"a=max-message-size:");return m.length>0?f=parseInt(m[0].substr(19),10):t.browser==="firefox"&&h!==-1&&(f=2147483637),f},l=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let u=i(arguments[0]),h=s(u),f=c(arguments[0],u),m;m=h===0&&f===0?Number.POSITIVE_INFINITY:h===0||f===0?Math.max(h,f):Math.min(h,f);let E={};Object.defineProperty(E,"maxMessageSize",{get:()=>m}),this._sctp=E}return l.apply(this,arguments)}}function J_(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,s){let c=i.send;i.send=function(){let l=arguments[0],u=l.length||l.size||l.byteLength;if(i.readyState==="open"&&s.sctp&&u>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return c.apply(i,arguments)}}let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let i=r.apply(this,arguments);return t(i,this),i},Kl(e,"datachannel",i=>(t(i.channel,i.target),i))}function mC(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{let i=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{let c=s.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;let l=new Event("connectionstatechange",s);c.dispatchEvent(l)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function _C(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let s=i.sdp.split(`
`).filter(c=>Wn(c).call(c)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return r.apply(this,arguments)}}function X_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?_e.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),_e.resolve())})}function $_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return r.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?r.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>r.apply(this,[s]))})}var Bq=Object.freeze({__proto__:null,removeExtmapAllowMixed:_C,shimAddIceCandidateNullOrEmpty:X_,shimConnectionState:mC,shimMaxMessageSize:Y_,shimParameterlessSetLocalDescription:$_,shimRTCIceCandidate:q_,shimRTCIceCandidateRelayProtocol:fC,shimSendThrowTypeError:J_});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=VO,i=function(c){let l={browser:null,version:null};if(c===void 0||!c.navigator)return l.browser="Not a browser.",l;let{navigator:u}=c;if(u.mozGetUserMedia)l.browser="firefox",l.version=C_(u.userAgent,/Firefox\/(\d+)\./,1);else if(u.webkitGetUserMedia||c.isSecureContext===!1&&c.webkitRTCPeerConnection)l.browser="chrome",l.version=C_(u.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!c.RTCPeerConnection||!u.userAgent.match(/AppleWebKit\/(\d+)\./))return l.browser="Not a supported browser.",l;l.browser="safari",l.version=C_(u.userAgent,/AppleWebKit\/(\d+)\./,1),l.supportsUnifiedPlan=c.RTCRtpTransceiver&&"currentDirection"in c.RTCRtpTransceiver.prototype}return l}(e),s={browserDetails:i,commonShim:Bq,extractVersion:C_,disableLog:V8,disableWarnings:F8,sdp:jq};switch(i.browser){case"chrome":if(!HD||!lC||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),s;if(i.version===null)return r("Chrome shim can not determine version, not shimming."),s;r("adapter.js shimming chrome."),s.browserShim=HD,X_(e,i),$_(e),MD(e,i),xD(e),lC(e,i),UD(e),WD(e,i),VD(e),FD(e),jD(e),GD(e,i),q_(e),fC(e),mC(e),Y_(e,i),J_(e),_C(e,i);break;case"firefox":if(!tP||!dC||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),s;r("adapter.js shimming firefox."),s.browserShim=tP,X_(e,i),$_(e),KD(e,i),dC(e,i),zD(e),JD(e),qD(e),YD(e),XD(e),$D(e),QD(e),ZD(e),eP(e),q_(e),mC(e),Y_(e,i),J_(e);break;case"safari":if(!uP||!t.shimSafari)return r("Safari shim is not included in this adapter release."),s;r("adapter.js shimming safari."),s.browserShim=uP,X_(e,i),$_(e),aP(e),lP(e),iP(e),rP(e),nP(e),cP(e),oP(e),dP(e),q_(e),fC(e),Y_(e,i),J_(e),_C(e,i);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Wq=zo("Array").keys,Gq=la,Hq=Nr,Kq=M,zq=Wq,EC=Array.prototype,qq={DOMTokenList:!0,NodeList:!0},Yq=function(e){var t=e.keys;return e===EC||Kq(EC,e)&&t===EC.keys||Hq(qq,Gq(e))?zq:t},qi=p(Yq),EP=Ha,Jq=TypeError,Xq=g_,$q=Ko,Qq=tn,Q_=function(e,t,r){var i=Xq(t);i in e?$q.f(e,i,Qq(0,r)):e[i]=r},gP=eT,Zq=za,eY=Q_,tY=Array,rY=Math.max,gC=function(e,t,r){for(var i=Zq(e),s=gP(t,i),c=gP(r===void 0?i:r,i),l=tY(rY(c-s,0)),u=0;s<c;s++,u++)eY(l,u,e[s]);return l.length=u,l},SP=gC,nY=Math.floor,SC=function(e,t){var r=e.length,i=nY(r/2);return r<8?iY(e,t):oY(e,SC(SP(e,0,i),t),SC(SP(e,i),t),t)},iY=function(e,t){for(var r,i,s=e.length,c=1;c<s;){for(i=c,r=e[c];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==c++&&(e[i]=r)}return e},oY=function(e,t,r,i){for(var s=t.length,c=r.length,l=0,u=0;l<s||u<c;)e[l+u]=l<s&&u<c?i(t[l],r[u])<=0?t[l++]:r[u++]:l<s?t[l++]:r[u++];return e},yP=SC,vP=Ei.match(/firefox\/(\d+)/i),sY=!!vP&&+vP[1],aY=/MSIE|Trident/.test(Ei),TP=Ei.match(/AppleWebKit\/(\d+)\./),cY=!!TP&&+TP[1],lY=Ut,CP=k,dY=zi,uY=gi,RP=za,hY=function(e,t){if(!delete e[t])throw Jq("Cannot delete property "+EP(t)+" of "+EP(e))},wP=mo,yC=_,pY=yP,fY=T_,IP=sY,mY=aY,bP=aa,AP=cY,xc=[],OP=CP(xc.sort),_Y=CP(xc.push),EY=yC(function(){xc.sort(void 0)}),gY=yC(function(){xc.sort(null)}),SY=fY("sort"),NP=!yC(function(){if(bP)return bP<70;if(!(IP&&IP>3)){if(mY)return!0;if(AP)return AP<603;var e,t,r,i,s="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(i=0;i<47;i++)xc.push({k:t+i,v:r})}for(xc.sort(function(c,l){return l.v-c.v}),i=0;i<xc.length;i++)t=xc[i].k.charAt(0),s.charAt(s.length-1)!==t&&(s+=t);return s!=="DGBEFHACIJK"}});lY({target:"Array",proto:!0,forced:EY||!gY||!SY||!NP},{sort:function(e){e!==void 0&&dY(e);var t=uY(this);if(NP)return e===void 0?OP(t):OP(t,e);var r,i,s=[],c=RP(t);for(i=0;i<c;i++)i in t&&_Y(s,t[i]);for(pY(s,function(l){return function(u,h){return h===void 0?-1:u===void 0?1:l!==void 0?+l(u,h)||0:wP(u)>wP(h)?1:-1}}(e)),r=RP(s),i=0;i<r;)t[i]=s[i++];for(;i<c;)hY(t,i++);return t}});var yY=zo("Array").sort,vY=M,TY=yY,vC=Array.prototype,CY=function(e){var t=e.sort;return e===vC||vY(vC,e)&&t===vC.sort?TY:t},Mp=p(CY),TC={exports:{}};(function(e,t){(function(r,i){var s="function",c="undefined",l="object",u="string",h="major",f="model",m="name",E="type",S="vendor",y="version",A="architecture",T="console",w="mobile",O="tablet",P="smarttv",F="wearable",W="embedded",K="Amazon",X="Apple",ie="ASUS",ae="BlackBerry",le="Browser",we="Chrome",nt="Firefox",gt="Google",jt="Huawei",wr="LG",ir="Microsoft",ps="Motorola",ne="Opera",me="Samsung",Re="Sharp",He="Sony",_t="Xiaomi",Ee="Zebra",I="Facebook",U="Chromium OS",j="Mac OS",de=function(Sr){for(var xr={},qt=0;qt<Sr.length;qt++)xr[Sr[qt].toUpperCase()]=Sr[qt];return xr},We=function(Sr,xr){return typeof Sr===u&&xt(xr).indexOf(xt(Sr))!==-1},xt=function(Sr){return Sr.toLowerCase()},Hr=function(Sr,xr){if(typeof Sr===u)return Sr=Sr.replace(/^\s\s*/,""),typeof xr===c?Sr:Sr.substring(0,350)},wi=function(Sr,xr){for(var qt,Fi,Da,yr,Et,Ii,pl=0;pl<xr.length&&!Et;){var zs=xr[pl],Nj=xr[pl+1];for(qt=Fi=0;qt<zs.length&&!Et&&zs[qt];)if(Et=zs[qt++].exec(Sr))for(Da=0;Da<Nj.length;Da++)Ii=Et[++Fi],typeof(yr=Nj[Da])===l&&yr.length>0?yr.length===2?typeof yr[1]==s?this[yr[0]]=yr[1].call(this,Ii):this[yr[0]]=yr[1]:yr.length===3?typeof yr[1]!==s||yr[1].exec&&yr[1].test?this[yr[0]]=Ii?Ii.replace(yr[1],yr[2]):i:this[yr[0]]=Ii?yr[1].call(this,Ii,yr[2]):i:yr.length===4&&(this[yr[0]]=Ii?yr[3].call(this,Ii.replace(yr[1],yr[2])):i):this[yr]=Ii||i;pl+=2}},cc=function(Sr,xr){for(var qt in xr)if(typeof xr[qt]===l&&xr[qt].length>0){for(var Fi=0;Fi<xr[qt].length;Fi++)if(We(xr[qt][Fi],Sr))return qt==="?"?i:qt}else if(We(xr[qt],Sr))return qt==="?"?i:qt;return Sr},Kg={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},zg={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,y],[/opios[\/ ]+([\w\.]+)/i],[y,[m,ne+" Mini"]],[/\bopr\/([\w\.]+)/i],[y,[m,ne]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[m,y],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[m,"UC"+le]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[y,[m,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[y,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[m,"IE"]],[/yabrowser\/([\w\.]+)/i],[y,[m,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+le],y],[/\bfocus\/([\w\.]+)/i],[y,[m,nt+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[m,ne+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[m,ne+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[m,"MIUI "+le]],[/fxios\/([-\w\.]+)/i],[y,[m,nt]],[/\bqihu|(qi?ho?o?|360)browser/i],[[m,"360 "+le]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1 "+le],y],[/(comodo_dragon)\/([\w\.]+)/i],[[m,/_/g," "],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[m,y],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,I],y],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[m,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[m,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[m,we+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,we+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[m,"Android "+le]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[y,cc,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[m,nt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[m,y],[/(cobalt)\/([\w\.]+)/i],[m,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[A,"amd64"]],[/(ia32(?=;))/i],[[A,xt]],[/((?:i[346]|x)86)[;\)]/i],[[A,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[A,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[A,"armhf"]],[/windows (ce|mobile); ppc;/i],[[A,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[A,/ower/,"",xt]],[/(sun4\w)[;\)]/i],[[A,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[A,xt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[S,me],[E,O]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[f,[S,me],[E,w]],[/\((ip(?:hone|od)[\w ]*);/i],[f,[S,X],[E,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[S,X],[E,O]],[/(macintosh);/i],[f,[S,X]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[S,Re],[E,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[S,jt],[E,O]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[S,jt],[E,w]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[f,/_/g," "],[S,_t],[E,w]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[S,_t],[E,O]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[S,"OPPO"],[E,w]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[S,"Vivo"],[E,w]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[f,[S,"Realme"],[E,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[S,ps],[E,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[S,ps],[E,O]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[S,wr],[E,O]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[S,wr],[E,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[S,"Lenovo"],[E,O]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[S,"Nokia"],[E,w]],[/(pixel c)\b/i],[f,[S,gt],[E,O]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[S,gt],[E,w]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[S,He],[E,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[S,He],[E,O]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[S,"OnePlus"],[E,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[S,K],[E,O]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[S,K],[E,w]],[/(playbook);[-\w\),; ]+(rim)/i],[f,S,[E,O]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[S,ae],[E,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[S,ie],[E,O]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[S,ie],[E,w]],[/(nexus 9)/i],[f,[S,"HTC"],[E,O]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[f,/_/g," "],[E,w]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[S,"Acer"],[E,O]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[S,"Meizu"],[E,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,f,[E,w]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,f,[E,O]],[/(surface duo)/i],[f,[S,ir],[E,O]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[S,"Fairphone"],[E,w]],[/(u304aa)/i],[f,[S,"AT&T"],[E,w]],[/\bsie-(\w*)/i],[f,[S,"Siemens"],[E,w]],[/\b(rct\w+) b/i],[f,[S,"RCA"],[E,O]],[/\b(venue[\d ]{2,7}) b/i],[f,[S,"Dell"],[E,O]],[/\b(q(?:mv|ta)\w+) b/i],[f,[S,"Verizon"],[E,O]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[S,"Barnes & Noble"],[E,O]],[/\b(tm\d{3}\w+) b/i],[f,[S,"NuVision"],[E,O]],[/\b(k88) b/i],[f,[S,"ZTE"],[E,O]],[/\b(nx\d{3}j) b/i],[f,[S,"ZTE"],[E,w]],[/\b(gen\d{3}) b.+49h/i],[f,[S,"Swiss"],[E,w]],[/\b(zur\d{3}) b/i],[f,[S,"Swiss"],[E,O]],[/\b((zeki)?tb.*\b) b/i],[f,[S,"Zeki"],[E,O]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],f,[E,O]],[/\b(ns-?\w{0,9}) b/i],[f,[S,"Insignia"],[E,O]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[S,"NextBook"],[E,O]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],f,[E,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],f,[E,w]],[/\b(ph-1) /i],[f,[S,"Essential"],[E,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[S,"Envizen"],[E,O]],[/\b(trio[-\w\. ]+) b/i],[f,[S,"MachSpeed"],[E,O]],[/\btu_(1491) b/i],[f,[S,"Rotor"],[E,O]],[/(shield[\w ]+) b/i],[f,[S,"Nvidia"],[E,O]],[/(sprint) (\w+)/i],[S,f,[E,w]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[S,ir],[E,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[S,Ee],[E,O]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[S,Ee],[E,w]],[/smart-tv.+(samsung)/i],[S,[E,P]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[S,me],[E,P]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,wr],[E,P]],[/(apple) ?tv/i],[S,[f,X+" TV"],[E,P]],[/crkey/i],[[f,we+"cast"],[S,gt],[E,P]],[/droid.+aft(\w)( bui|\))/i],[f,[S,K],[E,P]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[S,Re],[E,P]],[/(bravia[\w ]+)( bui|\))/i],[f,[S,He],[E,P]],[/(mitv-\w{5}) bui/i],[f,[S,_t],[E,P]],[/Hbbtv.*(technisat) (.*);/i],[S,f,[E,P]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,Hr],[f,Hr],[E,P]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,P]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,f,[E,T]],[/droid.+; (shield) bui/i],[f,[S,"Nvidia"],[E,T]],[/(playstation [345portablevi]+)/i],[f,[S,He],[E,T]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[S,ir],[E,T]],[/((pebble))app/i],[S,f,[E,F]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[S,X],[E,F]],[/droid.+; (glass) \d/i],[f,[S,gt],[E,F]],[/droid.+; (wt63?0{2,3})\)/i],[f,[S,Ee],[E,F]],[/(quest( 2| pro)?)/i],[f,[S,I],[E,F]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[E,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[f,[E,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[E,O]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,O]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,w]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[m,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[m,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,y],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[m,[y,cc,Kg]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,"Windows"],[y,cc,Kg]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,j],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,y],[/\(bb(10);/i],[y,[m,ae]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[m,nt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[m,we+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,U],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,y],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[m,y]]},Io=function(Sr,xr){if(typeof Sr===l&&(xr=Sr,Sr=i),!(this instanceof Io))return new Io(Sr,xr).getResult();var qt=typeof r!==c&&r.navigator?r.navigator:i,Fi=Sr||(qt&&qt.userAgent?qt.userAgent:""),Da=qt&&qt.userAgentData?qt.userAgentData:i,yr=xr?function(Et,Ii){var pl={};for(var zs in Et)Ii[zs]&&Ii[zs].length%2==0?pl[zs]=Ii[zs].concat(Et[zs]):pl[zs]=Et[zs];return pl}(zg,xr):zg;return this.getBrowser=function(){var Et={};return Et[m]=i,Et[y]=i,wi.call(Et,Fi,yr.browser),Et[h]=function(Ii){return typeof Ii===u?Ii.replace(/[^\d\.]/g,"").split(".")[0]:i}(Et[y]),qt&&qt.brave&&typeof qt.brave.isBrave==s&&(Et[m]="Brave"),Et},this.getCPU=function(){var Et={};return Et[A]=i,wi.call(Et,Fi,yr.cpu),Et},this.getDevice=function(){var Et={};return Et[S]=i,Et[f]=i,Et[E]=i,wi.call(Et,Fi,yr.device),!Et[E]&&Da&&Da.mobile&&(Et[E]=w),Et[f]=="Macintosh"&&qt&&typeof qt.standalone!==c&&qt.maxTouchPoints&&qt.maxTouchPoints>2&&(Et[f]="iPad",Et[E]=O),Et},this.getEngine=function(){var Et={};return Et[m]=i,Et[y]=i,wi.call(Et,Fi,yr.engine),Et},this.getOS=function(){var Et={};return Et[m]=i,Et[y]=i,wi.call(Et,Fi,yr.os),!Et[m]&&Da&&Da.platform!="Unknown"&&(Et[m]=Da.platform.replace(/chrome os/i,U).replace(/macos/i,j)),Et},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Fi},this.setUA=function(Et){return Fi=typeof Et===u&&Et.length>350?Hr(Et,350):Et,this},this.setUA(Fi),this};Io.VERSION="0.7.34",Io.BROWSER=de([m,y,h]),Io.CPU=de([A]),Io.DEVICE=de([f,S,E,T,w,P,O,F,W]),Io.ENGINE=Io.OS=de([m,y]),e.exports&&(t=e.exports=Io),t.UAParser=Io;var hl=typeof r!==c&&(r.jQuery||r.Zepto);if(hl&&!hl.ua){var mh=new Io;hl.ua=mh.getResult(),hl.ua.get=function(){return mh.getUA()},hl.ua.set=function(Sr){mh.setUA(Sr);var xr=mh.getResult();for(var qt in xr)hl.ua[qt]=xr[qt]}}})(typeof window=="object"?window:d)})(TC,TC.exports);var RY=p(TC.exports),wY=la,IY=Nr,bY=En,AY=zl,OY=vr("iterator"),NY=Object,DY=function(e){if(bY(e))return!1;var t=NY(e);return t[OY]!==void 0||"@@iterator"in t||IY(AY,wY(t))},PY=p(DY),CC=z;Ut({global:!0,forced:CC.globalThis!==CC},{globalThis:CC});var DP=p(z);function PP(e,t){return function(){return e.apply(t,arguments)}}let{toString:kY}=Object.prototype,{getPrototypeOf:RC}=Object,Z_=(wC=Object.create(null),e=>{let t=kY.call(e);return wC[t]||(wC[t]=t.slice(8,-1).toLowerCase())});var wC;let ha=e=>(e=e.toLowerCase(),t=>Z_(t)===e),eE=e=>t=>typeof t===e,{isArray:Eu}=Array,xp=eE("undefined"),kP=ha("ArrayBuffer"),LY=eE("string"),qo=eE("function"),LP=eE("number"),tE=e=>e!==null&&typeof e=="object",rE=e=>{if(Z_(e)!=="object")return!1;let t=RC(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||PY(e))},MY=ha("Date"),xY=ha("File"),UY=ha("Blob"),VY=ha("FileList"),FY=ha("URLSearchParams");function Up(e,t){let r,i,{allOwnKeys:s=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Eu(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{let c=s?Object.getOwnPropertyNames(e):Object.keys(e),l=c.length,u;for(r=0;r<l;r++)u=c[r],t.call(null,e[u],u,e)}}function MP(e,t){t=t.toLowerCase();let r=Object.keys(e),i,s=r.length;for(;s-- >0;)if(i=r[s],t===i.toLowerCase())return i;return null}let xP=DP!==void 0?DP:typeof self<"u"?self:typeof window<"u"?window:global,UP=e=>!xp(e)&&e!==xP,jY=(IC=typeof Uint8Array<"u"&&RC(Uint8Array),e=>IC&&e instanceof IC);var IC;let BY=ha("HTMLFormElement"),VP=(e=>{let{hasOwnProperty:t}=e;return(r,i)=>t.call(r,i)})(Object.prototype),WY=ha("RegExp"),FP=(e,t)=>{let r=Object.getOwnPropertyDescriptors(e),i={};Up(r,(s,c)=>{let l;(l=t(s,c,e))!==!1&&(i[c]=l||s)}),Object.defineProperties(e,i)},bC="abcdefghijklmnopqrstuvwxyz",jP="0123456789",BP={DIGIT:jP,ALPHA:bC,ALPHA_DIGIT:bC+bC.toUpperCase()+jP},GY=ha("AsyncFunction");var Ce={isArray:Eu,isArrayBuffer:kP,isBuffer:function(e){return e!==null&&!xp(e)&&e.constructor!==null&&!xp(e.constructor)&&qo(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||qo(e.append)&&((t=Z_(e))==="formdata"||t==="object"&&qo(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&kP(e.buffer),t},isString:LY,isNumber:LP,isBoolean:e=>e===!0||e===!1,isObject:tE,isPlainObject:rE,isUndefined:xp,isDate:MY,isFile:xY,isBlob:UY,isRegExp:WY,isFunction:qo,isStream:e=>tE(e)&&qo(e.pipe),isURLSearchParams:FY,isTypedArray:jY,isFileList:VY,forEach:Up,merge:function e(){let{caseless:t}=UP(this)&&this||{},r={},i=(s,c)=>{let l=t&&MP(r,c)||c;rE(r[l])&&rE(s)?r[l]=e(r[l],s):rE(s)?r[l]=e({},s):Eu(s)?r[l]=s.slice():r[l]=s};for(let s=0,c=arguments.length;s<c;s++)arguments[s]&&Up(arguments[s],i);return r},extend:function(e,t,r){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Up(t,(s,c)=>{r&&qo(s)?e[c]=PP(s,r):e[c]=s},{allOwnKeys:i}),e},trim:e=>Wn(e)?Wn(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,i)=>{let s,c,l,u={};if(t=t||{},e==null)return t;do{for(s=Object.getOwnPropertyNames(e),c=s.length;c-- >0;)l=s[c],i&&!i(l,e,t)||u[l]||(t[l]=e[l],u[l]=!0);e=r!==!1&&RC(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:Z_,kindOfTest:ha,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;let i=e.indexOf(t,r);return i!==-1&&i===r},toArray:e=>{if(!e)return null;if(Eu(e))return e;let t=e.length;if(!LP(t))return null;let r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{let r=(e&&e[Symbol.iterator]).call(e),i;for(;(i=r.next())&&!i.done;){let s=i.value;t.call(e,s[0],s[1])}},matchAll:(e,t)=>{let r,i=[];for(;(r=e.exec(t))!==null;)i.push(r);return i},isHTMLForm:BY,hasOwnProperty:VP,hasOwnProp:VP,reduceDescriptors:FP,freezeMethods:e=>{FP(e,(t,r)=>{if(qo(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;let i=e[r];qo(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{let r={},i=s=>{s.forEach(c=>{r[c]=!0})};return Eu(e)?i(e):i(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,i){return r.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:MP,global:xP,isContextDefined:UP,ALPHABET:BP,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:BP.ALPHA_DIGIT,r="",{length:i}=t;for(;e--;)r+=t[Math.random()*i|0];return r},isSpecCompliantForm:function(e){return!!(e&&qo(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{let t=new Array(10),r=(i,s)=>{if(tE(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[s]=i;let c=Eu(i)?[]:{};return Up(i,(l,u)=>{let h=r(l,s+1);!xp(h)&&(c[u]=h)}),t[s]=void 0,c}}return i};return r(e,0)},isAsyncFn:GY,isThenable:e=>e&&(tE(e)||qo(e))&&qo(e.then)&&qo(e.catch)};function tr(e,t,r,i,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),i&&(this.request=i),s&&(this.response=s)}Ce.inherits(tr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ce.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});let WP=tr.prototype,GP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{GP[e]={value:e}}),Object.defineProperties(tr,GP),Object.defineProperty(WP,"isAxiosError",{value:!0}),tr.from=(e,t,r,i,s,c)=>{let l=Object.create(WP);return Ce.toFlatObject(e,l,function(u){return u!==Error.prototype},u=>u!=="isAxiosError"),tr.call(l,e.message,t,r,i,s),l.cause=e,l.name=e.name,c&&Object.assign(l,c),l};function AC(e){return Ce.isPlainObject(e)||Ce.isArray(e)}function HP(e){return Ce.endsWith(e,"[]")?e.slice(0,-2):e}function KP(e,t,r){return e?e.concat(t).map(function(i,s){return i=HP(i),!r&&s?"["+i+"]":i}).join(r?".":""):t}let HY=Ce.toFlatObject(Ce,{},null,function(e){return/^is[A-Z]/.test(e)});function nE(e,t,r){if(!Ce.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let i=(r=Ce.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,y){return!Ce.isUndefined(y[S])})).metaTokens,s=r.visitor||f,c=r.dots,l=r.indexes,u=(r.Blob||typeof Blob<"u"&&Blob)&&Ce.isSpecCompliantForm(t);if(!Ce.isFunction(s))throw new TypeError("visitor must be a function");function h(S){if(S===null)return"";if(Ce.isDate(S))return S.toISOString();if(!u&&Ce.isBlob(S))throw new tr("Blob is not supported. Use a Buffer instead.");return Ce.isArrayBuffer(S)||Ce.isTypedArray(S)?u&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function f(S,y,A){let T=S;if(S&&!A&&typeof S=="object"){if(Ce.endsWith(y,"{}"))y=i?y:y.slice(0,-2),S=JSON.stringify(S);else if(Ce.isArray(S)&&function(w){return Ce.isArray(w)&&!w.some(AC)}(S)||(Ce.isFileList(S)||Ce.endsWith(y,"[]"))&&(T=Ce.toArray(S)))return y=HP(y),T.forEach(function(w,O){!Ce.isUndefined(w)&&w!==null&&t.append(l===!0?KP([y],O,c):l===null?y:y+"[]",h(w))}),!1}return!!AC(S)||(t.append(KP(A,y,c),h(S)),!1)}let m=[],E=Object.assign(HY,{defaultVisitor:f,convertValue:h,isVisitable:AC});if(!Ce.isObject(e))throw new TypeError("data must be an object");return function S(y,A){if(!Ce.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+A.join("."));m.push(y),Ce.forEach(y,function(T,w){(!(Ce.isUndefined(T)||T===null)&&s.call(t,T,Ce.isString(w)?Wn(w).call(w):w,A,E))===!0&&S(T,A?A.concat(w):[w])}),m.pop()}}(e),t}function zP(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function OC(e,t){this._pairs=[],e&&nE(e,this,t)}let qP=OC.prototype;function KY(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function YP(e,t,r){if(!t)return e;let i=r&&r.encode||KY,s=r&&r.serialize,c;if(c=s?s(t,r):Ce.isURLSearchParams(t)?t.toString():new OC(t,r).toString(i),c){let l=e.indexOf("#");l!==-1&&(e=e.slice(0,l)),e+=(e.indexOf("?")===-1?"?":"&")+c}return e}qP.append=function(e,t){this._pairs.push([e,t])},qP.toString=function(e){let t=e?function(r){return e.call(this,r,zP)}:zP;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};var JP=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ce.forEach(this.handlers,function(t){t!==null&&e(t)})}},XP={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$P={exports:{}},zY=Ut,qY=jr,QP=Ko.f;zY({target:"Object",stat:!0,forced:Object.defineProperty!==QP,sham:!qY},{defineProperty:QP});var ZP=fo.Object,YY=$P.exports=function(e,t,r){return ZP.defineProperty(e,t,r)};ZP.defineProperty.sham&&(YY.sham=!0);var ek=p($P.exports),JY=pe,Vp=Array.isArray||function(e){return JY(e)=="Array"},XY=TypeError,tk=Vp,$Y=F_,QY=_i,ZY=vr("species"),rk=Array,eJ=function(e){var t;return tk(e)&&(t=e.constructor,($Y(t)&&(t===rk||tk(t.prototype))||QY(t)&&(t=t[ZY])===null)&&(t=void 0)),t===void 0?rk:t},nk=function(e,t){return new(eJ(e))(t===0?0:t)},tJ=_,rJ=aa,nJ=vr("species"),ik=function(e){return rJ>=51||!tJ(function(){var t=[];return(t.constructor={})[nJ]=function(){return{foo:1}},t[e](Boolean).foo!==1})},iJ=Ut,oJ=_,sJ=Vp,aJ=_i,cJ=gi,lJ=za,ok=function(e){if(e>9007199254740991)throw XY("Maximum allowed index exceeded");return e},sk=Q_,dJ=nk,uJ=ik,hJ=aa,ak=vr("isConcatSpreadable"),pJ=hJ>=51||!oJ(function(){var e=[];return e[ak]=!1,e.concat()[0]!==e}),fJ=function(e){if(!aJ(e))return!1;var t=e[ak];return t!==void 0?!!t:sJ(e)};iJ({target:"Array",proto:!0,arity:1,forced:!pJ||!uJ("concat")},{concat:function(e){var t,r,i,s,c,l=cJ(this),u=dJ(l,0),h=0;for(t=-1,i=arguments.length;t<i;t++)if(fJ(c=t===-1?l:arguments[t]))for(s=lJ(c),ok(h+s),r=0;r<s;r++,h++)r in c&&sk(u,h,c[r]);else ok(h+1),sk(u,h++,c);return u.length=h,u}});var ck={},mJ=pe,_J=sa,lk=w_.f,EJ=gC,dk=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];ck.f=function(e){return dk&&mJ(e)=="Window"?function(t){try{return lk(t)}catch{return EJ(dk)}}(e):lk(_J(e))};var gu={},gJ=vr;gu.f=gJ;var uk=fo,SJ=Nr,yJ=gu,vJ=Ko.f,Sn=function(e){var t=uk.Symbol||(uk.Symbol={});SJ(t,e)||vJ(t,e,{value:yJ.f(e)})},TJ=Ge,CJ=jn,RJ=vr,wJ=kc,hk=function(){var e=CJ("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,i=RJ("toPrimitive");t&&!t[i]&&wJ(t,i,function(s){return TJ(r,this)},{arity:1})},IJ=Dc,bJ=tu,AJ=gi,OJ=za,NJ=nk,pk=k([].push),Uc=function(e){var t=e==1,r=e==2,i=e==3,s=e==4,c=e==6,l=e==7,u=e==5||c;return function(h,f,m,E){for(var S,y,A=AJ(h),T=bJ(A),w=IJ(f,m),O=OJ(T),P=0,F=E||NJ,W=t?F(h,O):r||l?F(h,0):void 0;O>P;P++)if((u||P in T)&&(y=w(S=T[P],P,A),e))if(t)W[P]=y;else if(y)switch(e){case 3:return!0;case 5:return S;case 6:return P;case 2:pk(W,S)}else switch(e){case 4:return!1;case 7:pk(W,S)}return c?-1:i||s?s:W}},fk={forEach:Uc(0),map:Uc(1),filter:Uc(2),some:Uc(3),every:Uc(4),find:Uc(5),findIndex:Uc(6),filterReject:Uc(7)},iE=Ut,NC=z,DC=Ge,DJ=k,Su=jr,yu=Os,PJ=_,Xn=Nr,kJ=M,PC=Si,oE=sa,kC=g_,LJ=mo,LC=tn,Fp=wp,mk=b_,MJ=w_,_k=ck,xJ=Rp,Ek=Jn,gk=Ko,UJ=hT,Sk=ut,yk=kc,VJ=V_,MC=Gt,vk=I_,Tk=Nc,FJ=vr,jJ=gu,BJ=Sn,WJ=hk,GJ=Lc,Ck=Yl,sE=fk.forEach,Yi=R_("hidden"),aE="Symbol",jp="prototype",HJ=Ck.set,Rk=Ck.getterFor(aE),Ps=Object[jp],$l=NC.Symbol,cE=$l&&$l[jp],KJ=NC.TypeError,xC=NC.QObject,wk=Ek.f,Ql=gk.f,Ik=_k.f,zJ=Sk.f,bk=DJ([].push),qa=MC("symbols"),Bp=MC("op-symbols"),qJ=MC("wks"),UC=!xC||!xC[jp]||!xC[jp].findChild,VC=Su&&PJ(function(){return Fp(Ql({},"a",{get:function(){return Ql(this,"a",{value:7}).a}})).a!=7})?function(e,t,r){var i=wk(Ps,t);i&&delete Ps[t],Ql(e,t,r),i&&e!==Ps&&Ql(Ps,t,i)}:Ql,FC=function(e,t){var r=qa[e]=Fp(cE);return HJ(r,{type:aE,tag:e,description:t}),Su||(r.description=t),r},lE=function(e,t,r){e===Ps&&lE(Bp,t,r),PC(e);var i=kC(t);return PC(r),Xn(qa,i)?(r.enumerable?(Xn(e,Yi)&&e[Yi][i]&&(e[Yi][i]=!1),r=Fp(r,{enumerable:LC(0,!1)})):(Xn(e,Yi)||Ql(e,Yi,LC(1,{})),e[Yi][i]=!0),VC(e,i,r)):Ql(e,i,r)},jC=function(e,t){PC(e);var r=oE(t),i=mk(r).concat(Dk(r));return sE(i,function(s){Su&&!DC(Ak,r,s)||lE(e,s,r[s])}),e},Ak=function(e){var t=kC(e),r=DC(zJ,this,t);return!(this===Ps&&Xn(qa,t)&&!Xn(Bp,t))&&(!(r||!Xn(this,t)||!Xn(qa,t)||Xn(this,Yi)&&this[Yi][t])||r)},Ok=function(e,t){var r=oE(e),i=kC(t);if(r!==Ps||!Xn(qa,i)||Xn(Bp,i)){var s=wk(r,i);return!s||!Xn(qa,i)||Xn(r,Yi)&&r[Yi][i]||(s.enumerable=!0),s}},Nk=function(e){var t=Ik(oE(e)),r=[];return sE(t,function(i){Xn(qa,i)||Xn(vk,i)||bk(r,i)}),r},Dk=function(e){var t=e===Ps,r=Ik(t?Bp:oE(e)),i=[];return sE(r,function(s){!Xn(qa,s)||t&&!Xn(Ps,s)||bk(i,qa[s])}),i};yu||($l=function(){if(kJ(cE,this))throw KJ("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?LJ(arguments[0]):void 0,t=Tk(e),r=function(i){this===Ps&&DC(r,Bp,i),Xn(this,Yi)&&Xn(this[Yi],t)&&(this[Yi][t]=!1),VC(this,t,LC(1,i))};return Su&&UC&&VC(Ps,t,{configurable:!0,set:r}),FC(t,e)},yk(cE=$l[jp],"toString",function(){return Rk(this).tag}),yk($l,"withoutSetter",function(e){return FC(Tk(e),e)}),Sk.f=Ak,gk.f=lE,UJ.f=jC,Ek.f=Ok,MJ.f=_k.f=Nk,xJ.f=Dk,jJ.f=function(e){return FC(FJ(e),e)},Su&&VJ(cE,"description",{configurable:!0,get:function(){return Rk(this).description}})),iE({global:!0,constructor:!0,wrap:!0,forced:!yu,sham:!yu},{Symbol:$l}),sE(mk(qJ),function(e){BJ(e)}),iE({target:aE,stat:!0,forced:!yu},{useSetter:function(){UC=!0},useSimple:function(){UC=!1}}),iE({target:"Object",stat:!0,forced:!yu,sham:!Su},{create:function(e,t){return t===void 0?Fp(e):jC(Fp(e),t)},defineProperty:lE,defineProperties:jC,getOwnPropertyDescriptor:Ok}),iE({target:"Object",stat:!0,forced:!yu},{getOwnPropertyNames:Nk}),WJ(),GJ($l,aE),vk[Yi]=!0;var Pk=Os&&!!Symbol.for&&!!Symbol.keyFor,YJ=Ut,JJ=jn,XJ=Nr,$J=mo,kk=Gt,QJ=Pk,BC=kk("string-to-symbol-registry"),ZJ=kk("symbol-to-string-registry");YJ({target:"Symbol",stat:!0,forced:!QJ},{for:function(e){var t=$J(e);if(XJ(BC,t))return BC[t];var r=JJ("Symbol")(t);return BC[t]=r,ZJ[r]=t,r}});var eX=Ut,tX=Nr,rX=bc,nX=Ha,iX=Pk,Lk=Gt("symbol-to-string-registry");eX({target:"Symbol",stat:!0,forced:!iX},{keyFor:function(e){if(!rX(e))throw TypeError(nX(e)+" is not a symbol");if(tX(Lk,e))return Lk[e]}});var Mk=Vp,oX=st,xk=pe,sX=mo,Uk=k([].push),aX=Ut,Vk=jn,Fk=q,cX=Ge,Wp=k,jk=_,Bk=st,Wk=bc,Gk=LT,lX=function(e){if(oX(e))return e;if(Mk(e)){for(var t=e.length,r=[],i=0;i<t;i++){var s=e[i];typeof s=="string"?Uk(r,s):typeof s!="number"&&xk(s)!="Number"&&xk(s)!="String"||Uk(r,sX(s))}var c=r.length,l=!0;return function(u,h){if(l)return l=!1,h;if(Mk(this))return h;for(var f=0;f<c;f++)if(r[f]===u)return h}}},dX=Os,uX=String,Vc=Vk("JSON","stringify"),dE=Wp(/./.exec),Hk=Wp("".charAt),hX=Wp("".charCodeAt),pX=Wp("".replace),fX=Wp(1 .toString),mX=/[\uD800-\uDFFF]/g,Kk=/^[\uD800-\uDBFF]$/,zk=/^[\uDC00-\uDFFF]$/,qk=!dX||jk(function(){var e=Vk("Symbol")();return Vc([e])!="[null]"||Vc({a:e})!="{}"||Vc(Object(e))!="{}"}),Yk=jk(function(){return Vc("\uDF06\uD834")!=='"\\udf06\\ud834"'||Vc("\uDEAD")!=='"\\udead"'}),_X=function(e,t){var r=Gk(arguments),i=lX(t);if(Bk(i)||e!==void 0&&!Wk(e))return r[1]=function(s,c){if(Bk(i)&&(c=cX(i,this,uX(s),c)),!Wk(c))return c},Fk(Vc,null,r)},EX=function(e,t,r){var i=Hk(r,t-1),s=Hk(r,t+1);return dE(Kk,e)&&!dE(zk,s)||dE(zk,e)&&!dE(Kk,i)?"\\u"+fX(hX(e,0),16):e};Vc&&aX({target:"JSON",stat:!0,arity:3,forced:qk||Yk},{stringify:function(e,t,r){var i=Gk(arguments),s=Fk(qk?_X:Vc,null,i);return Yk&&typeof s=="string"?pX(s,mX,EX):s}});var Jk=Rp,gX=gi;Ut({target:"Object",stat:!0,forced:!Os||_(function(){Jk.f(1)})},{getOwnPropertySymbols:function(e){var t=Jk.f;return t?t(gX(e)):[]}}),Sn("asyncIterator"),Sn("hasInstance"),Sn("isConcatSpreadable"),Sn("iterator"),Sn("match"),Sn("matchAll"),Sn("replace"),Sn("search"),Sn("species"),Sn("split");var SX=hk;Sn("toPrimitive"),SX();var yX=jn,vX=Lc;Sn("toStringTag"),vX(yX("Symbol"),"Symbol"),Sn("unscopables"),Lc(z.JSON,"JSON",!0);var TX=fo.Symbol,CX=vr,RX=Ko.f,Xk=CX("metadata"),$k=Function.prototype;$k[Xk]===void 0&&RX($k,Xk,{value:null}),Sn("dispose"),Sn("metadata");var wX=TX;Sn("asyncDispose");var IX=k,WC=jn("Symbol"),bX=WC.keyFor,AX=IX(WC.prototype.valueOf),Qk=WC.isRegisteredSymbol||function(e){try{return bX(AX(e))!==void 0}catch{return!1}};Ut({target:"Symbol",stat:!0},{isRegisteredSymbol:Qk});for(var OX=Gt,Zk=jn,NX=k,DX=bc,PX=vr,uE=Zk("Symbol"),e1=uE.isWellKnownSymbol,t1=Zk("Object","getOwnPropertyNames"),kX=NX(uE.prototype.valueOf),r1=OX("wks"),GC=0,n1=t1(uE),LX=n1.length;GC<LX;GC++)try{var i1=n1[GC];DX(uE[i1])&&PX(i1)}catch{}var o1=function(e){if(e1&&e1(e))return!0;try{for(var t=kX(e),r=0,i=t1(r1),s=i.length;r<s;r++)if(r1[i[r]]==t)return!0}catch{}return!1};Ut({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:o1}),Sn("matcher"),Sn("observable"),Ut({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Qk}),Ut({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:o1}),Sn("metadataKey"),Sn("patternMatch"),Sn("replaceAll");var vu=p(wX),s1=p(gu.f("iterator"));function Gp(e){return Gp=typeof vu=="function"&&typeof s1=="symbol"?function(t){return typeof t}:function(t){return t&&typeof vu=="function"&&t.constructor===vu&&t!==vu.prototype?"symbol":typeof t},Gp(e)}var MX=p(gu.f("toPrimitive"));function xX(e){var t=function(r,i){if(Gp(r)!=="object"||r===null)return r;var s=r[MX];if(s!==void 0){var c=s.call(r,i||"default");if(Gp(c)!=="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(r)}(e,"string");return Gp(t)==="symbol"?t:String(t)}function b(e,t,r){return(t=xX(t))in e?ek(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var UX=_,VX=vr("iterator"),HC=!UX(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2"),i="";return e.pathname="c%20d",t.forEach(function(s,c){t.delete("b"),i+=c+s}),r.delete("a",2),!e.toJSON||!r.has("a",1)||r.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[VX]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||i!=="a1c3"||new URL("http://x",void 0).host!=="x"}),FX=kc,KC=Ut,Tu=z,hE=Ge,pa=k,Cu=jr,a1=HC,c1=kc,jX=V_,BX=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:FX(e,i,t[i],r);return e},WX=Lc,GX=IT,zC=Yl,l1=OT,qC=st,HX=Nr,KX=Dc,zX=la,qX=Si,d1=_i,Li=mo,YX=wp,u1=tn,YC=_T,JX=N_,Ru=j_,XX=yP,$X=vr("iterator"),Hp="URLSearchParams",h1=Hp+"Iterator",p1=zC.set,Yo=zC.getterFor(Hp),QX=zC.getterFor(h1),ZX=Object.getOwnPropertyDescriptor,JC=function(e){if(!Cu)return Tu[e];var t=ZX(Tu,e);return t&&t.value},f1=JC("fetch"),pE=JC("Request"),Kp=JC("Headers"),XC=pE&&pE.prototype,m1=Kp&&Kp.prototype,e$=Tu.RegExp,t$=Tu.TypeError,_1=Tu.decodeURIComponent,r$=Tu.encodeURIComponent,n$=pa("".charAt),E1=pa([].join),Zl=pa([].push),$C=pa("".replace),i$=pa([].shift),g1=pa([].splice),S1=pa("".split),o$=pa("".slice),s$=/\+/g,y1=Array(4),a$=function(e){return y1[e-1]||(y1[e-1]=e$("((?:%[\\da-f]{2}){"+e+"})","gi"))},c$=function(e){try{return _1(e)}catch{return e}},v1=function(e){var t=$C(e,s$," "),r=4;try{return _1(t)}catch{for(;r;)t=$C(t,a$(r--),c$);return t}},l$=/[!'()~]|%20/g,d$={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},u$=function(e){return d$[e]},T1=function(e){return $C(r$(e),l$,u$)},QC=GX(function(e,t){p1(this,{type:h1,iterator:YC(Yo(e).entries),kind:t})},"Iterator",function(){var e=QX(this),t=e.kind,r=e.iterator.next(),i=r.value;return r.done||(r.value=t==="keys"?i.key:t==="values"?i.value:[i.key,i.value]),r},!0),C1=function(e){this.entries=[],this.url=null,e!==void 0&&(d1(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?n$(e,0)==="?"?o$(e,1):e:Li(e)))};C1.prototype={type:Hp,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,i,s,c,l,u,h=JX(e);if(h)for(r=(t=YC(e,h)).next;!(i=hE(r,t)).done;){if(c=(s=YC(qX(i.value))).next,(l=hE(c,s)).done||(u=hE(c,s)).done||!hE(c,s).done)throw t$("Expected sequence with length 2");Zl(this.entries,{key:Li(l.value),value:Li(u.value)})}else for(var f in e)HX(e,f)&&Zl(this.entries,{key:f,value:Li(e[f])})},parseQuery:function(e){if(e)for(var t,r,i=S1(e,"&"),s=0;s<i.length;)(t=i[s++]).length&&(r=S1(t,"="),Zl(this.entries,{key:v1(i$(r)),value:v1(E1(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],i=0;i<t.length;)e=t[i++],Zl(r,T1(e.key)+"="+T1(e.value));return E1(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var fE=function(){l1(this,wu);var e=p1(this,new C1(arguments.length>0?arguments[0]:void 0));Cu||(this.size=e.entries.length)},wu=fE.prototype;if(BX(wu,{append:function(e,t){var r=Yo(this);Ru(arguments.length,2),Zl(r.entries,{key:Li(e),value:Li(t)}),Cu||this.length++,r.updateURL()},delete:function(e){for(var t=Yo(this),r=Ru(arguments.length,1),i=t.entries,s=Li(e),c=r<2?void 0:arguments[1],l=c===void 0?c:Li(c),u=0;u<i.length;){var h=i[u];if(h.key!==s||l!==void 0&&h.value!==l)u++;else if(g1(i,u,1),l!==void 0)break}Cu||(this.size=i.length),t.updateURL()},get:function(e){var t=Yo(this).entries;Ru(arguments.length,1);for(var r=Li(e),i=0;i<t.length;i++)if(t[i].key===r)return t[i].value;return null},getAll:function(e){var t=Yo(this).entries;Ru(arguments.length,1);for(var r=Li(e),i=[],s=0;s<t.length;s++)t[s].key===r&&Zl(i,t[s].value);return i},has:function(e){for(var t=Yo(this).entries,r=Ru(arguments.length,1),i=Li(e),s=r<2?void 0:arguments[1],c=s===void 0?s:Li(s),l=0;l<t.length;){var u=t[l++];if(u.key===i&&(c===void 0||u.value===c))return!0}return!1},set:function(e,t){var r=Yo(this);Ru(arguments.length,1);for(var i,s=r.entries,c=!1,l=Li(e),u=Li(t),h=0;h<s.length;h++)(i=s[h]).key===l&&(c?g1(s,h--,1):(c=!0,i.value=u));c||Zl(s,{key:l,value:u}),Cu||(this.size=s.length),r.updateURL()},sort:function(){var e=Yo(this);XX(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=Yo(this).entries,i=KX(e,arguments.length>1?arguments[1]:void 0),s=0;s<r.length;)i((t=r[s++]).value,t.key,this)},keys:function(){return new QC(this,"keys")},values:function(){return new QC(this,"values")},entries:function(){return new QC(this,"entries")}},{enumerable:!0}),c1(wu,$X,wu.entries,{name:"entries"}),c1(wu,"toString",function(){return Yo(this).serialize()},{enumerable:!0}),Cu&&jX(wu,"size",{get:function(){return Yo(this).entries.length},configurable:!0,enumerable:!0}),WX(fE,Hp),KC({global:!0,constructor:!0,forced:!a1},{URLSearchParams:fE}),!a1&&qC(Kp)){var h$=pa(m1.has),p$=pa(m1.set),R1=function(e){if(d1(e)){var t,r=e.body;if(zX(r)===Hp)return t=e.headers?new Kp(e.headers):new Kp,h$(t,"content-type")||p$(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),YX(e,{body:u1(0,Li(r)),headers:u1(0,t)})}return e};if(qC(f1)&&KC({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return f1(e,arguments.length>1?R1(arguments[1]):{})}}),qC(pE)){var ZC=function(e){return l1(this,XC),new pE(e,arguments.length>1?R1(arguments[1]):{})};XC.constructor=ZC,ZC.prototype=XC,KC({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:ZC})}}var f$={URLSearchParams:fE,getState:Yo},w1=p(fo.URLSearchParams),m$={isBrowser:!0,classes:{URLSearchParams:w1!==void 0?w1:OC,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let I1=typeof window<"u"&&typeof document<"u",_$=(b1=typeof navigator<"u"&&navigator.product,I1&&["ReactNative","NativeScript","NS"].indexOf(b1)<0);var b1;let E$=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function A1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function O1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?A1(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var fa=O1(O1({},Object.freeze({__proto__:null,hasBrowserEnv:I1,hasStandardBrowserEnv:_$,hasStandardBrowserWebWorkerEnv:E$})),m$),g$=Si,S$=Ge,y$=Nr,v$=M,T$=function(){var e=g$(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},N1=RegExp.prototype,D1=function(e){var t=e.flags;return t!==void 0||"flags"in N1||y$(e,"flags")||!v$(N1,e)?t:S$(T$,e)},C$=sC.charAt,P1=Ge,R$=Si,w$=st,I$=pe,b$=/./.exec,A$=TypeError,O$=Ut,k1=Ge,L1=je,N$=IT,mE=AT,M1=Ic,x1=AO,zp=mo,D$=Si,P$=En,k$=pe,L$=NO,U1=D1,M$=he,x$=_,U$=kT,V$=function(e,t,r){return t+(r?C$(e,t).length:1)},F$=function(e,t){var r=e.exec;if(w$(r)){var i=P1(r,e,t);return i!==null&&R$(i),i}if(I$(e)==="RegExp")return P1(b$,e,t);throw A$("RegExp#exec called on incompatible receiver")},V1=Yl,j$=vr("matchAll"),F1="RegExp String",j1=F1+" Iterator",B$=V1.set,W$=V1.getterFor(j1),G$=TypeError,eR=L1("".indexOf),_E=L1("".matchAll),tR=!!_E&&!x$(function(){_E("a",/./)}),H$=N$(function(e,t,r,i){B$(this,{type:j1,regexp:e,string:t,global:r,unicode:i,done:!1})},F1,function(){var e=W$(this);if(e.done)return mE(void 0,!0);var t=e.regexp,r=e.string,i=F$(t,r);return i===null?(e.done=!0,mE(void 0,!0)):e.global?(zp(i[0])===""&&(t.lastIndex=V$(r,x1(t.lastIndex),e.unicode)),mE(i,!1)):(e.done=!0,mE(i,!1))}),B1=function(e){var t,r,i,s=D$(this),c=zp(e),l=U$(s,RegExp),u=zp(U1(s));return t=new l(l===RegExp?s.source:s,u),r=!!~eR(u,"g"),i=!!~eR(u,"u"),t.lastIndex=x1(s.lastIndex),new H$(t,c,r,i)};O$({target:"String",proto:!0,forced:tR},{matchAll:function(e){var t,r,i,s,c=M1(this);if(P$(e)){if(tR)return _E(c,e)}else{if(L$(e)&&(t=zp(M1(U1(e))),!~eR(t,"g")))throw G$("`.matchAll` does not allow non-global regexes");if(tR)return _E(c,e);if((i=M$(e,j$))===void 0&&k$(e)=="RegExp"&&(i=B1),i)return k1(i,e,c)}return r=zp(c),s=new RegExp(e,"g"),k1(B1,s,r)}});var K$=zo("String").matchAll,z$=M,q$=K$,rR=String.prototype,Y$=function(e){var t=e.matchAll;return typeof e=="string"||e===rR||z$(rR,e)&&t===rR.matchAll?q$:t},J$=p(Y$);function W1(e){function t(r,i,s,c){let l=r[c++];if(l==="__proto__")return!0;let u=Number.isFinite(+l),h=c>=r.length;return l=!l&&Ce.isArray(s)?s.length:l,h?(Ce.hasOwnProp(s,l)?s[l]=[s[l],i]:s[l]=i,!u):(s[l]&&Ce.isObject(s[l])||(s[l]=[]),t(r,i,s[l],c)&&Ce.isArray(s[l])&&(s[l]=function(f){let m={},E=Object.keys(f),S,y=E.length,A;for(S=0;S<y;S++)A=E[S],m[A]=f[A];return m}(s[l])),!u)}if(Ce.isFormData(e)&&Ce.isFunction(e.entries)){let r={};return Ce.forEachEntry(e,(i,s)=>{t(function(c){return J$(Ce).call(Ce,/\w+|\[(\w*)]/g,c).map(l=>l[0]==="[]"?"":l[1]||l[0])}(i),s,r,0)}),r}return null}let nR={transitional:XP,adapter:["xhr","http"],transformRequest:[function(e,t){let r=t.getContentType()||"",i=r.indexOf("application/json")>-1,s=Ce.isObject(e);if(s&&Ce.isHTMLForm(e)&&(e=new FormData(e)),Ce.isFormData(e))return i?JSON.stringify(W1(e)):e;if(Ce.isArrayBuffer(e)||Ce.isBuffer(e)||Ce.isStream(e)||Ce.isFile(e)||Ce.isBlob(e))return e;if(Ce.isArrayBufferView(e))return e.buffer;if(Ce.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(s){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(l,u){return nE(l,new fa.classes.URLSearchParams,Object.assign({visitor:function(h,f,m,E){return fa.isNode&&Ce.isBuffer(h)?(this.append(f,h.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},u))}(e,this.formSerializer).toString();if((c=Ce.isFileList(e))||r.indexOf("multipart/form-data")>-1){let l=this.env&&this.env.FormData;return nE(c?{"files[]":e}:e,l&&new l,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),function(l,u,h){if(Ce.isString(l))try{return(u||JSON.parse)(l),Wn(Ce).call(Ce,l)}catch(f){if(f.name!=="SyntaxError")throw f}return(0,JSON.stringify)(l)}(e)):e}],transformResponse:[function(e){let t=this.transitional||nR.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&Ce.isString(e)&&(r&&!this.responseType||i)){let s=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(c){if(s)throw c.name==="SyntaxError"?tr.from(c,tr.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:fa.classes.FormData,Blob:fa.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ce.forEach(["delete","get","head","post","put","patch"],e=>{nR.headers[e]={}});var iR=nR;let X$=Ce.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),G1=Symbol("internals");function qp(e){var t;return e&&Wn(t=String(e)).call(t).toLowerCase()}function EE(e){return e===!1||e==null?e:Ce.isArray(e)?e.map(EE):String(e)}function oR(e,t,r,i,s){return Ce.isFunction(i)?i.call(this,t,r):(s&&(t=r),Ce.isString(t)?Ce.isString(i)?t.indexOf(i)!==-1:Ce.isRegExp(i)?i.test(t):void 0:void 0)}class gE{constructor(t){t&&this.set(t)}set(t,r,i){let s=this;function c(h,f,m){let E=qp(f);if(!E)throw new Error("header name must be a non-empty string");let S=Ce.findKey(s,E);(!S||s[S]===void 0||m===!0||m===void 0&&s[S]!==!1)&&(s[S||f]=EE(h))}let l=(h,f)=>Ce.forEach(h,(m,E)=>c(m,E,f));var u;return Ce.isPlainObject(t)||t instanceof this.constructor?l(t,r):Ce.isString(t)&&(t=Wn(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Wn(u=t).call(u))?l((h=>{let f={},m,E,S;return h&&h.split(`
`).forEach(function(y){var A,T;S=y.indexOf(":"),m=Wn(A=y.substring(0,S)).call(A).toLowerCase(),E=Wn(T=y.substring(S+1)).call(T),!m||f[m]&&X$[m]||(m==="set-cookie"?f[m]?f[m].push(E):f[m]=[E]:f[m]=f[m]?f[m]+", "+E:E)}),f})(t),r):t!=null&&c(r,t,i),this}get(t,r){if(t=qp(t)){let i=Ce.findKey(this,t);if(i){let s=this[i];if(!r)return s;if(r===!0)return function(c){let l=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,h;for(;h=u.exec(c);)l[h[1]]=h[2];return l}(s);if(Ce.isFunction(r))return r.call(this,s,i);if(Ce.isRegExp(r))return r.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=qp(t)){let i=Ce.findKey(this,t);return!(!i||this[i]===void 0||r&&!oR(0,this[i],i,r))}return!1}delete(t,r){let i=this,s=!1;function c(l){if(l=qp(l)){let u=Ce.findKey(i,l);!u||r&&!oR(0,i[u],u,r)||(delete i[u],s=!0)}}return Ce.isArray(t)?t.forEach(c):c(t),s}clear(t){let r=Object.keys(this),i=r.length,s=!1;for(;i--;){let c=r[i];t&&!oR(0,this[c],c,t,!0)||(delete this[c],s=!0)}return s}normalize(t){let r=this,i={};return Ce.forEach(this,(s,c)=>{var l;let u=Ce.findKey(i,c);if(u)return r[u]=EE(s),void delete r[c];let h=t?function(f){return Wn(f).call(f).toLowerCase().replace(/([a-z\d])(\w*)/g,(m,E,S)=>E.toUpperCase()+S)}(c):Wn(l=String(c)).call(l);h!==c&&delete r[c],r[h]=EE(s),i[h]=!0}),this}concat(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.constructor.concat(this,...r)}toJSON(t){let r=Object.create(null);return Ce.forEach(this,(i,s)=>{i!=null&&i!==!1&&(r[s]=t&&Ce.isArray(i)?i.join(", "):i)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[r,i]=t;return r+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let r=new this(t);for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];return s.forEach(l=>r.set(l)),r}static accessor(t){let r=(this[G1]=this[G1]={accessors:{}}).accessors,i=this.prototype;function s(c){let l=qp(c);r[l]||(function(u,h){let f=Ce.toCamelCase(" "+h);["get","set","has"].forEach(m=>{Object.defineProperty(u,m+f,{value:function(E,S,y){return this[m].call(this,h,E,S,y)},configurable:!0})})}(i,c),r[l]=!0)}return Ce.isArray(t)?t.forEach(s):s(t),this}}gE.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ce.reduceDescriptors(gE.prototype,(e,t)=>{let{value:r}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(s){this[i]=s}}}),Ce.freezeMethods(gE);var Ya=gE;function sR(e,t){let r=this||iR,i=t||r,s=Ya.from(i.headers),c=i.data;return Ce.forEach(e,function(l){c=l.call(r,c,s.normalize(),t?t.status:void 0)}),s.normalize(),c}function H1(e){return!(!e||!e.__CANCEL__)}function Yp(e,t,r){tr.call(this,e??"canceled",tr.ERR_CANCELED,t,r),this.name="CanceledError"}Ce.inherits(Yp,tr,{__CANCEL__:!0});var $$=fa.hasStandardBrowserEnv?{write(e,t,r,i,s,c){let l=[e+"="+encodeURIComponent(t)];Ce.isNumber(r)&&l.push("expires="+new Date(r).toGMTString()),Ce.isString(i)&&l.push("path="+i),Ce.isString(s)&&l.push("domain="+s),c===!0&&l.push("secure"),document.cookie=l.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function K1(e,t){return e&&!function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}(t)?function(r,i){return i?r.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):r}(e,t):t}var Q$=fa.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),r;function i(s){let c=s;return e&&(t.setAttribute("href",c),c=t.href),t.setAttribute("href",c),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=i(window.location.href),function(s){let c=Ce.isString(s)?i(s):s;return c.protocol===r.protocol&&c.host===r.host}}():function(){return!0};function z1(e,t){let r=0,i=function(s,c){s=s||10;let l=new Array(s),u=new Array(s),h,f=0,m=0;return c=c!==void 0?c:1e3,function(E){let S=Date.now(),y=u[m];h||(h=S),l[f]=E,u[f]=S;let A=m,T=0;for(;A!==f;)T+=l[A++],A%=s;if(f=(f+1)%s,f===m&&(m=(m+1)%s),S-h<c)return;let w=y&&S-y;return w?Math.round(1e3*T/w):void 0}}(50,250);return s=>{let c=s.loaded,l=s.lengthComputable?s.total:void 0,u=c-r,h=i(u);r=c;let f={loaded:c,total:l,progress:l?c/l:void 0,bytes:u,rate:h||void 0,estimated:h&&l&&c<=l?(l-c)/h:void 0,event:s};f[t?"download":"upload"]=!0,e(f)}}var Z$=typeof XMLHttpRequest<"u"&&function(e){return new _e(function(t,r){let i=e.data,s=Ya.from(e.headers).normalize(),c,l,{responseType:u,withXSRFToken:h}=e;function f(){e.cancelToken&&e.cancelToken.unsubscribe(c),e.signal&&e.signal.removeEventListener("abort",c)}if(Ce.isFormData(i)){if(fa.hasStandardBrowserEnv||fa.hasStandardBrowserWebWorkerEnv)s.setContentType(!1);else if((l=s.getContentType())!==!1){let[A,...T]=l?l.split(";").map(w=>Wn(w).call(w)).filter(Boolean):[];s.setContentType([A||"multipart/form-data",...T].join("; "))}}let m=new XMLHttpRequest;if(e.auth){let A=e.auth.username||"",T=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";s.set("Authorization","Basic "+btoa(A+":"+T))}let E=K1(e.baseURL,e.url);function S(){if(!m)return;let A=Ya.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());(function(T,w,O){let P=O.config.validateStatus;O.status&&P&&!P(O.status)?w(new tr("Request failed with status code "+O.status,[tr.ERR_BAD_REQUEST,tr.ERR_BAD_RESPONSE][Math.floor(O.status/100)-4],O.config,O.request,O)):T(O)})(function(T){t(T),f()},function(T){r(T),f()},{data:u&&u!=="text"&&u!=="json"?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:A,config:e,request:m}),m=null}if(m.open(e.method.toUpperCase(),YP(E,e.params,e.paramsSerializer),!0),m.timeout=e.timeout,"onloadend"in m?m.onloadend=S:m.onreadystatechange=function(){m&&m.readyState===4&&(m.status!==0||m.responseURL&&m.responseURL.indexOf("file:")===0)&&setTimeout(S)},m.onabort=function(){m&&(r(new tr("Request aborted",tr.ECONNABORTED,e,m)),m=null)},m.onerror=function(){r(new tr("Network Error",tr.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let A=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",T=e.transitional||XP;e.timeoutErrorMessage&&(A=e.timeoutErrorMessage),r(new tr(A,T.clarifyTimeoutError?tr.ETIMEDOUT:tr.ECONNABORTED,e,m)),m=null},fa.hasStandardBrowserEnv&&(h&&Ce.isFunction(h)&&(h=h(e)),h||h!==!1&&Q$(E))){let A=e.xsrfHeaderName&&e.xsrfCookieName&&$$.read(e.xsrfCookieName);A&&s.set(e.xsrfHeaderName,A)}i===void 0&&s.setContentType(null),"setRequestHeader"in m&&Ce.forEach(s.toJSON(),function(A,T){m.setRequestHeader(T,A)}),Ce.isUndefined(e.withCredentials)||(m.withCredentials=!!e.withCredentials),u&&u!=="json"&&(m.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&m.addEventListener("progress",z1(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&m.upload&&m.upload.addEventListener("progress",z1(e.onUploadProgress)),(e.cancelToken||e.signal)&&(c=A=>{m&&(r(!A||A.type?new Yp(null,e,m):A),m.abort(),m=null)},e.cancelToken&&e.cancelToken.subscribe(c),e.signal&&(e.signal.aborted?c():e.signal.addEventListener("abort",c)));let y=function(A){let T=/^([-+\w]{1,25})(:?\/\/|:)/.exec(A);return T&&T[1]||""}(E);y&&fa.protocols.indexOf(y)===-1?r(new tr("Unsupported protocol "+y+":",tr.ERR_BAD_REQUEST,e)):m.send(i||null)})};let aR={http:null,xhr:Z$};Ce.forEach(aR,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let q1=e=>"- ".concat(e),eQ=e=>Ce.isFunction(e)||e===null||e===!1;var Y1={getAdapter:e=>{e=Ce.isArray(e)?e:[e];let{length:t}=e,r,i,s={};for(let c=0;c<t;c++){let l;if(r=e[c],i=r,!eQ(r)&&(i=aR[(l=String(r)).toLowerCase()],i===void 0))throw new tr("Unknown adapter '".concat(l,"'"));if(i)break;s[l||"#"+c]=i}if(!i){let c=Object.entries(s).map(l=>{let[u,h]=l;return"adapter ".concat(u," ")+(h===!1?"is not supported by the environment":"is not available in the build")});throw new tr("There is no suitable adapter to dispatch the request "+(t?c.length>1?`since :
`+c.map(q1).join(`
`):" "+q1(c[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:aR};function cR(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Yp(null,e)}function J1(e){return cR(e),e.headers=Ya.from(e.headers),e.data=sR.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Y1.getAdapter(e.adapter||iR.adapter)(e).then(function(t){return cR(e),t.data=sR.call(e,e.transformResponse,t),t.headers=Ya.from(t.headers),t},function(t){return H1(t)||(cR(e),t&&t.response&&(t.response.data=sR.call(e,e.transformResponse,t.response),t.response.headers=Ya.from(t.response.headers))),_e.reject(t)})}function X1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}let $1=e=>e instanceof Ya?function(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?X1(Object(i),!0).forEach(function(s){b(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):X1(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}({},e):e;function Iu(e,t){t=t||{};let r={};function i(f,m,E){return Ce.isPlainObject(f)&&Ce.isPlainObject(m)?Ce.merge.call({caseless:E},f,m):Ce.isPlainObject(m)?Ce.merge({},m):Ce.isArray(m)?m.slice():m}function s(f,m,E){return Ce.isUndefined(m)?Ce.isUndefined(f)?void 0:i(void 0,f,E):i(f,m,E)}function c(f,m){if(!Ce.isUndefined(m))return i(void 0,m)}function l(f,m){return Ce.isUndefined(m)?Ce.isUndefined(f)?void 0:i(void 0,f):i(void 0,m)}function u(f,m,E){return E in t?i(f,m):E in e?i(void 0,f):void 0}let h={url:c,method:c,data:c,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(f,m)=>s($1(f),$1(m),!0)};return Ce.forEach(Object.keys(Object.assign({},e,t)),function(f){let m=h[f]||s,E=m(e[f],t[f],f);Ce.isUndefined(E)&&m!==u||(r[f]=E)}),r}let Q1="1.6.8",lR={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{lR[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});let Z1={};lR.transitional=function(e,t,r){function i(s,c){return"[Axios v"+Q1+"] Transitional option '"+s+"'"+c+(r?". "+r:"")}return(s,c,l)=>{if(e===!1)throw new tr(i(c," has been removed"+(t?" in "+t:"")),tr.ERR_DEPRECATED);return t&&!Z1[c]&&(Z1[c]=!0,console.warn(i(c," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,c,l)}};var dR={assertOptions:function(e,t,r){if(typeof e!="object")throw new tr("options must be an object",tr.ERR_BAD_OPTION_VALUE);let i=Object.keys(e),s=i.length;for(;s-- >0;){let c=i[s],l=t[c];if(l){let u=e[c],h=u===void 0||l(u,c,e);if(h!==!0)throw new tr("option "+c+" must be "+h,tr.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new tr("Unknown option "+c,tr.ERR_BAD_OPTION)}},validators:lR};let Fc=dR.validators,SE=class{constructor(e){this.defaults=e,this.interceptors={request:new JP,response:new JP}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;let s=i.stack?i.stack.replace(/^.+\n/,""):"";r.stack?s&&!String(r.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+s):r.stack=s}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Iu(this.defaults,t);let{transitional:r,paramsSerializer:i,headers:s}=t;r!==void 0&&dR.assertOptions(r,{silentJSONParsing:Fc.transitional(Fc.boolean),forcedJSONParsing:Fc.transitional(Fc.boolean),clarifyTimeoutError:Fc.transitional(Fc.boolean)},!1),i!=null&&(Ce.isFunction(i)?t.paramsSerializer={serialize:i}:dR.assertOptions(i,{encode:Fc.function,serialize:Fc.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let c=s&&Ce.merge(s.common,s[t.method]);s&&Ce.forEach(["delete","get","head","post","put","patch","common"],y=>{delete s[y]}),t.headers=Ya.concat(c,s);let l=[],u=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(u=u&&y.synchronous,l.unshift(y.fulfilled,y.rejected))});let h=[],f;this.interceptors.response.forEach(function(y){h.push(y.fulfilled,y.rejected)});let m,E=0;if(!u){let y=[J1.bind(this),void 0];for(y.unshift.apply(y,l),y.push.apply(y,h),m=y.length,f=_e.resolve(t);E<m;)f=f.then(y[E++],y[E++]);return f}m=l.length;let S=t;for(E=0;E<m;){let y=l[E++],A=l[E++];try{S=y(S)}catch(T){A.call(this,T);break}}try{f=J1.call(this,S)}catch(y){return _e.reject(y)}for(E=0,m=h.length;E<m;)f=f.then(h[E++],h[E++]);return f}getUri(e){return YP(K1((e=Iu(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};Ce.forEach(["delete","get","head","options"],function(e){SE.prototype[e]=function(t,r){return this.request(Iu(r||{},{method:e,url:t,data:(r||{}).data}))}}),Ce.forEach(["post","put","patch"],function(e){function t(r){return function(i,s,c){return this.request(Iu(c||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:s}))}}SE.prototype[e]=t(),SE.prototype[e+"Form"]=t(!0)});var yE=SE;class uR{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new _e(function(s){r=s});let i=this;this.promise.then(s=>{if(!i._listeners)return;let c=i._listeners.length;for(;c-- >0;)i._listeners[c](s);i._listeners=null}),this.promise.then=s=>{let c,l=new _e(u=>{i.subscribe(u),c=u}).then(s);return l.cancel=function(){i.unsubscribe(c)},l},t(function(s,c,l){i.reason||(i.reason=new Yp(s,c,l),r(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}static source(){let t;return{token:new uR(function(r){t=r}),cancel:t}}}var tQ=uR;let hR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(hR).forEach(e=>{let[t,r]=e;hR[r]=t});var rQ=hR;let kn=function e(t){let r=new yE(t),i=PP(yE.prototype.request,r);return Ce.extend(i,yE.prototype,r,{allOwnKeys:!0}),Ce.extend(i,r,null,{allOwnKeys:!0}),i.create=function(s){return e(Iu(t,s))},i}(iR);kn.Axios=yE,kn.CanceledError=Yp,kn.CancelToken=tQ,kn.isCancel=H1,kn.VERSION=Q1,kn.toFormData=nE,kn.AxiosError=tr,kn.Cancel=kn.CanceledError,kn.all=function(e){return _e.all(e)},kn.spread=function(e){return function(t){return e.apply(null,t)}},kn.isAxiosError=function(e){return Ce.isObject(e)&&e.isAxiosError===!0},kn.mergeConfig=Iu,kn.AxiosHeaders=Ya,kn.formToJSON=e=>W1(Ce.isHTMLForm(e)?new FormData(e):e),kn.getAdapter=Y1.getAdapter,kn.HttpStatusCode=rQ,kn.default=kn;var si=kn;let nQ=()=>{};function Jp(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:nQ};return e.promise=new _e((t,r)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(i))}}),e}let vE=new Map,TE=new Map,ma=new Map,Yr=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),yt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),eL=new RY,ks=eL.getResult(),pR=null;function dt(e){if(!pR){ks=eL.getResult();let t=function(u){if(u.engine.name==="Blink"&&u.browser.name!=="WeChat")return yt.CHROME;switch(u.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return yt.CHROME;case"Safari":case"Mobile Safari":return yt.SAFARI;case"Edge":return yt.EDGE;case"Firefox":return yt.FIREFOX;case"QQ":case"QQBrowser":return yt.QQ;case"Opera":return yt.OPERA;case"WeChat":return yt.WECHAT;default:return u.browser.name||""}}(ks),r=tL(ks),i=function(u){return u.os.name==="Windows"?u.os.version?u.os.name+" "+u.os.version:u.os.name:u.os.name||""}(ks),s=ks.os.version,c=tL(ks,!1),l=ks.device.type;if(!(t&&r&&i&&s))return{name:t,version:r,os:i,osVersion:s,browserVersion:c,deviceType:l};pR={name:t,version:r,os:i,osVersion:s,browserVersion:c,deviceType:l}}return pR}function tL(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function CE(){return dt().os}function rL(){let e=dt();return"".concat(e.os," ").concat(e.osVersion)}function RE(){let e=dt();return!!(ks.engine.name==="WebKit"&&e.os===Yr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==yt.SAFARI||bn()&&e.name!==yt.SAFARI)}function jc(){return dt().name===yt.CHROME}function Jr(){return dt().name===yt.SAFARI}function nL(){return dt().name===yt.EDGE}function Dt(){return dt().name===yt.FIREFOX}function bn(){return dt().os===Yr.IOS}function fR(e){let t=dt();return!(t.name!==yt.CHROME||!t.osVersion)&&Number(t.version)>=e}function iL(e){let t=dt();return!(t.name!==yt.EDGE||!t.osVersion)&&Number(t.version)>=e}function oL(e){let t=dt();return!(t.name!==yt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function sL(e,t,r){let i=dt();if(i.os!==Yr.IOS||!i.osVersion)return!1;let s=i.osVersion.split(".");return t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e}function aL(e,t,r){let i=dt();if(i.name!==yt.SAFARI||!i.osVersion||!i.browserVersion)return!1;let s=i.browserVersion.split(".");return t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e}function cL(e){let t=dt();return!(t.name!==yt.OPERA||!t.osVersion)&&Number(t.version)>=e}function lL(){let e=dt();return!(e.name!==yt.CHROME||!e.osVersion)&&Number(e.version)<=90}function dL(){let e=dt();if(e.os!==Yr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function bu(){let e=dt();if(e.os!==Yr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function mR(){let e=dt();if(e.os!==Yr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function uL(){let e=dt();if(e.os!==Yr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Jo(){return Jr()&&navigator.maxTouchPoints>0}function hL(){return dt().name===yt.WECHAT}function pL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function _R(){let e=CE();return function(){let{deviceType:t}=dt();return t==="mobile"||t==="tablet"}()||e===Yr.ANDROID||e===Yr.IOS||e===Yr.HARMONY_OS}function Bc(){let e=dt();return e.name!==yt.EDGE&&e.name!==yt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function wE(){return CE()===Yr.ANDROID}function Xp(){let e=dt();return wE()&&(e.name===yt.CHROME||e.name===yt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function fL(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function Ae(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fL(Object(r),!0).forEach(function(i){zt(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fL(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function zt(e,t,r){return(t=function(i){var s=function(c,l){if(typeof c!="object"||c===null)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var h=u.call(c,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof s=="symbol"?s:String(s)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let N=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({});class ee extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),zt(this,"code",void 0),zt(this,"message",void 0),zt(this,"data",void 0),zt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}}function Ja(e,t){if(typeof e!="boolean")throw new ee(N.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Gr(e,t,r){if(!ge(r).call(r,e))throw new ee(N.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function At(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(s){return typeof s=="number"&&s%1==0}(e))throw new ee(N.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(i,"]. integer only"))}function ER(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new ee(N.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&At(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&At(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&At(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&At(e.ideal,"".concat(t,".ideal"),1,1/0)}else At(e,t,1,1/0)}function dn(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new ee(N.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!mL(e,r,i,s))throw new ee(N.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(i,"].").concat(s?" ASCII characters only.":""))}function Xa(e,t){if(!Array.isArray(e))throw new ee(N.INVALID_PARAMS,"".concat(t," should be an array"))}function or(e){return e==null}function mL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!i||function(s){if(typeof s!="string")return!1;for(let c=0;c<s.length;c+=1){let l=s.charCodeAt(c);if(l<0||l>255)return!1}return!0}(e))}function _L(e,t,r){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,r);let i=e.getUint32(t,r),s=e.getUint32(t+4,r),c=+!!r,l=+!r;return BigInt(i*l+s*c)<<BigInt(32)|BigInt(i*c+s*l)}function EL(e,t,r,i){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,r,i);let s=Number(r>>BigInt(32)),c=Number(r&BigInt(4294967295));e.setUint32(t,s,i),e.setUint32(t+4,c,i)}var $p=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}($p||{}),gR=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(gR||{});let gL=new class{constructor(){zt(this,"_clientSize",null),zt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),zt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),zt(this,"getStyle",e=>window.getComputedStyle(e,null)),zt(this,"checkCssVisibleProperty",e=>{var t;let r=!0,i=this.getStyle(e),{display:s,visibility:c,opacity:l,filter:u}=i;return(s==="none"||ge(t=["hidden","collapse"]).call(t,c)||Number(l)<.1)&&(r=!1),!!r&&(u&&u.split(" ").filter(h=>{var f;let m=h.split("(")[0];return ge(f=["brightness","blur","opacity"]).call(f,m)}).map(h=>{let[f,m]=h.split(/\(|\)/);return[f,Number(m.match(/^[0-9\.]+/))]}).forEach(h=>{let[f,m]=h;switch(f){case"brightness":(m<.1||m>3)&&(r=!1);break;case"blur":m>3&&(r=!1);break;case"opacity":m<.1&&(r=!1)}}),r)}),zt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,i=!0,s=l=>t(l),c=e;for(;c&&i;)s(c)||(r=!1,i=!1),c=c.parentElement,c||(i=!1);return r}),zt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),zt(this,"getSizeAboutClient",e=>{let{width:t,height:r,left:i,right:s,top:c,bottom:l}=e.getBoundingClientRect(),u=this.getClientWidth(),h=this.getClientHeight();return{width:t,height:r,left:i,right:s,top:c,bottom:l,clientWidth:u,clientHeight:h,clientMin:Math.min(u,h)}}),zt(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),zt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),zt(this,"checkCoverForAPoint",(e,t,r)=>{let i=this.elementFromPoint(e,t);return i!==null&&i!==r}),zt(this,"getPointPositionList",()=>{let{width:e,height:t,left:r,top:i}=this._clientSize,s=e/6,c=t/6,l=[],u=10**6;for(let h=0;h<5;h++)for(let f=0;f<5;f++){let m=(r*u+(h===0?.1:h===4?(s*h*u-1e5)/u:s*h)*u)/u,E=(i*u+(f===0?.1:f===4?(c*f*u-1e5)/u:c*f)*u)/u;l.push({x:m,y:E})}return[...l]}),zt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),zt(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),zt(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:r,bottom:i,clientHeight:s,clientWidth:c,clientMin:l}=this._clientSize,u,h,f,m;if(e<0)u=0;else{if(!(e<c))return!1;u=e}if(t<0)return!1;if(h=t<c?t:c,r<0)f=0;else{if(!(r<s))return!1;f=r}if(i<0)return!1;m=i<s?i:s;let E=h-u,S=m-f;return this.checkSizeIsVisible(E,S,l)}),zt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),zt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult($p.COVERED);{let t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult($p.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult($p.SIZE)}}return this.returnHiddenResult($p.STYLE)}return this.returnHiddenResult(gR.UNMOUNTED)}return this.returnHiddenResult(gR.INVALID_HTML_ELEMENT)}),zt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function SR(e){return new TextEncoder().encode(e)}let SL=function(e,t){let r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},yR=async e=>function(t,r){let i="";return new Uint8Array(t).forEach(s=>{i+=s.toString(r).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",SR(e)),16),Jt=class{constructor(){zt(this,"_events",{}),zt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let r=this._events[e],i=this._indexOfListener(r,t);i!==-1&&r.splice(i,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(c=>c);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];for(let c=0;c<t.length;c+=1){let l=t[c];l.once&&this.off(e,l.listener),l.listener.apply(this,i||[])}}safeEmit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];[...this._events[e]||[]].forEach(s=>{s.once&&this.off(e,s.listener);try{s.listener.apply(this,r)}catch(c){console.error("safeEmit event:".concat(e," error ").concat(c==null?void 0:c.toString()))}})}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return-1}},Qp=null;function yL(){if(Qp)return Qp;if(window.electron)return Qp=window.electron;if(!window.require)return null;try{return Qp=window.require("electron"),Qp}catch{return null}}let Pr=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),sr=function(e){return e.TRACER="tracer",e}({});function vL(e){return At(e.timeout,"config.timeout",0,1e5),At(e.timeoutFactor,"config.timeoutFactor",0,100,!1),At(e.maxRetryCount,"config.maxRetryConfig",0,1/0),At(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let iQ=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),et=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Au(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function TL(e){return dn(e.turnServerURL,"turnServerURL"),dn(e.username,"username"),dn(e.password,"password"),e.udpport&&At(e.udpport,"udpport",1,99999,!0),e.forceturn&&Ja(e.forceturn,"forceturn"),e.security&&Ja(e.security,"security"),e.tcpport&&At(e.tcpport,"tcpport",1,99999,!0),!0}function CL(e){return e.level!==void 0&&Gr(e.level,"level",[1,2,3]),e.delay!==void 0&&At(e.delay,"delay",0,3e3,!0),!0}let tt=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),yn=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),$n=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),ed=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function kr(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return e.getListeners(t).length===0?_e.reject(new ee(N.UNEXPECTED_ERROR,"can not emit promise")):new _e((c,l)=>{e.emit(t,...i,c,l)})}function Pt(e,t){if(e.getListeners(t).length===0)return _e.resolve();for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return kr(e,t,...i)}function Mi(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return td(e,t,...i)}function td(e,t){let r=null,i=null;for(var s=arguments.length,c=new Array(s>2?s-2:0),l=2;l<s;l++)c[l-2]=arguments[l];if(e.emit(t,...c,u=>{r=u},u=>{i=u}),i!==null)throw i;if(r===null)throw new ee(N.UNEXPECTED_ERROR,"handler is not sync");return r}let ar=new class extends Jt{set networkState(e){this.emit(ed.NETWORK_STATE_CHANGE,e,this._networkState),e===$n.ONLINE?this.emit(ed.ONLINE):e===$n.OFFLINE&&(this.onlineWaiter=new _e(t=>{this.once(ed.ONLINE,()=>{this.onlineWaiter=void 0,t($n.ONLINE)})}),this.emit(ed.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===$n.ONLINE}constructor(){super(),zt(this,"_moduleName","network-indicator"),zt(this,"_networkState",$n.ONLINE),zt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=$n.ONLINE}),window.addEventListener("offline",()=>{this.networkState=$n.OFFLINE})}};function IE(e,t){let r=e.indexOf(t);r!==-1&&e.splice(r,1)}function Ou(e){let t=[];return e.forEach(r=>{t.indexOf(r)===-1&&t.push(r)}),t}function bE(e){_e!==void 0?_e.resolve().then(e):setTimeout(e,0)}function Vt(e){return JSON.parse(JSON.stringify(e))}function rd(e){try{return Vt(e)}catch{return e}}let RL={};function Wc(e,t){RL[t]||(RL[t]=!0,e())}function nd(e){let t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)r[i]=t.charCodeAt(i);return r}function Gc(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function wL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){let i=new Uint8Array(t);i.set(r),r=i}return r}function IL(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=Ds(t).call(t,(l,u)=>l+u.length,0),s=new Uint8Array(new ArrayBuffer(i)),c=0;return t.forEach(l=>{s.set(l,c),c+=l.length}),s}function _a(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function bL(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(r=>{t+=typeof r=="string"?_a(r):r.size}),t+138}function oQ(e){let t=new ee(N.TIMEOUT,"timeout");return new _e((r,i)=>{window.setTimeout(()=>i(t),e)})}function Xr(e){return new _e(t=>{window.setTimeout(t,e)})}function kt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+kt(e-r.length,"")}function Zp(){return kt(32,"").toUpperCase()}let AE=()=>{},AL=new class{constructor(){zt(this,"fnMap",new Map)}throttleByKey(e,t,r,i){for(var s=arguments.length,c=new Array(s>4?s-4:0),l=4;l<s;l++)c[l-4]=arguments[l];if(this.fnMap.has(t)){let u=this.fnMap.get(t);if(u.threshold!==r){u.fn(...u.args),clearTimeout(u.timer);let h=window.setTimeout(()=>{let f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:h,args:c,skipFn:i})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(t,Ae(Ae({},u),{},{fn:e,args:c,skipFn:i}))}else{let u=window.setTimeout(()=>{let h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:u,args:c,skipFn:i})}}},OL=AL.throttleByKey.bind(AL);function NL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function vR(e,t){if(!NL(e)||!NL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let r=[...e];for(let i=0;i<t.length;i++)r[i]=vR(e[i],t[i]);return r}{let r=Ae({},e);for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?r[i]=vR(e[i],t[i]):r[i]=t[i]);return r}}function DL(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let i=0;for(;e>0&&(r[i]=255&e,e>>=8,i++,i!==t););return r}function TR(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function PL(e){let t="0123456789abcdef";function r(F){let W,K="";for(W=0;W<=3;W++)K+=t.charAt(F>>8*W+4&15)+t.charAt(F>>8*W&15);return K}function i(F,W){let K=(65535&F)+(65535&W);return(F>>16)+(W>>16)+(K>>16)<<16|65535&K}function s(F,W,K,X,ie,ae){return i(function(le,we){return le<<we|le>>>32-we}(i(i(W,F),i(X,ae)),ie),K)}function c(F,W,K,X,ie,ae,le){return s(W&K|~W&X,F,W,ie,ae,le)}function l(F,W,K,X,ie,ae,le){return s(W&X|K&~X,F,W,ie,ae,le)}function u(F,W,K,X,ie,ae,le){return s(W^K^X,F,W,ie,ae,le)}function h(F,W,K,X,ie,ae,le){return s(K^(W|~X),F,W,ie,ae,le)}let f=function(F){let W,K=1+(F.length+8>>6),X=new Array(16*K);for(W=0;W<16*K;W++)X[W]=0;for(W=0;W<F.length;W++)X[W>>2]|=F.charCodeAt(W)<<W%4*8;return X[W>>2]|=128<<W%4*8,X[16*K-2]=8*F.length,X}(e),m,E,S,y,A,T=1732584193,w=-271733879,O=-1732584194,P=271733878;for(m=0;m<f.length;m+=16)E=T,S=w,y=O,A=P,T=c(T,w,O,P,f[m+0],7,-680876936),P=c(P,T,w,O,f[m+1],12,-389564586),O=c(O,P,T,w,f[m+2],17,606105819),w=c(w,O,P,T,f[m+3],22,-1044525330),T=c(T,w,O,P,f[m+4],7,-176418897),P=c(P,T,w,O,f[m+5],12,1200080426),O=c(O,P,T,w,f[m+6],17,-1473231341),w=c(w,O,P,T,f[m+7],22,-45705983),T=c(T,w,O,P,f[m+8],7,1770035416),P=c(P,T,w,O,f[m+9],12,-1958414417),O=c(O,P,T,w,f[m+10],17,-42063),w=c(w,O,P,T,f[m+11],22,-1990404162),T=c(T,w,O,P,f[m+12],7,1804603682),P=c(P,T,w,O,f[m+13],12,-40341101),O=c(O,P,T,w,f[m+14],17,-1502002290),w=c(w,O,P,T,f[m+15],22,1236535329),T=l(T,w,O,P,f[m+1],5,-165796510),P=l(P,T,w,O,f[m+6],9,-1069501632),O=l(O,P,T,w,f[m+11],14,643717713),w=l(w,O,P,T,f[m+0],20,-373897302),T=l(T,w,O,P,f[m+5],5,-701558691),P=l(P,T,w,O,f[m+10],9,38016083),O=l(O,P,T,w,f[m+15],14,-660478335),w=l(w,O,P,T,f[m+4],20,-405537848),T=l(T,w,O,P,f[m+9],5,568446438),P=l(P,T,w,O,f[m+14],9,-1019803690),O=l(O,P,T,w,f[m+3],14,-187363961),w=l(w,O,P,T,f[m+8],20,1163531501),T=l(T,w,O,P,f[m+13],5,-1444681467),P=l(P,T,w,O,f[m+2],9,-51403784),O=l(O,P,T,w,f[m+7],14,1735328473),w=l(w,O,P,T,f[m+12],20,-1926607734),T=u(T,w,O,P,f[m+5],4,-378558),P=u(P,T,w,O,f[m+8],11,-2022574463),O=u(O,P,T,w,f[m+11],16,1839030562),w=u(w,O,P,T,f[m+14],23,-35309556),T=u(T,w,O,P,f[m+1],4,-1530992060),P=u(P,T,w,O,f[m+4],11,1272893353),O=u(O,P,T,w,f[m+7],16,-155497632),w=u(w,O,P,T,f[m+10],23,-1094730640),T=u(T,w,O,P,f[m+13],4,681279174),P=u(P,T,w,O,f[m+0],11,-358537222),O=u(O,P,T,w,f[m+3],16,-722521979),w=u(w,O,P,T,f[m+6],23,76029189),T=u(T,w,O,P,f[m+9],4,-640364487),P=u(P,T,w,O,f[m+12],11,-421815835),O=u(O,P,T,w,f[m+15],16,530742520),w=u(w,O,P,T,f[m+2],23,-995338651),T=h(T,w,O,P,f[m+0],6,-198630844),P=h(P,T,w,O,f[m+7],10,1126891415),O=h(O,P,T,w,f[m+14],15,-1416354905),w=h(w,O,P,T,f[m+5],21,-57434055),T=h(T,w,O,P,f[m+12],6,1700485571),P=h(P,T,w,O,f[m+3],10,-1894986606),O=h(O,P,T,w,f[m+10],15,-1051523),w=h(w,O,P,T,f[m+1],21,-2054922799),T=h(T,w,O,P,f[m+8],6,1873313359),P=h(P,T,w,O,f[m+15],10,-30611744),O=h(O,P,T,w,f[m+6],15,-1560198380),w=h(w,O,P,T,f[m+13],21,1309151649),T=h(T,w,O,P,f[m+4],6,-145523070),P=h(P,T,w,O,f[m+11],10,-1120210379),O=h(O,P,T,w,f[m+2],15,718787259),w=h(w,O,P,T,f[m+9],21,-343485551),T=i(T,E),w=i(w,S),O=i(O,y),P=i(P,A);return r(T)+r(w)+r(O)+r(P)}let sQ=1,OE=console,rn=class{static setLogger(e){OE=e}constructor(e){zt(this,"lockingPromise",_e.resolve()),zt(this,"locks",0),zt(this,"name",""),zt(this,"lockId",void 0),this.lockId=sQ++,e&&(this.name=e),OE.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,OE.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));let r=new _e(s=>{t=()=>{this.locks-=1,OE.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),s()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),i}};function Nu(e,t){return function(r,i,s){let c=s.value;if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){let l=this[t];if(!l)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let u=await l.lock("From ".concat(e,".").concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return await c.apply(this,f)}finally{u()}},s}}let Tr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function NE(e,t){let r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function Ls(e,t,r,i){let s=Object.assign({},Tr,i),c=s.timeout,l=async()=>{await function(f){return new _e(m=>{window.setTimeout(m,f)})}(c),c*=s.timeoutFactor,c=Math.min(s.maxRetryTimeout,c)},u=!1,h=new _e(async(f,m)=>{t=t||(()=>!1),r=r||(()=>!0);for(let E=0;E<s.maxRetryCount;E+=1){if(u)return m(new ee(N.OPERATION_ABORTED));try{let S=await e();if(!t(S,E)||E+1===s.maxRetryCount)return f(S);await l()}catch(S){if(!r(S,E)||E+1===s.maxRetryCount)return m(S);await l()}}});return h.cancel=()=>u=!0,h}class CR{constructor(t){zt(this,"input",[]),zt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Ds(t=this.input).call(t,(r,i)=>r+i)/this.input.length}}let DE,PE=0,RR=0;function wR(e,t,r,i){return new _e((s,c)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),PE+=_a(t.data)):r&&(t.data.size?PE+=t.data.size:t.data instanceof FormData?PE+=bL(t.data):PE+=_a(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,si.request(t).then(l=>{typeof l.data=="string"?RR+=_a(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?RR+=l.data.byteLength:RR+=_a(JSON.stringify(l.data)),s(l.data)}).catch(l=>{si.isCancel(l)?c(new ee(N.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?c(new ee(N.NETWORK_TIMEOUT,l.message)):l.response?c(new ee(N.NETWORK_RESPONSE_ERROR,l.response.status)):c(new ee(N.NETWORK_ERROR,l.message))})})}async function aQ(e,t){let r=new Blob([t.data],{type:"buffer"});return await wR(e,Ae(Ae({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}let kL=()=>window.isSecureContext!==void 0,Eo=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){let i=t[1],s=t[2];return"".concat(i,".").concat(s)}let r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(r&&r[1]&&r[2]){let i=r[1],s=r[2];return"".concat(i,".").concat(100*(Number(s)+1))}return"4.0.0.999"}("4.21.0"),IR=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),id=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),bR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},AR="v4.21.0-0-g16fdae2c-dirty(6/3/2024, 2:55:18 PM)",Ur={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:void 0,ENABLE_CC_FALLBACK:void 0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:bR,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0};function Ot(e,t,r){var i,s,c;ge(i=Object.keys(Ur)).call(i,e)&&(!r&&ge(s=Object.keys(Hc)).call(s,e)||(Ur[e]=t,e==="ENABLE_VIDEO_SEI"&&t===!0&&(Ur.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(c=!!t,Ur.USE_NEW_NETWORK_CONFIG=c,c&&(Ur.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Ur.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Ur.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Ur.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Ur.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Ur.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Ur.GATEWAY_DOMAINS=["edge.sd-rtn.com"]))))}function x(e){return Ur[e]}let Hc={};var Qe=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Qe||{});class cQ{constructor(t,r,i,s){zt(this,"state",void 0),this.state={codec:t,audioCodec:r,mode:i,clientId:s,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:id.Default}}dispatch(t){this.state=function(r,i){switch(i.type){case Qe.SET_SESSION_ID:return Ae(Ae({},r),{},{sessionId:i.sessionId});case Qe.SET_P2P_ID:return Ae(Ae({},r),{},{p2pId:i.p2pId});case Qe.SET_UID:return Ae(Ae({},r),{},{uid:i.uid});case Qe.SET_INT_UID:return Ae(Ae({},r),{},{intUid:i.intUid});case Qe.SET_PUB_ID:return Ae(Ae({},r),{},{pubId:i.pubId});case Qe.KEY_METRIC_CLIENT_CREATED:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{clientCreated:i.metric})});case Qe.KEY_METRIC_JOIN_START:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{joinStart:i.metric})});case Qe.AVOID_JOIN_START:return Ae(Ae({},r),{},{avoidJoinStart:i.avoidJoinStart});case Qe.KEY_METRIC_JOIN_END:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{joinEnd:i.metric})});case Qe.KEY_METRIC_REQUEST_AP_START:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{requestAPStart:i.metric})});case Qe.KEY_METRIC_REQUEST_AP_END:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{requestAPEnd:i.metric})});case Qe.KEY_METRIC_JOIN_GATEWAY_START:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{joinGatewayStart:i.metric})});case Qe.KEY_METRIC_JOIN_GATEWAY_END:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{joinGatewayEnd:i.metric})});case Qe.KEY_METRIC_PEER_CONNECTION_START:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{peerConnectionStart:i.metric})});case Qe.KEY_METRIC_PEER_CONNECTION_END:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{peerConnectionEnd:i.metric})});case Qe.KEY_METRIC_DESCRIPTION_START:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{descriptionStart:i.metric})});case Qe.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{signalChannelOpen:i.metric})});case Qe.KEY_METRIC_ICE_CONNECTION_END:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{iceConnectionEnd:i.metric})});case Qe.KEY_METRIC_PUBLISH:{let s=r.keyMetrics.publish,c=s.findIndex(l=>l.trackId===i.metric.trackId);return c!==-1?(s[c]=Ae(Ae({},s[c]),i.metric),Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{publish:[...s]})})):Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{publish:[...r.keyMetrics.publish,i.metric]})})}case Qe.KEY_METRIC_SUBSCRIBE:{let s=r.keyMetrics.subscribe,c=s.findIndex(l=>l.userId===i.metric.userId&&l.type===i.metric.type);return c!==-1?(s[c]=Ae(Ae({},s[c]),i.metric),Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{subscribe:[...s]})})):Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{subscribe:[...r.keyMetrics.subscribe,i.metric]})})}case Qe.SET_CLOUD_PROXY_SERVER_MODE:return r.cloudProxyServerMode=i.mode,r;case Qe.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?r.joinChannelServiceRecords=[...r.joinChannelServiceRecords,i.record]:(r.joinChannelServiceRecords[i.index]=Ae(Ae({},r.joinChannelServiceRecords[i.index]),i.record),r.joinChannelServiceRecords=[...r.joinChannelServiceRecords]),r;case Qe.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return r.joinChannelServiceRecords=[],r;case Qe.RESET_KEY_METRICS:return r.keyMetrics={publish:[],subscribe:[]},r;case Qe.SET_USE_DATACHANNEL:return Ae(Ae({},r),{},{useDataChannel:i.val});case Qe.SET_USE_P2P:return Ae(Ae({},r),{},{useP2P:i.val});case Qe.SET_TRANSPORT_TYPE:return Ae(Ae({},r),{},{p2pTransport:i.val});default:return r}}(this.state,t)}set sessionId(t){this.dispatch({type:Qe.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:Qe.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:Qe.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:Qe.SET_UID,uid:t})}get uid(){return this.state.uid}set intUid(t){this.dispatch({type:Qe.SET_INT_UID,intUid:t})}get intUid(){return this.state.intUid}set pubId(t){this.dispatch({type:Qe.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:Qe.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:Qe.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}set useP2P(t){this.dispatch({type:Qe.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}set p2pTransport(t){this.dispatch({type:Qe.SET_TRANSPORT_TYPE,val:t})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:Qe.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Qe.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Qe.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Qe.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Qe.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Qe.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Qe.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Qe.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Qe.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Qe.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Qe.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Qe.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,r,i,s){this.dispatch({type:Qe.KEY_METRIC_PUBLISH,metric:Ae(Ae({trackId:t,type:r},i&&{publishStart:i}),s&&{publishEnd:s})})}subscribe(t,r,i,s,c,l,u){this.dispatch({type:Qe.KEY_METRIC_SUBSCRIBE,metric:Ae(Ae(Ae(Ae(Ae({userId:t,type:r},i&&{subscribeStart:i}),s&&{subscribeEnd:s}),c&&{firstFrame:c}),l&&{streamAdded:l}),u&&{firstDecoded:u})})}massSubscribe(t,r,i,s){t.forEach(c=>{this.dispatch({type:Qe.KEY_METRIC_SUBSCRIBE,metric:Ae(Ae(Ae({userId:c.userId,type:c.type},r&&{subscribeStart:r}),i&&{subscribeEnd:i}),s&&{firstFrame:s})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,r){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof r!="number"?(this.dispatch({type:Qe.RECORD_JOIN_CHANNEL_SERVICE,record:Ae(Ae({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(r<0||r>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Qe.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:r}),r)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Qe.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Qe.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:Qe.AVOID_JOIN_START,avoidJoinStart:t})}}let Du=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let LL=128,lQ=96,ML=1e3,Pu=10,dQ=0;function xL(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function qe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xL(Object(r),!0).forEach(function(i){mr(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xL(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function mr(e,t,r){return(t=function(i){var s=function(c,l){if(typeof c!="object"||c===null)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var h=u.call(c,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof s=="symbol"?s:String(s)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let UL=new class extends Jt{constructor(){super(...arguments),mr(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class uQ{constructor(t){mr(this,"logger",void 0),mr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logger.debug(...this.prefixLists,...r)}info(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logger.info(...this.prefixLists,...r)}warning(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logger.warning(...this.prefixLists,...r)}error(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logger.error(...this.prefixLists,...r)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function OR(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function VL(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let go={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},kE=Date.now(),ef=e=>{for(let t in go)if(Object.prototype.hasOwnProperty.call(go,t)&&go[t]===e)return t;return"DEFAULT"},v=new class{constructor(){mr(this,"proxyServerURL",void 0),mr(this,"logLevel",go.DEBUG),mr(this,"uploadState","collecting"),mr(this,"uploadLogWaitingList",[]),mr(this,"uploadLogUploadingList",[]),mr(this,"uploadErrorCount",0),mr(this,"currentLogID",0),mr(this,"url",void 0),mr(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[go.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[go.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[go.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[go.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[go.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Ot("UPLOAD_LOG",!0)}disableLogUpload(){Ot("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new uQ(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-kE<100)return void setTimeout(()=>{this.log(...t)},Date.now()-kE);let i=Math.max(0,Math.min(4,t[0]));if(t[0]=OR()+" Agora-SDK [".concat(ef(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;let s=OR()+" %cAgora-SDK [".concat(ef(i),"]:"),c=[];if(!x("USE_NEW_LOG"))switch(i){case go.DEBUG:c=[s,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,c);break;case go.INFO:c=[s,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,c);break;case go.WARNING:c=[s,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,c);break;case go.ERROR:c=[s,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,c)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-kE<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-kE);let i=Math.max(0,Math.min(4,t[0]));t[0]=OR()+" Agora-SDK [".concat(ef(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!x("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];Array.isArray(r[0])?r[0][0]=VL()+" Agora-SDK [".concat(ef(e),"]:"):r[0]=VL()+" Agora-SDK [".concat(ef(e),"]:");let s="";r.forEach(c=>{typeof c=="object"&&(c=JSON.stringify(c)),s+="".concat(c," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:Eo,process_id:x("PROCESS_ID"),payload:JSON.stringify(e)};return Ls(async()=>{let r=await si.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(x("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(x("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){let i=new Error("unexpected upload log response");throw i.response=r,i}},()=>(this.uploadLogUploadingList=[],!1),r=>{let i={status:-1,message:r.message,errorRange:e.map(s=>s.log_item_id)};return r.response?(i.status=r.response.status,i.data=r.response.data,i.headers=r.response.headers):r.request&&(i.status=r.request.status),UL.reportLogUploadError(i),!0},{timeout:x("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:x("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,x("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var FL;function hQ(e){return dn(e.reportId,"params.reportId",0,100,!1),dn(e.category,"params.category",0,100,!1),dn(e.event,"params.event",0,100,!1),dn(e.label,"params.label",0,100,!1),At(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(FL={}).FREE="free",FL.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});let pQ={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},nn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),rr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({}),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}({});class tf{constructor(){mr(this,"baseInfoMap",new Map),mr(this,"proxyServer",void 0),mr(this,"eventUploadTimer",void 0),mr(this,"setSessionIdTimer",void 0),mr(this,"url",void 0),mr(this,"backupUrl",void 0),mr(this,"_appId",void 0),mr(this,"keyEventUploadPendingItems",[]),mr(this,"normalEventUploadPendingItems",[]),mr(this,"apiInvokeUploadPendingItems",[]),mr(this,"apiInvokeCount",0),mr(this,"ltsList",[]),mr(this,"lastSendNormalEventTime",Date.now()),mr(this,"customReportCounterTimer",void 0),mr(this,"customReportCount",0),mr(this,"extApiInvoke",async t=>{for(let r of t){let i=qe(qe({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:sr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),x("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),x("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void v.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));let r=this.baseInfoMap.get(t),i=Date.now(),s=r.startTime;r.startTime=i,v.debug("rewrite session ".concat(t," startTime: ").concat(i," , ").concat(i-s,"ms")),this.baseInfoMap.set(t,r)}setAppId(t){this._appId=t}reportApiInvoke(t,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;let s=Date.now();this.apiInvokeCount+=1;let c=this.apiInvokeCount,l=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:s,options:r.options,states:r.states||null}),u=!!x("SHOW_REPORT_INVOKER_LOG");u&&v.info("".concat(r.name," start"),r.options);let h=!1;Xr(r.timeout).then(()=>{h||(this.sendApiInvoke(qe(qe({},l()),{},{error:N.API_INVOKE_TIMEOUT,success:!1})),v.debug("".concat(r.name," timeout")))});let f=new ee(N.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:m=>{let E=()=>{if(h)throw f;return h=!0,this.sendApiInvoke(qe(qe({},l()),{},{success:!0},r.reportResult&&{result:m})),u&&v.info("".concat(r.name," onSuccess")),m};return i?OL(E,r.name+"Success",i,()=>h=!0):E()},onError:m=>{let E=()=>{if(h)throw m;h=!0,this.sendApiInvoke(qe(qe({},l()),{},{success:!1,error:m})),u&&v.info("".concat(r.name," onFailure"),m.toString())};return i?OL(E,r.name+"Error",i,()=>h=!0):E()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;let i=Date.now(),s=this.createBaseInfo(t,i);s.cname=r.cname;let c=Object.assign({},{willUploadConsoleLog:x("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:IR?"global":"oversea",areas:x("AREAS")&&x("AREAS").join(",")},r.extend),{stringUid:l,channelProfile:u,channelMode:h,isABTestSuccess:f,lsid:m,clientRole:E}=r,S=Date.now(),y=qe(qe({},s),{},{eventType:nn.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:AR,lts:S,elapse:S-i,extend:JSON.stringify(c),mode:r.mode,process:x("PROCESS_ID"),appType:x("APP_TYPE"),success:!0,version:Eo,stringUid:l,channelProfile:u,channelMode:h,isABTestSuccess:f,lsid:m,clientType:20,clientRole:E,serviceId:x("PROCESS_ID"),extensionID:x("PLUGIN_INFO").join(",")||"",preload:r.preload?1:0});this.send({type:rr.SESSION,data:y},!0)}joinChooseServer(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe({},s),{},{eventType:nn.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3});this.send({type:rr.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe({},s),{},{eventType:nn.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-i.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:rr.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info;r.vid&&(s.vid=r.vid),s.uid=r.uid,s.cid=r.cid;let c=Date.now(),{firstSuccess:l,avoidJoinStartTime:u,isProxy:h,addr:f}=r,m=c-(l&&u?u:i.startTime),E=qe(qe({},s),{},{eventType:nn.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,elapse:m,eventElapse:c-r.lts,firstSuccess:l,signalChannel:r.signalChannel}),S=E.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=c),l)this.send({type:rr.JOIN_GATEWAY,data:E},!0);else{let y;if(f)if(h){let T=f.match(/h=(\d{1,3}-){3}\d{1,3}/g),w=f.match(/p=[0-9]{1,6}/g);y={isSuccess:S,gatewayIp:T&&T.length?T[0].split("=")[1].replace(/-/g,"."):"",port:w&&w.length?w[0].split("=")[1]:"",isProxy:h?1:0}}else{let T=f.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),w=f.match(/(:|p=)[0-9]{1,6}/g);y={isSuccess:S,gatewayIp:T&&T.length?T[0].split("//")[1].replace(/-/g,"."):"",port:w&&w.length?w[0].split(/:|p=/g)[1]:"",isProxy:h?1:0}}else y={isSuccess:S,gatewayIp:"",port:"",isProxy:h?1:0};delete E.success,delete E.eventType,delete E.firstSuccess,E.vid=Number(E.vid);let A=Object.assign({},E,y,{eventType:nn.REJOIN_GATEWAY});this.send({type:rr.RE_JOIN_GATEWAY,data:A},!0)}}joinChannelTimeout(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=Date.now(),c=qe(qe({},i.info),{},{lts:s,timeout:r,elapse:s-i.startTime});this.send({type:rr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe({},s),{},{eventType:nn.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:rr.PUBLISH,data:l},!0)}subscribe(t,r,i){let s=this.baseInfoMap.get(t);if(!s)return;let c=s.info,l=Date.now(),u=qe(qe({},c),{},{eventType:nn.SUBSCRIBE,lts:l,eventElapse:r.eventElapse,elapse:l-s.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?u.peerSuid=r.peerid:u.peer=r.peerid,this.send({type:rr.SUBSCRIBE,data:u},!0)}wsCompressorInit(t){var r;let i=[...qi(r=this.baseInfoMap).call(r)],s=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(s);if(!c)return;let l=c.info,u=Date.now(),h=qe(qe({},l),{},{eventType:nn.WS_COMPRESSOR_INIT,lts:u,eventElapse:t.eventElapse,elapse:u-c.startTime,status:t.status?1:2});this.send({type:rr.WS_COMPRESSOR_INIT,data:h},!0)}firstRemoteVideoDecode(t,r,i,s){let c=this.baseInfoMap.get(t);if(!c)return;let l=c.info,u=Date.now(),h=qe(qe(qe({},l),s),{},{elapse:u-c.startTime,eventType:r,lts:u,firstDecodeFrame:Math.max(u-c.startTime,0),apEnd:Math.max(s.apEnd-c.startTime,0),apStart:Math.max(s.apStart-c.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-c.startTime,0),joinGwStart:Math.max(s.joinGwStart-c.startTime,0),pcEnd:Math.max(s.pcEnd-c.startTime,0),pcStart:Math.max(s.pcStart-c.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-c.startTime,0),subscriberStart:Math.max(s.subscriberStart-c.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-c.startTime,0)});this.send({type:i,data:h},!0)}firstRemoteFrame(t,r,i,s){let c=this.baseInfoMap.get(t);if(!c)return;let l=c.info,u=Date.now(),h=qe(qe(qe({},l),s),{},{elapse:u-c.startTime,eventType:r,lts:u});this.send({type:i,data:h},!0)}pcStats(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe(qe({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-i.startTime,eventType:nn.PC_STATS,lts:c});this.send({type:rr.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(t,r){if(t){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe(qe({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),eventType:nn.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:rr.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(t,r,i,s){let c=this.baseInfoMap.get(t);if(!c)return;let l=c.info,u=Date.now(),h=qe(qe(qe({},l),s),{},{eventType:r,lts:u});this.send({type:i,data:h},!0)}streamSwitch(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe({},s),{},{eventType:nn.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-i.startTime,success:r.succ});this.send({type:rr.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe({},s),{},{eventType:nn.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:rr.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe({},s),{},{eventType:nn.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:rr.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(t){this.proxyServer=t,t?v.debug("reportProxyServerurl: ".concat(t)):v.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe({},s),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:rr.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now();(function(l,u,h){let f=l[u];if(!f||typeof f!="string")return[l];l[u]="";let m=_a(JSON.stringify(l)),E=0,S=[],y=0;for(let A=0;A<f.length;A++)y+=f.charCodeAt(A)<=127?1:3,y<=h-m||(S[S.length]=Ae(Ae({},l),{},{[u]:f.substring(E,A)}),E=A,y=f.charCodeAt(A)<=127?1:3);return E!==f.length-1&&(S[S.length]=Ae(Ae({},l),{},{[u]:f.substring(E)})),S})(qe(qe(qe({},s),r),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:rr.WORKER_EVENT,data:l},!0))}apworkerEvent(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe(qe({},s),r),{},{elapse:c-i.startTime,lts:c});this.send({type:rr.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe(qe({},s),r),{},{elapse:c-i.startTime,lts:c,extend:r.extend||void 0});this.send({type:rr.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let s=i.info,c=Date.now(),l=qe(qe(qe({},s),r),{},{elapse:c-i.startTime,lts:c});this.send({type:rr.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>x("CUSTOM_REPORT_LIMIT"))throw new ee(N.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let i=Date.now(),s=r.map(c=>({type:rr.USER_ANALYTICS,data:qe(qe({sid:t},c),{},{lts:i})}));try{x("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(c){throw v.error("send custom report message failed",c.toString()),new ee(N.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){let r=x("NOT_REPORT_EVENT");if(t.tag&&ge(r)&&ge(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;let i=this.baseInfoMap.get(t.sid);if(!i)return this.apiInvokeUploadPendingItems.push(t),!1;let{cname:s,uid:c,cid:l}=i.info,u;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof ee){let{code:f,message:m}=t.error;u=f||m||t.error.toString()}else u=t.error.toString();let h={invokeId:t.invokeId,sid:t.sid,cname:s,cid:l,uid:c,lts:t.lts,success:t.success,elapse:t.lts-i.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?u:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:rr.API_INVOKE,data:h},!1),!0}appendSessionId(){tf.__CLIENT_LIST__.forEach(t=>{if(t._sessionId){let r=this.apiInvokeUploadPendingItems.length;for(let i=0;i<r;i++){let s=this.apiInvokeUploadPendingItems.shift();s&&(s.sid=t._sessionId,this.sendApiInvoke(Object.assign({},s)))}}})}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>x("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){let i=[],s=[];for(;t.length;){let l=t.shift();i.length<20?i.push(l):s.push(l)}t.push(...s);for(let l of[...i]){var c;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),Mp(c=this.ltsList).call(c,(u,h)=>u-h))}return r||(this.lastSendNormalEventTime=Date.now()),x("ENABLE_EVENT_REPORT")&&i.length&&(x("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((l=>u=>{x("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>x("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-x("NORMAL_EVENT_QUEUE_CAPACITY")),v.warning("report: drop normal events"))))})(i)),t}async postDataToStatsCollector2(t){ar.networkState===$n.OFFLINE&&await _e.race([ar.onlineWaiter,Xr(2*Tr.maxRetryTimeout)]);let r=c=>{let l=new Uint8Array;return c.forEach(u=>{let h=SR(JSON.stringify(u.data)),f=new ArrayBuffer(5),m=(S=>{let y=0;return Object.entries(rr).forEach(A=>{let[T,w]=A;w===S.type&&(y=EventNameToID[T])}),y})(u),E=new DataView(f);E.setUint16(0,h.byteLength,!0),E.setUint8(2,255&m),E.setUint8(3,m>>>8&255),E.setUint8(4,m>>>16&255),l=SL(l,new Uint8Array(f)),l=SL(l,h)}),l},i="event",s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(x("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(x("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await wR(s,{timeout:1e4,data:r(t),headers:qe(qe({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(c===1)throw l;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(l=>JSON.stringify(l)),vid:(l=>{let u=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return u&&u.info.vid&&+u.info.vid||0})(t[0])};ar.networkState===$n.OFFLINE&&await _e.race([ar.onlineWaiter,Xr(2*Tr.maxRetryTimeout)]);let s=r?"/events/proto-raws":"/events/messages",c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("EVENT_REPORT_DOMAIN"),"&p=").concat(x("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(x("EVENT_REPORT_DOMAIN"),":").concat(x("STATS_COLLECTOR_PORT")).concat(s));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(x("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(x("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(x("STATS_COLLECTOR_PORT")).concat(s)));try{r?await aQ(c,{timeout:1e4,data:i}):await wR(c,{timeout:1e4,data:i})}catch(u){if(l===1)throw u;continue}return}}createBaseInfo(t,r){let i=Object.assign({},pQ);return i.sid=t,this.baseInfoMap.set(t,{info:i,startTime:r}),i}reportResourceTiming(t,r){let i=performance.getEntriesByName(t),s=i[i.length-1];s&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:s,tag:sr.TRACER}).onSuccess()}}function ke(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,i){let s=i.value;if(typeof s=="function"){let c=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];let f=u;if(e.argsMap)try{f=e.argsMap(this,...u)}catch(E){v.warning(E),f=[]}try{JSON.stringify(f)}catch{v.warning("arguments for method ".concat(c,".").concat(String(r)," not serializable for apiInvoke.")),f=[]}let m=(e.report||be).reportApiInvoke(this._sessionId||null,{name:"".concat(c,".").concat(String(r)),options:f,tag:sr.TRACER,reportResult:e.reportResult},e.throttleTime);try{let E=s.apply(this,u);return E instanceof _e?E.then(S=>(m.onSuccess(e.reportResult&&S),S)).catch(S=>{throw m.onError(S),S}):(m.onSuccess(e.reportResult&&E),E)}catch(E){throw m.onError(E),E}}}return i}}mr(tf,"__CLIENT_LIST__",[]);let be=new tf;UL.on("REPORT_LOG_UPLOAD",e=>{e.networkState=ar.networkState,be.reportApiInvoke(null,{name:"logUploadError",options:e,tag:sr.TRACER}).onSuccess("logUploadError")});let fQ=["CHINA","GLOBAL"],vn=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");let i=r.join(""),s=[];for(let u=0;u<6;u++)s.push("1");let c=s.join(""),l={};return l[e]=i,l[t]=c,Object.assign(l,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=vn,IR||(Ur.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Ur.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Ur.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Ur.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Ur.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Ur.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Ur.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Ur.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Ur.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Ur.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Ur.AREAS=["NORTH_AMERICA","OVERSEA"]);let jL=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Kc=[];function od(e,t){return!!t&&Kc.some(r=>r.uid===e&&r.channelName===t)}tf.__CLIENT_LIST__=Kc;var mQ=fk.forEach,BL=T_("forEach")?[].forEach:function(e){return mQ(this,e,arguments.length>1?arguments[1]:void 0)};Ut({target:"Array",proto:!0,forced:[].forEach!=BL},{forEach:BL});var _Q=zo("Array").forEach,EQ=la,gQ=Nr,SQ=M,yQ=_Q,NR=Array.prototype,vQ={DOMTokenList:!0,NodeList:!0},TQ=function(e){var t=e.forEach;return e===NR||SQ(NR,e)&&t===NR.forEach||gQ(vQ,EQ(e))?yQ:t},CQ=p(TQ),RQ=gi,WL=b_;Ut({target:"Object",stat:!0,forced:_(function(){WL(1)})},{keys:function(e){return WL(RQ(e))}});var GL=p(fo.Object.keys),wQ=p(MO),IQ=Ut,bQ=Vp,AQ=k([].reverse),HL=[1,2];IQ({target:"Array",proto:!0,forced:String(HL)===String(HL.reverse())},{reverse:function(){return bQ(this)&&(this.length=this.length),AQ(this)}});var OQ=zo("Array").reverse,NQ=M,DQ=OQ,DR=Array.prototype,PQ=function(e){var t=e.reverse;return e===DR||NQ(DR,e)&&t===DR.reverse?DQ:t},KL=PQ,kQ=p(KL),LQ=Ut,zL=Vp,MQ=F_,xQ=_i,qL=eT,UQ=za,VQ=sa,FQ=Q_,jQ=vr,BQ=LT,WQ=ik("slice"),GQ=jQ("species"),PR=Array,HQ=Math.max;LQ({target:"Array",proto:!0,forced:!WQ},{slice:function(e,t){var r,i,s,c=VQ(this),l=UQ(c),u=qL(e,l),h=qL(t===void 0?l:t,l);if(zL(c)&&(r=c.constructor,(MQ(r)&&(r===PR||zL(r.prototype))||xQ(r)&&(r=r[GQ])===null)&&(r=void 0),r===PR||r===void 0))return BQ(c,u,h);for(i=new(r===void 0?PR:r)(HQ(h-u,0)),s=0;u<h;u++,s++)u in c&&FQ(i,s,c[u]);return i.length=s,i}});var KQ=zo("Array").slice,zQ=M,qQ=KQ,kR=Array.prototype,YQ=function(e){var t=e.slice;return e===kR||zQ(kR,e)&&t===kR.slice?qQ:t},JQ=p(YQ);function fe(e,t,r,i,s){var c,l,u,h={};return CQ(c=GL(i)).call(c,function(f){h[f]=i[f]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=wQ(l=kQ(u=JQ(r).call(r)).call(u)).call(l,function(f,m){return m(e,t,f)||f},h),s&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(s):void 0,h.initializer=void 0),h.initializer===void 0&&(ek(e,t,h),h=null),h}var XQ=zo("Array").values,$Q=la,QQ=Nr,ZQ=M,eZ=XQ,LR=Array.prototype,tZ={DOMTokenList:!0,NodeList:!0},rZ=function(e){var t=e.values;return e===LR||ZQ(LR,e)&&t===LR.values||QQ(tZ,$Q(e))?eZ:t},Ms=p(rZ);let nZ=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Ji=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),LE=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),MR=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Xo=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Qn=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Pe=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Ze=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Te=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),Ne=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),sd=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Be=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Zn=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Ue=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});class H extends ee{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),b(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,v)}throw(){super.throw(v)}}function ME(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw v.error("Invalid Channel Name ".concat(e)),new H(N.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function xE(e){if(!function(t){return typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295}(e)&&!mL(e,1,255))throw new H(N.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&v.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let on=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming",e}({}),ku=function(e){return e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN",e}({}),iZ={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},xR={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function UR(e,t){dn(e.url,"".concat(t,".url"),1,1e3,!1),or(e.x)||At(e.x,"".concat(t,".x"),0,1e4),or(e.y)||At(e.y,"".concat(t,".y"),0,1e4),or(e.width)||At(e.width,"".concat(t,".width"),0,1e4),or(e.height)||At(e.height,"".concat(t,".height"),0,1e4),or(e.zOrder)||At(e.zOrder,"".concat(t,".zOrder"),0,255),or(e.alpha)||At(e.alpha,"".concat(t,".alpha"),0,1,!1)}let oZ={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},sZ={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30},Ea=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),UE=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Vr=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function YL(e){if(!e.channelName)throw new H(N.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new H(N.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&dn(e.token,"info.token",1,2047),xE(e.uid),ME(e.channelName),!0}let ei=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),$a=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),yi=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Lu=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),vt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),_r=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal",e}({}),rf=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),$r=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),JL=function(e){return e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel",e}({}),mt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),XL=[mt.AFRICA,mt.ASIA,mt.CHINA,mt.EUROPE,mt.GLOBAL,mt.INDIA,mt.JAPAN,mt.NORTH_AMERICA,mt.OCEANIA,mt.OVERSEA,mt.SOUTH_AMERICA],An=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),VE={CHINA:{},ASIA:{CODE:An.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:An.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:An.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:An.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:An.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:An.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:An.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:An.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:An.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:An.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:An.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:An.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:An.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};IR&&(VE.CHINA={CODE:An.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let VR=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({});class $L extends Jt{constructor(t,r){super(),b(this,"onICEConnectionStateChange",void 0),b(this,"onConnectionStateChange",void 0),b(this,"onDTLSTransportStateChange",void 0),b(this,"onDTLSTransportError",void 0),b(this,"onICETransportStateChange",void 0),b(this,"onFirstAudioReceived",void 0),b(this,"onFirstVideoReceived",void 0),b(this,"onFirstAudioDecoded",void 0),b(this,"onFirstVideoDecoded",void 0),b(this,"onFirstVideoDecodedTimeout",void 0),b(this,"onSelectedLocalCandidateChanged",void 0),b(this,"onSelectedRemoteCandidateChanged",void 0),b(this,"getLocalVideoStats",void 0)}}class FE extends $L{constructor(t,r){super(t,r),b(this,"establishPromise",void 0)}}let Ie=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Gn=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),Qa=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),ce=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Ct=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Le=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),$o=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Qo=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),sn=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),zc=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),Lr=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e}({}),ga=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),So=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),xs=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Mu=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Er=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),xu=function(e){return e.ABORT="abort",e}({}),qc=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),aZ=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),cZ={[LE.ACCESS_POINT]:{[Qn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Qn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Qn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Qn.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Qn.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Qn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Qn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[LE.UNILBS]:{[Xo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Xo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Xo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Xo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Xo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Xo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Xo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Xo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Xo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Xo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Xo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Xo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[LE.STRING_UID_ALLOCATOR]:{[MR.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[MR.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[MR.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Uu(e){let t=cZ[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===LE.ACCESS_POINT){let i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}let lZ={[Pe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Pe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Pe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Pe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Pe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Pe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Pe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Pe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Pe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Pe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Pe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Pe.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Pe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Pe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Pe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Pe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Pe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Pe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Pe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Pe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Pe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Pe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Pe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Pe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Pe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Pe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Pe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Pe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Pe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Pe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Pe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Pe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Pe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Pe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Pe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Pe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Pe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Pe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Pe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Pe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Pe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Pe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Pe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Pe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Pe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Pe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Pe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Pe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Pe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Pe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Pe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Pe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Pe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Pe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Pe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Pe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Pe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Pe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Pe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Pe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Pe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Pe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Pe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function ad(e){return lZ[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function QL(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function FR(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QL(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QL(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ZL(e){return e.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function eM(e,t){if(typeof e=="string")return e;let{proxy:r,host:i,port:s}=e;if(t){let c=x("JOIN_GATEWAY_FALLBACK_PORT")||443;return c===443?"wss://".concat(i,"/ws/?p=").concat(Number(s)+150):"wss://".concat(i,":").concat(c,"/ws/?p=").concat(Number(s)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(i,"&p=").concat(s):"wss://".concat(i,":").concat(s)}let dZ=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,uZ=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,hZ=/wss:\/\/(.+):([0-9]+)\/?/,pZ=/wss:\/\/(.[^\/]+)\/?/,fZ=0;class mZ{constructor(t,r){b(this,"id",0),b(this,"store",void 0),b(this,"recordIndex",void 0),b(this,"websockets",[]),b(this,"try443PortDuration",2e3),b(this,"forceCloseWSDuration",5e3),b(this,"try443PortTimeout",null),b(this,"forceCloseTimeout",null),b(this,"isTry443PortFailed",!1),b(this,"isNormalPortFailed",!1),b(this,"useDoubleDomain",!1),b(this,"useProxy",!1),b(this,"startTime",Date.now()),this.id=++fZ,this.try443PortDuration=x("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;let r=Date.now()-this.startTime;for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];v.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...s)}createWebSocket(t,r,i){this.logger("createWebSocket:",t,{isTry443Port:r,hasTimeoutDetection:i});let s=x("GATEWAY_DOMAINS"),c=Date.now(),l=[],u=s.find(m=>{var E;return ge(E=t.host).call(E,m)});u||(this.useDoubleDomain=!1);let h=[];if(this.useDoubleDomain)s.forEach(m=>{h.push(eM(FR(FR({},t),{},{host:t.host.replace(u,m)}),r))});else{let m=FR({},t);if(r&&u){let E=s.find(S=>S!==u);E&&(m.host=m.host.replace(u,E))}h.push(eM(m,r))}try{h.forEach(m=>{let E=new WebSocket(m);E.binaryType="arraybuffer",l.push(E),this.logger("ws is connecting:",E.url)})}catch(m){if(this.logger("ws create failed"),l.forEach(E=>E.close()),l.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,r,i);if(!r&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new H(N.WS_ERR,"init websocket failed! Error: ".concat(m.toString()))}let f=Jp();return this.store&&this.store.recordJoinChannelService({urls:l.map(m=>m.url),service:"gateway"},this.recordIndex),l.forEach(m=>{m.onopen=()=>{this.logger("onopen: ws ".concat(m.url," open cost ").concat(Date.now()-c,"ms")),this.websockets.forEach(E=>{E!==m&&(E.onopen=null,E.onclose=null,E.onmessage=null,E.close(),this.logger("close backup websocket: ".concat(E.url)))}),this.websockets.length=0,f.resolve(m)},m.onclose=E=>{this.logger("onclose: ws ".concat(m.url," closed cost ").concat(Date.now()-c,"ms state: ").concat(m.readyState)),r?this.isTry443PortFailed=ZL(l):this.isNormalPortFailed=ZL(l),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(r&&this.isTry443PortFailed||!r&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(E.reason)),f.reject({code:E.code,reason:rf.A_ROUND_WS_FAILED}))},m.onmessage=E=>this.logger("".concat(m.url," onmessage: ").concat(E.data))}),this.websockets.push(...l),i||(()=>{let m=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",f.isResolved),this.websockets.forEach(E=>E.readyState!==WebSocket.OPEN&&E.close())};if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(m,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",f.isResolved),f.isResolved)return m();dt().os===Yr.MAC_OS&&Dt()&&m(),this.createWebSocket(t,!0,!0).then(E=>f.resolve(E)).catch(E=>{this.isNormalPortFailed&&f.reject(E),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(m,this.forceCloseWSDuration)},this.try443PortDuration)})(),f.promise}chooseBestWebsocket(t,r,i,s){return this.useDoubleDomain=!!r,typeof t=="string"&&(t=function(c){let l,u,h;return[,l,u,h]=c.match(dZ)||[],l||([,u,h]=c.match(uZ)||[]),u&&h||([,u,h]=c.match(hZ)||[]),u&&h||([,u]=c.match(pZ)||[]),u||v.warning("un-destructible url: ",c),{proxy:l,host:u,port:h||"443"}}(t)),this.recordIndex=s,this.useProxy=!!t.proxy,i&&this.useProxy&&(v.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function tM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}class rM extends Jt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;ge(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Ue.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ue.CONNECTED):this._state==="closed"?this.emit(Ue.CLOSED):this._state==="failed"&&this.emit(Ue.FAILED))}resetReconnectCount(t){v.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],c=arguments.length>4&&arguments[4]!==void 0&&arguments[4],l=arguments.length>5?arguments[5]:void 0;super(),b(this,"connectionID",0),b(this,"currentURLIndex",0),b(this,"urls",[]),b(this,"_reconnectMode","tryNext"),b(this,"reconnectReason",void 0),b(this,"_initMutex",new rn("websocket")),b(this,"name",void 0),b(this,"_state","closed"),b(this,"reconnectInterrupter",void 0),b(this,"websocket",void 0),b(this,"retryConfig",void 0),b(this,"reconnectCount",0),b(this,"forceCloseTimeout",5e3),b(this,"onlineReconnectListener",void 0),b(this,"useCompress",void 0),b(this,"tryDoubleDomain",!1),b(this,"use443PortOnly",!1),b(this,"wsInflateLength",0),b(this,"wsDeflateLength",0),b(this,"closeEstablishingWs",()=>{}),b(this,"store",void 0),b(this,"joinGatewayRecordIndex",void 0),this.store=l,this.name=t,this.retryConfig=function(E){for(var S=1;S<arguments.length;S++){var y=arguments[S]!=null?arguments[S]:{};S%2?tM(Object(y),!0).forEach(function(A){b(E,A,y[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(y)):tM(Object(y)).forEach(function(A){Object.defineProperty(E,A,Object.getOwnPropertyDescriptor(y,A))})}return E}({},r),this.useCompress=i,this.tryDoubleDomain=s,this.use443PortOnly=c;let{timeout:u,timeoutFactor:h}=r,f=Math.max(300,Math.floor(3*u/5)),m=Math.max(1.2,Math.floor(8*h)/10);$n.ONLINE&&(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m),ar.on(ed.NETWORK_STATE_CHANGE,(E,S)=>{E!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(E)),E===$n.ONLINE?(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h))})}getConnection(){return this.websocket||void 0}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=await this._initMutex.lock();this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{let s=Jp(),c=this.urls[this.currentURLIndex];this.createWebSocketConnection(c).then(s.resolve).catch(s.reject),this.once(Ue.CLOSED,()=>{s.reject(new ee(N.WS_DISCONNECT))}),this.once(Ue.CONNECTED,s.resolve),await s.promise}catch{}finally{i()}}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let i=this.websocket;r?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void v.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);let i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ee(N.WS_ABORT,"websocket is not ready");try{r||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new ee(N.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var r;let i=Jp();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let s=m=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),v.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},c=async m=>{var E;if(v.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new ee(N.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");let S=Mi(this,Ue.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,y=await this.reconnectWithAction(S);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return i.reject(new ee(N.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);i.resolve()}},l=m=>{this.emit(Ue.ON_MESSAGE,m)},u=m=>{v.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),x("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=x("GATEWAY_WSS_ADDRESS")),v.debug("[".concat(this.name,"] start connect, url:"),t);let h=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var f;let m=await this.chooseBestWebsocketConnection(t);this.websocket=m,s&&s(this.websocket.url),this.websocket.onclose=c,this.websocket.onmessage=l,this.websocket.onerror=u,(f=this.store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this.joinGatewayRecordIndex=h}catch(m){let E=this.state==="closed",S=m instanceof ee,y=S&&m.code===N.WS_ABORT,A=S&&m.code===N.WS_ERR,T=S?m.message:m&&(m.reason||m.toString());v.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(T)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[m]},h),E||A?(i.reject(E?new ee(N.WS_DISCONNECT,"websocket is closed: ".concat(T)):new ee(N.WS_ERR,"init websocket failed: ".concat(T))),A&&v.error("[".concat(this.name,"] init websocket failed: ").concat(T))):c&&c(m)}return i.promise}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;v.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||ar.isOnline||!ar.onlineWaiter||(this.onlineReconnectListener=ar.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,r){let l=NE(this.reconnectCount,this.retryConfig);v.debug("[".concat(this.name,"] wait ").concat(l,"ms to reconnect websocket, mode: ").concat(t)),await _e.race([Xr(l),this.onlineReconnectListener||new _e(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;let s=async(l,u)=>{this.emit(Ue.RECONNECT_CREATE_CONNECTION,u),await this.createWebSocketConnection(l)};try{if(t==="retry")this.emit(Ue.RECONNECT_WAITTING_FINISH,t),await s(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);v.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Ue.RECONNECT_WAITTING_FINISH,t),await s(this.urls[this.currentURLIndex],t)}else t==="recover"&&(v.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Ue.RECONNECT_WAITTING_FINISH,t),this.urls=await kr(this,Ue.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],t))}catch(l){var c;v.error("[".concat(this.name,"] reconnect failed ").concat(l&&l.toString()));let u=l==null||(c=l.data)===null||c===void 0?void 0:c.desc;return Array.isArray(u)&&ge(u).call(u,"dynamic key expired")?(this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,r)}return!0}}class nf extends rM{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){let i=Jp(),s=function(l,u){return new mZ(l,u)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),i.reject(new ee(N.WS_ABORT,"choose best websocket aborted"))};let c=x("GATEWAY_DOMAINS");return v.debug("[choose-best-ws] currentDomain: ",t,", domains: ",c,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,r).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class of extends rM{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){return new _e((i,s)=>{let c=!1,l=[];this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),l.forEach(A=>{A.onclose=null,A.onopen=null,A.onmessage=null,A.close()}),s(new ee(N.WS_ABORT,"choose best websocket aborted"))};let u=x("GATEWAY_DOMAINS"),h,f=t.indexOf("?h="),m=u.find(A=>f!==-1?ge(t).call(t,A,f):ge(t).call(t,A));v.debug("[choose-best-ws] currentDomain: ",m,", domains: ",u);let E=!this.tryDoubleDomain||!m;if(!E&&m){var S;let A=Date.now();try{u.forEach(T=>{let w=f===-1?t.replace(m,T):t.substr(0,f)+t.substr(f).replace(m,T),O=new WebSocket(w);O.binaryType="arraybuffer",l.push(O),v.debug("[choose-best-ws] ws is connecting:",O.url)})}catch{for(v.debug("[choose-best-ws] ws create failed, fallback to single url"),l.forEach(T=>T.close());l.length;)l.pop();E=!0}(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:l.map(T=>T.url),service:"gateway"},r),l.forEach(T=>{T.onopen=()=>{if(c)return;let w=Date.now()-A;v.debug("[choose-best-ws] ws open cost ".concat(w,"ms")),l.filter(O=>O!==T).forEach(O=>{v.debug("[choose-best-ws]close backup websocket: ".concat(O.url)),O.close()}),c=!0,i(T)},T.onclose=w=>{h=w,!c&&(l.find(O=>!(O.readyState===WebSocket.CLOSED||O.readyState===WebSocket.CLOSING))||(v.debug("[choose-best-ws] all websocket is closed"),c=!0,s(h)))},T.onmessage=w=>{v.debug("[choose-best-ws]".concat(T.url," onmessage: ").concat(w.data))}}),Xr(this.forceCloseTimeout).then(()=>{l.forEach(T=>{T.readyState!==WebSocket.OPEN&&T.close()})})}if(E){var y;let A;v.debug("[choose-best-ws] use single url: ",t),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[t],service:"gateway"},r);try{A=new WebSocket(t),l.push(A),A.binaryType="arraybuffer"}catch(T){let w=new ee(N.WS_ERR,"init websocket failed! Error: ".concat(T.toString()));return v.error("[".concat(this.name,"]").concat(w)),void s(w)}A.onopen=()=>{i(A)},A.onclose=T=>{s(T)},A.onmessage=T=>{v.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(T.data))},Xr(this.forceCloseTimeout).then(()=>{A&&A.readyState!==WebSocket.OPEN&&A.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class nM extends Jt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ze.CONNECTED?this.emit(Te.WS_CONNECTED):t===Ze.RECONNECTING?this.emit(Te.WS_RECONNECTING,this._websocketReconnectReason):t===Ze.CLOSED&&this.emit(Te.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),b(this,"_disconnectedReason",void 0),b(this,"_websocketReconnectReason",void 0),b(this,"_connectionState",Ze.CLOSED),b(this,"reconnectToken",void 0),b(this,"websocket",void 0),b(this,"openConnectionTime",void 0),b(this,"clientId",void 0),b(this,"lastMsgTime",Date.now()),b(this,"uploadCache",[]),b(this,"uploadCacheInterval",void 0),b(this,"rttRolling",new CR(5)),b(this,"pingpongTimer",void 0),b(this,"wsInflateDataTimer",void 0),b(this,"pingpongTimeoutCount",0),b(this,"joinResponse",void 0),b(this,"multiIpOption",void 0),b(this,"initError",void 0),b(this,"spec",void 0),b(this,"store",void 0),b(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Te.ON_BINARY_DATA,i.data);let s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){let c="res-@".concat(s._id);this.emit(c,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===Be.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Be.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(et.UID_BANNED);break;case 15:this.close(et.IP_BANNED);break;case 16:this.close(et.CHANNEL_BANNED)}if(s._type===Be.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Pe.ERR_LICENSE_MISSING:this.close(et.LICENSE_MISSING);break;case Pe.ERR_LICENSE_EXPIRED:this.close(et.LICENSE_EXPIRED);break;case Pe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(et.LICENSE_MINUTES_EXCEEDED);break;case Pe.ERR_LICENSE_PERIOD_INVALID:this.close(et.LICENSE_PERIOD_INVALID);break;case Pe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(et.LICENSE_MULTIPLE_SDK_SERVICE);break;case Pe.ERR_LICENSE_ILLEGAL:this.close(et.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new nf("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ze.CONNECTED&&this.reconnect("retry",yn.OFFLINE)})}async request(t,r,i,s){let c=kt(6,""),l={_id:c,_type:t,_message:r},u=this.websocket.connectionID,h=()=>new _e((A,T)=>{if(this.connectionState===Ze.CONNECTED)return A();let w=()=>{this.off(Te.WS_CLOSED,O),A()},O=()=>{this.off(Te.WS_CONNECTED,w),T(new H(N.WS_ABORT))};this.once(Te.WS_CONNECTED,w),this.once(Te.WS_CLOSED,O),t!==Ne.PUBLISH&&t!==Ne.PUBLISH_DATASTREAM&&t!==Ne.SUBSCRIBE&&t!==Ne.SUBSCRIBE_DATASTREAM&&t!==Ne.UNSUBSCRIBE&&t!==Ne.UNSUBSCRIBE_DATASTREAM&&t!==Ne.UNPUBLISH&&t!==Ne.UNPUBLISH_DATASTREAM&&t!==Ne.CONTROL&&t!==Ne.RESTART_ICE||this.once(Te.DISCONNECT_P2P,()=>{T(new H(N.DISCONNECT_P2P))}),t!==Ne.PUBLISH&&t!==Ne.RESTART_ICE||this.once(Te.ABORT_P2P_EXECUTION,()=>{T(new H(N.DISCONNECT_P2P))})});if(this.connectionState!==Ze.CONNECTING&&this.connectionState!==Ze.RECONNECTING||t===Ne.JOIN||t===Ne.REJOIN||await h(),this.websocket.sendMessage(l,!0),s)return;let f=new _e((A,T)=>{let w=!1,O=(F,W)=>{w=!0,A({isSuccess:F==="success",message:W||{}}),this.off(Te.WS_CLOSED,P),this.off(Te.WS_RECONNECTING,P),this.emit(Te.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(c),O);let P=()=>{T(new H(N.WS_ABORT,"type: ".concat(t))),this.off(Te.WS_CLOSED,P),this.off(Te.WS_RECONNECTING,P),this.off("res-@".concat(c),O)};this.once(Te.WS_CLOSED,P),this.once(Te.WS_RECONNECTING,P),Xr(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||w||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Te.REQUEST_TIMEOUT,t,r))})}),m=null;try{m=await f}catch(A){if(this.connectionState===Ze.CLOSED||t===Ne.LEAVE)throw new H(N.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?A.throw():t===Ne.JOIN||t===Ne.REJOIN?null:(await h(),await this.request(t,r))}if(m.isSuccess)return m.message;let E=Number(m.message.error_code||m.message.code),S=ad(E),y=new H(N.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(m.message.error_str),{code:E,data:m.message});return S.action==="success"?m.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(S.desc,", action: ").concat(S.action)),E===Pe.ERR_TOO_MANY_BROADCASTERS?((t===Ne.JOIN||t===Ne.REJOIN)&&(this.initError=y,this.close()),y.throw()):S.action==="failed"?y.throw():S.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===Pe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",yn.MULTI_IP)):this.reconnect(S.action,yn.SERVER_ERROR),t===Ne.JOIN||t===Ne.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new _e(i=>{let s=c=>{(!r||r(c))&&(this.off(t,s),i(c))};this.on(t,s)})}uploadWRTCStats(t){if(!this.store.sessionId)return void v.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(sd.WRTC_STATS,r)}upload(t,r){let i={_type:t,_message:r};try{this.websocket.sendMessage(i)}catch{let s=x("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ze.CONNECTED)return;let c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},x("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){let i={_type:t,_message:r};this.websocket.sendMessage(i)}init(t,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new _e((i,s)=>{this.once(Te.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Te.WS_CLOSED,()=>s(this.initError||new H(N.WS_ABORT))),this.connectionState=Ze.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||et.LEAVE,this.connectionState=Ze.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===et.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new nf("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Te.ABORT_P2P_EXECUTION);let t=await kr(this,Te.REQUEST_JOIN_INFO),r=await this.request(Ne.JOIN,t);if(!r)return this.emit(Te.REPORT_JOIN_GATEWAY,rf.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(Te.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ze.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new H(N.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=td(this,Te.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let r=await this.request(Ne.REJOIN,t);return!!r&&(this.connectionState=Ze.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(i=>{this.emit(Be.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Be.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Be.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Be.MUTE_AUDIO,{uid:i.uid}):this.emit(Be.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Be.MUTE_VIDEO,{uid:i.uid}):this.emit(Be.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Be.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Be.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Be.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Be.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Be.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);let r=ad(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(et.UID_BANNED),void this.close()):void this.reconnect(r.action,yn.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=x("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>x("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",yn.TIMEOUT):this.request(Ne.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let i=Date.now()-r;this.rttRolling.add(i),x("REPORT_STATS")&&this.send(Ne.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(sd.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Ue.RECONNECT_WAITTING_FINISH,t=>{this.emit(Te.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Ue.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Te.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ue.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ue.CLOSED,()=>{this.connectionState=Ze.CLOSED}),this.websocket.on(Ue.FAILED,()=>{this._disconnectedReason=et.NETWORK_ERROR,this.connectionState=Ze.CLOSED}),this.websocket.on(Ue.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ze.CONNECTED?this.connectionState=Ze.RECONNECTING:this.connectionState=Ze.CONNECTING}),this.websocket.on(Ue.WILL_RECONNECT,(t,r,i)=>{let s=td(this,Te.IS_P2P_DISCONNECTED),c=s||t!=="retry";s&&t==="retry"&&(v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",r=rf.P2P_DISCONNECTED),c&&(v.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Te.REPORT_JOIN_GATEWAY,r||rf.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Te.NEED_RENEW_SESSION,this.websocket.currentURLIndex>=this.websocket.urls.length-1?"recover":t),this.emit(Te.DISCONNECT_P2P)),i(t)}),this.websocket.on(Ue.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",yn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Te.REPORT_JOIN_GATEWAY,t.message||t.code||rf.UNKNOWN_REASON,this.url||""),t instanceof H){if(t.code===N.UNEXPECTED_RESPONSE&&t.data.code===Pe.ERR_NO_AUTHORIZED)return this.initError=new H(N.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",yn.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",yn.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Ue.REQUEST_NEW_URLS,(t,r)=>{kr(this,Te.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Be.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let Cr=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function iM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function jE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iM(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iM(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Yc(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(x("TURN_DOMAIN")):(v.info("Unidentified as ip: ".concat(e,", use as host")),e)}function jR(e,t){e.addresses||(e.addresses=[]);let r=function(c,l){if(x("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return c.map(f=>{let{ip:m,port:E}=f;return{address:"".concat(m,":").concat(E)}});let u=x("GATEWAY_DOMAINS"),h=u[1]&&ge(l).call(l,u[1])?1:0;return c.map(f=>{let{domain_prefix:m,port:E,ip:S}=f;if(m)return{address:"".concat(m,".").concat(u[h++%u.length],":").concat(E)};let y=/^[\.\:\d]+$/.test(S),A=y?"".concat(S.replace(/[^\d]/g,"-"),".").concat(u[h++%u.length],":").concat(E):"".concat(S,":").concat(E);return y||v.info("Unidentified as ip: ".concat(S,", use as host")),{ip:S,port:E,address:A}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){let c=i.split(";");for(let l=0;l<c.length;l++){var s;let u=Wn(s=c[l]).call(s);r[l]&&u&&(r[l].ip6=u)}}return{gatewayAddrs:r,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function vi(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function oM(e){let t=e._encoderConfig;if(!t)return{};let r={resolution:t.width&&t.height?"".concat(vi(t.width),"x").concat(vi(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function sM(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function sf(e,t){let r,i,s;switch(t){case Cr.CHOOSE_SERVER:i=4096,s="choose server";break;case Cr.CLOUD_PROXY:i=1048576,s="proxy";break;case Cr.CLOUD_PROXY_5:i=4194304,s="proxy5";break;case Cr.CLOUD_PROXY_FALLBACK:i=4194310,s="proxy fallback";break;default:throw new H(N.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(c=>{c.buffer&&c.buffer.flag===i&&(r={code:c.buffer.code,addresses:(c.buffer.edges_services||[]).map(l=>jE(jE({},l),{},{ticket:c.buffer.cert})),server_ts:e.enter_ts,uid:c.buffer.uid,cid:c.buffer.cid,cname:c.buffer.cname,detail:jE(jE({},c.buffer.detail),e.detail),flag:c.buffer.flag,opid:e.opid,cert:c.buffer.cert})}),!r)throw new H(N.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function aM(e,t){return await _e.all(e.addresses.map(async r=>({address:Yc(r.ip),tcpport:r.port,udpport:r.port,username:t&&x("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():vn.username,password:t&&x("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await yR(t.toString()):vn.password})))}function BR(e,t){let r=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||r.height,s=t.videoWidth||r.width;return i&&s?Math.max(Math.min(i,s)/Math.min(vi(e.height),vi(e.width)),1):(v.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Jc(e){let{candidateType:t,relayProtocol:r,type:i,address:s,port:c,protocol:l}=e;return i==="local-candidate"?{candidateType:t,relayProtocol:r,protocol:l}:{candidateType:t,relayProtocol:r,address:s,port:c,protocol:l}}function cM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}class _Z extends Jt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;ge(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Lr.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Lr.CONNECTED):this._state==="closed"?this.emit(Lr.CLOSED):this._state==="failed"&&this.emit(Lr.FAILED))}constructor(t,r,i,s){super(),b(this,"connectionID",0),b(this,"currentURLIndex",0),b(this,"reconnectReason",void 0),b(this,"_reconnectMode","tryNext"),b(this,"_initMutex",void 0),b(this,"_name",void 0),b(this,"_state","closed"),b(this,"_reconnectInterrupter",void 0),b(this,"_url",void 0),b(this,"_retryConfig",void 0),b(this,"_reconnectCount",0),b(this,"_forceCloseTimeout",5e3),b(this,"_onlineReconnectListener",void 0),b(this,"_closeEstablishingTransmitter",()=>{}),b(this,"_store",void 0),b(this,"_joinChannelServiceRecordIndex",void 0),b(this,"_transmitter",void 0),b(this,"_useCompress",void 0),b(this,"_inflateLength",0),b(this,"_deflateLength",0),this._store=s,this._name=t,this._retryConfig=function(c){for(var l=1;l<arguments.length;l++){var u=arguments[l]!=null?arguments[l]:{};l%2?cM(Object(u),!0).forEach(function(h){b(c,h,u[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(u)):cM(Object(u)).forEach(function(h){Object.defineProperty(c,h,Object.getOwnPropertyDescriptor(u,h))})}return c}({},r),this._useCompress=i}resetReconnectCount(t){v.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;let i=this._transmitter;r?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,r){if(!this._transmitter)return void v.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(r)]},this._joinChannelServiceRecordIndex));let s=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),s&&s.bind(this._transmitter)({code:9999,reason:r})}getInflateData(){let t=this._inflateLength,r=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:r}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Us=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class EZ{constructor(t,r,i){b(this,"version",1),b(this,"initialRTO",void 0),b(this,"maxBatchAckCount",void 0),b(this,"maxRTO",void 0),b(this,"initialRTT",void 0),b(this,"ID",void 0),b(this,"rtt",void 0),b(this,"packetNumber",1),b(this,"rtoRatioMap",new Map),b(this,"timeoutMap",new Map),b(this,"unorderedPacketQueue",[]),b(this,"batchAckPacketQueue",[]),b(this,"lastOrderedPacketNumber",0),b(this,"batchAckTimer",void 0),b(this,"sendImpl",void 0),b(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=r,this.ID=kt(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:x("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:x("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:x("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:x("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:x("TRANSMITTER_MAX_RTO")}packetize(t,r){return{type:Us.Default,version:this.version,packetNumber:r,payload:t}}serialize(t){switch(t.type){case Us.Default:{let r;typeof t.payload=="string"?r=new TextEncoder().encode(t.payload):r=t.payload;let i=new ArrayBuffer(r.length+15),s=new DataView(i);return s.setUint16(0,t.version),s.setUint8(2,t.type),s.setUint32(3,t.packetNumber),EL(s,7,BigInt(t.sendTs)),new Uint8Array(s.buffer).set(r,15),i}case Us.Ack:{let r=new ArrayBuffer(16),i=new DataView(r);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.maxAckPacketNumber),i.setUint8(7,t.shift),EL(i,8,BigInt(t.ackSendTs)),r}}}deserialize(t){let r=new DataView(t),i=r.getUint16(0),s=r.getUint8(2);switch(s){case Us.Default:{let c=r.getUint32(3),l=_L(r,7),u=t.slice(15),h=new TextDecoder().decode(u);return{version:i,type:s,packetNumber:c,sendTs:Number(l),payload:h}}case Us.Ack:{let c=r.getUint32(3),l=r.getUint8(7),u=_L(r,8);return{version:i,type:s,maxAckPacketNumber:c,shift:l,ackSendTs:Number(u)}}default:throw v.error("[".concat(this.ID,"] Unrecognized packet type ").concat(s)),new Error("Unrecognized packet type ".concat(s))}}sendMessage(t){let r=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;let i=this.calculateRTO(r),s=window.setTimeout(()=>{this.resendMessage(r)},i);this.timeoutMap.set(r.packetNumber,s),this.sendPacket(r)}onData(t){let r=this.deserialize(t);r.type===Us.Default?this.ack(r):r.type===Us.Ack&&(this.updateRTT(r,Math.round(performance.now())),this.clearRTO(r))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[r,i]=t;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){let r=this.calculateRTO(t),i=window.setTimeout(()=>{this.resendMessage(t)},r);this.timeoutMap.set(t.packetNumber,i),this.sendPacket(t)}calculateRTO(t){let r=this.rtoRatioMap.get(t.packetNumber);if(r===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{let i=9*this.rtt/8*r;return this.rtoRatioMap.set(t.packetNumber,r+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(t,r){let i=t.ackSendTs;this.rtt=this.rtt*(7/8)+(r-i-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){let r=this.unorderedPacketQueue[0];if(!r){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(r.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){let r={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Us.Ack,version:this.version};this.sendPacket(r)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;let r={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Us.Ack,version:this.version};this.sendPacket(r)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;let t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Us.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Us.Default&&(t.sendTs=Math.round(performance.now()));let r=this.serialize(t);this.sendImpl(r)}clearRTO(t){for(let r=t.maxAckPacketNumber-t.shift;r<=t.maxAckPacketNumber;r++){let i=this.timeoutMap.get(r);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(r),this.rtoRatioMap.delete(r)}}}class lM extends _Z{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),b(this,"_initMutex",void 0),b(this,"_reconnectInterrupter",void 0),b(this,"_url",void 0),b(this,"_transmitter",void 0),b(this,"_addresses",void 0),b(this,"_reliableTransmission",void 0),this._initMutex=new rn("datachannel");let{timeout:i,timeoutFactor:s}=r,c=Math.max(300,Math.floor(3*i/5)),l=Math.max(1.2,Math.floor(8*s)/10);$n.ONLINE&&(this._retryConfig.timeout=c,this._retryConfig.timeoutFactor=l),ar.on(ed.NETWORK_STATE_CHANGE,(u,h)=>{u!==h&&(this.resetReconnectCount("network state change: ".concat(h," -> ").concat(u)),u===$n.ONLINE?(this._retryConfig.timeout=c,this._retryConfig.timeoutFactor=l):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=s))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=r;let i=(s,c)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(u=>u.fingerprint||x("FINGERPRINT"));let l=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(l).then(s).catch(c),this.once(Lr.CLOSED,()=>c(new H(N.WS_DISCONNECT))),this.once(Lr.CONNECTED,()=>s())};return this._initMutex.lock().then(s=>new _e((c,l)=>{i(c,l)}).then(()=>{s()}).catch(()=>{s()}))}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new H(N.WS_ABORT,"datachannel is not ready");try{r||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(i){throw new H(N.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){let r=JSON.stringify(t);return{compressed:r,compressedLength:r.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new _e((r,i)=>{var s;let c=()=>{v.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r()},l=async m=>{var E;if((E=this._closeEstablishingTransmitter)===null||E===void 0||E.call(this),v.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");let S=Mi(this,Lr.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,y=await this.reconnectWithAction(S);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!y)return i(new H(N.WS_DISCONNECT,"datachannel reconnect failed: ".concat(m.code))),void this.close(!0);r()}else i(new H(N.WS_DISCONNECT,"datachannel close: ".concat(m.code))),this.close()},u=m=>{var E;(E=this._reliableTransmission)===null||E===void 0||E.onData(m.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),v.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));let h=(s=this._store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),f=Date.now();kr(this,Lr.TO_CONNECT_DATACHANNEL,t).then(m=>{var E,S;if(!m)throw new Error("transmissonInfo not exist yet");let{transmitter:y,close:A}=m;this._transmitter=y,(E=this._store)===null||E===void 0||E.signalChannelOpen();let T=Date.now()-f;v.debug("[choose dc] dc open cost ".concat(T,"ms")),this._reliableTransmission=new EZ(w=>{var O;this._transmitter&&this._transmitter.readyState==="open"&&((O=this._transmitter)===null||O===void 0||O.send(w))},w=>{typeof w=="string"&&this.emit(Lr.ON_MESSAGE,w)}),this._closeEstablishingTransmitter=()=>{var w;(w=this._reliableTransmission)===null||w===void 0||w.close(),this._reliableTransmission=void 0,A()},c&&c(),y.onclose=l,y.onmessage=u,(S=this._store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this._joinChannelServiceRecordIndex=h}).catch(m=>{var E;if((E=this._store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:m instanceof H&&m.code===N.WS_ABORT?"aborted":"error",errors:[m]},h),this.state!=="closed"){if(m instanceof H&&m.code===N.WS_ERR){let S=new H(N.WS_ERR,"init datachannel failed! Error: ".concat(m.toString()));return v.error("[".concat(this._name,"]").concat(S)),void i(S)}l&&l(m)}else i(new H(N.WS_DISCONNECT,"datachannel is closed: ".concat(m.toString())))})})}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||ar.networkState!==$n.OFFLINE||(this._onlineReconnectListener=ar.onlineWaiter&&ar.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},r){let u=NE(this._reconnectCount,this._retryConfig);v.debug("[".concat(this._name,"] wait ").concat(u,"ms to reconnect datachannel, mode: ").concat(t)),await _e.race([Xr(u),this._onlineReconnectListener||new _e(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;let s=async(u,h)=>{this.emit(Lr.RECONNECT_CREATE_CONNECTION,h),await this.createTransmitterConnection(u)};try{if(t==="retry"){let u=this._addresses[this.currentURLIndex];this.emit(Lr.RECONNECT_WAITTING_FINISH,t),await s(u,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let h=this.currentURLIndex;h<this._addresses.length;h++){if(this._addresses[h].fingerprint||x("FINGERPRINT")){this.currentURLIndex=h;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return v.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);v.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));let u=this._addresses[this.currentURLIndex];this.emit(Lr.RECONNECT_WAITTING_FINISH,t),await s(u,t)}else t==="recover"&&(v.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(Lr.RECONNECT_WAITTING_FINISH,t),this.emit(Lr.FAILBACK));return!0}catch(u){var c,l;return v.error("[".concat(this._name,"] reconnect failed"),u.toString()),u!=null&&(c=u.data)!==null&&c!==void 0&&c.desc&&Array.isArray(u.data.desc)&&u.data.desc.length&&ge(l=u.data.desc).call(l,"dynamic key expired")?(this.emit(Lr.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,r)}}}class Za extends Jt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ze.CONNECTED?this.emit(Te.WS_CONNECTED):t===Ze.RECONNECTING?this.emit(Te.WS_RECONNECTING,this._websocketReconnectReason):t===Ze.CLOSED&&this.emit(Te.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),b(this,"_disconnectedReason",void 0),b(this,"_websocketReconnectReason",void 0),b(this,"_connectionState",Ze.CLOSED),b(this,"reconnectToken",void 0),b(this,"websocket",void 0),b(this,"openConnectionTime",void 0),b(this,"clientId",void 0),b(this,"lastMsgTime",Date.now()),b(this,"uploadCache",[]),b(this,"uploadCacheInterval",void 0),b(this,"rttRolling",new CR(5)),b(this,"pingpongTimer",void 0),b(this,"inflateDataTimer",void 0),b(this,"pingpongTimeoutCount",0),b(this,"joinResponse",void 0),b(this,"multiIpOption",void 0),b(this,"initError",void 0),b(this,"spec",void 0),b(this,"store",void 0),b(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(Te.ON_BINARY_DATA,i);let s=JSON.parse(i);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){let c="res-@".concat(s._id);this.emit(c,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")&&(this.emit(s._type,s._message),s._type===Be.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Be.ON_USER_BANNED))switch(s._message.error_code){case 14:this.close(et.UID_BANNED);break;case 15:this.close(et.IP_BANNED);break;case 16:this.close(et.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new lM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ze.CONNECTED&&this.reconnect("retry",zc.OFFLINE)})}async request(t,r,i,s){let c=kt(6,""),l={_id:c,_type:t,_message:r},u=this.websocket.connectionID,h=()=>new _e((A,T)=>{if(this.connectionState===Ze.CONNECTED)return A();let w=()=>{this.off(Te.WS_CLOSED,O),A()},O=()=>{this.off(Te.WS_CONNECTED,w),T(new H(N.WS_ABORT))};this.once(Te.WS_CONNECTED,w),this.once(Te.WS_CLOSED,O),t!==Ne.PUBLISH&&t!==Ne.SUBSCRIBE&&t!==Ne.UNSUBSCRIBE&&t!==Ne.UNPUBLISH&&t!==Ne.CONTROL&&t!==Ne.RESTART_ICE||this.once(Te.DISCONNECT_P2P,()=>{T(new H(N.DISCONNECT_P2P))}),t!==Ne.PUBLISH&&t!==Ne.RESTART_ICE||this.once(Te.ABORT_P2P_EXECUTION,()=>{T(new H(N.DISCONNECT_P2P))})});if(this.connectionState!==Ze.CONNECTING&&this.connectionState!==Ze.RECONNECTING||t===Ne.JOIN||t===Ne.REJOIN||await h(),t===Ne.LEAVE&&(this.websocket.unbindDcCloseEventListener(),s=!0),this.websocket.sendMessage(l,!0,!1),s)return;let f=new _e((A,T)=>{let w=!1,O=(F,W)=>{w=!0,A({isSuccess:F==="success",message:W||{}}),this.off(Te.WS_CLOSED,P),this.off(Te.WS_RECONNECTING,P),this.emit(Te.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(c),O);let P=()=>{T(new H(N.WS_ABORT,"type: ".concat(t))),this.off(Te.WS_CLOSED,P),this.off(Te.WS_RECONNECTING,P),this.off("res-@".concat(c),O)};this.once(Te.WS_CLOSED,P),this.once(Te.WS_RECONNECTING,P),Xr(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||w||(v.warning("dc request timeout, type: ".concat(t)),this.emit(Te.REQUEST_TIMEOUT,t,r))})}),m=null;try{m=await f}catch(A){if(this.connectionState===Ze.CLOSED||t===Ne.LEAVE)throw new H(N.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?A.throw():t===Ne.JOIN||t===Ne.REJOIN?null:(await h(),await this.request(t,r))}if(m.isSuccess)return m.message;let E=Number(m.message.error_code||m.message.code),S=ad(E),y=new H(N.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(m.message.error_str),{code:E,data:m.message});return S.action==="success"?m.message:(v.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(S.desc,", action: ").concat(S.action)),E===Pe.ERR_TOO_MANY_BROADCASTERS?((t===Ne.JOIN||t===Ne.REJOIN)&&(this.initError=y,this.close()),y.throw()):S.action==="failed"?y.throw():S.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===Pe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",zc.MULTI_IP)):this.reconnect(S.action,zc.SERVER_ERROR),t===Ne.JOIN||t===Ne.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new _e(i=>{let s=c=>{(!r||r(c))&&(this.off(t,s),i(c))};this.on(t,s)})}uploadWRTCStats(t){if(!this.store.sessionId)return void v.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(sd.WRTC_STATS,r)}upload(t,r){let i={_type:t,_message:r};try{this.websocket.sendMessage(i)}catch{let s=x("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ze.CONNECTED)return;let c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},x("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){let i={_type:t,_message:r};this.websocket.sendMessage(i)}init(t,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new _e((i,s)=>{this.once(Te.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Te.WS_CLOSED,()=>s(this.initError||new H(N.WS_ABORT))),this.connectionState=Ze.CONNECTING,this.websocket.init(t).catch(s),this.websocket.once(Lr.FAILBACK,()=>{this.openConnectionTime===void 0&&s(new H(N.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{r&&this.openConnectionTime===void 0&&(v.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),s(new H(N.INIT_DATACHANNEL_TIMEOUT)))},x("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||et.LEAVE,this.connectionState=Ze.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===et.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new lM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Te.ABORT_P2P_EXECUTION);let t=await kr(this,Te.DATACHANNEL_CONNECTING),r=await this.request(Ne.JOIN,t);if(!r)return this.emit(Te.REPORT_JOIN_GATEWAY,N.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(Te.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ze.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new H(N.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=td(this,Te.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let r=await this.request(Ne.REJOIN,t);return!!r&&(this.connectionState=Ze.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(i=>{this.emit(Be.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Be.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Be.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Be.MUTE_AUDIO,{uid:i.uid}):this.emit(Be.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Be.MUTE_VIDEO,{uid:i.uid}):this.emit(Be.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Be.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Be.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Be.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Be.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Be.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);let r=ad(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(et.UID_BANNED),void this.close()):void this.reconnect(r.action,zc.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=x("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("PINGPONG Timeout. Last Socket Message: ".concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>x("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",zc.TIMEOUT):this.request(Ne.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let i=Date.now()-r;this.rttRolling.add(i),x("REPORT_STATS")&&this.send(Ne.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){let{inflateLength:t,deflateLength:r}=this.websocket.getInflateData();t!==0&&r!==0&&this.upload(sd.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Lr.RECONNECT_WAITTING_FINISH,t=>{this.emit(Te.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Lr.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Te.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Lr.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Lr.CLOSED,()=>{this.connectionState=Ze.CLOSED}),this.websocket.on(Lr.FAILED,()=>{this._disconnectedReason=et.NETWORK_ERROR,this.connectionState=Ze.CLOSED}),this.websocket.on(Lr.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ze.CONNECTED?this.connectionState=Ze.RECONNECTING:this.connectionState=Ze.CONNECTING}),this.websocket.on(Lr.WILL_RECONNECT,(t,r)=>{if(td(this,Te.IS_P2P_DISCONNECTED)&&t==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Te.NEED_RENEW_SESSION),this.emit(Te.DISCONNECT_P2P),r("tryNext");t!=="retry"&&(v.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Te.NEED_RENEW_SESSION),this.emit(Te.DISCONNECT_P2P)),r(t)}),this.websocket.on(Lr.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",zc.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Te.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof H&&t.code===N.UNEXPECTED_RESPONSE&&t.data.code===Pe.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",zc.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",zc.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Lr.REQUEST_NEW_URLS,(t,r)=>{kr(this,Te.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(Lr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Be.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Lr.TO_CONNECT_DATACHANNEL,async(t,r,i)=>kr(this,Te.DATACHANNEL_PRECONNECT,t).then(r).catch(i)),this.websocket.on(Lr.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Te.DATACHANNEL_FAILBACK)})}}class cd extends Jt{constructor(t,r){super(),b(this,"signal",void 0),b(this,"token",void 0),b(this,"tokenTimeout",void 0),b(this,"tokenInterval",void 0),b(this,"_sequence",0),b(this,"userMap",new Map),b(this,"encoder",new TextEncoder),this.signal=t,this.token=r;let i=()=>{this.signal.connectionState===Ze.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*x("P2P_TOKEN_INTERVAL"))};i()}async send(t,r,i,s,c){var l,u,h;if(this.userMap.size===0)return;let f=Array.from(Ms(l=this.userMap).call(l))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),s=(u=s)!==null&&u!==void 0?u:kt(6,""),c=(h=c)!==null&&h!==void 0?h:this._sequence++;let m={_id:s,_type:t,_seq:c,_message:r,token:"".concat(this.token,"_").concat(f)};x("SHOW_P2P_LOG")&&v.debug("send message",m,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(m)).forEach(S=>{this.signal.request(Ne.DATA_STREAM,{payload:Gc(this.encoder.encode(S))})});let E=new _e((S,y)=>{let A=window.setTimeout(()=>{this.off("res-@".concat(s,"_ack"),T),this.off("res-@".concat(s),O),this.off(xu.ABORT,w),v.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(s)),this.userMap.size===0?y(new ee(N.INVALID_REMOTE_USER)):y(new ee(N.TIMEOUT))},x("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),T=()=>{A&&window.clearTimeout(A),this.off(xu.ABORT,w),i&&S()},w=()=>{A&&window.clearTimeout(A),this.off("res-@".concat(s,"_ack"),T),this.off("res-@".concat(s),O),y(new ee(N.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(s)))};this.once(xu.ABORT,w),this.once("res-@".concat(s,"_ack"),T);let O=(F,W)=>{P=!0,A&&window.clearTimeout(A),this.off("res-@".concat(s,"_ack"),T),this.off(xu.ABORT,w),F==="success"?S(W):y(new ee(N.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(s)))},P=!1;i||(this.once("res-@".concat(s),O),Xr(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{P||v.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(s,", ").concat(m))}))});try{return await E}catch(S){if(S.code===N.TIMEOUT)return await this.send(t,r,i,s,c);throw S}}onMessage(t){var r;let{_uid:i}=t,s,c=this.userMap.get(i);if(c)s=c.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Er.CHECK)return;let{token:f}=t;s=new Map,c={uid:i,isStart:!0,token:f,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,c),this.signal.emit(Be.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var l;let{id:f,total:m}=t,E=(l=s.get(f))!==null&&l!==void 0?l:[];if(E.push(t),s.has(f)||s.set(f,E),E.length!==m)return;{let S=Mp(E).call(E,(y,A)=>y.index-A.index).map(y=>y.payload).join("");s.delete(f),(t=JSON.parse(S))._uid=i}}let{_type:u,token:h}=t;if(ge(r=[Er.ACK,Er.CHECK]).call(r,u))return u===Er.CHECK&&this.handleCheckToken(c,h),void this.receiveMessage(t);h==="".concat(c.token,"_").concat(this.token)?this.handleReceivedMessage(t):v.debug('Receive unexpected message", '.concat(h,", cur_token: ").concat(c.token,"_").concat(this.token),t)}check(){let t={_id:kt(6,""),token:this.token,_type:Er.CHECK};x("SHOW_P2P_LOG")&&v.debug("send message",t),this.signal.request(Ne.DATA_STREAM,{payload:Gc(this.encoder.encode(JSON.stringify(t)))})}ack(t){let r={_id:t,_type:Er.ACK,token:this.token};x("SHOW_P2P_LOG")&&v.debug("send message",r),this.signal.request(Ne.DATA_STREAM,{payload:Gc(this.encoder.encode(JSON.stringify(r)))})}response(t,r,i){this.send(Er.RESPONSE,JSON.stringify({success:!i,message:r}),!0,t)}handleReceivedMessage(t){let r=()=>{this.userMap.forEach(f=>{let{receivedMessagesMap:m,nextExpectedSequenceNumber:E}=f;for(;m.has(E);){let S=m.get(E);m.delete(E),this.receiveMessage(S),f.nextExpectedSequenceNumber++}})};if(!t)return void r();let{_uid:i,_seq:s}=t,c=this.userMap.get(i),{receivedMessagesMap:l,isStart:u,nextExpectedSequenceNumber:h}=c;if(s<h)return this.ack(t._id),void v.debug("[external-signal] receive old message, seq: ".concat(s,", ").concat(t._message));l.set(s,t),u&&s===h&&(this.receiveMessage(t),l.delete(h),c.nextExpectedSequenceNumber++,r())}receiveMessage(t){let{_id:r,_type:i,_message:s,_uid:c}=t;if(x("SHOW_P2P_LOG")&&v.debug("receive message",t),r){let l;switch(t._type!==Er.ACK&&(s&&(l=JSON.parse(s)),this.ack(t._id)),t._type){case Er.CANDIDATE:case Er.CONTROL:this.signal.emit(i,l,c);break;case Er.PUBLISH:case Er.UNPUBLISH:case Er.RESTART_ICE:case Er.CALL:l.uid=c,kr(this.signal,i,l).then(u=>{this.response(t._id,u)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Er.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case Er.RESPONSE:{let{success:u,message:h}=l;this.emit("res-@".concat(r),u?"success":"failed",h);break}}}}splitMessage(t){if(t.length<cd.MAX_MESSAGE_SIZE)return[t];let r=[],{remoteToken:i}=JSON.parse(t),s=kt(6,""),c=0,l=800,u=Math.ceil(t.length/l);for(;t.length>0;){c++;let h={id:s,index:c,total:u,payload:t.slice(0,l),token:"".concat(this.token,"_").concat(i)};JSON.stringify(h).length>cd.MAX_MESSAGE_SIZE?l-=50:(r.push(h),t=t.slice(l))}return r.map(h=>JSON.stringify(h))}handleCheckToken(t,r){return t.token!==r?(v.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{v.debug("token timeout, ".concat(r)),this.reset(t.uid)},x("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await kr(this.signal,Er.CALL,void 0),r=await this.send(Er.CALL,t);this.signal.emit(Te.P2P_CONNECTION,r,!0)}async reset(t,r){let i=this.userMap.get(t);i&&(this.emit(xu.ABORT),this.signal.emit(Be.ON_USER_OFFLINE,{uid:i.uid,reason:aZ.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(v.debug("change local token from ".concat(r," to ").concat(r)),this.token=kt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(xu.ABORT)}}b(cd,"MAX_SIZE",1),b(cd,"MAX_MESSAGE_SIZE",1024);class dM extends Jt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ze.CONNECTED?this.emit(Te.WS_CONNECTED):t===Ze.RECONNECTING?this.emit(Te.WS_RECONNECTING,this._websocketReconnectReason):t===Ze.CLOSED&&this.emit(Te.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),b(this,"_disconnectedReason",void 0),b(this,"_websocketReconnectReason",void 0),b(this,"_connectionState",Ze.CLOSED),b(this,"reconnectToken",void 0),b(this,"p2pToken",void 0),b(this,"websocket",void 0),b(this,"openConnectionTime",void 0),b(this,"clientId",void 0),b(this,"lastMsgTime",Date.now()),b(this,"uploadCache",[]),b(this,"uploadCacheInterval",void 0),b(this,"rttRolling",new CR(5)),b(this,"pingpongTimer",void 0),b(this,"pingpongTimeoutCount",0),b(this,"joinResponse",void 0),b(this,"multiIpOption",void 0),b(this,"initError",void 0),b(this,"spec",void 0),b(this,"store",void 0),b(this,"_external_signal",void 0),b(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Te.ON_BINARY_DATA,i.data);let s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){let c="res-@".concat(s._id);this.emit(c,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){switch(s._type){case Be.ON_DATA_STREAM:return void this.handleDataStream(s._message);case Be.MUTE_AUDIO:case Be.MUTE_VIDEO:case Be.ON_P2P_LOST:case Be.ON_USER_ONLINE:return;case Be.ON_USER_OFFLINE:let{uid:c}=s._message;return v.debug("[".concat(this.clientId,"] user-offline uid: ").concat(c)),void this._external_signal.reset(c)}if(this.emit(s._type,s._message),s._type===Be.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Be.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(et.UID_BANNED);break;case 15:this.close(et.IP_BANNED);break;case 16:this.close(et.CHANNEL_BANNED)}if(s._type===Be.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Pe.ERR_LICENSE_MISSING:this.close(et.LICENSE_MISSING);break;case Pe.ERR_LICENSE_EXPIRED:this.close(et.LICENSE_EXPIRED);break;case Pe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(et.LICENSE_MINUTES_EXCEEDED);break;case Pe.ERR_LICENSE_PERIOD_INVALID:this.close(et.LICENSE_PERIOD_INVALID);break;case Pe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(et.LICENSE_MULTIPLE_SDK_SERVICE);break;case Pe.ERR_LICENSE_ILLEGAL:this.close(et.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new nf("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ze.CONNECTED&&this.reconnect("retry",yn.OFFLINE)}),this.p2pToken=kt(6,""),this._external_signal=new cd(this,this.p2pToken)}async request(t,r,i,s){let c=kt(6,""),l={_id:c,_type:t,_message:r},u=this.websocket.connectionID,h=()=>new _e((A,T)=>{if(this.connectionState===Ze.CONNECTED)return A();let w=()=>{this.off(Te.WS_CLOSED,O),A()},O=()=>{this.off(Te.WS_CONNECTED,w),T(new ee(N.WS_ABORT))};this.once(Te.WS_CONNECTED,w),this.once(Te.WS_CLOSED,O)});if(this.connectionState!==Ze.CONNECTING&&this.connectionState!==Ze.RECONNECTING||t===Ne.JOIN||t===Ne.REJOIN||await h(),this.websocket.sendMessage(l,!0),s)return;let f=new _e((A,T)=>{let w=!1,O=(F,W)=>{w=!0,A({isSuccess:F==="success",message:W||{}}),this.off(Te.WS_CLOSED,P),this.off(Te.WS_RECONNECTING,P),this.emit(Te.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(c),O);let P=()=>{T(new ee(N.WS_ABORT,"type: ".concat(t))),this.off(Te.WS_CLOSED,P),this.off(Te.WS_RECONNECTING,P),this.off("res-@".concat(c),O)};this.once(Te.WS_CLOSED,P),this.once(Te.WS_RECONNECTING,P),Xr(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||w||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Te.REQUEST_TIMEOUT,t,r))})}),m=null;try{m=await f}catch(A){if(this.connectionState===Ze.CLOSED||t===Ne.LEAVE)throw new ee(N.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?A.throw():t===Ne.JOIN||t===Ne.REJOIN?null:(await h(),await this.request(t,r))}if(m.isSuccess)return m.message;let E=Number(m.message.error_code||m.message.code),S=ad(E),y=new ee(N.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(m.message.error_str),{code:E,data:m.message});return S.action==="success"?m.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(S.desc,", action: ").concat(S.action)),E===Pe.ERR_TOO_MANY_BROADCASTERS?((t===Ne.JOIN||t===Ne.REJOIN)&&(this.initError=y,this.close()),y.throw()):S.action==="failed"?y.throw():S.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===Pe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",yn.MULTI_IP)):this.reconnect(S.action,yn.SERVER_ERROR),t===Ne.JOIN||t===Ne.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new _e(i=>{let s=c=>{(!r||r(c))&&(this.off(t,s),i(c))};this.on(t,s)})}uploadWRTCStats(t){if(!this.store.sessionId)return void v.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(sd.WRTC_STATS,r)}upload(t,r){let i={_type:t,_message:r};try{this.websocket.sendMessage(i)}catch{let s=x("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ze.CONNECTED)return;let c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},x("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){let i={_type:t,_message:r};this.websocket.sendMessage(i)}async sendExtensionMessage(t,r,i){return await this._external_signal.send(t,r,i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new _e((r,i)=>{this.once(Te.WS_CONNECTED,()=>r(this.joinResponse)),this.once(Te.WS_CLOSED,()=>i(this.initError||new ee(N.WS_ABORT))),this.connectionState=Ze.CONNECTING,this.websocket.init(t).catch(i)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||et.LEAVE,this.connectionState=Ze.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===et.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new nf("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=kt(6,""),this._external_signal.clear(),this._external_signal=new cd(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Te.ABORT_P2P_EXECUTION);let t=await kr(this,Te.REQUEST_JOIN_INFO),r=await this.request(Ne.JOIN,t);if(!r)return this.emit(Te.REPORT_JOIN_GATEWAY,N.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(Te.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ze.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleDataStream(t){try{var r;let i=nd(t.payload),s=new TextDecoder().decode(i),c=JSON.parse(s);"total"in c&&"id"in c||ge(r=Object.values(Er)).call(r,c._type)?(c._uid=t.uid,this._external_signal.onMessage(c)):this.emit(Be.ON_DATA_STREAM,t)}catch{this.emit(Be.ON_DATA_STREAM,t)}}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);let r=ad(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(et.UID_BANNED),void this.close()):void this.reconnect(r.action,yn.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=x("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>x("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",yn.TIMEOUT):this.request(Ne.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let i=Date.now()-r;this.rttRolling.add(i),x("REPORT_STATS")&&this.send(Ne.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(Ue.RECONNECT_WAITTING_FINISH,t=>{this.emit(Te.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Ue.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Te.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ue.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ue.CLOSED,()=>{this.connectionState=Ze.CLOSED}),this.websocket.on(Ue.FAILED,()=>{this._disconnectedReason=et.NETWORK_ERROR,this.connectionState=Ze.CLOSED}),this.websocket.on(Ue.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ze.CONNECTED?this.connectionState=Ze.RECONNECTING:this.connectionState=Ze.CONNECTING}),this.websocket.on(Ue.WILL_RECONNECT,(t,r,i)=>{t!=="retry"?(v.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Te.NEED_RENEW_SESSION)):v.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)}),this.websocket.on(Ue.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Te.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof ee&&t.code===N.UNEXPECTED_RESPONSE&&t.data.code===Pe.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",yn.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",yn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Ue.REQUEST_NEW_URLS,(t,r)=>{kr(this,Te.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Be.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function uM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function Zo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uM(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uM(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let WR=new Map;class gZ extends Jt{get state(){return this._state}set state(t){if(t===this._state)return;let r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(_r.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(_r.CONNECTION_STATE_CHANGE,t,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){v.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,r){super(),b(this,"store",void 0),b(this,"joinInfo",void 0),b(this,"key",void 0),b(this,"ntpOffset",0),b(this,"signal",void 0),b(this,"role",void 0),b(this,"inChannelInfo",{joinAt:null,duration:0}),b(this,"spec",void 0),b(this,"_state","DISCONNECTED"),b(this,"_statsCollector",void 0),b(this,"_disconnectedReason",void 0),b(this,"isSignalRecover",!1),b(this,"hasChangeBGPAddress",!1),b(this,"trafficStatsInterval",void 0),b(this,"networkQualityInterval",void 0),b(this,"_joinGatewayStartTime",0),b(this,"_signalTimeout",!1),b(this,"_clientRoleOptions",void 0),b(this,"_isProactiveJoin",!1),this.store=t,this.spec=r,this.signal=this.store.useP2P?new dM(Zo(Zo({},r),{},{retryConfig:r.websocketRetryConfig}),t):this.store.useDataChannel?new Za(Zo(Zo({},r),{},{retryConfig:r.websocketRetryConfig}),t):new nM(Zo(Zo({},r),{},{retryConfig:r.websocketRetryConfig}),t),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}async join(t,r,i){if(this.signal instanceof Za){let h=!1;t.cloudProxyServer!=="disabled"?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),h=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),h=!0):t.apResponse.addresses.some(f=>f.fingerprint)||x("FINGERPRINT")||(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),h=!0),h&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let s=Date.now(),c=WR.get(t.cname);if(c||(c=new Map,WR.set(t.cname,c)),this._isProactiveJoin=!0,c.has(t.uid)){let h=new H(N.UID_CONFLICT);throw be.joinGateway(t.sid,{lts:s,succ:!1,ec:h.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof Za?"1":"0"}),this._isProactiveJoin=!1,h}c.set(t.uid,!0),this.joinInfo=t,this.key=r;let l=0;this.joinGatewayStartTime=s;let u=t.proxyServer;try{let h;if(v.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof Za?"datachannel":"websocket"," join uid ").concat(l)),this.signal instanceof Za)h=await this.signal.init(t.apResponse.addresses,i);else{let f=t.gatewayAddrs.map(m=>{let{address:E}=m,[S,y]=E.split(":"),A={host:S,port:y};return t.proxyServer&&(A.proxy=t.proxyServer),A});h=await this.signal.init(f,i)}l=h.uid,v.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof Za?"datachannel":"websocket"," join uid ").concat(l," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){throw h&&h.code===N.INIT_WEBSOCKET_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join failed"),h.toString()),h):h&&h.code===N.INIT_DATACHANNEL_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join datachannel failed"),h.toString()),this.resetSignal(),h):(v.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),be.joinGateway(t.sid,{lts:s,succ:!1,ec:h.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!u,signalChannel:this.signal instanceof Za?"1":"0"}),this._isProactiveJoin=!1,c.delete(t.uid),this.signal.close(),h)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),v.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{v.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(_r.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(_r.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(_r.NETWORK_QUALITY,{uplinkNetworkQuality:sM(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:sM(this._statsCollector.trafficStats.B_dnq)}):this.emit(_r.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),l}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==et.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Ze.CONNECTED||await function(i,s){return s===1/0?i:_e.race([i,oQ(s)])}(this.signal.request(Ne.LEAVE,void 0,!0),3e3)}catch(i){v.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(r),r!==et.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let s={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:x("PUB_EXTEND"),twcc:!!x("PUBLISH_TWCC"),rtx:!!x("USE_PUB_RTX")};try{return(await this.signal.request(Ne.PUBLISH,s,!0))._message}catch(c){if(i&&c.data&&c.data.code===Pe.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),c.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw c}}async publishDataChannel(t,r,i){var s;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let c={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(s=r.maxRetransmits)!==null&&s!==void 0?s:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(Ne.PUBLISH_DATASTREAM,c,!0)}catch(l){if(i&&l.data&&l.data.code===Pe.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),l.toString()),await this.tryUnpubDataChannelBeforeRepub(t,r),this.publishDataChannel(t,r,!1);throw l}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ne.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await _e.all(t.map(r=>this.signal.request(Ne.UNPUBLISH_DATASTREAM,{channel_id:r},!0)))}catch(r){v.warning("unpublish datachannels warning: ",r)}}async presubscribe(t,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let s={stream_id:t,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!x("SUBSCRIBE_TWCC"),rtx:!!x("USE_SUB_RTX")||void 0,extend:x("SUB_EXTEND"),svc:Array.isArray(x("SVC"))&&x("SVC").length!==0?x("SVC"):void 0};try{return await this.signal.request(Ne.PRE_SUBSCRIBE,s,!0)}catch(c){if(i&&c.data&&c.data.code===Pe.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),c.toString()),this.presubscribe(t,r,!1);throw c}}async subscribe(t,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let s={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!x("SUBSCRIBE_TWCC"),rtx:!!x("USE_SUB_RTX"),extend:x("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(x("SVC"))&&x("SVC").length!==0?x("SVC"):void 0};try{return(await this.signal.request(Ne.SUBSCRIBE,s,!0))._message}catch(c){if(i&&c.data&&c.data.code===Pe.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),c.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw c}}async subscribeDataChannel(t,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let s={uid:t,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(Ne.SUBSCRIBE_DATASTREAM,s,!0)}catch(c){if(i&&c.data&&c.data.code===Pe.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),c.toString()),await this.tryUnsubDataChannelBeforeResub(t,r),await this.subscribeDataChannel(t,r,!1);throw c}}async subscribeAll(t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!x("USE_SUB_RTX"),twcc:!!x("SUBSCRIBE_TWCC"),svc:Array.isArray(x("SVC"))&&x("SVC").length!==0?x("SVC"):void 0};try{return await this.signal.request(Ne.SUBSCRIBE_STREAMS,i,!0)}catch(s){if(r&&s.data&&s.data.code===Pe.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw s}}async setVideoProfile(t){let r=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let s=i.frameRate,c=i.width,l=i.height,u=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(u=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(u=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,s||(u=!1)),u?{stream_type:0,width:c,height:l,fps:s,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(r)return this.signal.request(Ne.SET_VIDEO_PROFILE,r);v.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,r){try{await this.signal.request(Ne.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await _e.all(t.map(i=>this.signal.request(Ne.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:r},!0)))}catch(i){v.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(Ne.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){v.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(t){let{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}=t;return{gatewayEstablishParams:await this.signal.request(Ne.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ne.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Ne.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),this.state!=="CONNECTED")return void(this.role=t);let i,s=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0,await this.signal.request(Ne.SET_CLIENT_ROLE,{role:t,level:s,delay:i,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,r){await this.signal.request(Ne.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ne.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,r){await this.signal.request(Ne.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(Ne.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Ne.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,r,i){if(this.signal instanceof dM)return this.signal.sendExtensionMessage(t,r,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Zo({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ne.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=WR.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=function(r){let i;return i=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:vn.username,password:vn.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Zo(Zo({},vn),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let t=await this.signal.request(Ne.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(r=>{let i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(s=>s.peer_uid===r.peer_uid);i&&i.B_st!==r.B_st&&bE(()=>{this.emit(_r.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new H(N.UNEXPECTED_ERROR,"can not generate join message, no join info");let r=Object.assign({},this.joinInfo.apResponse),i=x("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);let s=Zo({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Eo,browser:navigator.userAgent,process_id:x("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:x("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:x("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:x("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof x("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?x("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof x("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?x("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof x("ENABLE_USER_LICENSE_CHECK")=="boolean"?x("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:x("USE_PUB_RTX")===!0||x("USE_SUB_RTX")===!0||void 0,disableFEC:x("DISABLE_FEC"),enableNTPReport:!!x("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!x("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof x("ENABLE_DATASTREAM_2")=="boolean"?x("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!x("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof x("USE_XR")=="boolean"?x("USE_XR"):void 0,enableLossbasedBwe:typeof x("ENABLE_LOSSBASED_BWE")=="boolean"?x("ENABLE_LOSSBASED_BWE"):void 0,enableAutCC:typeof x("ENABLE_AUT_CC")=="boolean"?x("ENABLE_AUT_CC"):void 0,enableCCFallback:typeof x("ENABLE_CC_FALLBACK")=="boolean"?x("ENABLE_CC_FALLBACK"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,x("ENCRYPT_AES")?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),this.joinInfo.defaultVideoStream!==void 0&&(s.default_video_stream=this.joinInfo.defaultVideoStream),s}getRejoinMessage(){if(!this.joinInfo)throw new H(N.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Te.WS_RECONNECT_WAITTING_FINISH,t=>{var r;ge(r=["tryNext","recover"]).call(r,t)&&this.joinInfo&&be.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(Te.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Te.WS_RECONNECTING,t=>{this.joinInfo&&be.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||yn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",be.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Te.WS_CLOSED,t=>{let r;switch(t){case et.LEAVE:r=yn.LEAVE;break;case et.UID_BANNED:case et.IP_BANNED:case et.CHANNEL_BANNED:case et.SERVER_ERROR:r=yn.SERVER_ERROR;break;case et.FALLBACK:r=yn.FALLBACK;break;case et.LICENSE_MISSING:case et.LICENSE_EXPIRED:case et.LICENSE_MINUTES_EXCEEDED:case et.LICENSE_PERIOD_INVALID:case et.LICENSE_MULTIPLE_SDK_SERVICE:case et.LICENSE_ILLEGAL:case et.TOKEN_EXPIRE:r=t;break;default:r=yn.NETWORK_ERROR}v.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+yn.NETWORK_ERROR)),this.joinInfo&&be.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===et.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=t,t!==et.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Te.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(v.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),be.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Za?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void v.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Ot("EVENT_REPORT_DOMAIN",t[1]),Ot("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Ot("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(Be.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Te.REQUEST_RECOVER,(t,r,i)=>{if(!this.joinInfo)return i(new H(N.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,kr(this,_r.REQUEST_NEW_GATEWAY_LIST).then(r).catch(i)}),this.signal.on(Te.REQUEST_JOIN_INFO,async t=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}=await kr(this,_r.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(r=this.joinInfo)===null||r===void 0?void 0:r.turnServer});t(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:c,version:"2"}}))}),this.signal.on(Te.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Te.REPORT_JOIN_GATEWAY,(t,r)=>{this.joinInfo&&(be.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Za?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(Te.IS_P2P_DISCONNECTED,t=>{t(td(this,_r.IS_P2P_DISCONNECTED))}),this.signal.on(Te.DISCONNECT_P2P,()=>{this.emit(_r.DISCONNECT_P2P)}),this.signal.on(Te.NEED_RENEW_SESSION,t=>{this.emit(_r.NEED_RENEW_SESSION,t)}),this.signal.on(Te.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Te.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Te.JOIN_RESPONSE,t=>{let r=this.getCurrentGatewayAddress();this.emit(_r.JOIN_RESPONSE,t,r)}),this.signal.on(Te.DATACHANNEL_PRECONNECT,async(t,r,i)=>{this.updateTurnConfigFromSignal();let s=this.getCurrentGatewayAddress();return kr(this,_r.DATACHANNEL_PRECONNECT,t,s).then(r).catch(i)}),this.signal.on(Te.DATACHANNEL_CONNECTING,async t=>{let{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}=await kr(this,_r.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:r,dtlsParameters:i,rtpCapabilities:s,version:"2"}}))}),this.signal.on(Te.DATACHANNEL_FAILBACK,()=>{v.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(_r.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,r){try{await this.signal.request(Ne.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,r){try{await this.signal.request(Ne.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(i){throw v.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request(Ne.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,r){try{await this.signal.request(Ne.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(i){throw v.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){let r={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Ne.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,r){let i={action:t.find(s=>s.stream_type===vt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(t,r){let i={action:t.find(s=>s.stream_type===vt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}async muteRemote(t,r){let i={action:t===Ie.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),s),s}}async unmuteRemote(t,r){let i={action:t===Ie.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),s),s}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){let r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Ne.RESTART_ICE,r,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,yn.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!x("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Ne.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(et.FALLBACK)),this.store.useDataChannel=!1,this.signal=new nM(Zo(Zo({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(_r.RESET_SIGNAL,JL.websocket)}}let BE=0,GR=0;function Vs(e,t,r,i){return new _e((s,c)=>{t.timeout=t.timeout||x("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),BE+=_a(t.data)):r&&(t.data.size?BE+=t.data.size:t.data instanceof FormData?BE+=bL(t.data):BE+=_a(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,si.request(t).then(l=>{typeof l.data=="string"?GR+=_a(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?GR+=l.data.byteLength:GR+=_a(JSON.stringify(l.data)),i&&s({data:l.data,headers:l.headers}),s(l.data)}).catch(l=>{si.isCancel(l)?c(new H(N.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?c(new H(N.NETWORK_TIMEOUT,l.message)):l.response?c(new H(N.NETWORK_RESPONSE_ERROR,l.response.status)):c(new H(N.NETWORK_ERROR,l.message))})})}(function(){var e;function t(ne){var me=0;return function(){return me<ne.length?{done:!1,value:ne[me++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(ne,me,Re){return ne==Array.prototype||ne==Object.prototype||(ne[me]=Re.value),ne},i,s=function(ne){ne=[typeof globalThis=="object"&&globalThis,ne,typeof window=="object"&&window,typeof self=="object"&&self,typeof d=="object"&&d];for(var me=0;me<ne.length;++me){var Re=ne[me];if(Re&&Re.Math==Math)return Re}throw Error("Cannot find global object")}(this);function c(ne,me){if(me)e:{var Re=s;ne=ne.split(".");for(var He=0;He<ne.length-1;He++){var _t=ne[He];if(!(_t in Re))break e;Re=Re[_t]}(me=me(He=Re[ne=ne[ne.length-1]]))!=He&&me!=null&&r(Re,ne,{configurable:!0,writable:!0,value:me})}}function l(ne){return(ne={next:ne})[Symbol.iterator]=function(){return this},ne}function u(ne){var me=typeof Symbol<"u"&&Symbol.iterator&&ne[Symbol.iterator];return me?me.call(ne):{next:t(ne)}}if(c("Symbol",function(ne){function me(_t,Ee){this.A=_t,r(this,"description",{configurable:!0,writable:!0,value:Ee})}if(ne)return ne;me.prototype.toString=function(){return this.A};var Re="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",He=0;return function _t(Ee){if(this instanceof _t)throw new TypeError("Symbol is not a constructor");return new me(Re+(Ee||"")+"_"+He++,Ee)}}),c("Symbol.iterator",function(ne){if(ne)return ne;ne=Symbol("Symbol.iterator");for(var me="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Re=0;Re<me.length;Re++){var He=s[me[Re]];typeof He=="function"&&typeof He.prototype[ne]!="function"&&r(He.prototype,ne,{configurable:!0,writable:!0,value:function(){return l(t(this))}})}return ne}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var h;e:{var f={};try{f.__proto__={a:!0},h=f.a;break e}catch{}h=!1}i=h?function(ne,me){if(ne.__proto__=me,ne.__proto__!==me)throw new TypeError(ne+" is not extensible");return ne}:null}var m=i;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(ne){if(ne.m)throw new TypeError("Generator is already running");ne.m=!0}function y(ne,me){return ne.h=3,{value:me}}function A(ne){this.g=new E,this.G=ne}function T(ne,me,Re,He){try{var _t=me.call(ne.g.j,Re);if(!(_t instanceof Object))throw new TypeError("Iterator result "+_t+" is not an object");if(!_t.done)return ne.g.m=!1,_t;var Ee=_t.value}catch(I){return ne.g.j=null,ne.g.s(I),w(ne)}return ne.g.j=null,He.call(ne.g,Ee),w(ne)}function w(ne){for(;ne.g.h;)try{var me=ne.G(ne.g);if(me)return ne.g.m=!1,{value:me.value,done:!1}}catch(Re){ne.g.v=void 0,ne.g.s(Re)}if(ne.g.m=!1,ne.g.l){if(me=ne.g.l,ne.g.l=null,me.F)throw me.D;return{value:me.return,done:!0}}return{value:void 0,done:!0}}function O(ne){this.next=function(me){return ne.o(me)},this.throw=function(me){return ne.s(me)},this.return=function(me){return function(Re,He){S(Re.g);var _t=Re.g.j;return _t?T(Re,"return"in _t?_t.return:function(Ee){return{value:Ee,done:!0}},He,Re.g.return):(Re.g.return(He),w(Re))}(ne,me)},this[Symbol.iterator]=function(){return this}}function P(ne,me){return me=new O(new A(me)),m&&ne.prototype&&m(me,ne.prototype),me}if(E.prototype.o=function(ne){this.v=ne},E.prototype.s=function(ne){this.l={D:ne,F:!0},this.h=this.C||this.u},E.prototype.return=function(ne){this.l={return:ne},this.h=this.u},A.prototype.o=function(ne){return S(this.g),this.g.j?T(this,this.g.j.next,ne,this.g.o):(this.g.o(ne),w(this))},A.prototype.s=function(ne){return S(this.g),this.g.j?T(this,this.g.j.throw,ne,this.g.o):(this.g.s(ne),w(this))},c("Array.prototype.entries",function(ne){return ne||function(){return function(me,Re){me instanceof String&&(me+="");var He=0,_t=!1,Ee={next:function(){if(!_t&&He<me.length){var I=He++;return{value:Re(I,me[I]),done:!1}}return _t=!0,{done:!0,value:void 0}}};return Ee[Symbol.iterator]=function(){return Ee},Ee}(this,function(me,Re){return[me,Re]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var F=function(ne,me){for(var Re=0;Re<ne.length;Re++)me(ne[Re])},W=function(ne){return ne.replace(/\r?\n|\r/g,`\r
`)},K=function(ne,me,Re){return me instanceof Blob?(Re=Re!==void 0?Re+"":typeof me.name=="string"?me.name:"blob",me.name===Re&&Object.prototype.toString.call(me)!=="[object Blob]"||(me=new File([me],Re)),[String(ne),me]):[String(ne),String(me)]},X=function(ne,me){if(ne.length<me)throw new TypeError(me+" argument required, but only "+ne.length+" present.")},ie=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ae=ie.FormData,le=ie.XMLHttpRequest&&ie.XMLHttpRequest.prototype.send,we=ie.Request&&ie.fetch,nt=ie.navigator&&ie.navigator.sendBeacon,gt=ie.Element&&ie.Element.prototype,jt=ie.Symbol&&Symbol.toStringTag;jt&&(Blob.prototype[jt]||(Blob.prototype[jt]="Blob"),"File"in ie&&!File.prototype[jt]&&(File.prototype[jt]="File"));try{new File([],"")}catch{ie.File=function(ne,me,Re){return ne=new Blob(ne,Re||{}),Object.defineProperties(ne,{name:{value:me},lastModified:{value:+(Re&&Re.lastModified!==void 0?new Date(Re.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),jt&&Object.defineProperty(ne,jt,{value:"File"}),ne}}var wr=function(ne){return ne.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},ir=function(ne){this.i=[];var me=this;ne&&F(ne.elements,function(Re){if(Re.name&&!Re.disabled&&Re.type!=="submit"&&Re.type!=="button"&&!Re.matches("form fieldset[disabled] *"))if(Re.type==="file"){var He=Re.files&&Re.files.length?Re.files:[new File([],"",{type:"application/octet-stream"})];F(He,function(_t){me.append(Re.name,_t)})}else Re.type==="select-multiple"||Re.type==="select-one"?F(Re.options,function(_t){!_t.disabled&&_t.selected&&me.append(Re.name,_t.value)}):Re.type==="checkbox"||Re.type==="radio"?Re.checked&&me.append(Re.name,Re.value):(He=Re.type==="textarea"?W(Re.value):Re.value,me.append(Re.name,He))})};if((e=ir.prototype).append=function(ne,me,Re){X(arguments,2),this.i.push(K(ne,me,Re))},e.delete=function(ne){X(arguments,1);var me=[];ne=String(ne),F(this.i,function(Re){Re[0]!==ne&&me.push(Re)}),this.i=me},e.entries=function ne(){var me,Re=this;return P(ne,function(He){if(He.h==1&&(me=0),He.h!=3)return me<Re.i.length?He=y(He,Re.i[me]):(He.h=0,He=void 0),He;me++,He.h=2})},e.forEach=function(ne,me){X(arguments,1);for(var Re=u(this),He=Re.next();!He.done;He=Re.next()){var _t=u(He.value);He=_t.next().value,_t=_t.next().value,ne.call(me,_t,He,this)}},e.get=function(ne){X(arguments,1);var me=this.i;ne=String(ne);for(var Re=0;Re<me.length;Re++)if(me[Re][0]===ne)return me[Re][1];return null},e.getAll=function(ne){X(arguments,1);var me=[];return ne=String(ne),F(this.i,function(Re){Re[0]===ne&&me.push(Re[1])}),me},e.has=function(ne){X(arguments,1),ne=String(ne);for(var me=0;me<this.i.length;me++)if(this.i[me][0]===ne)return!0;return!1},e.keys=function ne(){var me,Re,He,_t,Ee=this;return P(ne,function(I){if(I.h==1&&(me=u(Ee),Re=me.next()),I.h!=3)return Re.done?void(I.h=0):(He=Re.value,_t=u(He),y(I,_t.next().value));Re=me.next(),I.h=2})},e.set=function(ne,me,Re){X(arguments,2),ne=String(ne);var He=[],_t=K(ne,me,Re),Ee=!0;F(this.i,function(I){I[0]===ne?Ee&&(Ee=!He.push(_t)):He.push(I)}),Ee&&He.push(_t),this.i=He},e.values=function ne(){var me,Re,He,_t,Ee=this;return P(ne,function(I){if(I.h==1&&(me=u(Ee),Re=me.next()),I.h!=3)return Re.done?void(I.h=0):(He=Re.value,(_t=u(He)).next(),y(I,_t.next().value));Re=me.next(),I.h=2})},ir.prototype._asNative=function(){for(var ne=new ae,me=u(this),Re=me.next();!Re.done;Re=me.next()){var He=u(Re.value);Re=He.next().value,He=He.next().value,ne.append(Re,He)}return ne},ir.prototype._blob=function(){var ne="----formdata-polyfill-"+Math.random(),me=[],Re="--"+ne+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(He,_t){return typeof He=="string"?me.push(Re+wr(W(_t))+`"\r
\r
`+W(He)+`\r
`):me.push(Re+wr(W(_t))+'"; filename="'+wr(He.name)+`"\r
Content-Type: `+(He.type||"application/octet-stream")+`\r
\r
`,He,`\r
`)}),me.push("--"+ne+"--"),new Blob(me,{type:"multipart/form-data; boundary="+ne})},ir.prototype[Symbol.iterator]=function(){return this.entries()},ir.prototype.toString=function(){return"[object FormData]"},gt&&!gt.matches&&(gt.matches=gt.matchesSelector||gt.mozMatchesSelector||gt.msMatchesSelector||gt.oMatchesSelector||gt.webkitMatchesSelector||function(ne){for(var me=(ne=(this.document||this.ownerDocument).querySelectorAll(ne)).length;0<=--me&&ne.item(me)!==this;);return-1<me}),jt&&(ir.prototype[jt]="FormData"),le){var ps=ie.XMLHttpRequest.prototype.setRequestHeader;ie.XMLHttpRequest.prototype.setRequestHeader=function(ne,me){ps.call(this,ne,me),ne.toLowerCase()==="content-type"&&(this.B=!0)},ie.XMLHttpRequest.prototype.send=function(ne){ne instanceof ir?(ne=ne._blob(),this.B||this.setRequestHeader("Content-Type",ne.type),le.call(this,ne)):le.call(this,ne)}}we&&(ie.fetch=function(ne,me){return me&&me.body&&me.body instanceof ir&&(me.body=me.body._blob()),we.call(this,ne,me)}),nt&&(ie.navigator.sendBeacon=function(ne,me){return me instanceof ir&&(me=me._asNative()),nt.call(this,ne,me)}),ie.FormData=ir}})();let af=()=>{let e=x("AREAS");return e.length===0&&e.push(mt.GLOBAL),Ds(e).call(e,(t,r,i)=>{let s=hM(r);return s?i===0?s:"".concat(t,",").concat(s):t},"")},hM=e=>e===mt.OVERSEA?"".concat(An.ASIA,",").concat(An.EUROPE,",").concat(An.AFRICA,",").concat(An.NORTH_AMERICA,",").concat(An.SOUTH_AMERICA,",").concat(An.OCEANIA):An[e],SZ=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(r=>{let i=VE[r],s=Object.keys(i);s&&s.map(c=>{c!=="CODE"&&(t[c]=t[c].concat(i[c]))})}),t},WE={GLOBAL:{ASIA:[mt.CHINA,mt.JAPAN,mt.INDIA,mt.KOREA,mt.HKMC],EUROPE:[],NORTH_AMERICA:[mt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},GE=Object.keys(WE[mt.GLOBAL]),HR=[mt.CHINA,mt.NORTH_AMERICA,mt.EUROPE,mt.ASIA,mt.JAPAN,mt.INDIA,mt.OCEANIA,mt.SOUTH_AMERICA,mt.AFRICA,mt.KOREA,mt.HKMC,mt.US],yZ=function(e,t){let r=[];if(ge(e).call(e,mt.GLOBAL)){let c=[mt.GLOBAL,mt.OVERSEA],l=Object.keys(VE);if(t===mt.GLOBAL)throw new H(N.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===mt.CHINA)r=[mt.OVERSEA];else if(s=t,ge(GE).call(GE,s)){let u=(i=t,WE[mt.GLOBAL][i]||[]),h=[...c,t,...u];r=l.filter(f=>!ge(h).call(h,f))}else if(function(u){let h=!1;return GE.forEach(f=>{var m;ge(m=WE[mt.GLOBAL][f]).call(m,u)&&(h=!0)}),h}(t)){let u=function(f){let m;return GE.forEach(E=>{var S;ge(S=WE[mt.GLOBAL][E]).call(S,f)&&(m=E)}),m}(t),h=[...c,u,t];r=l.filter(f=>!ge(h).call(h,f))}else r=e;r=function(u){let h=[];return HR.forEach(f=>{ge(u).call(u,f)&&h.push(f)}),h.concat(u.filter(f=>!ge(HR).call(HR,f)))}(r)}else r=e;var i,s;return r};function pM(e){var t,r;if(!e&&ge(t=x("AREAS")).call(t,mt.EXTENSIONS))return v.debug("update area from ap : reset"),void KR(fQ,!0);if(!ge(r=x("AREAS")).call(r,mt.GLOBAL)||!e)return;let i=VE.EXTENSIONS;i&&(i={CODE:hM(mt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},v.debug("update area from ap success: ".concat(e,",config is "),i),Ot("AREAS",[mt.EXTENSIONS],!0),Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Ot(s,i[s][0]):Ot(s,i[s])}))}function KR(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=be.reportApiInvoke(null,{name:Pr.SET_AREA,options:e,tag:sr.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(c=>{if(!ge(XL).call(XL,c))throw new H(N.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:c,excludedArea:l}=e;if(!c)throw new H(N.INVALID_PARAMS,"area code is needed");let u=c;typeof c=="string"&&(u=[c]),i=l?yZ(u,l):u}if(!t){if(Hc.AREAS){let c=new H(N.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(c),void v.warning("setArea is prohibited because of config-distribute")}if(ge(i).call(i,mt.GLOBAL)&&x("AREAS")===mt.EXTENSIONS){let c=new H(N.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(c),void v.warning("setArea is prohibited because of ap extensions")}}Ot("AREAS",i,t);let s=SZ(i);Object.keys(s).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Ot(c,s[c][0]):Ot(c,s[c])}),v.debug("set area success:",i.join(","))}catch(i){throw r.onError(i),i}r.onSuccess()}function fM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function zR(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fM(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fM(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let qR=1;function vZ(e,t,r,i,s){qR+=1;let c={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:qR,requestId:qR,version:Eo,cname:r.cname},l={service_name:t,json_body:JSON.stringify(c)},u,h,f=e[0];return Ls(async()=>{u=Date.now();let m=await Vs(f,{data:l,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-u,m.code!==0){let y=new H(N.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:h});throw v.error(y.toString()),y}let E=JSON.parse(m.json_body);if(E.code!==200){let y=new H(N.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:h});throw v.error(y.toString()),y}if(!E.servers||E.servers.length===0){let y=new H(N.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:h});throw v.error(y.toString()),y}let S=function(y,A){return{addressList:y.servers.map(T=>"wss://".concat(T.address.replace(/\./g,"-"),".").concat(x("WORKER_DOMAIN"),":").concat(T.wss,"?serviceName=").concat(encodeURIComponent(A))),workerToken:y.workerToken,vid:y.vid}}(E,t);return x("LIVE_STREAMING_ADDRESS")&&(S.addressList=x("LIVE_STREAMING_ADDRESS")instanceof Array?x("LIVE_STREAMING_ADDRESS"):[x("LIVE_STREAMING_ADDRESS")]),zR(zR({},S),{},{responseTime:h})},(m,E)=>(be.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(m.addressList),firstSuccess:E===0,responseTime:h,serverIp:e[E%e.length]}),!1),(m,E)=>(be.apworkerEvent(r.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:t,responseTime:h,serverIp:e[E%e.length]}),!!(m.code!==N.OPERATION_ABORTED&&m.code!==N.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(f=e[(E+1)%e.length],!0)),s)}let YR=1;function mM(e,t,r,i){let{url:s,areaCode:c}=e,{clientId:l,sid:u}=t,h=Date.now(),f,[m,E]=XR(t,c,[Cr.CHOOSE_SERVER]),S=ar.networkState;return Ls(async()=>{S&&ar.networkState===$n.OFFLINE&&ar.onlineWaiter&&await _e.race([ar.onlineWaiter,Xr(i&&i.maxRetryTimeout||Tr.maxRetryTimeout)]),S=ar.networkState;let{data:y,headers:A}=await Vs(s,{data:m,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=A.http3==="1"?1:-1,be.reportResourceTiming(s,u),EM(y,s,t,h,[Cr.CHOOSE_SERVER],f);let T=sf(y,Cr.CHOOSE_SERVER);return JR(T),jR(T,s)},y=>(y&&be.joinChooseServer(u,{lts:h,succ:!0,csAddr:s,opid:E,serverList:y.gatewayAddrs.map(A=>A.address),ec:null,cid:y.cid.toString(),uid:y.uid.toString(),csIp:y.csIp,unilbsServerIds:[Cr.CHOOSE_SERVER].toString(),isHttp3:f}),!1),y=>y.code!==N.OPERATION_ABORTED&&(y.code===N.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(be.joinChooseServer(u,{lts:h,succ:!1,csAddr:s,serverList:null,opid:E,ec:y.code,csIp:y.data&&y.data.csIp,unilbsServerIds:[Cr.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:S}),isHttp3:f}),v.warning("[".concat(l||"sid-".concat(u.slice(0,6)),"] Choose server network error, retry"),y),!0)),i)}function _M(e,t,r,i){let s,{url:c,areaCode:l,serviceIds:u}=e,h=Date.now(),[f,m]=XR(t,l,u),E;return Ls(async()=>{E&&ar.networkState===$n.OFFLINE&&ar.onlineWaiter&&await _e.race([ar.onlineWaiter,Xr(i&&i.maxRetryTimeout||Tr.maxRetryTimeout)]),E=ar.networkState;let{data:S,headers:y}=await Vs(c,{data:f,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=y.http3==="1"?1:-1,be.reportResourceTiming(c,t.sid),EM(S,c,t,h,u,s);let A=sf(S,Cr.CHOOSE_SERVER),T=sf(S,t.cloudProxyServer==="proxy5"?Cr.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Cr.CLOUD_PROXY:Cr.CLOUD_PROXY_FALLBACK);return JR(A),{gatewayInfo:jR(A,c),proxyInfo:T,url:c}},S=>(S.gatewayInfo&&be.joinChooseServer(t.sid,{lts:h,succ:!0,csAddr:c,serverList:S.gatewayInfo.gatewayAddrs.map(y=>y.address),ec:null,opid:m,cid:S.gatewayInfo.cid.toString(),uid:S.gatewayInfo.uid.toString(),csIp:S.gatewayInfo.csIp,unilbsServerIds:u.toString(),isHttp3:s}),S.proxyInfo&&be.joinWebProxyAP(t.sid,{lts:h,sucess:1,apServerAddr:c,turnServerAddrList:S.proxyInfo.addresses.map(y=>y.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:u.toString()}),!1),S=>S.code!==N.OPERATION_ABORTED&&(S.code===N.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(be.joinWebProxyAP(t.sid,{lts:h,sucess:0,apServerAddr:c,turnServerAddrList:null,errorCode:S.code,eventType:t.cloudProxyServer,unilbsServerIds:u.toString(),extend:JSON.stringify({networkState:E})}),v.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),S),!0)),i)}let EM=(e,t,r,i,s,c)=>{let{sid:l,clientId:u,cloudProxyServer:h}=r,f=[],m=E=>{E.flag===4096?be.joinChooseServer(l,{lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:c}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||be.joinWebProxyAP(l,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:E.error.code,eventType:h,unilbsServerIds:s.toString()})};if(e.response_body.forEach(E=>{let S=E.buffer.code;if(E.uri===23&&S===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{let y={error:new H(N.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:E.buffer.flag};f.push(y),m(y)}if(S!==0){let y=Uu(S),A={error:new H(N.CAN_NOT_GET_GATEWAY_SERVER,y.desc,{desc:y.desc,retry:y.retry,csIp:e.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?v.warning(A.error.toString()):f.push(A),m(A)}}),f.length)throw v.warning("[".concat(u||"sid-".concat(l.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(f.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message,", retry: ").concat(E.error.data.retry)).join(" | "))),new H(N.CAN_NOT_GET_GATEWAY_SERVER,f.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message)).join(" | "),{retry:!!f.find(E=>E.error.data.retry),csIp:e.detail[502],desc:[...new Set(f.map(E=>{var S;return E==null||(S=E.error)===null||S===void 0||(S=S.data)===null||S===void 0?void 0:S.desc}).filter(E=>!!E))]})},JR=e=>{var t,r,i,s;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new H(N.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(x("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((s=e.detail)===null||s===void 0?void 0:s[23])=="string"?pM(e.detail[23].toLowerCase()):pM()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){let l=e.detail[19],u=l==null?void 0:l.split(";");for(let h=0;h<u.length;h++){var c;let f=Wn(c=u[h]).call(c);e.addresses[h]&&u&&(e.addresses[h].fingerprint=f)}}if(x("GATEWAY_ADDRESS")&&x("GATEWAY_ADDRESS").length>0){v.debug("assign gateway address to",x("GATEWAY_ADDRESS"));let l=x("GATEWAY_ADDRESS").map(u=>{var h,f;let m=(h=(f=e.addresses.find(E=>E.ip===u.ip&&E.port===u.port))===null||f===void 0?void 0:f.fingerprint)!==null&&h!==void 0?h:"";return{ip:u.ip,port:u.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:m}});e.addresses=l}},TZ=(e,t)=>{if(e.response_body&&e.response_body.length){let r=e.response_body[0];if(r.buffer.code!==0){let i=Uu(r.buffer.code);throw new H(N.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return r.buffer.ticket}throw v.debug("update ticket request received ap response without response body:",t),new H(N.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},XR=(e,t,r)=>{let i=Math.floor(Math.random()*1e12),s={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:zR({6:e.stringUid,11:t,12:x("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};s.request_bodies.forEach(l=>{e.multiIP&&e.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]},CZ=(e,t)=>{let r=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(c=>({ip:c.ip,port:c.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(i)),[s,r]},Vu=0;function Fu(e){return _e.all(e.map(t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}let cf=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:i,allFailedhandler:s,promisesCollector:c}=e,l=0,u=t,h,f=0,m=async()=>{let E=(()=>{let S=l*u,y=S+u;return r.slice(S,y).map(i)})();c&&c.push(...E);try{h=await Fu(E)}catch(S){if(f+=u,l++,!(f>=r.length))return void await m();s(S)}E.forEach(S=>S.cancel())};return await m(),h},gM=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:i}=e,s=t.length,c=0,l=async()=>{let u=r(t.shift());try{return await u}catch(h){if(c++,c>=s||i!=null&&i(h))throw h;return l()}};return l()};async function $R(e,t,r,i){return{gatewayInfo:await async function(s,c,l,u){let h=null,f=[],m=async()=>{let S=x("WEBCS_DOMAIN").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(T=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(T+"/api/v2/transpond/webrtc?v=2"):"https://".concat(T,"/api/v2/transpond/webrtc?v=2"),areaCode:af()})),y=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(T=>T.url)}),A=await cf({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:T=>(v.debug("[".concat(s.clientId,"] Connect to choose_server:"),T.url),mM(T,s,c,l)),allFailedhandler:T=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:T},y),T[0]},promisesCollector:f});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},y),A},E=async()=>{if(await Xr(1e3),h!==null)return h;let S=x("WEBCS_DOMAIN_BACKUP_LIST").map(T=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(T+"/api/v2/transpond/webrtc?v=2"):"https://".concat(T,"/api/v2/transpond/webrtc?v=2"),areaCode:af()})),y=u.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(T=>T.url)}),A=await cf({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:T=>(v.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),T.url),mM(T,s,c,l)),allFailedhandler:T=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:T},y),T[0]},promisesCollector:f});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},y),A};try{return h=await Fu([m(),E()]),f.length&&f.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),h}catch(S){throw S[0]}}(e,t,r,i)}}async function SM(e,t,r,i,s){let c=e.cloudProxyServer;if(c==="disabled"){if(e.useLocalAccessPoint)return await $R(e,t,r,s);if(x("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:S,proxyInfo:y}=await TM(e,t,r,s);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:S};let A=y.map(T=>({turnServerURL:T.address,tcpport:T.tcpport||vn.tcpport,udpport:T.udpport||vn.udpport,username:T.username||vn.username,password:T.password||vn.password,forceturn:!1,security:!0}));if(s.useP2P){var l;let T=(l=e.uid)!==null&&l!==void 0?l:S.uid,w="glb:".concat(T.toString()),O=await yR(w),P=y.map(F=>({turnServerURL:F.address,tcpport:F.tcpport||vn.tcpport,udpport:F.udpport||vn.udpport,username:w,password:O,forceturn:!1,security:!0}));A.push(...P)}return e.turnServer={mode:"manual",servers:A},{gatewayInfo:S}}return await $R(e,t,r,s)}let{proxyInfo:u,gatewayInfo:h}=await TM(e,t,r,s),f={gatewayInfo:h},m=u.map(S=>({turnServerURL:S.address,tcpport:c==="proxy3"?void 0:S.tcpport?S.tcpport:vn.tcpport,udpport:c==="proxy4"?void 0:S.udpport?S.udpport:vn.udpport,username:S.username||vn.username,password:S.password||vn.password,forceturn:c!=="proxy4",security:c==="proxy5"}));if(s.useP2P){var E;let S=(E=e.uid)!==null&&E!==void 0?E:h.uid,y="glb:".concat(S.toString()),A=await yR(y),T=u.map(w=>({turnServerURL:w.address,tcpport:c==="proxy3"?void 0:w.tcpport||vn.tcpport,udpport:c==="proxy4"?void 0:w.udpport||vn.udpport,username:y,password:A,forceturn:c!=="proxy4",security:c==="proxy5"}));m.push(...T)}return e.turnServer={mode:"manual",servers:m},v.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(c)),f}async function yM(e,t,r,i,s){let c=x("ACCOUNT_REGISTER").slice(0,x("AJAX_REQUEST_CONCURRENT")),l=[];l=t.proxyServer?c.map(h=>"https://".concat(t.proxyServer,"/ap/?url=").concat(h+"/api/v1")):c.map(h=>"https://".concat(h,"/api/v1"));let u=s==null?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:l});try{let h=await async function(f,m,E,S,y){let A=Date.now(),T={sid:E.sid,opid:10,appid:E.appId,string_uid:m},w=f[0],O=await Ls(()=>Vs(w+"".concat(w.indexOf("?")===-1?"?":"&","action=stringuid"),{data:T,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(P,F)=>{if(P.code===0){if(P.uid<=0||P.uid>=Math.pow(2,32))throw v.error("Invalid Uint Uid ".concat(m," => ").concat(P.uid),P),be.reqUserAccount(T.sid,{lts:A,success:!1,serverAddr:w,stringUid:T.string_uid,uid:P.uid,errorCode:N.INVALID_UINT_UID_FROM_STRING_UID,extend:T}),new H(N.INVALID_UINT_UID_FROM_STRING_UID);return be.reqUserAccount(T.sid,{lts:A,success:!0,serverAddr:w,stringUid:T.string_uid,uid:P.uid,errorCode:null,extend:T}),!1}let W=Uu(P.code);return W.retry&&(w=f[(F+1)%f.length]),be.reqUserAccount(T.sid,{lts:A,success:!1,serverAddr:w,stringUid:T.string_uid,uid:P.uid,errorCode:W.desc,extend:T}),W.retry},(P,F)=>P.code!==N.OPERATION_ABORTED&&(be.reqUserAccount(T.sid,{lts:A,success:!1,serverAddr:w,stringUid:T.string_uid,uid:null,errorCode:P.code,extend:T}),w=f[(F+1)%f.length],!0),y);if(O.code!==0){let P=Uu(O.code);throw new H(N.UNEXPECTED_RESPONSE,P.desc)}return O}(l,e,t,r,i);return s==null||s.recordJoinChannelService({status:"success",endTs:Date.now()},u),h.uid}catch(h){throw s==null||s.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},u),h}}async function RZ(e,t,r){let i=x("ACCOUNT_REGISTER"),s=[];s=t.proxyServer?i.map(c=>"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1")):i.map(c=>"https://".concat(c,"/api/v1"));try{return await gM({referenceList:s,asyncMapHandler:c=>async function(l,u,h,f){let m=Date.now(),E={sid:h.sid,opid:10,appid:h.appId,string_uid:u};try{let S=await Vs(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:E,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(S.code!==0){let y=Uu(S.code);throw new H(N.UNEXPECTED_RESPONSE,"preload sua error:".concat(y.desc),y)}if(S.uid<=0||S.uid>=Math.pow(2,32))throw new H(N.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:m,url:l,req:E,uid:S.uid,elapse:Date.now()-m}}catch(S){throw S}}(c,e,t,r),closeFn:c=>c.code===N.OPERATION_ABORTED||c.code===N.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(c){throw c}}async function wZ(e,t,r){let i=x("CDS_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v1"):"https://".concat(h,"/api/v1?action=config")),s=i.map(h=>function(f,m,E,S){let y=dt(),A={flag:64,cipher_method:0,features:{device:y.name,system:y.os,system_general:navigator.userAgent,vendor:m.appId,version:Eo,cname:m.cname,sid:m.sid,session_id:m.sid,detail:"",proxyServer:m.proxyServer}};return Ls(()=>Vs(f,{data:A,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,T=>T.code!==N.OPERATION_ABORTED,S)}(h,e,t,r)),c=null,l=null,u={};try{c=await Fu(s)}catch(h){if(h.code===N.OPERATION_ABORTED)throw h;l=h}if(s.forEach(h=>h.cancel()),be.reportApiInvoke(e.sid,{name:Pr.REQUEST_CONFIG_DISTRIBUTE,options:{error:l,res:c}}).onSuccess(),c&&c.test_tags)try{u=function(h){if(!h.test_tags)return{};let f=h.test_tags,m=Object.keys(f),E={};return m.forEach(S=>{var y;let A=Wn(y=S.slice(4)).call(y),T=JSON.parse(f[S])[1];E[A]=T}),E}(c)}catch{}return u}async function vM(e,t){let r=x("WEBCS_DOMAIN").concat(x("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:af(),serviceIds:[Cr.CHOOSE_SERVER,Cr.CLOUD_PROXY_FALLBACK]}));try{return await gM({referenceList:r,asyncMapHandler:i=>async function(s,c,l){let u,{url:h,areaCode:f,serviceIds:m}=s,E=Date.now(),[S,y]=XR(c,f,m),A=ar.networkState;try{A&&ar.networkState===$n.OFFLINE&&ar.onlineWaiter&&await _e.race([ar.onlineWaiter,Xr(Tr.maxRetryTimeout)]),A=ar.networkState;let{data:T,headers:w}=await Vs(h,{data:S,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=w.http3==="1"?1:-1,(F=>{let W=[];if(F.response_body.forEach(K=>{let X=K.buffer.code;if(K.uri===23&&X===0&&!K.buffer.edges_services)if(K.buffer.flag===4194310)K.buffer.edges_services=[];else{let ie={error:new H(N.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:F.detail[502]}),flag:K.buffer.flag};W.push(ie)}if(X!==0){let ie=Uu(X),ae={error:new H(N.CAN_NOT_GET_GATEWAY_SERVER,ie.desc,{desc:ie.desc,retry:ie.retry,csIp:F.detail[502]}),flag:K.buffer.flag};K.buffer.flag===4194310?v.warning(ae.error.toString()):W.push(ae)}}),W.length)throw new H(N.CAN_NOT_GET_GATEWAY_SERVER,W.map(K=>"flag: ".concat(K.flag,", message: ").concat(K.error.message)).join(" | "),{retry:!!W.find(K=>K.error.data.retry),csIp:F.detail[502],desc:[...new Set(W.map(K=>{var X;return K==null||(X=K.error)===null||X===void 0||(X=X.data)===null||X===void 0?void 0:X.desc}).filter(K=>!!K))]})})(T);let O=sf(T,Cr.CHOOSE_SERVER),P=sf(T,Cr.CLOUD_PROXY_FALLBACK);return JR(O),{gatewayInfo:jR(O,h),proxyInfo:P,opid:y,requestTime:E,url:h,isHttp3:u,elapse:Date.now()-E}}catch(T){throw T}}(i,e,t),closeFn:i=>i.code===N.OPERATION_ABORTED||i.code===N.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(i){throw i}}async function TM(e,t,r,i){let s=x("PROXY_SERVER_TYPE3"),c=(y,A,T)=>{let w=T||s;return Array.isArray(w)&&(w=A%2==0?s[1]:s[0]),"https://".concat(w,"/ap/?url=").concat(y)},l=null,u=[],h=async()=>{let y=x("WEBCS_DOMAIN").slice(0,x("AJAX_REQUEST_CONCURRENT")).map((w,O)=>{let P;return P=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(w,"/api/v2/transpond/webrtc?v=2"),O,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):c("".concat(w,"/api/v2/transpond/webrtc?v=2"),O),{url:P,areaCode:af(),serviceIds:[Cr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Cr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Cr.CLOUD_PROXY:Cr.CLOUD_PROXY_FALLBACK]}}),A=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(w=>w.url)}),T=await cf({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:w=>(v.debug("[".concat(e.clientId,"] Connect to choose_server:"),w.url),_M(w,e,t,r)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},A),w[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},A),T},f=async()=>{if(await Xr(1e3),l!==null)return l;let y=x("WEBCS_DOMAIN_BACKUP_LIST").map((w,O)=>{let P;return P=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(w,"/api/v2/transpond/webrtc?v=2"),O,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):c("".concat(w,"/api/v2/transpond/webrtc?v=2"),O),{url:P,areaCode:af(),serviceIds:[Cr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Cr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Cr.CLOUD_PROXY:Cr.CLOUD_PROXY_FALLBACK]}}),A=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(w=>w.url)}),T=await cf({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:w=>(v.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),w.url),_M(w,e,t,r)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},A),w[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},A),T},m,E,S;try{({gatewayInfo:m,proxyInfo:E,url:S}=await Fu([h(),f()]))}catch(y){throw y[0]}if(u.length&&u.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!m||!E)throw new H(N.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=S,e.cloudProxyServer!=="disabled"&&Array.isArray(s)&&S){let y=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];ge(s).call(s,y)&&(e.proxyServer=y,v.setProxyServer(y),be.setProxyServer(y))}return l={gatewayInfo:m,proxyInfo:await aM(E,m.uid)},l}async function CM(e,t,r,i){let s=x("UAP_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(c=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1?action=uap"):"https://".concat(c,"/api/v1?action=uap"));return await vZ(s,e,t,r,i)}async function IZ(e,t,r){let i=x("UAP_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1?action=uap"):"https://".concat(c,"/api/v1?action=uap")),s=i.map(c=>function(l,u,h,f){let m={command:"convergeAllocateEdge",sid:u.sid,appId:u.appId,token:u.token,ts:Date.now(),version:Eo,cname:u.cname,uid:u.uid.toString(),requestId:YR,seq:YR};YR+=1;let E={service_name:"tele_channel",json_body:JSON.stringify(m)};return Ls(async()=>{let S=await Vs(l,{data:E,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){let A=new H(N.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw v.error(A.toString()),A}let y=JSON.parse(S.json_body);if(y.code!==200){let A=new H(N.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw v.error(A.toString()),A}if(!y.servers||y.servers.length===0){let A=new H(N.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw v.error(A.toString()),A}return{vid:y.vid,workerToken:y.workerToken,addressList:(x("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(x("WORKER_DOMAIN"),":").concat(A.wss))}},void 0,S=>!!(S.code!==N.OPERATION_ABORTED&&S.code!==N.UNEXPECTED_RESPONSE||S.data&&S.data.retry),f)}(c,e,t,r));try{let c=await Fu(s);return s.forEach(l=>l.cancel()),c}catch(c){throw c[0]}}async function bZ(e,t,r){let i=null,s=[],c=async l=>{let u=x(l?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return l&&(await Xr(1e3),i!==null)?i:await cf({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:u,asyncMapHandler:h=>(v.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(l?"backup":""," choose_server:"),h),function(f,m,E,S){let[y]=CZ(m,[Cr.CHOOSE_SERVER]),A=ar.networkState;return Ls(async()=>{A&&ar.networkState===$n.OFFLINE&&ar.onlineWaiter&&await _e.race([ar.onlineWaiter,Xr(S&&S.maxRetryTimeout||Tr.maxRetryTimeout)]),A=ar.networkState;let T=await Vs(f,{data:y,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return TZ(T,f)},()=>!1,T=>T.code!==N.OPERATION_ABORTED&&(T.code===N.UPDATE_TICKET_FAILED?T.data.retry:(v.warning("[".concat(m.clientId,"] update ticket network error, retry"),T),!0)),S)}(h,e,t,r)),allFailedhandler:h=>{throw h[0]},promisesCollector:s})};try{return i=await Fu([c(!1),c(!0)]),s.length&&s.forEach(l=>l.cancel&&typeof l.cancel=="function"&&l.cancel()),i}catch(l){throw l[0]}}function RM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function wM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RM(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RM(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class AZ extends Jt{get isSuccess(){return!!this.configs}constructor(){super(),b(this,"configs",void 0),b(this,"joinInfo",void 0),b(this,"cancelToken",void 0),b(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),b(this,"interval",void 0),b(this,"mutex",new rn("config-distribute")),b(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),x("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},x("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,be.reportApiInvoke(null,{options:void 0,name:Pr.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:sr.TRACER}).onSuccess(JSON.stringify(Hc))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void v.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,r=await this.mutex.lock();try{t=await wZ(this.joinInfo,this.cancelToken,this.retryConfig),v.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(i){let s=new H(N.NETWORK_RESPONSE_ERROR,i);v.warning("[config-distribute] ".concat(s.toString()))}finally{r()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var r;(r=t)&&r.uplink&&r.id&&r.uplink.max_bitrate!==void 0&&r.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(VR.UPDATE_BITRATE_LIMIT,t):this.emit(VR.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&wM({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var r;let i=Mp(r=Object.keys(t).filter(c=>/^webrtc_ng_global_parameter/.test(c))).call(r);for(let c=0;c<i.length;c++)for(let l=i.length-1;l>c;l--){let u=i[l];if(typeof t[u].__priority=="number"){let h=t[u].__priority,f=i[l-1];if(typeof t[f].__priority=="number"){if(!(h>t[f].__priority))continue;{let m=u;i[l]=i[l-1],i[l-1]=m}}else{let m=u;i[l]=i[l-1],i[l-1]=m}}}let s={};i.forEach(c=>{let l=t[c],u=l.__expires;Object.keys(l).forEach(h=>{h==="__priority"||h==="__expires"||Object.prototype.hasOwnProperty.call(s,h)||(s[h]=wM({value:l[h]},u&&{expires:u}))})});try{(function(u){try{let h=Date.now();Object.keys(u).forEach(f=>{switch(f){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(Ur,f)){let{value:m,expires:E}=u[f];if(E&&E<=h)return;Hc[f]=m,Ur[f]=m,v.debug("Update global parameters from config distribute",f,m)}}})}catch(h){v.error("Error update config immediately: ".concat(u),h.message)}})(s);let c=JSON.stringify(s),l=window.btoa(c);window.localStorage.setItem("websdk_ng_global_parameter",l),v.debug("Caching global parameters ".concat(c))}catch(c){v.error("Error caching global parameters:",c.message)}}}var es,OZ=p(KL),IM=jr,NZ=k,DZ=Ge,PZ=_,QR=b_,kZ=Rp,LZ=ut,MZ=gi,xZ=tu,ju=Object.assign,bM=Object.defineProperty,UZ=NZ([].concat),VZ=!ju||PZ(function(){if(IM&&ju({b:1},ju(bM({},"a",{enumerable:!0,get:function(){bM(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(s){t[s]=s}),ju({},e)[r]!=7||QR(ju({},t)).join("")!=i})?function(e,t){for(var r=MZ(e),i=arguments.length,s=1,c=kZ.f,l=LZ.f;i>s;)for(var u,h=xZ(arguments[s++]),f=c?UZ(QR(h),c(h)):QR(h),m=f.length,E=0;m>E;)u=f[E++],IM&&!DZ(l,h,u)||(r[u]=h[u]);return r}:ju,FZ=Si,jZ=iN,BZ=Dc,WZ=Ge,GZ=gi,HZ=function(e,t,r,i){try{return i?t(FZ(r)[0],r[1]):t(r)}catch(s){jZ(e,"throw",s)}},KZ=tN,zZ=F_,qZ=za,AM=Q_,YZ=_T,JZ=N_,OM=Array,ld=k,ZR=2147483647,XZ=/[^\0-\u007E]/,NM=/[.\u3002\uFF0E\uFF61]/g,DM="Overflow: input needs wider integers to process",PM=RangeError,$Z=ld(NM.exec),Bu=Math.floor,ew=String.fromCharCode,kM=ld("".charCodeAt),LM=ld([].join),Xc=ld([].push),QZ=ld("".replace),ZZ=ld("".split),eee=ld("".toLowerCase),MM=function(e){return e+22+75*(e<26)},tee=function(e,t,r){var i=0;for(e=r?Bu(e/700):e>>1,e+=Bu(e/t);e>455;)e=Bu(e/35),i+=36;return Bu(i+36*e/(e+38))},ree=function(e){var t=[];e=function(O){for(var P=[],F=0,W=O.length;F<W;){var K=kM(O,F++);if(K>=55296&&K<=56319&&F<W){var X=kM(O,F++);(64512&X)==56320?Xc(P,((1023&K)<<10)+(1023&X)+65536):(Xc(P,K),F--)}else Xc(P,K)}return P}(e);var r,i,s=e.length,c=128,l=0,u=72;for(r=0;r<e.length;r++)(i=e[r])<128&&Xc(t,ew(i));var h=t.length,f=h;for(h&&Xc(t,"-");f<s;){var m=ZR;for(r=0;r<e.length;r++)(i=e[r])>=c&&i<m&&(m=i);var E=f+1;if(m-c>Bu((ZR-l)/E))throw PM(DM);for(l+=(m-c)*E,c=m,r=0;r<e.length;r++){if((i=e[r])<c&&++l>ZR)throw PM(DM);if(i==c){for(var S=l,y=36;;){var A=y<=u?1:y>=u+26?26:y-u;if(S<A)break;var T=S-A,w=36-A;Xc(t,ew(MM(A+T%w))),S=Bu(T/w),y+=36}Xc(t,ew(MM(S))),u=tee(l,E,f==h),l=0,f++}}l++,c++}return LM(t,"")},nee=Ut,tw=jr,iee=HC,rw=z,xM=Dc,ts=k,HE=kc,rs=V_,oee=OT,nw=Nr,iw=VZ,Wu=function(e){var t=GZ(e),r=zZ(this),i=arguments.length,s=i>1?arguments[1]:void 0,c=s!==void 0;c&&(s=BZ(s,i>2?arguments[2]:void 0));var l,u,h,f,m,E,S=JZ(t),y=0;if(!S||this===OM&&KZ(S))for(l=qZ(t),u=r?new this(l):OM(l);l>y;y++)E=c?s(t[y],y):t[y],AM(u,y,E);else for(m=(f=YZ(t,S)).next,u=r?new this:[];!(h=WZ(m,f)).done;y++)E=c?HZ(f,s,[h.value,y],!0):h.value,AM(u,y,E);return u.length=y,u},Fs=gC,see=sC.codeAt,aee=function(e){var t,r,i=[],s=ZZ(QZ(eee(e),NM,"."),".");for(t=0;t<s.length;t++)r=s[t],Xc(i,$Z(XZ,r)?"xn--"+ree(r):r);return LM(i,".")},ec=mo,cee=Lc,lee=j_,UM=f$,VM=Yl,dee=VM.set,KE=VM.getterFor("URL"),uee=UM.URLSearchParams,hee=UM.getState,lf=rw.URL,ow=rw.TypeError,zE=rw.parseInt,pee=Math.floor,FM=Math.pow,ns=ts("".charAt),js=ts(/./.exec),df=ts([].join),fee=ts(1 .toString),mee=ts([].pop),Gu=ts([].push),sw=ts("".replace),_ee=ts([].shift),Eee=ts("".split),uf=ts("".slice),qE=ts("".toLowerCase),gee=ts([].unshift),aw="Invalid scheme",hf="Invalid host",jM="Invalid port",BM=/[a-z]/i,See=/[\d+-.a-z]/i,cw=/\d/,yee=/^0x/i,vee=/^[0-7]+$/,Tee=/^\d+$/,WM=/^[\da-f]+$/i,Cee=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Ree=/[\0\t\n\r #/:<>?@[\\\]^|]/,wee=/^[\u0000-\u0020]+/,Iee=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,bee=/[\t\n\r]/g,pf=function(e){var t,r,i,s;if(typeof e=="number"){for(t=[],r=0;r<4;r++)gee(t,e%256),e=pee(e/256);return df(t,".")}if(typeof e=="object"){for(t="",i=function(c){for(var l=null,u=1,h=null,f=0,m=0;m<8;m++)c[m]!==0?(f>u&&(l=h,u=f),h=null,f=0):(h===null&&(h=m),++f);return f>u&&(l=h,u=f),l}(e),r=0;r<8;r++)s&&e[r]===0||(s&&(s=!1),i===r?(t+=r?":":"::",s=!0):(t+=fee(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},YE={},GM=iw({},YE,{" ":1,'"':1,"<":1,">":1,"`":1}),HM=iw({},GM,{"#":1,"?":1,"{":1,"}":1}),lw=iw({},HM,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),$c=function(e,t){var r=see(e,0);return r>32&&r<127&&!nw(t,e)?e:encodeURIComponent(e)},JE={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ff=function(e,t){var r;return e.length==2&&js(BM,ns(e,0))&&((r=ns(e,1))==":"||!t&&r=="|")},KM=function(e){var t;return e.length>1&&ff(uf(e,0,2))&&(e.length==2||(t=ns(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Aee=function(e){return e==="."||qE(e)==="%2e"},dw={},zM={},uw={},qM={},YM={},hw={},JM={},XM={},XE={},$E={},pw={},fw={},mw={},_w={},$M={},Ew={},Hu={},Sa={},QM={},dd={},tc={},gw=function(e,t,r){var i,s,c,l=ec(e);if(t){if(s=this.parse(l))throw ow(s);this.searchParams=null}else{if(r!==void 0&&(i=new gw(r,!0)),s=this.parse(l,null,i))throw ow(s);(c=hee(new uee)).bindURL(this),this.searchParams=c}};gw.prototype={type:"URL",parse:function(e,t,r){var i,s,c,l,u,h=this,f=t||dw,m=0,E="",S=!1,y=!1,A=!1;for(e=ec(e),t||(h.scheme="",h.username="",h.password="",h.host=null,h.port=null,h.path=[],h.query=null,h.fragment=null,h.cannotBeABaseURL=!1,e=sw(e,wee,""),e=sw(e,Iee,"$1")),e=sw(e,bee,""),i=Wu(e);m<=i.length;){switch(s=i[m],f){case dw:if(!s||!js(BM,s)){if(t)return aw;f=uw;continue}E+=qE(s),f=zM;break;case zM:if(s&&(js(See,s)||s=="+"||s=="-"||s=="."))E+=qE(s);else{if(s!=":"){if(t)return aw;E="",f=uw,m=0;continue}if(t&&(h.isSpecial()!=nw(JE,E)||E=="file"&&(h.includesCredentials()||h.port!==null)||h.scheme=="file"&&!h.host))return;if(h.scheme=E,t)return void(h.isSpecial()&&JE[h.scheme]==h.port&&(h.port=null));E="",h.scheme=="file"?f=_w:h.isSpecial()&&r&&r.scheme==h.scheme?f=qM:h.isSpecial()?f=XM:i[m+1]=="/"?(f=YM,m++):(h.cannotBeABaseURL=!0,Gu(h.path,""),f=QM)}break;case uw:if(!r||r.cannotBeABaseURL&&s!="#")return aw;if(r.cannotBeABaseURL&&s=="#"){h.scheme=r.scheme,h.path=Fs(r.path),h.query=r.query,h.fragment="",h.cannotBeABaseURL=!0,f=tc;break}f=r.scheme=="file"?_w:hw;continue;case qM:if(s!="/"||i[m+1]!="/"){f=hw;continue}f=XE,m++;break;case YM:if(s=="/"){f=$E;break}f=Sa;continue;case hw:if(h.scheme=r.scheme,s==es)h.username=r.username,h.password=r.password,h.host=r.host,h.port=r.port,h.path=Fs(r.path),h.query=r.query;else if(s=="/"||s=="\\"&&h.isSpecial())f=JM;else if(s=="?")h.username=r.username,h.password=r.password,h.host=r.host,h.port=r.port,h.path=Fs(r.path),h.query="",f=dd;else{if(s!="#"){h.username=r.username,h.password=r.password,h.host=r.host,h.port=r.port,h.path=Fs(r.path),h.path.length--,f=Sa;continue}h.username=r.username,h.password=r.password,h.host=r.host,h.port=r.port,h.path=Fs(r.path),h.query=r.query,h.fragment="",f=tc}break;case JM:if(!h.isSpecial()||s!="/"&&s!="\\"){if(s!="/"){h.username=r.username,h.password=r.password,h.host=r.host,h.port=r.port,f=Sa;continue}f=$E}else f=XE;break;case XM:if(f=XE,s!="/"||ns(E,m+1)!="/")continue;m++;break;case XE:if(s!="/"&&s!="\\"){f=$E;continue}break;case $E:if(s=="@"){S&&(E="%40"+E),S=!0,c=Wu(E);for(var T=0;T<c.length;T++){var w=c[T];if(w!=":"||A){var O=$c(w,lw);A?h.password+=O:h.username+=O}else A=!0}E=""}else if(s==es||s=="/"||s=="?"||s=="#"||s=="\\"&&h.isSpecial()){if(S&&E=="")return"Invalid authority";m-=Wu(E).length+1,E="",f=pw}else E+=s;break;case pw:case fw:if(t&&h.scheme=="file"){f=Ew;continue}if(s!=":"||y){if(s==es||s=="/"||s=="?"||s=="#"||s=="\\"&&h.isSpecial()){if(h.isSpecial()&&E=="")return hf;if(t&&E==""&&(h.includesCredentials()||h.port!==null))return;if(l=h.parseHost(E))return l;if(E="",f=Hu,t)return;continue}s=="["?y=!0:s=="]"&&(y=!1),E+=s}else{if(E=="")return hf;if(l=h.parseHost(E))return l;if(E="",f=mw,t==fw)return}break;case mw:if(!js(cw,s)){if(s==es||s=="/"||s=="?"||s=="#"||s=="\\"&&h.isSpecial()||t){if(E!=""){var P=zE(E,10);if(P>65535)return jM;h.port=h.isSpecial()&&P===JE[h.scheme]?null:P,E=""}if(t)return;f=Hu;continue}return jM}E+=s;break;case _w:if(h.scheme="file",s=="/"||s=="\\")f=$M;else{if(!r||r.scheme!="file"){f=Sa;continue}if(s==es)h.host=r.host,h.path=Fs(r.path),h.query=r.query;else if(s=="?")h.host=r.host,h.path=Fs(r.path),h.query="",f=dd;else{if(s!="#"){KM(df(Fs(i,m),""))||(h.host=r.host,h.path=Fs(r.path),h.shortenPath()),f=Sa;continue}h.host=r.host,h.path=Fs(r.path),h.query=r.query,h.fragment="",f=tc}}break;case $M:if(s=="/"||s=="\\"){f=Ew;break}r&&r.scheme=="file"&&!KM(df(Fs(i,m),""))&&(ff(r.path[0],!0)?Gu(h.path,r.path[0]):h.host=r.host),f=Sa;continue;case Ew:if(s==es||s=="/"||s=="\\"||s=="?"||s=="#"){if(!t&&ff(E))f=Sa;else if(E==""){if(h.host="",t)return;f=Hu}else{if(l=h.parseHost(E))return l;if(h.host=="localhost"&&(h.host=""),t)return;E="",f=Hu}continue}E+=s;break;case Hu:if(h.isSpecial()){if(f=Sa,s!="/"&&s!="\\")continue}else if(t||s!="?")if(t||s!="#"){if(s!=es&&(f=Sa,s!="/"))continue}else h.fragment="",f=tc;else h.query="",f=dd;break;case Sa:if(s==es||s=="/"||s=="\\"&&h.isSpecial()||!t&&(s=="?"||s=="#")){if((u=qE(u=E))===".."||u==="%2e."||u===".%2e"||u==="%2e%2e"?(h.shortenPath(),s=="/"||s=="\\"&&h.isSpecial()||Gu(h.path,"")):Aee(E)?s=="/"||s=="\\"&&h.isSpecial()||Gu(h.path,""):(h.scheme=="file"&&!h.path.length&&ff(E)&&(h.host&&(h.host=""),E=ns(E,0)+":"),Gu(h.path,E)),E="",h.scheme=="file"&&(s==es||s=="?"||s=="#"))for(;h.path.length>1&&h.path[0]==="";)_ee(h.path);s=="?"?(h.query="",f=dd):s=="#"&&(h.fragment="",f=tc)}else E+=$c(s,HM);break;case QM:s=="?"?(h.query="",f=dd):s=="#"?(h.fragment="",f=tc):s!=es&&(h.path[0]+=$c(s,YE));break;case dd:t||s!="#"?s!=es&&(s=="'"&&h.isSpecial()?h.query+="%27":h.query+=s=="#"?"%23":$c(s,YE)):(h.fragment="",f=tc);break;case tc:s!=es&&(h.fragment+=$c(s,GM))}m++}},parseHost:function(e){var t,r,i;if(ns(e,0)=="["){if(ns(e,e.length-1)!="]"||(t=function(s){var c,l,u,h,f,m,E,S=[0,0,0,0,0,0,0,0],y=0,A=null,T=0,w=function(){return ns(s,T)};if(w()==":"){if(ns(s,1)!=":")return;T+=2,A=++y}for(;w();){if(y==8)return;if(w()!=":"){for(c=l=0;l<4&&js(WM,w());)c=16*c+zE(w(),16),T++,l++;if(w()=="."){if(l==0||(T-=l,y>6))return;for(u=0;w();){if(h=null,u>0){if(!(w()=="."&&u<4))return;T++}if(!js(cw,w()))return;for(;js(cw,w());){if(f=zE(w(),10),h===null)h=f;else{if(h==0)return;h=10*h+f}if(h>255)return;T++}S[y]=256*S[y]+h,++u!=2&&u!=4||y++}if(u!=4)return;break}if(w()==":"){if(T++,!w())return}else if(w())return;S[y++]=c}else{if(A!==null)return;T++,A=++y}}if(A!==null)for(m=y-A,y=7;y!=0&&m>0;)E=S[y],S[y--]=S[A+m-1],S[A+--m]=E;else if(y!=8)return;return S}(uf(e,1,-1)),!t))return hf;this.host=t}else if(this.isSpecial()){if(e=aee(e),js(Cee,e)||(t=function(s){var c,l,u,h,f,m,E,S=Eee(s,".");if(S.length&&S[S.length-1]==""&&S.length--,(c=S.length)>4)return s;for(l=[],u=0;u<c;u++){if((h=S[u])=="")return s;if(f=10,h.length>1&&ns(h,0)=="0"&&(f=js(yee,h)?16:8,h=uf(h,f==8?1:2)),h==="")m=0;else{if(!js(f==10?Tee:f==8?vee:WM,h))return s;m=zE(h,f)}Gu(l,m)}for(u=0;u<c;u++)if(m=l[u],u==c-1){if(m>=FM(256,5-c))return null}else if(m>255)return null;for(E=mee(l),u=0;u<l.length;u++)E+=l[u]*FM(256,3-u);return E}(e),t===null))return hf;this.host=t}else{if(js(Ree,e))return hf;for(t="",r=Wu(e),i=0;i<r.length;i++)t+=$c(r[i],YE);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return nw(JE,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&ff(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,i=e.password,s=e.host,c=e.port,l=e.path,u=e.query,h=e.fragment,f=t+":";return s!==null?(f+="//",e.includesCredentials()&&(f+=r+(i?":"+i:"")+"@"),f+=pf(s),c!==null&&(f+=":"+c)):t=="file"&&(f+="//"),f+=e.cannotBeABaseURL?l[0]:l.length?"/"+df(l,"/"):"",u!==null&&(f+="?"+u),h!==null&&(f+="#"+h),f},setHref:function(e){var t=this.parse(e);if(t)throw ow(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new Ku(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+pf(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ec(e)+":",dw)},getUsername:function(){return this.username},setUsername:function(e){var t=Wu(ec(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=$c(t[r],lw)}},getPassword:function(){return this.password},setPassword:function(e){var t=Wu(ec(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=$c(t[r],lw)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?pf(e):pf(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,pw)},getHostname:function(){var e=this.host;return e===null?"":pf(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,fw)},getPort:function(){var e=this.port;return e===null?"":ec(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ec(e))==""?this.port=null:this.parse(e,mw))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+df(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Hu))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ec(e))==""?this.query=null:(ns(e,0)=="?"&&(e=uf(e,1)),this.query="",this.parse(e,dd)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ec(e))!=""?(ns(e,0)=="#"&&(e=uf(e,1)),this.fragment="",this.parse(e,tc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ku=function(e){var t=oee(this,xi),r=lee(arguments.length,1)>1?arguments[1]:void 0,i=dee(t,new gw(e,!1,r));tw||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},xi=Ku.prototype,is=function(e,t){return{get:function(){return KE(this)[e]()},set:t&&function(r){return KE(this)[t](r)},configurable:!0,enumerable:!0}};if(tw&&(rs(xi,"href",is("serialize","setHref")),rs(xi,"origin",is("getOrigin")),rs(xi,"protocol",is("getProtocol","setProtocol")),rs(xi,"username",is("getUsername","setUsername")),rs(xi,"password",is("getPassword","setPassword")),rs(xi,"host",is("getHost","setHost")),rs(xi,"hostname",is("getHostname","setHostname")),rs(xi,"port",is("getPort","setPort")),rs(xi,"pathname",is("getPathname","setPathname")),rs(xi,"search",is("getSearch","setSearch")),rs(xi,"searchParams",is("getSearchParams")),rs(xi,"hash",is("getHash","setHash"))),HE(xi,"toJSON",function(){return KE(this).serialize()},{enumerable:!0}),HE(xi,"toString",function(){return KE(this).serialize()},{enumerable:!0}),lf){var ZM=lf.createObjectURL,e2=lf.revokeObjectURL;ZM&&HE(Ku,"createObjectURL",xM(ZM,lf)),e2&&HE(Ku,"revokeObjectURL",xM(e2,lf))}cee(Ku,"URL"),nee({global:!0,constructor:!0,forced:!iee,sham:!tw},{URL:Ku});var Oee=Ut,Nee=_,Dee=j_,t2=mo,Pee=HC,r2=jn("URL");Oee({target:"URL",stat:!0,forced:!(Pee&&Nee(function(){r2.canParse()}))},{canParse:function(e){var t=Dee(arguments.length,1),r=t2(e),i=t<2||arguments[1]===void 0?void 0:t2(arguments[1]);try{return!!new r2(r,i)}catch{return!1}}});var n2=p(fo.URL),kee=M,Lee=D1,i2=RegExp.prototype,Mee=function(e){return e===i2||kee(i2,e)?Lee(e):e.flags},Hn=p(Mee);function zu(e){let t=e.length;for(;--t>=0;)e[t]=0}let Sw=256,o2=286,mf=30,_f=15,yw=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),QE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),xee=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),s2=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rc=new Array(576);zu(rc);let Ef=new Array(60);zu(Ef);let gf=new Array(512);zu(gf);let Sf=new Array(256);zu(Sf);let vw=new Array(29);zu(vw);let ZE=new Array(mf);function Tw(e,t,r,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}let a2,c2,l2;function Cw(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}zu(ZE);let d2=e=>e<256?gf[e]:gf[256+(e>>>7)],yf=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Xi=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,yf(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},ya=(e,t,r)=>{Xi(e,r[2*t],r[2*t+1])},u2=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},h2=(e,t,r)=>{let i=new Array(16),s,c,l=0;for(s=1;s<=_f;s++)l=l+r[s-1]<<1,i[s]=l;for(c=0;c<=t;c++){let u=e[2*c+1];u!==0&&(e[2*c]=u2(i[u]++,u))}},p2=e=>{let t;for(t=0;t<o2;t++)e.dyn_ltree[2*t]=0;for(t=0;t<mf;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},f2=e=>{e.bi_valid>8?yf(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},m2=(e,t,r,i)=>{let s=2*t,c=2*r;return e[s]<e[c]||e[s]===e[c]&&i[t]<=i[r]},Rw=(e,t,r)=>{let i=e.heap[r],s=r<<1;for(;s<=e.heap_len&&(s<e.heap_len&&m2(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!m2(t,i,e.heap[s],e.depth));)e.heap[r]=e.heap[s],r=s,s<<=1;e.heap[r]=i},_2=(e,t,r)=>{let i,s,c,l,u=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+u++],i+=(255&e.pending_buf[e.sym_buf+u++])<<8,s=e.pending_buf[e.sym_buf+u++],i===0?ya(e,s,t):(c=Sf[s],ya(e,c+Sw+1,t),l=yw[c],l!==0&&(s-=vw[c],Xi(e,s,l)),i--,c=d2(i),ya(e,c,r),l=QE[c],l!==0&&(i-=ZE[c],Xi(e,i,l)));while(u<e.sym_next);ya(e,256,t)},ww=(e,t)=>{let r=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,l,u,h,f=-1;for(e.heap_len=0,e.heap_max=573,l=0;l<c;l++)r[2*l]!==0?(e.heap[++e.heap_len]=f=l,e.depth[l]=0):r[2*l+1]=0;for(;e.heap_len<2;)h=e.heap[++e.heap_len]=f<2?++f:0,r[2*h]=1,e.depth[h]=0,e.opt_len--,s&&(e.static_len-=i[2*h+1]);for(t.max_code=f,l=e.heap_len>>1;l>=1;l--)Rw(e,r,l);h=c;do l=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Rw(e,r,1),u=e.heap[1],e.heap[--e.heap_max]=l,e.heap[--e.heap_max]=u,r[2*h]=r[2*l]+r[2*u],e.depth[h]=(e.depth[l]>=e.depth[u]?e.depth[l]:e.depth[u])+1,r[2*l+1]=r[2*u+1]=h,e.heap[1]=h++,Rw(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((m,E)=>{let S=E.dyn_tree,y=E.max_code,A=E.stat_desc.static_tree,T=E.stat_desc.has_stree,w=E.stat_desc.extra_bits,O=E.stat_desc.extra_base,P=E.stat_desc.max_length,F,W,K,X,ie,ae,le=0;for(X=0;X<=_f;X++)m.bl_count[X]=0;for(S[2*m.heap[m.heap_max]+1]=0,F=m.heap_max+1;F<573;F++)W=m.heap[F],X=S[2*S[2*W+1]+1]+1,X>P&&(X=P,le++),S[2*W+1]=X,W>y||(m.bl_count[X]++,ie=0,W>=O&&(ie=w[W-O]),ae=S[2*W],m.opt_len+=ae*(X+ie),T&&(m.static_len+=ae*(A[2*W+1]+ie)));if(le!==0){do{for(X=P-1;m.bl_count[X]===0;)X--;m.bl_count[X]--,m.bl_count[X+1]+=2,m.bl_count[P]--,le-=2}while(le>0);for(X=P;X!==0;X--)for(W=m.bl_count[X];W!==0;)K=m.heap[--F],K>y||(S[2*K+1]!==X&&(m.opt_len+=(X-S[2*K+1])*S[2*K],S[2*K+1]=X),W--)}})(e,t),h2(r,f,e.bl_count)},E2=(e,t,r)=>{let i,s,c=-1,l=t[1],u=0,h=7,f=4;for(l===0&&(h=138,f=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)s=l,l=t[2*(i+1)+1],++u<h&&s===l||(u<f?e.bl_tree[2*s]+=u:s!==0?(s!==c&&e.bl_tree[2*s]++,e.bl_tree[32]++):u<=10?e.bl_tree[34]++:e.bl_tree[36]++,u=0,c=s,l===0?(h=138,f=3):s===l?(h=6,f=3):(h=7,f=4))},g2=(e,t,r)=>{let i,s,c=-1,l=t[1],u=0,h=7,f=4;for(l===0&&(h=138,f=3),i=0;i<=r;i++)if(s=l,l=t[2*(i+1)+1],!(++u<h&&s===l)){if(u<f)do ya(e,s,e.bl_tree);while(--u!=0);else s!==0?(s!==c&&(ya(e,s,e.bl_tree),u--),ya(e,16,e.bl_tree),Xi(e,u-3,2)):u<=10?(ya(e,17,e.bl_tree),Xi(e,u-3,3)):(ya(e,18,e.bl_tree),Xi(e,u-11,7));u=0,c=s,l===0?(h=138,f=3):s===l?(h=6,f=3):(h=7,f=4)}},S2=!1,y2=(e,t,r,i)=>{Xi(e,0+(i?1:0),3),f2(e),yf(e,r),yf(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var Uee=e=>{S2||((()=>{let t,r,i,s,c,l=new Array(16);for(i=0,s=0;s<28;s++)for(vw[s]=i,t=0;t<1<<yw[s];t++)Sf[i++]=s;for(Sf[i-1]=s,c=0,s=0;s<16;s++)for(ZE[s]=c,t=0;t<1<<QE[s];t++)gf[c++]=s;for(c>>=7;s<mf;s++)for(ZE[s]=c<<7,t=0;t<1<<QE[s]-7;t++)gf[256+c++]=s;for(r=0;r<=_f;r++)l[r]=0;for(t=0;t<=143;)rc[2*t+1]=8,t++,l[8]++;for(;t<=255;)rc[2*t+1]=9,t++,l[9]++;for(;t<=279;)rc[2*t+1]=7,t++,l[7]++;for(;t<=287;)rc[2*t+1]=8,t++,l[8]++;for(h2(rc,287,l),t=0;t<mf;t++)Ef[2*t+1]=5,Ef[2*t]=u2(t,5);a2=new Tw(rc,yw,257,o2,_f),c2=new Tw(Ef,QE,0,mf,_f),l2=new Tw(new Array(0),xee,0,19,7)})(),S2=!0),e.l_desc=new Cw(e.dyn_ltree,a2),e.d_desc=new Cw(e.dyn_dtree,c2),e.bl_desc=new Cw(e.bl_tree,l2),e.bi_buf=0,e.bi_valid=0,p2(e)},Vee=(e,t,r,i)=>{let s,c,l=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(u=>{let h,f=4093624447;for(h=0;h<=31;h++,f>>>=1)if(1&f&&u.dyn_ltree[2*h]!==0)return 0;if(u.dyn_ltree[18]!==0||u.dyn_ltree[20]!==0||u.dyn_ltree[26]!==0)return 1;for(h=32;h<Sw;h++)if(u.dyn_ltree[2*h]!==0)return 1;return 0})(e)),ww(e,e.l_desc),ww(e,e.d_desc),l=(u=>{let h;for(E2(u,u.dyn_ltree,u.l_desc.max_code),E2(u,u.dyn_dtree,u.d_desc.max_code),ww(u,u.bl_desc),h=18;h>=3&&u.bl_tree[2*s2[h]+1]===0;h--);return u.opt_len+=3*(h+1)+5+5+4,h})(e),s=e.opt_len+3+7>>>3,c=e.static_len+3+7>>>3,c<=s&&(s=c)):s=c=r+5,r+4<=s&&t!==-1?y2(e,t,r,i):e.strategy===4||c===s?(Xi(e,2+(i?1:0),3),_2(e,rc,Ef)):(Xi(e,4+(i?1:0),3),((u,h,f,m)=>{let E;for(Xi(u,h-257,5),Xi(u,f-1,5),Xi(u,m-4,4),E=0;E<m;E++)Xi(u,u.bl_tree[2*s2[E]+1],3);g2(u,u.dyn_ltree,h-1),g2(u,u.dyn_dtree,f-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),_2(e,e.dyn_ltree,e.dyn_dtree)),p2(e),i&&f2(e)},Fee=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Sf[r]+Sw+1)]++,e.dyn_dtree[2*d2(t)]++),e.sym_next===e.sym_end),jee=e=>{Xi(e,2,3),ya(e,256,rc),(t=>{t.bi_valid===16?(yf(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Bee={_tr_init:Uee,_tr_stored_block:y2,_tr_flush_block:Vee,_tr_tally:Fee,_tr_align:jee},vf=(e,t,r,i)=>{let s=65535&e|0,c=e>>>16&65535|0,l=0;for(;r!==0;){l=r>2e3?2e3:r,r-=l;do s=s+t[i++]|0,c=c+s|0;while(--l);s%=65521,c%=65521}return s|c<<16|0};let Wee=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var ti=(e,t,r,i)=>{let s=Wee,c=i+r;e^=-1;for(let l=i;l<c;l++)e=e>>>8^s[255&(e^t[l])];return-1^e},ud={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},qu={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:Gee,_tr_stored_block:Iw,_tr_flush_block:Hee,_tr_tally:Qc,_tr_align:Kee}=Bee,{Z_NO_FLUSH:Zc,Z_PARTIAL_FLUSH:zee,Z_FULL_FLUSH:qee,Z_FINISH:os,Z_BLOCK:v2,Z_OK:ai,Z_STREAM_END:T2,Z_STREAM_ERROR:va,Z_DATA_ERROR:Yee,Z_BUF_ERROR:bw,Z_DEFAULT_COMPRESSION:Jee,Z_FILTERED:Xee,Z_HUFFMAN_ONLY:eg,Z_RLE:$ee,Z_FIXED:Qee,Z_DEFAULT_STRATEGY:Zee,Z_UNKNOWN:ete,Z_DEFLATED:tg}=qu,Aw=286,tte=30,rte=19,nte=2*Aw+1,ite=15,hd=258,Ta=262,Yu=42,pd=113,Tf=666,fd=(e,t)=>(e.msg=ud[t],t),C2=e=>2*e-(e>4?9:0),el=e=>{let t=e.length;for(;--t>=0;)e[t]=0},ote=e=>{let t,r,i,s=e.w_size;t=e.hash_size,i=t;do r=e.head[--i],e.head[i]=r>=s?r-s:0;while(--t);t=s,i=t;do r=e.prev[--i],e.prev[i]=r>=s?r-s:0;while(--t)},tl=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,yo=e=>{let t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},vo=(e,t)=>{Hee(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,yo(e.strm)},ur=(e,t)=>{e.pending_buf[e.pending++]=t},Cf=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Ow=(e,t,r,i)=>{let s=e.avail_in;return s>i&&(s=i),s===0?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),r),e.state.wrap===1?e.adler=vf(e.adler,t,s,r):e.state.wrap===2&&(e.adler=ti(e.adler,t,s,r)),e.next_in+=s,e.total_in+=s,s)},R2=(e,t)=>{let r,i,s=e.max_chain_length,c=e.strstart,l=e.prev_length,u=e.nice_match,h=e.strstart>e.w_size-Ta?e.strstart-(e.w_size-Ta):0,f=e.window,m=e.w_mask,E=e.prev,S=e.strstart+hd,y=f[c+l-1],A=f[c+l];e.prev_length>=e.good_match&&(s>>=2),u>e.lookahead&&(u=e.lookahead);do if(r=t,f[r+l]===A&&f[r+l-1]===y&&f[r]===f[c]&&f[++r]===f[c+1]){c+=2,r++;do;while(f[++c]===f[++r]&&f[++c]===f[++r]&&f[++c]===f[++r]&&f[++c]===f[++r]&&f[++c]===f[++r]&&f[++c]===f[++r]&&f[++c]===f[++r]&&f[++c]===f[++r]&&c<S);if(i=hd-(S-c),c=S-hd,i>l){if(e.match_start=t,l=i,i>=u)break;y=f[c+l-1],A=f[c+l]}}while((t=E[t&m])>h&&--s!=0);return l<=e.lookahead?l:e.lookahead},Ju=e=>{let t=e.w_size,r,i,s;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ta)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),ote(e),i+=t),e.strm.avail_in===0)break;if(r=Ow(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=tl(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=tl(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ta&&e.strm.avail_in!==0)},w2=(e,t)=>{let r,i,s,c=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,l=0,u=e.strm.avail_in;do{if(r=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,i=e.strstart-e.block_start,r>i+e.strm.avail_in&&(r=i+e.strm.avail_in),r>s&&(r=s),r<c&&(r===0&&t!==os||t===Zc||r!==i+e.strm.avail_in)))break;l=t===os&&r===i+e.strm.avail_in?1:0,Iw(e,0,0,l),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,yo(e.strm),i&&(i>r&&(i=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,r-=i),r&&(Ow(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(l===0);return u-=e.strm.avail_in,u&&(u>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=u&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-u,e.strm.next_in),e.strstart),e.strstart+=u,e.insert+=u>e.w_size-e.insert?e.w_size-e.insert:u),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),l?4:t!==Zc&&t!==os&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(Ow(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,c=s>e.w_size?e.w_size:s,i=e.strstart-e.block_start,(i>=c||(i||t===os)&&t!==Zc&&e.strm.avail_in===0&&i<=s)&&(r=i>s?s:i,l=t===os&&e.strm.avail_in===0&&r===i?1:0,Iw(e,e.block_start,r,l),e.block_start+=r,yo(e.strm)),l?3:1)},Nw=(e,t)=>{let r,i;for(;;){if(e.lookahead<Ta){if(Ju(e),e.lookahead<Ta&&t===Zc)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=tl(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Ta&&(e.match_length=R2(e,r)),e.match_length>=3)if(i=Qc(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=tl(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=tl(e,e.ins_h,e.window[e.strstart+1]);else i=Qc(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(vo(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===os?(vo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(vo(e,!1),e.strm.avail_out===0)?1:2},Xu=(e,t)=>{let r,i,s;for(;;){if(e.lookahead<Ta){if(Ju(e),e.lookahead<Ta&&t===Zc)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=tl(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Ta&&(e.match_length=R2(e,r),e.match_length<=5&&(e.strategy===Xee||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=Qc(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=tl(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(vo(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=Qc(e,0,e.window[e.strstart-1]),i&&vo(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Qc(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===os?(vo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(vo(e,!1),e.strm.avail_out===0)?1:2};function Ca(e,t,r,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=s}let Rf=[new Ca(0,0,0,0,w2),new Ca(4,4,8,4,Nw),new Ca(4,5,16,8,Nw),new Ca(4,6,32,32,Nw),new Ca(4,4,16,16,Xu),new Ca(8,16,32,32,Xu),new Ca(8,16,128,128,Xu),new Ca(8,32,128,256,Xu),new Ca(32,128,258,1024,Xu),new Ca(32,258,258,4096,Xu)];function ste(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=tg,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*nte),this.dyn_dtree=new Uint16Array(2*(2*tte+1)),this.bl_tree=new Uint16Array(2*(2*rte+1)),el(this.dyn_ltree),el(this.dyn_dtree),el(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ite+1),this.heap=new Uint16Array(2*Aw+1),el(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Aw+1),el(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let wf=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==Yu&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==pd&&t.status!==Tf?1:0},I2=e=>{if(wf(e))return fd(e,va);e.total_in=e.total_out=0,e.data_type=ete;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Yu:pd,e.adler=t.wrap===2?0:1,t.last_flush=-2,Gee(t),ai},b2=e=>{let t=I2(e);return t===ai&&(r=>{r.window_size=2*r.w_size,el(r.head),r.max_lazy_match=Rf[r.level].max_lazy,r.good_match=Rf[r.level].good_length,r.nice_match=Rf[r.level].nice_length,r.max_chain_length=Rf[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},A2=(e,t,r,i,s,c)=>{if(!e)return va;let l=1;if(t===Jee&&(t=6),i<0?(l=0,i=-i):i>15&&(l=2,i-=16),s<1||s>9||r!==tg||i<8||i>15||t<0||t>9||c<0||c>Qee||i===8&&l!==1)return fd(e,va);i===8&&(i=9);let u=new ste;return e.state=u,u.strm=e,u.status=Yu,u.wrap=l,u.gzhead=null,u.w_bits=i,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=s+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<s+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.sym_buf=u.lit_bufsize,u.sym_end=3*(u.lit_bufsize-1),u.level=t,u.strategy=c,u.method=r,b2(e)};var ate=(e,t)=>{if(wf(e)||t>v2||t<0)return e?fd(e,va):va;let r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===Tf&&t!==os)return fd(e,e.avail_out===0?bw:va);let i=r.last_flush;if(r.last_flush=t,r.pending!==0){if(yo(e),e.avail_out===0)return r.last_flush=-1,ai}else if(e.avail_in===0&&C2(t)<=C2(i)&&t!==os)return fd(e,bw);if(r.status===Tf&&e.avail_in!==0)return fd(e,bw);if(r.status===Yu&&r.wrap===0&&(r.status=pd),r.status===Yu){let s=tg+(r.w_bits-8<<4)<<8,c=-1;if(c=r.strategy>=eg||r.level<2?0:r.level<6?1:r.level===6?2:3,s|=c<<6,r.strstart!==0&&(s|=32),s+=31-s%31,Cf(r,s),r.strstart!==0&&(Cf(r,e.adler>>>16),Cf(r,65535&e.adler)),e.adler=1,r.status=pd,yo(e),r.pending!==0)return r.last_flush=-1,ai}if(r.status===57){if(e.adler=0,ur(r,31),ur(r,139),ur(r,8),r.gzhead)ur(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ur(r,255&r.gzhead.time),ur(r,r.gzhead.time>>8&255),ur(r,r.gzhead.time>>16&255),ur(r,r.gzhead.time>>24&255),ur(r,r.level===9?2:r.strategy>=eg||r.level<2?4:0),ur(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ur(r,255&r.gzhead.extra.length),ur(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=ti(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(ur(r,0),ur(r,0),ur(r,0),ur(r,0),ur(r,0),ur(r,r.level===9?2:r.strategy>=eg||r.level<2?4:0),ur(r,3),r.status=pd,yo(e),r.pending!==0)return r.last_flush=-1,ai}if(r.status===69){if(r.gzhead.extra){let s=r.pending,c=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+c>r.pending_buf_size;){let u=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+u),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>s&&(e.adler=ti(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex+=u,yo(e),r.pending!==0)return r.last_flush=-1,ai;s=0,c-=u}let l=new Uint8Array(r.gzhead.extra);r.pending_buf.set(l.subarray(r.gzindex,r.gzindex+c),r.pending),r.pending+=c,r.gzhead.hcrc&&r.pending>s&&(e.adler=ti(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let s,c=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>c&&(e.adler=ti(e.adler,r.pending_buf,r.pending-c,c)),yo(e),r.pending!==0)return r.last_flush=-1,ai;c=0}s=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ur(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>c&&(e.adler=ti(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let s,c=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>c&&(e.adler=ti(e.adler,r.pending_buf,r.pending-c,c)),yo(e),r.pending!==0)return r.last_flush=-1,ai;c=0}s=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ur(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>c&&(e.adler=ti(e.adler,r.pending_buf,r.pending-c,c))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(yo(e),r.pending!==0))return r.last_flush=-1,ai;ur(r,255&e.adler),ur(r,e.adler>>8&255),e.adler=0}if(r.status=pd,yo(e),r.pending!==0)return r.last_flush=-1,ai}if(e.avail_in!==0||r.lookahead!==0||t!==Zc&&r.status!==Tf){let s=r.level===0?w2(r,t):r.strategy===eg?((c,l)=>{let u;for(;;){if(c.lookahead===0&&(Ju(c),c.lookahead===0)){if(l===Zc)return 1;break}if(c.match_length=0,u=Qc(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++,u&&(vo(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,l===os?(vo(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(vo(c,!1),c.strm.avail_out===0)?1:2})(r,t):r.strategy===$ee?((c,l)=>{let u,h,f,m,E=c.window;for(;;){if(c.lookahead<=hd){if(Ju(c),c.lookahead<=hd&&l===Zc)return 1;if(c.lookahead===0)break}if(c.match_length=0,c.lookahead>=3&&c.strstart>0&&(f=c.strstart-1,h=E[f],h===E[++f]&&h===E[++f]&&h===E[++f])){m=c.strstart+hd;do;while(h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&f<m);c.match_length=hd-(m-f),c.match_length>c.lookahead&&(c.match_length=c.lookahead)}if(c.match_length>=3?(u=Qc(c,1,c.match_length-3),c.lookahead-=c.match_length,c.strstart+=c.match_length,c.match_length=0):(u=Qc(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++),u&&(vo(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,l===os?(vo(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(vo(c,!1),c.strm.avail_out===0)?1:2})(r,t):Rf[r.level].func(r,t);if(s!==3&&s!==4||(r.status=Tf),s===1||s===3)return e.avail_out===0&&(r.last_flush=-1),ai;if(s===2&&(t===zee?Kee(r):t!==v2&&(Iw(r,0,0,!1),t===qee&&(el(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),yo(e),e.avail_out===0))return r.last_flush=-1,ai}return t!==os?ai:r.wrap<=0?T2:(r.wrap===2?(ur(r,255&e.adler),ur(r,e.adler>>8&255),ur(r,e.adler>>16&255),ur(r,e.adler>>24&255),ur(r,255&e.total_in),ur(r,e.total_in>>8&255),ur(r,e.total_in>>16&255),ur(r,e.total_in>>24&255)):(Cf(r,e.adler>>>16),Cf(r,65535&e.adler)),yo(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?ai:T2)},cte=(e,t)=>{let r=t.length;if(wf(e))return va;let i=e.state,s=i.wrap;if(s===2||s===1&&i.status!==Yu||i.lookahead)return va;if(s===1&&(e.adler=vf(e.adler,t,r,0)),i.wrap=0,r>=i.w_size){s===0&&(el(i.head),i.strstart=0,i.block_start=0,i.insert=0);let h=new Uint8Array(i.w_size);h.set(t.subarray(r-i.w_size,r),0),t=h,r=i.w_size}let c=e.avail_in,l=e.next_in,u=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,Ju(i);i.lookahead>=3;){let h=i.strstart,f=i.lookahead-2;do i.ins_h=tl(i,i.ins_h,i.window[h+3-1]),i.prev[h&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=h,h++;while(--f);i.strstart=h,i.lookahead=2,Ju(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=l,e.input=u,e.avail_in=c,i.wrap=s,ai},If={deflateInit:(e,t)=>A2(e,t,tg,15,8,Zee),deflateInit2:A2,deflateReset:b2,deflateResetKeep:I2,deflateSetHeader:(e,t)=>wf(e)||e.state.wrap!==2?va:(e.state.gzhead=t,ai),deflate:ate,deflateEnd:e=>{if(wf(e))return va;let t=e.state.status;return e.state=null,t===pd?fd(e,Yee):ai},deflateSetDictionary:cte,deflateInfo:"pako deflate (from Nodeca project)"};let lte=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var rg={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let i in r)lte(r,i)&&(e[i]=r[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i].length;let r=new Uint8Array(t);for(let i=0,s=0,c=e.length;i<c;i++){let l=e[i];r.set(l,s),s+=l.length}return r}};let O2=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{O2=!1}let bf=new Uint8Array(256);for(let e=0;e<256;e++)bf[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;bf[254]=bf[254]=1;var Af={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,i,s,c,l=e.length,u=0;for(s=0;s<l;s++)r=e.charCodeAt(s),(64512&r)==55296&&s+1<l&&(i=e.charCodeAt(s+1),(64512&i)==56320&&(r=65536+(r-55296<<10)+(i-56320),s++)),u+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(u),c=0,s=0;c<u;s++)r=e.charCodeAt(s),(64512&r)==55296&&s+1<l&&(i=e.charCodeAt(s+1),(64512&i)==56320&&(r=65536+(r-55296<<10)+(i-56320),s++)),r<128?t[c++]=r:r<2048?(t[c++]=192|r>>>6,t[c++]=128|63&r):r<65536?(t[c++]=224|r>>>12,t[c++]=128|r>>>6&63,t[c++]=128|63&r):(t[c++]=240|r>>>18,t[c++]=128|r>>>12&63,t[c++]=128|r>>>6&63,t[c++]=128|63&r);return t},buf2string:(e,t)=>{let r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,s,c=new Array(2*r);for(s=0,i=0;i<r;){let l=e[i++];if(l<128){c[s++]=l;continue}let u=bf[l];if(u>4)c[s++]=65533,i+=u-1;else{for(l&=u===2?31:u===3?15:7;u>1&&i<r;)l=l<<6|63&e[i++],u--;u>1?c[s++]=65533:l<65536?c[s++]=l:(l-=65536,c[s++]=55296|l>>10&1023,c[s++]=56320|1023&l)}}return((l,u)=>{if(u<65534&&l.subarray&&O2)return String.fromCharCode.apply(null,l.length===u?l:l.subarray(0,u));let h="";for(let f=0;f<u;f++)h+=String.fromCharCode(l[f]);return h})(c,s)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+bf[e[r]]>t?r:t}},N2=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let D2=Object.prototype.toString,{Z_NO_FLUSH:dte,Z_SYNC_FLUSH:ute,Z_FULL_FLUSH:hte,Z_FINISH:pte,Z_OK:ng,Z_STREAM_END:fte,Z_DEFAULT_COMPRESSION:mte,Z_DEFAULT_STRATEGY:_te,Z_DEFLATED:Ete}=qu;function Of(e){this.options=rg.assign({level:mte,method:Ete,chunkSize:16384,windowBits:15,memLevel:8,strategy:_te},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new N2,this.strm.avail_out=0;let r=If.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==ng)throw new Error(ud[r]);if(t.header&&If.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?Af.string2buf(t.dictionary):D2.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=If.deflateSetDictionary(this.strm,i),r!==ng)throw new Error(ud[r]);this._dict_set=!0}}function Dw(e,t){let r=new Of(t);if(r.push(e,!0),r.err)throw r.msg||ud[r.err];return r.result}Of.prototype.push=function(e,t){let r=this.strm,i=this.options.chunkSize,s,c;if(this.ended)return!1;for(c=t===~~t?t:t===!0?pte:dte,typeof e=="string"?r.input=Af.string2buf(e):D2.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(c===ute||c===hte)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(s=If.deflate(r,c),s===fte)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),s=If.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===ng;if(r.avail_out!==0){if(c>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},Of.prototype.onData=function(e){this.chunks.push(e)},Of.prototype.onEnd=function(e){e===ng&&(this.result=rg.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var gte={Deflate:Of,deflate:Dw,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Dw(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Dw(e,t)},constants:qu};let ig=16209;var Ste=function(e,t){let r,i,s,c,l,u,h,f,m,E,S,y,A,T,w,O,P,F,W,K,X,ie,ae,le,we=e.state;r=e.next_in,ae=e.input,i=r+(e.avail_in-5),s=e.next_out,le=e.output,c=s-(t-e.avail_out),l=s+(e.avail_out-257),u=we.dmax,h=we.wsize,f=we.whave,m=we.wnext,E=we.window,S=we.hold,y=we.bits,A=we.lencode,T=we.distcode,w=(1<<we.lenbits)-1,O=(1<<we.distbits)-1;e:do{y<15&&(S+=ae[r++]<<y,y+=8,S+=ae[r++]<<y,y+=8),P=A[S&w];t:for(;;){if(F=P>>>24,S>>>=F,y-=F,F=P>>>16&255,F===0)le[s++]=65535&P;else{if(!(16&F)){if(!(64&F)){P=A[(65535&P)+(S&(1<<F)-1)];continue t}if(32&F){we.mode=16191;break e}e.msg="invalid literal/length code",we.mode=ig;break e}W=65535&P,F&=15,F&&(y<F&&(S+=ae[r++]<<y,y+=8),W+=S&(1<<F)-1,S>>>=F,y-=F),y<15&&(S+=ae[r++]<<y,y+=8,S+=ae[r++]<<y,y+=8),P=T[S&O];r:for(;;){if(F=P>>>24,S>>>=F,y-=F,F=P>>>16&255,!(16&F)){if(!(64&F)){P=T[(65535&P)+(S&(1<<F)-1)];continue r}e.msg="invalid distance code",we.mode=ig;break e}if(K=65535&P,F&=15,y<F&&(S+=ae[r++]<<y,y+=8,y<F&&(S+=ae[r++]<<y,y+=8)),K+=S&(1<<F)-1,K>u){e.msg="invalid distance too far back",we.mode=ig;break e}if(S>>>=F,y-=F,F=s-c,K>F){if(F=K-F,F>f&&we.sane){e.msg="invalid distance too far back",we.mode=ig;break e}if(X=0,ie=E,m===0){if(X+=h-F,F<W){W-=F;do le[s++]=E[X++];while(--F);X=s-K,ie=le}}else if(m<F){if(X+=h+m-F,F-=m,F<W){W-=F;do le[s++]=E[X++];while(--F);if(X=0,m<W){F=m,W-=F;do le[s++]=E[X++];while(--F);X=s-K,ie=le}}}else if(X+=m-F,F<W){W-=F;do le[s++]=E[X++];while(--F);X=s-K,ie=le}for(;W>2;)le[s++]=ie[X++],le[s++]=ie[X++],le[s++]=ie[X++],W-=3;W&&(le[s++]=ie[X++],W>1&&(le[s++]=ie[X++]))}else{X=s-K;do le[s++]=le[X++],le[s++]=le[X++],le[s++]=le[X++],W-=3;while(W>2);W&&(le[s++]=le[X++],W>1&&(le[s++]=le[X++]))}break}}break}}while(r<i&&s<l);W=y>>3,r-=W,y-=W<<3,S&=(1<<y)-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=s<l?l-s+257:257-(s-l),we.hold=S,we.bits=y};let og=15,yte=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),vte=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Tte=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Cte=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Nf=(e,t,r,i,s,c,l,u)=>{let h=u.bits,f,m,E,S,y,A,T=0,w=0,O=0,P=0,F=0,W=0,K=0,X=0,ie=0,ae=0,le=null,we=new Uint16Array(16),nt=new Uint16Array(16),gt,jt,wr,ir=null;for(T=0;T<=og;T++)we[T]=0;for(w=0;w<i;w++)we[t[r+w]]++;for(F=h,P=og;P>=1&&we[P]===0;P--);if(F>P&&(F=P),P===0)return s[c++]=20971520,s[c++]=20971520,u.bits=1,0;for(O=1;O<P&&we[O]===0;O++);for(F<O&&(F=O),X=1,T=1;T<=og;T++)if(X<<=1,X-=we[T],X<0)return-1;if(X>0&&(e===0||P!==1))return-1;for(nt[1]=0,T=1;T<og;T++)nt[T+1]=nt[T]+we[T];for(w=0;w<i;w++)t[r+w]!==0&&(l[nt[t[r+w]]++]=w);if(e===0?(le=ir=l,A=20):e===1?(le=yte,ir=vte,A=257):(le=Tte,ir=Cte,A=0),ae=0,w=0,T=O,y=c,W=F,K=0,E=-1,ie=1<<F,S=ie-1,e===1&&ie>852||e===2&&ie>592)return 1;for(;;){gt=T-K,l[w]+1<A?(jt=0,wr=l[w]):l[w]>=A?(jt=ir[l[w]-A],wr=le[l[w]-A]):(jt=96,wr=0),f=1<<T-K,m=1<<W,O=m;do m-=f,s[y+(ae>>K)+m]=gt<<24|jt<<16|wr|0;while(m!==0);for(f=1<<T-1;ae&f;)f>>=1;if(f!==0?(ae&=f-1,ae+=f):ae=0,w++,--we[T]==0){if(T===P)break;T=t[r+l[w]]}if(T>F&&(ae&S)!==E){for(K===0&&(K=F),y+=O,W=T-K,X=1<<W;W+K<P&&(X-=we[W+K],!(X<=0));)W++,X<<=1;if(ie+=1<<W,e===1&&ie>852||e===2&&ie>592)return 1;E=ae&S,s[E]=F<<24|W<<16|y-c|0}}return ae!==0&&(s[y+ae]=T-K<<24|64<<16|0),u.bits=F,0};let{Z_FINISH:P2,Z_BLOCK:Rte,Z_TREES:sg,Z_OK:md,Z_STREAM_END:wte,Z_NEED_DICT:Ite,Z_STREAM_ERROR:ss,Z_DATA_ERROR:k2,Z_MEM_ERROR:L2,Z_BUF_ERROR:bte,Z_DEFLATED:M2}=qu,ag=16180,cg=16190,nc=16191,Pw=16192,kw=16194,lg=16199,dg=16200,Lw=16206,an=16209,x2=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Ate(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let _d=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<ag||t.mode>16211?1:0},U2=e=>{if(_d(e))return ss;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=ag,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,md},V2=e=>{if(_d(e))return ss;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,U2(e)},F2=(e,t)=>{let r;if(_d(e))return ss;let i=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ss:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,V2(e))},j2=(e,t)=>{if(!e)return ss;let r=new Ate;e.state=r,r.strm=e,r.window=null,r.mode=ag;let i=F2(e,t);return i!==md&&(e.state=null),i},Mw,xw,B2=!0,Ote=e=>{if(B2){Mw=new Int32Array(512),xw=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Nf(1,e.lens,0,288,Mw,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Nf(2,e.lens,0,32,xw,0,e.work,{bits:5}),B2=!1}e.lencode=Mw,e.lenbits=9,e.distcode=xw,e.distbits=5},W2=(e,t,r,i)=>{let s,c=e.state;return c.window===null&&(c.wsize=1<<c.wbits,c.wnext=0,c.whave=0,c.window=new Uint8Array(c.wsize)),i>=c.wsize?(c.window.set(t.subarray(r-c.wsize,r),0),c.wnext=0,c.whave=c.wsize):(s=c.wsize-c.wnext,s>i&&(s=i),c.window.set(t.subarray(r-i,r-i+s),c.wnext),(i-=s)?(c.window.set(t.subarray(r-i,r),0),c.wnext=i,c.whave=c.wsize):(c.wnext+=s,c.wnext===c.wsize&&(c.wnext=0),c.whave<c.wsize&&(c.whave+=s))),0};var Nte=(e,t)=>{let r,i,s,c,l,u,h,f,m,E,S,y,A,T,w,O,P,F,W,K,X,ie,ae=0,le=new Uint8Array(4),we,nt,gt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(_d(e)||!e.output||!e.input&&e.avail_in!==0)return ss;r=e.state,r.mode===nc&&(r.mode=Pw),l=e.next_out,s=e.output,h=e.avail_out,c=e.next_in,i=e.input,u=e.avail_in,f=r.hold,m=r.bits,E=u,S=h,ie=md;e:for(;;)switch(r.mode){case ag:if(r.wrap===0){r.mode=Pw;break}for(;m<16;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(2&r.wrap&&f===35615){r.wbits===0&&(r.wbits=15),r.check=0,le[0]=255&f,le[1]=f>>>8&255,r.check=ti(r.check,le,2,0),f=0,m=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",r.mode=an;break}if((15&f)!==M2){e.msg="unknown compression method",r.mode=an;break}if(f>>>=4,m-=4,X=8+(15&f),r.wbits===0&&(r.wbits=X),X>15||X>r.wbits){e.msg="invalid window size",r.mode=an;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&f?16189:nc,f=0,m=0;break;case 16181:for(;m<16;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(r.flags=f,(255&Hn(r))!==M2){e.msg="unknown compression method",r.mode=an;break}if(57344&Hn(r)){e.msg="unknown header flags set",r.mode=an;break}r.head&&(r.head.text=f>>8&1),512&Hn(r)&&4&r.wrap&&(le[0]=255&f,le[1]=f>>>8&255,r.check=ti(r.check,le,2,0)),f=0,m=0,r.mode=16182;case 16182:for(;m<32;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}r.head&&(r.head.time=f),512&Hn(r)&&4&r.wrap&&(le[0]=255&f,le[1]=f>>>8&255,le[2]=f>>>16&255,le[3]=f>>>24&255,r.check=ti(r.check,le,4,0)),f=0,m=0,r.mode=16183;case 16183:for(;m<16;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}r.head&&(r.head.xflags=255&f,r.head.os=f>>8),512&Hn(r)&&4&r.wrap&&(le[0]=255&f,le[1]=f>>>8&255,r.check=ti(r.check,le,2,0)),f=0,m=0,r.mode=16184;case 16184:if(1024&Hn(r)){for(;m<16;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}r.length=f,r.head&&(r.head.extra_len=f),512&Hn(r)&&4&r.wrap&&(le[0]=255&f,le[1]=f>>>8&255,r.check=ti(r.check,le,2,0)),f=0,m=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&Hn(r)&&(y=r.length,y>u&&(y=u),y&&(r.head&&(X=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(i.subarray(c,c+y),X)),512&Hn(r)&&4&r.wrap&&(r.check=ti(r.check,i,y,c)),u-=y,c+=y,r.length-=y),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&Hn(r)){if(u===0)break e;y=0;do X=i[c+y++],r.head&&X&&r.length<65536&&(r.head.name+=String.fromCharCode(X));while(X&&y<u);if(512&Hn(r)&&4&r.wrap&&(r.check=ti(r.check,i,y,c)),u-=y,c+=y,X)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&Hn(r)){if(u===0)break e;y=0;do X=i[c+y++],r.head&&X&&r.length<65536&&(r.head.comment+=String.fromCharCode(X));while(X&&y<u);if(512&Hn(r)&&4&r.wrap&&(r.check=ti(r.check,i,y,c)),u-=y,c+=y,X)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&Hn(r)){for(;m<16;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(4&r.wrap&&f!==(65535&r.check)){e.msg="header crc mismatch",r.mode=an;break}f=0,m=0}r.head&&(r.head.hcrc=Hn(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=nc;break;case 16189:for(;m<32;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}e.adler=r.check=x2(f),f=0,m=0,r.mode=cg;case cg:if(r.havedict===0)return e.next_out=l,e.avail_out=h,e.next_in=c,e.avail_in=u,r.hold=f,r.bits=m,Ite;e.adler=r.check=1,r.mode=nc;case nc:if(t===Rte||t===sg)break e;case Pw:if(r.last){f>>>=7&m,m-=7&m,r.mode=Lw;break}for(;m<3;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}switch(r.last=1&f,f>>>=1,m-=1,3&f){case 0:r.mode=16193;break;case 1:if(Ote(r),r.mode=lg,t===sg){f>>>=2,m-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=an}f>>>=2,m-=2;break;case 16193:for(f>>>=7&m,m-=7&m;m<32;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",r.mode=an;break}if(r.length=65535&f,f=0,m=0,r.mode=kw,t===sg)break e;case kw:r.mode=16195;case 16195:if(y=r.length,y){if(y>u&&(y=u),y>h&&(y=h),y===0)break e;s.set(i.subarray(c,c+y),l),u-=y,c+=y,h-=y,l+=y,r.length-=y;break}r.mode=nc;break;case 16196:for(;m<14;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(r.nlen=257+(31&f),f>>>=5,m-=5,r.ndist=1+(31&f),f>>>=5,m-=5,r.ncode=4+(15&f),f>>>=4,m-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=an;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;m<3;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}r.lens[gt[r.have++]]=7&f,f>>>=3,m-=3}for(;r.have<19;)r.lens[gt[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,we={bits:r.lenbits},ie=Nf(0,r.lens,0,19,r.lencode,0,r.work,we),r.lenbits=we.bits,ie){e.msg="invalid code lengths set",r.mode=an;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;ae=r.lencode[f&(1<<r.lenbits)-1],w=ae>>>24,O=ae>>>16&255,P=65535&ae,!(w<=m);){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(P<16)f>>>=w,m-=w,r.lens[r.have++]=P;else{if(P===16){for(nt=w+2;m<nt;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(f>>>=w,m-=w,r.have===0){e.msg="invalid bit length repeat",r.mode=an;break}X=r.lens[r.have-1],y=3+(3&f),f>>>=2,m-=2}else if(P===17){for(nt=w+3;m<nt;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}f>>>=w,m-=w,X=0,y=3+(7&f),f>>>=3,m-=3}else{for(nt=w+7;m<nt;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}f>>>=w,m-=w,X=0,y=11+(127&f),f>>>=7,m-=7}if(r.have+y>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=an;break}for(;y--;)r.lens[r.have++]=X}}if(r.mode===an)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=an;break}if(r.lenbits=9,we={bits:r.lenbits},ie=Nf(1,r.lens,0,r.nlen,r.lencode,0,r.work,we),r.lenbits=we.bits,ie){e.msg="invalid literal/lengths set",r.mode=an;break}if(r.distbits=6,r.distcode=r.distdyn,we={bits:r.distbits},ie=Nf(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,we),r.distbits=we.bits,ie){e.msg="invalid distances set",r.mode=an;break}if(r.mode=lg,t===sg)break e;case lg:r.mode=dg;case dg:if(u>=6&&h>=258){e.next_out=l,e.avail_out=h,e.next_in=c,e.avail_in=u,r.hold=f,r.bits=m,Ste(e,S),l=e.next_out,s=e.output,h=e.avail_out,c=e.next_in,i=e.input,u=e.avail_in,f=r.hold,m=r.bits,r.mode===nc&&(r.back=-1);break}for(r.back=0;ae=r.lencode[f&(1<<r.lenbits)-1],w=ae>>>24,O=ae>>>16&255,P=65535&ae,!(w<=m);){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(O&&!(240&O)){for(F=w,W=O,K=P;ae=r.lencode[K+((f&(1<<F+W)-1)>>F)],w=ae>>>24,O=ae>>>16&255,P=65535&ae,!(F+w<=m);){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}f>>>=F,m-=F,r.back+=F}if(f>>>=w,m-=w,r.back+=w,r.length=P,O===0){r.mode=16205;break}if(32&O){r.back=-1,r.mode=nc;break}if(64&O){e.msg="invalid literal/length code",r.mode=an;break}r.extra=15&O,r.mode=16201;case 16201:if(r.extra){for(nt=r.extra;m<nt;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}r.length+=f&(1<<r.extra)-1,f>>>=r.extra,m-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;ae=r.distcode[f&(1<<r.distbits)-1],w=ae>>>24,O=ae>>>16&255,P=65535&ae,!(w<=m);){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(!(240&O)){for(F=w,W=O,K=P;ae=r.distcode[K+((f&(1<<F+W)-1)>>F)],w=ae>>>24,O=ae>>>16&255,P=65535&ae,!(F+w<=m);){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}f>>>=F,m-=F,r.back+=F}if(f>>>=w,m-=w,r.back+=w,64&O){e.msg="invalid distance code",r.mode=an;break}r.offset=P,r.extra=15&O,r.mode=16203;case 16203:if(r.extra){for(nt=r.extra;m<nt;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}r.offset+=f&(1<<r.extra)-1,f>>>=r.extra,m-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=an;break}r.mode=16204;case 16204:if(h===0)break e;if(y=S-h,r.offset>y){if(y=r.offset-y,y>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=an;break}y>r.wnext?(y-=r.wnext,A=r.wsize-y):A=r.wnext-y,y>r.length&&(y=r.length),T=r.window}else T=s,A=l-r.offset,y=r.length;y>h&&(y=h),h-=y,r.length-=y;do s[l++]=T[A++];while(--y);r.length===0&&(r.mode=dg);break;case 16205:if(h===0)break e;s[l++]=r.length,h--,r.mode=dg;break;case Lw:if(r.wrap){for(;m<32;){if(u===0)break e;u--,f|=i[c++]<<m,m+=8}if(S-=h,e.total_out+=S,r.total+=S,4&r.wrap&&S&&(e.adler=r.check=Hn(r)?ti(r.check,s,S,l-S):vf(r.check,s,S,l-S)),S=h,4&r.wrap&&(Hn(r)?f:x2(f))!==r.check){e.msg="incorrect data check",r.mode=an;break}f=0,m=0}r.mode=16207;case 16207:if(r.wrap&&Hn(r)){for(;m<32;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(4&r.wrap&&f!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=an;break}f=0,m=0}r.mode=16208;case 16208:ie=wte;break e;case an:ie=k2;break e;case 16210:return L2;default:return ss}return e.next_out=l,e.avail_out=h,e.next_in=c,e.avail_in=u,r.hold=f,r.bits=m,(r.wsize||S!==e.avail_out&&r.mode<an&&(r.mode<Lw||t!==P2))&&W2(e,e.output,e.next_out,S-e.avail_out),E-=e.avail_in,S-=e.avail_out,e.total_in+=E,e.total_out+=S,r.total+=S,4&r.wrap&&S&&(e.adler=r.check=Hn(r)?ti(r.check,s,S,e.next_out-S):vf(r.check,s,S,e.next_out-S)),e.data_type=r.bits+(r.last?64:0)+(r.mode===nc?128:0)+(r.mode===lg||r.mode===kw?256:0),(E===0&&S===0||t===P2)&&ie===md&&(ie=bte),ie},ic={inflateReset:V2,inflateReset2:F2,inflateResetKeep:U2,inflateInit:e=>j2(e,15),inflateInit2:j2,inflate:Nte,inflateEnd:e=>{if(_d(e))return ss;let t=e.state;return t.window&&(t.window=null),e.state=null,md},inflateGetHeader:(e,t)=>{if(_d(e))return ss;let r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,md):ss},inflateSetDictionary:(e,t)=>{let r=t.length,i,s,c;return _d(e)?ss:(i=e.state,i.wrap!==0&&i.mode!==cg?ss:i.mode===cg&&(s=1,s=vf(s,t,r,0),s!==i.check)?k2:(c=W2(e,t,r,r),c?(i.mode=16210,L2):(i.havedict=1,md)))},inflateInfo:"pako inflate (from Nodeca project)"},Dte=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let G2=Object.prototype.toString,{Z_NO_FLUSH:Pte,Z_FINISH:kte,Z_OK:Df,Z_STREAM_END:Uw,Z_NEED_DICT:Vw,Z_STREAM_ERROR:Lte,Z_DATA_ERROR:H2,Z_MEM_ERROR:Mte}=qu;function Pf(e){this.options=rg.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new N2,this.strm.avail_out=0;let r=ic.inflateInit2(this.strm,t.windowBits);if(r!==Df)throw new Error(ud[r]);if(this.header=new Dte,ic.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Af.string2buf(t.dictionary):G2.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=ic.inflateSetDictionary(this.strm,t.dictionary),r!==Df)))throw new Error(ud[r])}function Fw(e,t){let r=new Pf(t);if(r.push(e),r.err)throw r.msg||ud[r.err];return r.result}Pf.prototype.push=function(e,t){let r=this.strm,i=this.options.chunkSize,s=this.options.dictionary,c,l,u;if(this.ended)return!1;for(l=t===~~t?t:t===!0?kte:Pte,G2.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),c=ic.inflate(r,l),c===Vw&&s&&(c=ic.inflateSetDictionary(r,s),c===Df?c=ic.inflate(r,l):c===H2&&(c=Vw));r.avail_in>0&&c===Uw&&r.state.wrap>0&&e[r.next_in]!==0;)ic.inflateReset(r),c=ic.inflate(r,l);switch(c){case Lte:case H2:case Vw:case Mte:return this.onEnd(c),this.ended=!0,!1}if(u=r.avail_out,r.next_out&&(r.avail_out===0||c===Uw))if(this.options.to==="string"){let h=Af.utf8border(r.output,r.next_out),f=r.next_out-h,m=Af.buf2string(r.output,h);r.next_out=f,r.avail_out=i-f,f&&r.output.set(r.output.subarray(h,h+f),0),this.onData(m)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(c!==Df||u!==0){if(c===Uw)return c=ic.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},Pf.prototype.onData=function(e){this.chunks.push(e)},Pf.prototype.onEnd=function(e){e===Df&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=rg.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var xte={Inflate:Pf,inflate:Fw,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Fw(e,t)},ungzip:Fw,constants:qu};let{Deflate:zme,deflate:Ute,deflateRaw:qme,gzip:Yme}=gte,{Inflate:Jme,inflate:Vte,inflateRaw:Xme,ungzip:$me}=xte;var Fte=Ute,jte=Vte;let Tn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function at(){return Tn}function K2(){return"setSinkId"in HTMLAudioElement.prototype&&(!x("RESTRICTION_SET_PLAYBACK_DEVICE")||(jc()||nL())&&!_R())}let un=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function $u(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function lt(e,t,r,i,s){return{width:e,height:t,frameRate:r,bitrateMin:i,bitrateMax:s}}function as(e,t,r,i,s){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:i,bitrateMax:s}}function jw(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let Bte={"90p":lt(160,90),"90p_1":lt(160,90),"120p":lt(160,120,15,30,65),"120p_1":lt(160,120,15,30,65),"120p_3":lt(120,120,15,30,50),"120p_4":lt(212,120),"180p":lt(320,180,15,30,140),"180p_1":lt(320,180,15,30,140),"180p_3":lt(180,180,15,30,100),"180p_4":lt(240,180,15,30,120),"240p":lt(320,240,15,40,200),"240p_1":lt(320,240,15,40,200),"240p_3":lt(240,240,15,40,140),"240p_4":lt(424,240,15,40,220),"360p":lt(640,360,15,80,400),"360p_1":lt(640,360,15,80,400),"360p_3":lt(360,360,15,80,260),"360p_4":lt(640,360,30,80,600),"360p_6":lt(360,360,30,80,400),"360p_7":lt(480,360,15,80,320),"360p_8":lt(480,360,30,80,490),"360p_9":lt(640,360,15,80,800),"360p_10":lt(640,360,24,80,800),"360p_11":lt(640,360,24,80,1e3),"480p":lt(640,480,15,100,500),"480p_1":lt(640,480,15,100,500),"480p_2":lt(640,480,30,100,1e3),"480p_3":lt(480,480,15,100,400),"480p_4":lt(640,480,30,100,750),"480p_6":lt(480,480,30,100,600),"480p_8":lt(848,480,15,100,610),"480p_9":lt(848,480,30,100,930),"480p_10":lt(640,480,10,100,400),"720p":lt(1280,720,15,120,1130),"720p_auto":lt(1280,720,30,900,3e3),"720p_1":lt(1280,720,15,120,1130),"720p_2":lt(1280,720,30,120,2e3),"720p_3":lt(1280,720,30,120,1710),"720p_5":lt(960,720,15,120,910),"720p_6":lt(960,720,30,120,1380),"1080p":lt(1920,1080,15,120,2080),"1080p_1":lt(1920,1080,15,120,2080),"1080p_2":lt(1920,1080,30,120,3e3),"1080p_3":lt(1920,1080,30,120,3150),"1080p_5":lt(1920,1080,60,120,4780),"1440p":lt(2560,1440,30,120,4850),"1440p_1":lt(2560,1440,30,120,4850),"1440p_2":lt(2560,1440,60,120,7350),"4k":lt(3840,2160,30,120,8910),"4k_1":lt(3840,2160,30,120,8910),"4k_3":lt(3840,2160,60,120,13500)},ug=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],Wte={"480p":as(640,480,5),"480p_1":as(640,480,5),"480p_2":as(640,480,30),"480p_3":as(640,480,15),"720p":as(1280,720,5),"720p_auto":lt(1280,720,30,900,3e3),"720p_1":as(1280,720,5),"720p_2":as(1280,720,30),"720p_3":as(1280,720,15),"1080p":as(1920,1080,5),"1080p_1":as(1920,1080,5),"1080p_2":as(1920,1080,30),"1080p_3":as(1920,1080,15)},Gte={"1SL1TL":jw(1,1),"3SL3TL":jw(3,3),"2SL3TL":jw(2,3)};function Ra(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Bte[e]):e}function Bw(e){return typeof e=="string"?Object.assign({},Wte[e]):e}function hg(e){return typeof e=="string"?Object.assign({},Gte[e]):e}let Hte={speech_low_quality:$u(16e3,!1),speech_standard:$u(32e3,!1,18),music_standard:$u(48e3,!1),standard_stereo:$u(48e3,!0,56),high_quality:$u(48e3,!1,128),high_quality_stereo:$u(48e3,!0,192)};function pg(e){return typeof e=="string"?Object.assign({},Hte[e]):e}let Qu=[];function z2(e){return Gr(e,"mediaSource",["screen","window","application"]),!0}let ve=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Ft=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),Zu=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Kte=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),zte=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),Ed=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),eh=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),th=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),$i=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let Ww={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Gw={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},q2={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},qte={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Y2={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},ri=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Qi=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),kf=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),gd=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Kn=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),wa=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),Hw={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},fg=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function J2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function Xt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?J2(Object(r),!0).forEach(function(i){te(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J2(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function te(e,t,r){return(t=function(i){var s=function(c,l){if(typeof c!="object"||c===null)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var h=u.call(c,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof s=="symbol"?s:String(s)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ct(e,t,r,i,s){var c,l,u={};return Object.keys(i).forEach(function(h){u[h]=i[h]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=Ds(c=OZ(l=r.slice()).call(l)).call(c,function(h,f){return f(e,t,h)||h},u),s&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(s):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(e,t,u),u=null),u}class X2 extends Jt{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Ed.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,r){super(),te(this,"trackMediaType",void 0),te(this,"_ID",void 0),te(this,"_rtpTransceiver",void 0),te(this,"_lowRtpTransceiver",void 0),te(this,"_hints",[]),te(this,"_isClosed",!1),te(this,"_originMediaStreamTrack",void 0),te(this,"mediaStreamTrack",void 0),te(this,"_external",{}),this._ID=r||kt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(i){ge(Qu).call(Qu,i)||Qu.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Wc(()=>{var r;be.reportApiInvoke(null,{name:Pr.GET_MEDIA_STREAM_TRACK,options:[],tag:sr.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Zu.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){let r=Qu.indexOf(t);r!==-1&&Qu.splice(r,1)}(this),this.emit(eh.CLOSED),this.removeAllListeners(Ed.SEI_RECEIVED)}_updateRtpTransceiver(t,r){if(r===Zu.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Ed.TRANSCEIVER_UPDATED,t,r)}}class rh extends X2{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,r){super(t,r),te(this,"_enabled",!0),te(this,"_muted",!1),te(this,"_isExternalTrack",!1),te(this,"_isClosed",!1),te(this,"_enabledMutex",void 0),te(this,"processor",void 0),te(this,"_processorContext",void 0),te(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new rn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,r;return(t=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,v.debug("[".concat(this.getTrackId(),"] close")),this.emit(ve.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Pt(this,ve.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(eh.TRACK_ENDED)}stateCheck(t,r){if(v.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(r,"]")),Ja(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new ee(N.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",v);if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new ee(N.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",v)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():_e.resolve([])}}let $2=window.AudioContext||window.webkitAudioContext,Zi=null,bt=new class extends Jt{constructor(){super(...arguments),te(this,"prevState",void 0),te(this,"curState",void 0),te(this,"currentTime",void 0),te(this,"currentTimeStuckAt",void 0),te(this,"interruptDetectorTrack",void 0),te(this,"onLocalAudioTrackMute",()=>{v.info("ios15-interruption-start"),this.emit(un.IOS_15_16_INTERRUPTION_START)}),te(this,"onLocalAudioTrackUnmute",async()=>{v.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?v.info("ios15-interruption-end-canceled"):(Zi&&await Zi.suspend(),this.emit(un.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){v.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){v.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function nh(){if(!Zi){if(function(){if(!$2)return void v.error("your browser is not support web audio");v.info("create audio context");let e=Xt({},x("WEBAUDIO_INIT_OPTIONS"));v.debug("audio context init option:",JSON.stringify(e)),Zi=new $2(e),bt.curState=Zi.state,Zi.onstatechange=()=>{bt.prevState=bt.curState,bt.curState=Zi?Zi.state:void 0;let{prevState:t,curState:r}=bt,i=r==="running",s=r==="interrupted",c=t==="running",l=t==="suspended",u=t==="interrupted",h=dt().osVersion;(bn()||Jo())&&c&&s&&(v.info("ios".concat(h,"-interruption-start")),bt.emit(un.IOS_INTERRUPTION_START)),(bn()||Jo())&&(l||u)&&i&&(v.info("ios".concat(h,"-interruption-end")),bt.emit(un.IOS_INTERRUPTION_END)),t!==r&&bt.emit(un.STATE_CHANGE,r,t)},setInterval(()=>{var t;let r=(t=Zi)===null||t===void 0?void 0:t.currentTime;bt.currentTime!==r?(bt.currentTimeStuckAt&&(v.debug("AudioContext current time resume at ".concat(r)),bt.currentTimeStuckAt=void 0),bt.currentTime=r):(r!==bt.currentTimeStuckAt&&(be.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:sr.TRACER}).onSuccess(),v.warning("AudioContext current time stuck at ".concat(r))),bt.currentTimeStuckAt=r)},5e3),async function(t){let r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],i,s=!1,c=!1,l=!1;function u(T){t.state==="running"?h(!1):bn()||Jo()?t.state==="suspended"&&(h(!0),T&&t.resume().then(f,f)):t.state!=="closed"&&(h(!0),T&&t.resume().then(f,f))}function h(T){if(s!==T){s=T;for(let w=0,O=r;w<O.length;w+=1){let P=O[w];T?window.addEventListener(P,m,{capture:!0,passive:!0}):window.removeEventListener(P,m,{capture:!0,passive:!0})}}}function f(){u(!1)}function m(){u(!0)}function E(T){if(!l)if(i.paused)if(T){let w;S(!1),l=!0;try{w=i.play(),w?w.then(y,y):(i.addEventListener("playing",y),i.addEventListener("abort",y),i.addEventListener("error",y))}catch{y()}}else S(!0);else S(!1)}function S(T){if(c!==T){c=T;for(let w=0,O=r;w<O.length;w++){let P=O[w];T?window.addEventListener(P,A,{capture:!0,passive:!0}):window.removeEventListener(P,A,{capture:!0,passive:!0})}}}function y(){i.removeEventListener("playing",y),i.removeEventListener("abort",y),i.removeEventListener("error",y),l=!1,E(!1)}function A(){E(!0)}if(bn()){let T=t.createMediaStreamDestination(),w=document.createElement("div");w.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=w.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=T.stream,E(!0)}bt.on(un.STATE_CHANGE,function(){u(!0)}),u(!1)}(Zi)}(),!Zi)throw new ee(N.NOT_SUPPORTED,"can not create audio context");return Zi}return Zi}function Sd(e){if(function(){if(Kw!==null)return Kw;let i=nh(),s=i.createBufferSource(),c=i.createGain(),l=i.createGain();s.connect(c),s.connect(l),s.disconnect(c);let u=!1;try{s.disconnect(c)}catch{u=!0}return s.disconnect(),Kw=u,u}())return;let t=e.connect,r=e.disconnect;e.connect=(i,s,c)=>{var l;return e._inputNodes||(e._inputNodes=[]),ge(l=e._inputNodes).call(l,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,s,c)):t.call(e,i,s)),e},e.disconnect=(i,s,c)=>{r.call(e),i?IE(e._inputNodes,i):e._inputNodes=[];for(let l of e._inputNodes)t.call(e,l)}}let Kw=null;function zw(e,t){let r=!1,i=1/t;if(x("DISABLE_WEBAUDIO")){let s=window.setInterval(()=>{r?window.clearInterval(s):e(performance.now()/1e3)},1e3*i)}else{let s=nh(),c=s.createGain();c.gain.value=0,c.connect(s.destination);let l=()=>{if(r)return void(c=null);let u=s.createOscillator();u.onended=l,u.connect(c),u.start(0),u.stop(s.currentTime+i),e(s.currentTime)};l()}return()=>{r=!0}}class Q2{constructor(){te(this,"context",void 0),te(this,"analyserNode",void 0),te(this,"sourceNode",void 0),this.context=nh(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||bn()||Jo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let s=0;s<t.length;++s)t[s]=i[s]/128-1}let r=Ds(t).call(t,(i,s)=>i+s*s,0)/t.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,r;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{v.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Z2 extends Jt{get processSourceNode(){return this.sourceNode}set processedNode(t){var r;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),te(this,"outputNode",void 0),te(this,"outputTrack",void 0),te(this,"isPlayed",!1),te(this,"sourceNode",void 0),te(this,"context",void 0),te(this,"audioBufferNode",void 0),te(this,"destNode",void 0),te(this,"audioOutputLevel",0),te(this,"volumeLevelAnalyser",void 0),te(this,"_processedNode",void 0),te(this,"playNode",void 0),te(this,"isDestroyed",!1),te(this,"onNoAudioInput",void 0),te(this,"isNoAudioInput",!1),te(this,"_noAudioInputCount",0),this.context=nh(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Sd(this.outputNode),this.volumeLevelAnalyser=new Q2}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit($i.ON_AUDIO_BUFFER,function(i){for(let s=0;s<i.outputBuffer.numberOfChannels;s+=1){let c=i.outputBuffer.getChannelData(s);for(let l=0;l<c.length;l+=1)c[l]=0}return i.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!at().webAudioMediaStreamDest)throw new ee(N.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&bE(()=>{bt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;bn()||Jo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let r=this.volumeLevelAnalyser.getAnalyserNode(),i;r.getFloatTimeDomainData?(i=new Float32Array(r.fftSize),r.getFloatTimeDomainData(i)):(i=new Uint8Array(r.fftSize),r.getByteTimeDomainData(i));let s=!1;for(let c=0;c<i.length;c++)i[c]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await Xr(200),await this.checkHasAudioInput(t?t+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,r;(t=this.processedNode)===null||t===void 0||t.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ex extends Z2{get isFreeze(){return!1}constructor(t,r,i){var s;if(super(),te(this,"sourceNode",void 0),te(this,"track",void 0),te(this,"clonedTrack",void 0),te(this,"audioElement",void 0),te(this,"isCurrentTrackCloned",!1),te(this,"isRemoteTrack",!1),te(this,"originVolumeLevelAnalyser",void 0),te(this,"rebuildWebAudio",async()=>{if(v.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void v.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>v.info("resume success")),v.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let u=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?u.stop():this.isCurrentTrackCloned=!0;let h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),Sd(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),Sd(this.outputNode),this.emit($i.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new ee(N.UNEXPECTED_ERROR);this.track=t;let c=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(c),Sd(this.sourceNode),i){let u=i.clone();u.enabled=!0,this.clonedTrack=u,v.debug("create an unmuted track ".concat(u.id," from the original track ").concat(i.id," to get the volume"));let h=this.context.createMediaStreamSource(new MediaStream([u]));Sd(h),this.originVolumeLevelAnalyser=new Q2,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=c;let l=dt();r&&l.os===Yr.IOS&&Number((s=l.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(bt.on(un.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(u=>{u||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),Sd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit($i.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),bt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let r=t.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),v.debug("create an unmuted track ".concat(r.id," from the original track ").concat(t.id," to get the volume"));let i=this.context.createMediaStreamSource(new MediaStream([r]));Sd(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function tx(e,t,r){let i=(c,l)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||l:c:l,s={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(s.video.mandatory.maxFrameRate=t.frameRate.max,s.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(s.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function Yte(e,t){let r=await rx(e.mediaSource),{sourceId:i,audio:s}=await function(c){let l=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new _e((u,h)=>{let f=document.createElement("div");f.innerText="share screen",f.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");let S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let A=document.createElement("button");A.innerHTML="cancel",A.setAttribute("style","width: 85px;"),A.onclick=()=>{document.body.removeChild(O);let P=new Error("NotAllowedError");P.name="NotAllowedError",h(P)};let T=l,w=document.createElement("div");if(l){let P=document.createElement("input");P.setAttribute("type","checkbox");let F=document.createElement("span");P.setAttribute("style","margin-right: 6px;"),F.innerText="Share audio",P.checked=T,P.onchange=()=>{T=P.checked},w.appendChild(P),w.appendChild(F)}y.appendChild(w),y.appendChild(A),m.appendChild(E),m.appendChild(S),m.appendChild(y);let O=document.createElement("div");O.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),O.appendChild(f),O.appendChild(m),document.body.appendChild(O),c.map(P=>{if(P.id){let F=document.createElement("div");F.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let W=P.thumbnail;try{let{width:K}=W.getSize();K>1920&&(W=W.resize({width:1920}))}catch(K){throw K&&K.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),K}F.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+W.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+P.name.replace(/[\u00A0-\u9999<>\&]/g,function(K){return"&#"+K.charCodeAt(0)+";"})+"</span>",F.onclick=()=>{document.body.removeChild(O),u({sourceId:P.id,audio:T})},S.appendChild(F)}})})}(r,t);return await tx(i,e,s)}async function rx(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let r=yL();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new ee(N.ELECTRON_IS_NULL);let i=null;try{var s;i=((s=r.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new _e((c,l)=>{r.desktopCapturer.getSources({types:t},(u,h)=>{u?l(u):c(h)})}));try{return await i}catch(c){throw new ee(N.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}}let qw=new rn("safari"),nx=!1,ix=!1;async function eo(e,t){let r=0,i=null;for(;r<2;)try{i=await Jte(e,t,r>0);break}catch(s){if(s instanceof ee)throw v.error("[".concat(t,"] ").concat(s.toString())),s;let c=mg(s.name||s.code||s,s.message);if(c.code===N.MEDIA_OPTION_INVALID){v.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await Xr(500);continue}throw v.error("[".concat(t,"] ").concat(c.toString())),c}if(!i)throw new ee(N.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function Jte(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ee(N.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let i=at(),s=new MediaStream;if(e.audioSource&&s.addTrack(e.audioSource),e.videoSource&&s.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return v.debug("Using Video Source/ Audio Source"),s;if(e.screen)if(yL())e.screen.sourceId?ih(s,await tx(e.screen.sourceId,e.screen,e.screenAudio)):ih(s,await Yte(e.screen,e.screenAudio));else if(jc()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new ee(N.NOT_SUPPORTED,"This browser does not support screen sharing");v.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let S=await(l=e.screen.extensionId,u=t,new _e((y,A)=>{try{chrome.runtime.sendMessage(l,{getStream:!0},T=>{if(!T||!T.streamId)return v.error("[".concat(u,"] No response from Chrome Plugin. Plugin not installed properly"),T),void A(new ee(N.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(T.streamId)})}catch(T){v.error("[".concat(u,"] AgoraRTC screensharing plugin is not accessible(").concat(l,")"),T.toString()),A(new ee(N.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=S,ih(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var c;e.screen.mediaSource&&z2(e.screen.mediaSource);let S={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(c=e.screen.displaySurface)!==null&&c!==void 0?c:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:A,systemAudio:T}=e.screen,w={selfBrowserSurface:y,surfaceSwitching:A,systemAudio:T};!y&&delete w.selfBrowserSurface,!A&&delete w.surfaceSwitching,!T&&delete w.systemAudio,v.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:S,audio:!!e.screenAudio,controls:w})),ih(s,await navigator.mediaDevices.getDisplayMedia(Xt({video:S,audio:!!e.screenAudio},w)))}else{if(!Dt())throw v.error("[".concat(t,"] This browser does not support screenSharing")),new ee(N.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&z2(e.screen.mediaSource);let S={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};v.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(S))),ih(s,await navigator.mediaDevices.getUserMedia(S))}}var l,u;if(!e.video&&!e.audio)return s;let h={video:e.video,audio:e.audio},f=x("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),h=vR(h,f)}catch{}v.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(h)),dt();let m,E=null;(Jr()||bn()||RE())&&(E=await qw.lock());try{m=await navigator.mediaDevices.getUserMedia(h)}catch(S){throw E&&E(),S}return h.audio&&(nx=!0),h.video&&(ix=!0),ih(s,m),E&&E(),s}function mg(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ee(N.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new ee(N.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new ee(N.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new ee(N.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ee(N.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new ee(N.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return v.error("getUserMedia unexpected error",e),new ee(N.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function ih(e,t){let r=e.getVideoTracks()[0],i=e.getAudioTracks()[0],s=t.getVideoTracks()[0],c=t.getAudioTracks()[0];c&&(i&&e.removeTrack(i),e.addTrack(c)),s&&(r&&e.removeTrack(r),e.addTrack(s))}let to=new class extends Jt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(gd.STATE_CHANGE,e),this._state=e)}constructor(){super(),te(this,"_state",kf.IDLE),te(this,"isAccessMicrophonePermission",!1),te(this,"isAccessCameraPermission",!1),te(this,"lastAccessMicrophonePermission",!1),te(this,"lastAccessCameraPermission",!1),te(this,"checkdeviceMatched",!1),te(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(x("ENUMERATE_DEVICES_INTERVAL")||(wE()||CE()===Yr.HARMONY_OS)&&Bc())&&this.updateDevicesInfo()},x("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>v.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ee(N.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let i=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(i),c=!this.isAccessMicrophonePermission&&e,l=!this.isAccessCameraPermission&&t;s.audio&&(c=!1),s.video&&(l=!1);let u=null,h=null,f=null;if(!r&&(c||l)){if(qw.isLocked&&(v.debug("[device manager] wait GUM lock"),(await qw.lock())(),v.debug("[device manager] GUM unlock")),nx&&(c=!1,this.isAccessMicrophonePermission=!0),ix&&(l=!1,this.isAccessCameraPermission=!0),v.debug("[device manager] check media device permissions",e,t,c,l),c&&l){try{f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(m){let E=mg(m.name||m.code||m,m.message);if(E.code===N.PERMISSION_DENIED)throw E;v.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(c){try{u=await navigator.mediaDevices.getUserMedia({audio:e})}catch(m){let E=mg(m.name||m.code||m,m.message);if(E.code===N.PERMISSION_DENIED)throw E;v.warning("getUserMedia failed in getDevices",E)}this.isAccessMicrophonePermission=!0}else if(l){try{h=await navigator.mediaDevices.getUserMedia({video:t})}catch(m){let E=mg(m.name||m.code||m,m.message);if(E.code===N.PERMISSION_DENIED)throw E;v.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0}v.debug("[device manager] mic permission",e,"cam permission",t)}try{let m=await navigator.mediaDevices.enumerateDevices();return u&&u.getTracks().forEach(E=>E.stop()),h&&h.getTracks().forEach(E=>E.stop()),f&&f.getTracks().forEach(E=>E.stop()),u=null,h=null,f=null,m}catch(m){return u&&u.getTracks().forEach(E=>E.stop()),h&&h.getTracks().forEach(E=>E.stop()),f&&f.getTracks().forEach(E=>E.stop()),u=null,h=null,f=null,new ee(N.ENUMERATE_DEVICES_FAILED,m.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===e);if(!t)throw new ee(N.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=kf.INITING;try{await this.updateDevicesInfo(),this.state=kf.INITEND}catch(e){throw v.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=kf.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ee(N.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let s=e.find(l=>l.kind==="audioinput"&&l.deviceId==="default"),c=e.find(l=>l.kind==="audiooutput"&&l.deviceId==="default");s&&c?c.groupId===s.groupId?v.debug("[device-check] default input ".concat(s.label," and output ").concat(c.label," is the same group")):v.warning("[device-check] default input ".concat(s.label," and output ").concat(c.label," is not the same group")):v.debug("[device-check] default input or output not found")}let i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(s=>{if(!s.deviceId)return;let c=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((c?c.state:"INACTIVE")!=="ACTIVE"){let l={initAt:t,updateAt:t,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),l),r.push(l)}c&&(c.updateAt=t)}),this.deviceInfoMap.forEach((s,c)=>{s.state==="ACTIVE"&&s.updateAt!==t&&(s.state="INACTIVE",r.push(s))}),this.state!==kf.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(gd.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(gd.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(gd.PLAYOUT_DEVICE_CHANGED,s)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(s=>s.kind==="audioinput"),r=e.filter(s=>s.kind==="videoinput"),i={audio:!1,video:!1};for(let s of t)if(s.label&&s.deviceId){i.audio=!0;break}for(let s of r)if(s.label&&s.deviceId){i.video=!0;break}return i}},Yw=!1,ro=new class extends Jt{constructor(){super(...arguments),te(this,"onAutoplayFailed",void 0),te(this,"onAudioAutoplayFailed",void 0)}};function ox(){if(dt(),!Yw){let e=t=>{t.preventDefault(),Yw=!1,Xp()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Yw=!0,Xp()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),v.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ro.onAutoplayFailed?ro.onAutoplayFailed():ro.onAudioAutoplayFailed?v.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):v.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ro.emit("autoplay-failed")}}function sx(e,t,r,i){if(!e)return;let s=be.getBaseInfoBySessionId(e);if(!s)return;let c=s.info,l=Date.now(),u=Xt(Xt({},c),{},{vid:c.vid===void 0?0:Number(c.vid),lts:l,elapse:l-s.startTime,cbRegistered:ro.onAutoplayFailed||ro.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:i,extend:void 0});be.send({type:rr.AUTOPLAY_FAILED,data:u},!0)}let Xte=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ci=new class{constructor(){te(this,"onAutoplayFailed",void 0),te(this,"elementMap",new Map),te(this,"elementStateMap",new Map),te(this,"elementsNeedToResume",[]),te(this,"sinkIdMap",new Map),te(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,i]=t,s=this.elementStateMap.get(r),c=i.srcObject.getAudioTracks()[0],l=c&&c.readyState;if(v.debug("resume after interrupted, ele: ".concat(s," audio: ").concat(l," ").concat(e)),l==="live"){if(e)return i.pause(),void i.play();if(bt.curState==="running")return bu()?(i.pause(),void i.play()):void(s&&s==="paused"&&i.play())}})}),te(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e,i=r.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(v.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),bt.on(un.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),bt.on(un.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),bt.on(un.STATE_CHANGE,()=>{bn()&&bt.prevState==="suspended"&&bt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(i){throw new ee(N.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,r,i){if(this.elementMap.has(t))return;let s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,s),this.elementMap.set(t,s),this.elementStateMap.set(t,Kn.INIT),this.setVolume(t,r);let c=this.sinkIdMap.get(t);if(c)try{s.setSinkId(c).catch(u=>{v.warning("[".concat(t,"] set sink id failed"),u.toString())})}catch(u){v.warning("[".concat(t,"] set sink id failed"),u.toString())}let l=s.play();l&&l.then&&l.catch(u=>{i&&sx(i,"audio",u.message,t),v.warning("audio element play warning",u.toString()),this.elementMap.has(t)&&u.name==="NotAllowedError"&&(v.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),bE(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),ox()}))})}updateTrack(e,t){let r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Xte.forEach(r=>{t.addEventListener(r,i=>{let s=this.elementStateMap.get(e),c=i.type==="pause"?"paused":i.type;if(v.debug("[".concat(e,"] audio-element-status change ").concat(s," => ").concat(c)),i.type==="error"){let l=t==null?void 0:t.error;l&&v.error("[".concat(e,"] media error, code: ").concat(l.code,", message: ").concat(l.message))}this.elementStateMap.set(e,c)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(r=>{v.debug("Auto resume audio element success")}).catch(r=>{v.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new _e(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Xp()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function gr(){return function(e,t,r){let i=r.value;return typeof i=="function"&&(r.value=function(){this._isClosed&&new ee(N.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",v);for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];let u=i.apply(this,c);return u instanceof _e?new _e((h,f)=>{u.then(h).catch(f)}):u}),r}}class ax extends Jt{constructor(t){super(),te(this,"name","VideoProcessorDestination"),te(this,"ID","0"),te(this,"_source",void 0),te(this,"videoContext",void 0),te(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ee(N.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ee(N.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(ri.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ri.ON_TRACK,void 0)}}class cx extends Jt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r){super(),te(this,"constraintsMap",new Map),te(this,"statsRegistry",[]),te(this,"usageRegistry",[]),te(this,"trackId",void 0),te(this,"direction",void 0),te(this,"_chained",!1),this.trackId=t,this.direction=r}async getConstraints(){return await kr(this,Qi.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,r){var i;return v.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),Pt(this,Qi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ms(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return v.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Pt(this,Qi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ms(r=this.constraintsMap).call(r)))}registerStats(t,r,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:i})}unregisterStats(t,r){let i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===r);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){let t=[];for(let{processorID:r,processorName:i,type:s,cb:c}of this.statsRegistry)try{let l=c();t.push({processorID:r,processorName:i,type:s,stats:l})}catch(l){v.error(new ee(N.UNEXPECTED_ERROR,l.message))}return t}registerUsage(t,r){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){let r=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:r}of this.usageRegistry)try{let i=r();i instanceof _e&&(i=await i),t.push(Xt(Xt({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class lx extends Jt{constructor(t){super(),te(this,"name","AudioProcessorDestination"),te(this,"ID","0"),te(this,"inputTrack",void 0),te(this,"inputNode",void 0),te(this,"audioProcessorContext",void 0),te(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ee(N.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ee(N.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ri.ON_TRACK,void 0),this.emit(ri.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(ri.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(ri.ON_NODE,this.inputNode))}}class dx extends Jt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r,i){super(),te(this,"constraintsMap",new Map),te(this,"statsRegistry",[]),te(this,"audioContext",void 0),te(this,"trackId",void 0),te(this,"direction",void 0),te(this,"usageRegistry",[]),te(this,"_chained",!1),this.audioContext=t,this.trackId=r,this.direction=i}async getConstraints(){return kr(this,Qi.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,r){var i;return v.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),Pt(this,Qi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ms(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Pt(this,Qi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ms(r=this.constraintsMap).call(r)))}registerStats(t,r,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:i})}unregisterStats(t,r){let i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===r);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){let t=[];for(let{processorID:r,processorName:i,type:s,cb:c}of this.statsRegistry)try{let l=c();t.push({processorID:r,processorName:i,type:s,stats:l})}catch(l){v.error(new ee(N.UNEXPECTED_ERROR,l.message))}return t}registerUsage(t,r){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){let r=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:r}of this.usageRegistry)try{let i=r();i instanceof _e&&(i=await i),t.push(Xt(Xt({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class Jw extends Jt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),te(this,"context",void 0),te(this,"processSourceNode",void 0),te(this,"outputTrack",void 0),te(this,"processedNode",void 0),te(this,"clonedTrack",void 0),te(this,"outputNode",void 0),this.outputNode=new $te}setVolume(){}createOutputTrack(){throw new ee(N.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class $te{disconnect(){}connect(){}}function ux(e){return new _e((t,r)=>{let i=!1,s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);let c=bn()?"canplay":"playing";s.addEventListener(c,()=>{let l=s.videoWidth,u=s.videoHeight;!l&&Dt()||(i=!0,s.srcObject=null,s.remove(),t([l,u]))}),s.srcObject=new MediaStream([e]),s.play().catch(AE),setTimeout(()=>{i||(s.srcObject=null,s.remove(),t([s.videoWidth,s.videoHeight]))},4e3)})}function _g(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let r=Ra(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!pL()&&r.frameRate&&(t.frameRate=r.frameRate),nL()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Dt()&&(t.frameRate={ideal:30,max:30}),t}function hx(e){let t={};if(pL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,jc()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){let r=pg(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),wE()&&(t.sampleRate=void 0),t}let Qte=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:r,width:i,height:s}=e.getMediaStreamTrackSettings(),{frameRate:c=r,width:l=i,height:u=s}=t;if(!c||!l||!u)return;l=TR(l),u=TR(u),c=TR(c);let{max:h,min:f}=function(y,A,T){let w=200*Math.pow(T/15,.6)*Math.pow(y*A/640/360,.75);return{min:Math.floor(w),max:Math.floor(4*w)}}(l,u,c),{bitrateMax:m,bitrateMin:E}=t||{};m||v.debug("calculate bitrate: [w: ".concat(l,", h: ").concat(u,", fps: ").concat(c,"] => [brMax: ").concat(m,", brMin: ").concat(E,"]"));let{maxFramerate:S}=x("ENCODER_CONFIG_LIMIT");return S&&typeof S=="number"&&(c=Math.min(c,S)),{frameRate:c,bitrateMax:m||h,bitrateMin:E||f,scaleResolutionDownBy:1,scale:0}},px=async(e,t,r)=>await(async(i,s,c)=>{let l=function(f){let m=[];for(let E=0;E<f.length;E+=2)m.push(parseInt(f.slice(E,E+2),16));return Uint8Array.from(m)}(PL(""+s+c)).slice(0,16),u=l.slice(0,12),h=await window.crypto.subtle.importKey("raw",l,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:u},h,i))})(e.buffer,t,r),Xw=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new _e((r,i)=>{t.toBlob(async s=>{if(t.remove(),s){let c=await fx(s);r({buffer:c,width:t.width,height:t.height})}else i(new ee(N.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},fx=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var mx,_x,Ex,gx,Sx,yx,vx,Tx,Cx,Rx,wx,Ix,bx,Ax,Ox,Nx,Dx,Px,nr,kx,Lx,Mx,xx,Ux,Vx,Ia,Fx,jx,Bx,Wx,Gx,Hx,Kx,zx,qx,Yx,Jx,Xx,$x,Cn;let lr=(mx=ke({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),_x=ke({argsMap:(e,t)=>[e.getTrackId(),t]}),Ex=gr(),gx=Nu("LocalAudioTrack","_enabledMutex"),Sx=ke({argsMap:(e,t)=>[e.getTrackId(),t]}),yx=gr(),vx=Nu("LocalAudioTrack","_enabledMutex"),Tx=ke({argsMap:(e,t)=>[e.getTrackId(),t]}),Cx=gr(),Rx=gr(),wx=gr(),Ix=ke({argsMap:e=>[e.getTrackId()]}),bx=gr(),Ax=ke({argsMap:e=>[e.getTrackId()]}),Ox=gr(),Nx=ke({argsMap:e=>[e.getTrackId()]}),Dx=ke({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Px=ke({argsMap:e=>[e.getTrackId()]}),ct((nr=class extends rh{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ci.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,i){super(e,r),te(this,"trackMediaType","audio"),te(this,"_encoderConfig",void 0),te(this,"_trackSource",void 0),te(this,"_enabled",!0),te(this,"_volume",100),te(this,"_useAudioElement",!0),te(this,"_bypassWebAudio",!1),te(this,"processor",void 0),te(this,"_processorContext",void 0),te(this,"_processorDestination",void 0),te(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new Jw,x("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),x("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Jr()&&!Zi?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){At(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ci.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void v.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Pt(this,ve.NEED_REPLACE_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{v.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!K2())throw new ee(N.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ci.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await Pt(this,ve.NEED_ENABLE_TRACK,this),v.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw r||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await Pt(this,ve.NEED_DISABLE_TRACK,this)}catch(i){throw r||(this._enabled=!0),v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Pt(this,ve.NEED_MUTE_TRACK,this):await Pt(this,ve.NEED_UNMUTE_TRACK,this))}getStats(){return Wc(()=>{v.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Mi(this,ve.GET_STATS)||Xt({},Ww)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners($i.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners($i.ON_AUDIO_BUFFER),this._source.on($i.ON_AUDIO_BUFFER,r=>e(r))}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ci.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ci.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ci.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Pt(this,ve.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return _e.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ee(N.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ee(N.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ri.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Pt(this,ve.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Pt(this,ve.NEED_REPLACE_TRACK,this))}),e.on(ri.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(ri.ON_TRACK),e.removeAllListeners(ri.ON_NODE)}bindProcessorContextEvents(e){e.on(Qi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Qi.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Jw&&(this._trackSource=new ex(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new dx(this._source.context,this.getTrackId(),"local"),t=new lx(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on($i.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ci.stop(this.getTrackId()),this._source.play()),Pt(this,ve.NEED_REPLACE_MIXING_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{v.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[mx],Object.getOwnPropertyDescriptor(nr.prototype,"setVolume"),nr.prototype),ct(nr.prototype,"setPlaybackDevice",[_x,Ex],Object.getOwnPropertyDescriptor(nr.prototype,"setPlaybackDevice"),nr.prototype),ct(nr.prototype,"setEnabled",[gx,Sx,yx],Object.getOwnPropertyDescriptor(nr.prototype,"setEnabled"),nr.prototype),ct(nr.prototype,"setMuted",[vx,Tx,Cx],Object.getOwnPropertyDescriptor(nr.prototype,"setMuted"),nr.prototype),ct(nr.prototype,"getStats",[Rx],Object.getOwnPropertyDescriptor(nr.prototype,"getStats"),nr.prototype),ct(nr.prototype,"setAudioFrameCallback",[wx],Object.getOwnPropertyDescriptor(nr.prototype,"setAudioFrameCallback"),nr.prototype),ct(nr.prototype,"play",[Ix,bx],Object.getOwnPropertyDescriptor(nr.prototype,"play"),nr.prototype),ct(nr.prototype,"stop",[Ax,Ox],Object.getOwnPropertyDescriptor(nr.prototype,"stop"),nr.prototype),ct(nr.prototype,"close",[Nx],Object.getOwnPropertyDescriptor(nr.prototype,"close"),nr.prototype),ct(nr.prototype,"pipe",[Dx],Object.getOwnPropertyDescriptor(nr.prototype,"pipe"),nr.prototype),ct(nr.prototype,"unpipe",[Px],Object.getOwnPropertyDescriptor(nr.prototype,"unpipe"),nr.prototype),nr),Eg=(kx=ke({argsMap:(e,t)=>[e.getTrackId(),t]}),Lx=gr(),Mx=Nu("MicrophoneAudioTrack","_enabledMutex"),xx=ke({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),Ux=gr(),Vx=ke({argsMap:e=>[e.getTrackId()]}),ct((Ia=class extends lr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,i){super(e,t.encoderConfig?pg(t.encoderConfig):{},i,x("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),te(this,"_config",void 0),te(this,"_deviceName","default"),te(this,"_constraints",void 0),te(this,"_originalConstraints",void 0),te(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(bu()||mR())&&bt.bindInterruptDetectorTrack(this)}async setDevice(e){if(v.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await to.getDeviceById(e),r={};r.audio=Xt({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await eo(r,this.getTrackId())}catch(s){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await eo({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await to.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}v.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return v.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),x("AUTO_RESET_AUDIO_ROUTE")&&(bn()||Jo())){let l=navigator.audioSession;l&&(e||(l.type="playback"),l.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),r||(this._enabled=!1);try{await Pt(this,ve.NEED_DISABLE_TRACK,this)}catch(l){throw v.error("[".concat(this.getTrackId(),"] setEnabled false failed"),l.toString()),l}return}let s=Xt({},this._constraints),c=to.searchDeviceIdByName(this._deviceName);c&&!s.deviceId&&(s.deviceId=c);try{r||(this._enabled=!0);let l=await eo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),await Pt(this,ve.NEED_ENABLE_TRACK,this)}catch(l){throw r||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled true failed"),l.toString()),l}v.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(bu()||mR())&&bt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((bn()||Jo())&&this._enabled&&!this._isClosed&&bt.duringInterruption){let e=async()=>{bt.off(un.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};bt.on(un.IOS_INTERRUPTION_END,e)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(eh.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,r=to.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let i=await eo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Qi.REQUEST_UPDATE_CONSTRAINTS,async(t,r,i)=>{try{let s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),r()}catch(s){i(s)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Qi.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[kx,Lx],Object.getOwnPropertyDescriptor(Ia.prototype,"setDevice"),Ia.prototype),ct(Ia.prototype,"setEnabled",[Mx,xx,Ux],Object.getOwnPropertyDescriptor(Ia.prototype,"setEnabled"),Ia.prototype),ct(Ia.prototype,"close",[Vx],Object.getOwnPropertyDescriptor(Ia.prototype,"close"),Ia.prototype),Ia),Zte=(Fx=ke({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),jx=gr(),Bx=ke({argsMap:e=>[e.getTrackId()]}),Wx=gr(),Gx=ke({argsMap:e=>[e.getTrackId()]}),Hx=gr(),Kx=ke({argsMap:e=>[e.getTrackId()]}),zx=gr(),qx=ke({argsMap:e=>[e.getTrackId()]}),Yx=gr(),Jx=ke({argsMap:e=>[e.getTrackId()]}),Xx=ke({argsMap:e=>[e.getTrackId()]}),$x=gr(),ct((Cn=class extends lr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,i){super(t.createOutputTrack(),r,i),te(this,"source",void 0),te(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on($i.AUDIO_SOURCE_STATE_CHANGE,s=>{this.safeEmit(eh.SOURCE_STATE_CHANGE,s)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){At(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Fx,jx],Object.getOwnPropertyDescriptor(Cn.prototype,"startProcessAudioBuffer"),Cn.prototype),ct(Cn.prototype,"pauseProcessAudioBuffer",[Bx,Wx],Object.getOwnPropertyDescriptor(Cn.prototype,"pauseProcessAudioBuffer"),Cn.prototype),ct(Cn.prototype,"seekAudioBuffer",[Gx,Hx],Object.getOwnPropertyDescriptor(Cn.prototype,"seekAudioBuffer"),Cn.prototype),ct(Cn.prototype,"resumeProcessAudioBuffer",[Kx,zx],Object.getOwnPropertyDescriptor(Cn.prototype,"resumeProcessAudioBuffer"),Cn.prototype),ct(Cn.prototype,"stopProcessAudioBuffer",[qx,Yx],Object.getOwnPropertyDescriptor(Cn.prototype,"stopProcessAudioBuffer"),Cn.prototype),ct(Cn.prototype,"close",[Jx],Object.getOwnPropertyDescriptor(Cn.prototype,"close"),Cn.prototype),ct(Cn.prototype,"setAudioBufferPlaybackSpeed",[Xx,$x],Object.getOwnPropertyDescriptor(Cn.prototype,"setAudioBufferPlaybackSpeed"),Cn.prototype),Cn);class Fr extends lr{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=nh().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,kt(8,"track-mix-")),te(this,"trackList",void 0),te(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(v.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):v.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){v.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}IE(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(r=>{r instanceof Fr?r.emit(Ed.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)}))}}class ere extends Z2{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit($i.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),te(this,"audioBuffer",void 0),te(this,"sourceNode",void 0),te(this,"startPlayTime",0),te(this,"startPlayOffset",0),te(this,"pausePlayTime",0),te(this,"options",void 0),te(this,"currentLoopCount",0),te(this,"currentPlaybackSpeed",100),te(this,"_currentState","stopped"),this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):v.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let Qx=new Map;class $w{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let t=this.renderStats.curTs-this.renderStats.lastTs,r=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,r}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(v.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var r;t!==this._videoState&&(this._videoState=t,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(t){te(this,"trackId",void 0),te(this,"config",void 0),te(this,"onFirstVideoFrameDecoded",void 0),te(this,"onVideoStateChanged",void 0),te(this,"freezeTimeCounterList",[]),te(this,"renderFreezeAccTime",0),te(this,"isKeepLastFrame",!1),te(this,"timeUpdatedCount",0),te(this,"freezeTime",0),te(this,"playbackTime",0),te(this,"lastTimeUpdatedTime",0),te(this,"autoplayFailed",!1),te(this,"videoTrack",void 0),te(this,"videoElement",void 0),te(this,"cacheVideoElement",void 0),te(this,"renderStats",void 0),te(this,"_videoState",wa.VideoStateStopped),te(this,"videoElementCheckInterval",void 0),te(this,"videoElementFreezeTimeout",void 0),te(this,"_videoElementStatus",Kn.NONE),te(this,"isGettingVideoDimensions",!1),te(this,"startGetVideoDimensions",()=>{let r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return v.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),te(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&bt.curState==="running"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(rL())),uL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),te(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Kn.PLAYING;break;case"loadeddata":if(this.videoState=wa.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Kn.CANPLAY;break;case"stalled":this.videoElementStatus=Kn.STALLED;break;case"suspend":this.videoElementStatus=Kn.SUSPEND;break;case"pause":this.videoElementStatus=Kn.PAUSED,bn()||Jo()||Jr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Kn.WAITING;break;case"abort":this.videoElementStatus=Kn.ABORT;break;case"ended":this.videoElementStatus=Kn.ENDED;break;case"emptied":this.videoElementStatus=Kn.EMPTIED;break;case"error":{let i=this.videoElement.error;i?(this.videoElementStatus=Kn.ERROR,v.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")"))):v.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{let i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);let s=i-this.lastTimeUpdatedTime,c=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,oc.lastVisibleTime<oc.lastHiddenTime||c<oc.lastHiddenTime||c<oc.lastVisibleTime)return;for(s>x("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;let l=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(l),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),te(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(rL())),uL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),bt.on(un.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),bt.on(un.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let r=this.videoElement.play();r&&r.catch&&r.catch(s=>{t&&sx(t,"video",s.message,this.trackId),s.name==="NotAllowedError"?(v.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):v.warning("[".concat(this.trackId,"] play warning: "),s)});let i=dt();if((i.name==="Safari"&&Number(i.version)===15||bu())&&r&&r.then){let s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(s).catch(s)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let r=t.getContext("2d");if(!r)return v.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);let i=r.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;let s=i.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,i.width,i.height),new _e((c,l)=>{i.toBlob(async u=>{if(i.remove(),u){let h=await fx(u);c({buffer:h,width:i.width,height:i.height})}else l(new ee(N.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,r<0?.1:r>1?1:r)})):await Xw(t)}destroy(){this.renderStats=void 0,bt.off(un.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),bt.off(un.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=wa.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Kn.INIT,!this.videoElementCheckInterval&&(Zx.forEach(c=>{this.videoElement.addEventListener(c,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(c){return c!==document.body&&document.body.contains(c)})(this.videoElement)||(this.videoElementStatus=Kn.DESTROYED)},1e3),x("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,r;let c,l=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",l),this.videoElementFreezeTimeout=window.setTimeout(u,x("VIDEO_FREEZE_DURATION")))},u=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===wa.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=wa.VideoStateFrozen:document.addEventListener("visibilitychange",l))},h=(f,m)=>{if(this.videoElementStatus===Kn.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=m.mediaTime):this.renderStats={lastTs:m.mediaTime,curTs:m.mediaTime,lastRenderNum:0,renderNum:0},c){let y=m.presentationTime-c.presentationTime;this.videoState===wa.VideoStateStarting&&(this.videoState=wa.VideoStateDecoding),this.videoState===wa.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(u,x("VIDEO_FREEZE_DURATION"))),y<x("VIDEO_FREEZE_DURATION")&&this.videoState===wa.VideoStateFrozen&&(this.videoState=wa.VideoStateDecoding),y>x("VIDEO_FREEZE_DURATION")&&oc.lastVisibleTime>=oc.lastHiddenTime&&c.timestamp>oc.lastVisibleTime&&c.timestamp>oc.lastHiddenTime&&(this.renderFreezeAccTime+=y)}c=Xt(Xt({},m),{},{timestamp:f})}var E,S;x("ENABLE_VIDEO_FRAME_CALLBACK")&&((E=(S=this.videoElement).requestVideoFrameCallback)===null||E===void 0||E.call(S,h))};(t=(r=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(r,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),wE()&&!x("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let i=dt();i.name==="Safari"&&Number(i.version)===15||bu()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Dt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Dt()&&this.videoElement.load());let s=this.videoElement.play();s!==void 0&&s.catch(c=>{v.debug("[".concat(this.trackId,"] playback interrupted"),c.toString())})}resetVideoElement(){Zx.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Kn.NONE}handleAutoPlayFailed(){let t=r=>{r.preventDefault(),this.videoElement.play().then(()=>{v.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{v.error(i)}),this.autoplayFailed=!1,Xp()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Xp()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),ox()}}let Zx=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class eU extends $w{constructor(t){super(t),te(this,"container",void 0),te(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let r=t.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var r;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await Xw(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",x("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var tU,rU,nU,iU,oU,sU,aU,cU,lU,dU,uU,hU,pU,fU,mU,_U,EU,gU,SU,yU,vU,TU,CU,RU,wU,rt,IU,bU,AU,OU,NU,DU,PU,kU,no;let Lt=(tU=ke({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),rU=gr(),nU=ke({argsMap:e=>[e.getTrackId()]}),iU=Nu("LocalVideoTrack","_enabledMutex"),oU=ke({argsMap:(e,t)=>[e.getTrackId(),t]}),sU=gr(),aU=Nu("LocalVideoTrack","_enabledMutex"),cU=ke({argsMap:(e,t)=>[e.getTrackId(),t]}),lU=gr(),dU=ke({argsMap:(e,t)=>[e.getTrackId(),t]}),uU=gr(),hU=gr(),pU=ke({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),fU=gr(),mU=gr(),_U=gr(),EU=gr(),gU=gr(),SU=gr(),yU=gr(),vU=ke({argsMap:(e,t)=>[e.getTrackId(),t.name]}),TU=ke({argsMap:e=>[e.getTrackId()]}),CU=ke({argsMap:e=>[e.getTrackId()]}),RU=ke({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),wU=ke(),rt=class AG extends rh{get videoHeight(){if(Jr()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Jr()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Kn.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,i,s,c,l){if(super(t,c),te(this,"trackMediaType","video"),te(this,"_player",void 0),te(this,"isUseScaleResolutionDownBy",!1),te(this,"_videoVisibleTimer",null),te(this,"_statsTimer",null),te(this,"_previousVideoVisibleStatus",void 0),te(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),te(this,"_encoderConfig",void 0),te(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),te(this,"_optimizationMode",void 0),te(this,"_videoHeight",void 0),te(this,"_videoWidth",void 0),te(this,"_forceBitrateLimit",void 0),te(this,"_enabled",!0),te(this,"_processorDestination",void 0),te(this,"_processorContext",void 0),Jr()){let{width:u,height:h}=t.getSettings();this._videoWidth=u,this._videoHeight=h}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r,this._scalabilityMode=i,this._optimizationMode=s,this._hints=l||[],this._hints.indexOf(Ft.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(u,h,f){let m=dt();return!(m.name!==u||!m.osVersion)&&Number(m.version)===h}(yt.CHROME,115)&&CE().indexOf("Windows")!==-1){let u=function(h,f){if("VideoFrame"in window&&"TransformStream"in window&&at().supportWebRTCInsertableStream){let m=new MediaStreamTrackProcessor(h),E=new MediaStreamTrackGenerator({kind:"video"}),S,y,A=Date.now(),T=()=>{w&&(clearInterval(w),w=void 0),S&&(S.close(),S=void 0),h.stop(),y=void 0,E.removeEventListener("ended",T)},w=window.setInterval(()=>{if(y&&S&&Date.now()-A>1e3)try{E.readyState==="live"?y.enqueue(S.clone()):T()}catch{T()}},1e3),O=new TransformStream({transform:(P,F)=>{E.readyState==="live"?(y=F,A=Date.now(),S===void 0?(S=P,F.enqueue(P.clone())):(F.enqueue(S),S=P)):P.close()}});return E.addEventListener("ended",T),m.readable.pipeThrough(O).pipeTo(E.writable),E}}(t);u&&(v.info("local screen video track begin to inject frame"),this._mediaStreamTrack=u)}r&&this._hints.indexOf(Ft.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new cx(this.getTrackId(),"local"),this._processorDestination=new ax(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let s=document.getElementById(t);s?t=s:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));let i=Xt(Xt(Xt({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new $w(i):this._player=new eU(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let s=this.getVideoElementVisibleStatus();this.safeEmit(eh.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},x("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Pt(this,ve.NEED_DISABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return r||(this._enabled=!1),void v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Pt(this,ve.NEED_ENABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Pt(this,ve.NEED_MUTE_TRACK,this):await Pt(this,ve.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,r){if(!this._enabled)throw new ee(N.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=Ra(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let i=_g({encoderConfig:t});(Jr()||bn()||Jo())&&(i.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){let c=new ee(N.UNEXPECTED_ERROR,s.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}}this._encoderConfig=t,this._hints.indexOf(Ft.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Pt(this,ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(v)}}getStats(){return Wc(()=>{v.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Mi(this,ve.GET_STATS)||Xt({},Gw)}async setBeautyEffect(t){v.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await Xw(t)}async setBitrateLimit(t){if(v.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await Pt(this,ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(v)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void v.error(N.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let r=this._optimizationMode;try{this._optimizationMode=t,await Pt(this,ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=r,v.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return v.error(N.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,v.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){ux(this._originMediaStreamTrack).then(t=>{let[r,i]=t;this._videoHeight=i,this._videoWidth=r}).catch(AE)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new ee(N.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");v.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Ra(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Ft.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Pt(this,ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(v)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:r,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!r||!i)return;let{bitrateMax:s,bitrateMin:c}=this._encoderConfig;if(c==null||s==null){let{max:l,min:u}=function(h,f,m,E,S){let y=x("BITRATE_ADAPTER_TYPE");if(y==="DEFAULT_BITRATE")return{min:E,max:S};if(S===void 0){var A;let w=Math.floor(200*Math.pow(m/15,.6)*Math.pow(h*f/640/360,.75));S=y==="STANDARD_BITRATE"?4*w:2*w,E=(A=E)!==null&&A!==void 0?A:w}else{var T;E=(T=E)!==null&&T!==void 0?T:Math.floor(S/10)}return{min:E,max:S}}(t,r,i,c,s);this._encoderConfig.bitrateMin=u,this._encoderConfig.bitrateMax=l,v.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(i,"] => [brMax: ").concat(l,", brMin: ").concat(u,"]"))}}getVideoElementVisibleStatus(){try{var t,r;let i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:l}=s;if(this.isPlaying&&c instanceof HTMLVideoElement&&l instanceof HTMLElement){let u=gL.checkOneElementVisible(c),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;let f=be.reportApiInvoke(null,{tag:sr.TRACER,name:Pr.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(i){throw new ee(N.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new ee(N.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Xt(Xt({},i),Ra(t))),i=rd(i);let s=kt(8,"track-video-cloned-"),c=new AG(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,rd(this._scalabilityMode),this._optimizationMode,s,rd(this._hints));return t&&i&&c.setEncoderConfiguration(i),v.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(r)),c}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new ee(N.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new ee(N.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!Jr()&&!bn())return;this._statsTimer&&window.clearInterval(this._statsTimer);let t=2,r=ug[t],i=-1,s=Date.now(),c=l=>{l>2||l<0||(s=Date.now(),r=ug[l],this.setSenderConfiguration(r))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{let l=this.getStats(),u=Mi(this,ve.GET_RTC_STATS);if(l.sendPackets>0&&u){i===-1&&(i=Date.now());let h=Date.now();if(h-i<1e3||h-s<x("PROFILE_SWITCH_INTERVAL"))return;let f=l.sendFrameRate,m=.6*r.frameRate,E=.9*r.frameRate;typeof f=="number"&&f>0&&f<m?t>0&&(t--,c(t),v.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(f,", switchProfile to ").concat(t))):u.OutgoingAvailableBandwidth<r.bitrateMin?t>0&&(t--,c(t),v.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(u.OutgoingAvailableBandwidth,", bitrateMin ").concat(r.bitrateMin,", switchProfile to ").concat(t))):typeof f=="number"&&f>E&&t<ug.length-1&&u.OutgoingAvailableBandwidth>1.2*ug[t+1].bitrateMin&&(t++,c(t),v.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(f,", OutgoingAvailableBandwidth ").concat(u.OutgoingAvailableBandwidth,", switchProfile to ").concat(t)))}},x("CHECK_LOCAL_STATS_INTERVAL"))}sendSeiData(t){if(Wc(()=>{be.reportApiInvoke(null,{name:Pr.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:sr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!x("ENABLE_VIDEO_SEI")||!x("ENABLE_ENCODED_TRANSFORM"))return void v.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new ee(N.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let r=this.getRTCRtpTransceiver();if(!r)return void v.warning("Video track is not published, SEI can not be send");let i=r.sender.getParameters();if(i.codecs.length===0)return;let s=i.codecs[0].mimeType.toLocaleLowerCase();s==="video/h264"?this.safeEmit("sei-to-send",t):v.warning("SEI is not supported by ".concat(s))}bindProcessorDestinationEvents(){this.processorDestination.on(ri.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Pt(this,ve.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Pt(this,ve.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ri.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Qi.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Qi.REQUEST_CONSTRAINTS)}},ct(rt.prototype,"play",[tU,rU],Object.getOwnPropertyDescriptor(rt.prototype,"play"),rt.prototype),ct(rt.prototype,"stop",[nU],Object.getOwnPropertyDescriptor(rt.prototype,"stop"),rt.prototype),ct(rt.prototype,"setEnabled",[iU,oU,sU],Object.getOwnPropertyDescriptor(rt.prototype,"setEnabled"),rt.prototype),ct(rt.prototype,"setMuted",[aU,cU,lU],Object.getOwnPropertyDescriptor(rt.prototype,"setMuted"),rt.prototype),ct(rt.prototype,"setEncoderConfiguration",[dU,uU],Object.getOwnPropertyDescriptor(rt.prototype,"setEncoderConfiguration"),rt.prototype),ct(rt.prototype,"getStats",[hU],Object.getOwnPropertyDescriptor(rt.prototype,"getStats"),rt.prototype),ct(rt.prototype,"setBeautyEffect",[pU,fU],Object.getOwnPropertyDescriptor(rt.prototype,"setBeautyEffect"),rt.prototype),ct(rt.prototype,"getCurrentFrameData",[mU],Object.getOwnPropertyDescriptor(rt.prototype,"getCurrentFrameData"),rt.prototype),ct(rt.prototype,"getCurrentFrameImage",[_U],Object.getOwnPropertyDescriptor(rt.prototype,"getCurrentFrameImage"),rt.prototype),ct(rt.prototype,"setBitrateLimit",[EU],Object.getOwnPropertyDescriptor(rt.prototype,"setBitrateLimit"),rt.prototype),ct(rt.prototype,"setOptimizationMode",[gU],Object.getOwnPropertyDescriptor(rt.prototype,"setOptimizationMode"),rt.prototype),ct(rt.prototype,"setScalabiltyMode",[SU],Object.getOwnPropertyDescriptor(rt.prototype,"setScalabiltyMode"),rt.prototype),ct(rt.prototype,"updateMediaStreamTrackResolution",[yU],Object.getOwnPropertyDescriptor(rt.prototype,"updateMediaStreamTrackResolution"),rt.prototype),ct(rt.prototype,"pipe",[vU],Object.getOwnPropertyDescriptor(rt.prototype,"pipe"),rt.prototype),ct(rt.prototype,"unpipe",[TU],Object.getOwnPropertyDescriptor(rt.prototype,"unpipe"),rt.prototype),ct(rt.prototype,"close",[CU],Object.getOwnPropertyDescriptor(rt.prototype,"close"),rt.prototype),ct(rt.prototype,"replaceTrack",[RU],Object.getOwnPropertyDescriptor(rt.prototype,"replaceTrack"),rt.prototype),ct(rt.prototype,"startMonitorStats",[wU],Object.getOwnPropertyDescriptor(rt.prototype,"startMonitorStats"),rt.prototype),rt),Qw=(IU=ke({argsMap:(e,t)=>[e.getTrackId(),t]}),bU=gr(),AU=Nu("CameraVideoTrack","_enabledMutex"),OU=ke({argsMap:(e,t)=>[e.getTrackId(),t]}),NU=gr(),DU=ke({argsMap:(e,t)=>[e.getTrackId(),t]}),PU=gr(),kU=ke({argsMap:e=>[e.getTrackId()]}),no=class OG extends Lt{get __className__(){return"CameraVideoTrack"}constructor(t,r,i,s,c,l){super(t,Ra(r.encoderConfig),s,c,l),te(this,"_config",void 0),te(this,"_originalConstraints",void 0),te(this,"_constraints",void 0),te(this,"_enabled",!0),te(this,"_deviceName","default"),te(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(bu()||mR())&&!function(){let u=dt();if(u.os!==Yr.IOS||!u.osVersion)return!1;let h=u.osVersion.split(".");return Number(h[0])===15&&Number(h[1])>=2}()&&hL()&&this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=Ra(this._config.encoderConfig),bt.on(un.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),bt.on(un.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(v.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let r=await to.getDeviceById(t),i={};i.video=Xt({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await eo(i,this.getTrackId())}catch(c){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),s=await eo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{let r=await to.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}v.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){v.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let r={video:Xt(Xt({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await eo(r,this.getTrackId())}catch(s){throw v.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),s.toString()),i=await eo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Xt({},r.video),v.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let i=await eo({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await Pt(this,ve.NEED_ENABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await Pt(this,ve.NEED_DISABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new ee(N.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=Ra(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let i=Vt(this._config);i.encoderConfig=t;let s=_g(i);(Jr()||bn()||Jo())&&(s.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(c){let l=new ee(N.UNEXPECTED_ERROR,c.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}this._config=i,this._constraints=s,this._originalConstraints=s,this._encoderConfig=t,this._hints.indexOf(Ft.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Pt(this,ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(c){return c.throw(v)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((bn()||Jo())&&this._enabled&&!this._isClosed&&bt.duringInterruption){let t=async()=>{bt.off(un.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};bt.on(un.IOS_INTERRUPTION_END,t)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(eh.TRACK_ENDED)}async renewMediaStreamTrack(t){let r=t||this._constraints,i=to.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId={exact:i}),this._enabled){let s=await eo({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),bt.off(un.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),bt.off(un.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Xt(Xt({},i),Ra(t))),i=rd(i);let s=kt(8,"track-cam-cloned-"),c=new OG(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,rd(Xt(Xt({},this._config),{},{encoderConfig:i})),rd(this._constraints),rd(this._scalabilityMode),this._optimizationMode,s);return t&&i&&c.setEncoderConfiguration(i),v.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(r)),c}bindProcessorContextEvents(){this.processorContext.on(Qi.REQUEST_UPDATE_CONSTRAINTS,async(t,r,i)=>{try{let s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),r()}catch(s){i(s)}}),this.processorContext.on(Qi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},ct(no.prototype,"setDevice",[IU,bU],Object.getOwnPropertyDescriptor(no.prototype,"setDevice"),no.prototype),ct(no.prototype,"setEnabled",[AU,OU,NU],Object.getOwnPropertyDescriptor(no.prototype,"setEnabled"),no.prototype),ct(no.prototype,"setEncoderConfiguration",[DU,PU],Object.getOwnPropertyDescriptor(no.prototype,"setEncoderConfiguration"),no.prototype),ct(no.prototype,"close",[kU],Object.getOwnPropertyDescriptor(no.prototype,"close"),no.prototype),no);function Zw(e,t,r,i){r.optimizationMode&&(i&&i.width&&i.height?(r.encoderConfig=Xt(Xt({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?v.debug("[".concat(e,"] set content hint to"),r.optimizationMode):v.debug("[".concat(e,"] set content hint failed")))):v.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var LU,MU,xU,UU,To,VU,FU,jU,BU,WU,GU,zn;class HU extends X2{getUserId(){return this._userId}constructor(t,r,i,s){super(t,"track-".concat(t.kind,"-").concat(r,"-").concat(s.clientId,"_").concat(kt(5,""))),te(this,"_userId",void 0),te(this,"_uintId",void 0),te(this,"_isDestroyed",!1),te(this,"store",void 0),te(this,"processor",void 0),te(this,"processorContext",void 0),this._userId=r,this._uintId=i,this.store=s}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,v.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let oh=(LU=ke({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),MU=ke({argsMap:e=>[e.getTrackId()]}),xU=ke({argsMap:(e,t)=>[e.getTrackId(),t.name]}),UU=ke({argsMap:e=>[e.getTrackId()]}),ct((To=class extends HU{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Kn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,i){super(e,t,r,i),te(this,"_videoVisibleTimer",null),te(this,"_previousVideoVisibleStatus",void 0),te(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),te(this,"trackMediaType","video"),te(this,"_videoWidth",void 0),te(this,"_videoHeight",void 0),te(this,"_player",void 0),te(this,"processorDestination",void 0),te(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new cx(this.getTrackId(),"remote"),this.processorDestination=new ax(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Wc(()=>{v.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Mi(this,ve.GET_STATS)||Xt({},Y2)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let i=document.getElementById(e);i?e=i:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let r=Xt(Xt({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new $w(r):this._player=new eU(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(th.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(th.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let i=this.getVideoElementVisibleStatus();this.safeEmit(th.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},x("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){ux(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(AE)}_updatePlayerSource(){v.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:s,slot:c}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&c instanceof HTMLElement){let l=gL.checkOneElementVisible(s),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;let h=be.reportApiInvoke(null,{tag:sr.TRACER,name:Pr.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(r){throw new ee(N.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ee(N.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ri.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ri.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Ed.SEI_RECEIVED,e)}}).prototype,"play",[LU],Object.getOwnPropertyDescriptor(To.prototype,"play"),To.prototype),ct(To.prototype,"stop",[MU],Object.getOwnPropertyDescriptor(To.prototype,"stop"),To.prototype),ct(To.prototype,"pipe",[xU],Object.getOwnPropertyDescriptor(To.prototype,"pipe"),To.prototype),ct(To.prototype,"unpipe",[UU],Object.getOwnPropertyDescriptor(To.prototype,"unpipe"),To.prototype),To),sh=(VU=ke({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),FU=ke({argsMap:(e,t)=>[e.getTrackId(),t]}),jU=ke({argsMap:e=>[e.getTrackId()]}),BU=ke({argsMap:e=>[e.getTrackId()]}),WU=ke({argsMap:(e,t)=>[e.getTrackId(),t.name]}),GU=ke({argsMap:e=>[e.getTrackId()]}),ct((zn=class extends HU{get isPlaying(){return this._useAudioElement?ci.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,i){super(e,t,r,i),te(this,"trackMediaType","audio"),te(this,"_source",void 0),te(this,"_useAudioElement",!0),te(this,"_volume",100),te(this,"processorContext",void 0),te(this,"processorDestination",void 0),te(this,"_played",!1),te(this,"_bypassWebAudio",!1),x("DISABLE_WEBAUDIO")?(this._source=new Jw,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ex(e,!0),x("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once($i.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(th.FIRST_FRAME_DECODED)}),this.processorContext=new dx(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new lx(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on($i.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners($i.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners($i.ON_AUDIO_BUFFER),this._source.on($i.ON_AUDIO_BUFFER,r=>e(r))}setVolume(e){this._volume=e,this._useAudioElement?ci.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!K2())throw new ee(N.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ci.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Wc(()=>{v.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Mi(this,ve.GET_STATS)||Xt({},q2)}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] use audio element to play")),ci.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ci.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ci.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ee(N.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ee(N.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ee(N.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ri.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ri.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ri.ON_TRACK),this.processorDestination.removeAllListeners(ri.ON_NODE)}}).prototype,"setVolume",[VU],Object.getOwnPropertyDescriptor(zn.prototype,"setVolume"),zn.prototype),ct(zn.prototype,"setPlaybackDevice",[FU],Object.getOwnPropertyDescriptor(zn.prototype,"setPlaybackDevice"),zn.prototype),ct(zn.prototype,"play",[jU],Object.getOwnPropertyDescriptor(zn.prototype,"play"),zn.prototype),ct(zn.prototype,"stop",[BU],Object.getOwnPropertyDescriptor(zn.prototype,"stop"),zn.prototype),ct(zn.prototype,"pipe",[WU],Object.getOwnPropertyDescriptor(zn.prototype,"pipe"),zn.prototype),ct(zn.prototype,"unpipe",[GU],Object.getOwnPropertyDescriptor(zn.prototype,"unpipe"),zn.prototype),zn),oc=new class extends Jt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),te(this,"_lastHiddenTime",0),te(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),v.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};var KU=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(KU||{});class tre{constructor(){te(this,"_sequence",0),te(this,"_startTime",Date.now()),te(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let u=new Uint8Array(4);u.set([1,0,0,0]);let h={id:0,length:4,data:u.buffer},f={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[h]};r.commonPacketHeader.extension=1,r.extension=f,r.payload=this.compress(t),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;x("SHOW_DATASTREAM2_LOG")&&v.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));let i=new ArrayBuffer(r.commonPacketHeader.length),s=new Uint8Array(i),c=new DataView(i),l=0;if(c.setUint16(l,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),l+=2,c.setUint32(l,r.commonPacketHeader.sequence,!0),l+=4,c.setUint16(l,r.commonStreamHeader,!0),l+=2,r.extension){let u=this.serializeExtension(r.extension);s.set(new Uint8Array(u),l),l+=u.byteLength}if(s.set(new Uint8Array(r.payload),l),l+=r.payload.byteLength,l!==r.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let r=new DataView(t),i=0,s=r.getUint16(i,!0);i+=2;let c={length:16383&s,reserved:(16384&s)>>14,extension:(32768&s)>>15,sequence:r.getUint16(i+2,!0)<<16|r.getUint16(i,!0)},l,u;if(i+=4,x("SHOW_DATASTREAM2_LOG")&&v.debug("receive data header: ".concat(JSON.stringify(c))),r.getUint16(i,!0),i+=2,c.extension){u=this.deserializeExtension(t.slice(i)),i+=2+u.length,l=t.slice(i);let h=!1;if(u.datas.length>0){let f=u.datas.find(m=>m.id===0);f&&(h=(1&new DataView(f.data).getUint32(0,!0))==1)}l=h?this.decompress(l):l}else l=t.slice(8);return l}serializeExtension(t){let{profile:r,length:i,datas:s}=t,c=new ArrayBuffer(i+2),l=new Uint8Array(c),u=new DataView(c),h=0;if(u.setUint8(h++,r),u.setUint8(h++,i),s.forEach(f=>{r?(u.setUint8(h++,f.id),u.setUint8(h++,f.length),l.set(new Uint8Array(f.data),h),h+=f.data.byteLength):(u.setUint8(h++,f.id|f.length<<4),l.set(new Uint8Array(f.data),h),h+=f.data.byteLength)}),h!==i+2)throw Error("serialize extension error, is ".concat(h,"!==").concat(i+2));return c}deserializeExtension(t){let r=new DataView(t),i=0,s=r.getUint8(i);i++;let c=r.getUint8(i);i++;let l=s===KU.TWO_BYTE,u=[],h=new DataView(t,2),f=0;for(;f<c;){let m=0,E=0,S=new ArrayBuffer(0);l?(m=h.getUint8(f),f++,E=h.getUint8(f),f++):(m=15&h.getUint8(f),E=h.getUint8(f)>>4,f++),E>0&&(S=h.buffer.slice(f+2,f+2+E),f+=S.byteLength),u.push({id:m,length:E,data:S})}if(f!==c)throw Error("parse error");return{profile:s,length:c,datas:u}}decompress(t){return jte(new Uint8Array(t))}compress(t){return Fte(new Uint8Array(t))}}class zU extends Jt{constructor(t,r){super(),te(this,"_version",1),te(this,"_type",3),te(this,"_config",void 0),te(this,"_originDataChannel",void 0),te(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),te(this,"_dataStreamPacketHandler",void 0),te(this,"_datachannelEventMap",new Map),this._config=t,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader(),this._dataStreamPacketHandler=new tre}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return x("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new _e((t,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let i=setTimeout(()=>{var s;r(new ee(N.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((s=this._originDataChannel)===null||s===void 0?void 0:s.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new ee(N.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new ee(N.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[fg.OPEN,fg.CLOSE,fg.ERROR].forEach(r=>{let i=()=>{this.emit(r)};this._datachannelEventMap.set(r,i),t.addEventListener(r,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[i,s]=r;t.removeEventListener(i,s)}),this._datachannelEventMap.clear()}}class rre extends zU{constructor(t){super(t),te(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let i=r.data.slice(0,this._dataStreamPacketHeader.byteLength),s=new DataView(i).getUint8(3);if(s!==this.id)return void(x("SHOW_DATASTREAM2_LOG")&&v.debug("invalid datachannel id: ".concat(s," !== ").concat(this.id)));let c=r.data.slice(this._dataStreamPacketHeader.byteLength);c=this._dataStreamPacketHandler.deserialize(c),this.emit(fg.MESSAGE,c)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class qU extends zU{send(t){if(this._originDataChannel){let r=t;r=this._dataStreamPacketHandler.serialize(t);let i=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function gg(){let e=new Blob([atob("ZnVuY3Rpb24gZShlKXtjb25zdCB0PW5ldyBEYXRhVmlldyhlLmRhdGEpO2lmKDA9PT10LmdldFVpbnQ4KDApJiYwPT09dC5nZXRVaW50OCgxKSYmMD09PXQuZ2V0VWludDgoMikmJjE9PT10LmdldFVpbnQ4KDMpJiY2PT09dC5nZXRVaW50OCg0KSl7bGV0IG49NixyPTAsbz0wO2Zvcig7MjU1PT09KG89dC5nZXRVaW50OChuKyspKTspcis9MjU1O3IrPW87Y29uc3QgYT1mdW5jdGlvbihlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLG89W10sYT0wO2Zvcig7YTxuOylhKzM8biYmMD09PXJbYV0mJjA9PT1yW2ErMV0mJjM9PT1yW2ErMl0mJigwPT09clthKzNdfHwxPT09clthKzNdfHwyPT09clthKzNdfHwzPT09clthKzNdKT8oby5wdXNoKHJbYV0sclthKzFdLHJbYSszXSksYSs9NCk6KG8ucHVzaChyW2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShvKX0oZS5kYXRhLG4scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHQoZSx0KXtjb25zdCBuPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5sZW5ndGg7bGV0IG49W10scj0wO2Zvcig7cjx0OylyKzI8dCYmMD09PWVbcl0mJjA9PT1lW3IrMV0mJigwPT09ZVtyKzJdfHwxPT09ZVtyKzJdfHwyPT09ZVtyKzJdfHwzPT09ZVtyKzJdKT8obi5wdXNoKGVbcl0sZVtyKzFdLDMsZVtyKzJdKSxyKz0zKToobi5wdXNoKGVbcl0pLHIrKyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KG4pfSh0KSxyPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihyLzI1NSksYT1yJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK3IrZS5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBpPTA7Zm9yKDtpPG87KXNbNitpXT0yNTUsaSsrO3JldHVybiBzWzYraV09YSxpKysscy5zZXQobiw2K2kpLHMuc2V0KG5ldyBVaW50OEFycmF5KGUpLDYraStyKSxzLmJ1ZmZlcn1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpPi0xJiYtMT09PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIikmJihzZWxmLm9ucnRjdHJhbnNmb3JtPW49Pntjb25zdCByPW4udHJhbnNmb3JtZXI7bGV0IG89W107ci5vcHRpb25zLnBvcnQub25tZXNzYWdlPWU9PntlLmRhdGEuc2VpJiZvLnB1c2goZS5kYXRhLnNlaSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBhPXIucmVhZGFibGUuZ2V0UmVhZGVyKCkscz1yLndyaXRhYmxlLmdldFdyaXRlcigpOyJyeCI9PT1yLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2EucmVhZCgpLnRoZW4oKHI9PntpZighci5kb25lKXtpZihyLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7YS5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1vLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>n2.revokeObjectURL(e),0),new Worker(n2.createObjectURL(e))}let Sg=new Map,yg=new Map,vg=new Map;async function nre(e,t){if(!at().supportWebRTCEncodedTransform)return void v.warning("browser not support video encoded transform");if(vg.has(e)||!e.track)return;let r={track:e.track};if(jc()){if(!e.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(u){return void v.error("create video-encoded-streams error",u&&u.message)}let c=[];t.on("sei-to-send",u=>{c.push(u)});let l=new TransformStream({transform(u,h){r.controller||(r.controller=h),e.track&&e.track.id!==r.track.id&&(v.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i));let f=c.shift();f&&(u.data=function(m,E){let S=function(P){let F=P.length,W=[],K=0;for(;K<F;)K+2<F&&P[K]===0&&P[K+1]===0&&(P[K+2]===0||P[K+2]===1||P[K+2]===2||P[K+2]===3)?(W.push(P[K],P[K+1],3,P[K+2]),K+=3):(W.push(P[K]),K++);return new Uint8Array(W)}(E),y=S.length,A=Math.floor(y/255),T=y%255,w=new Uint8Array(6+A+1+y+m.byteLength);w[0]=0,w[1]=0,w[2]=0,w[3]=1,w[4]=6,w[5]=101;let O=0;for(;O<A;)w[6+O]=255,O++;return w[6+O]=T,O++,w.set(S,6+O),w.set(new Uint8Array(m),6+O+y),w.buffer}(u.data,f)),h.enqueue(u)}});s.readable.pipeThrough(l).pipeTo(s.writable)}else{if(!Jr())return;{if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");let s=gg(),c=new MessageChannel;await new _e(u=>s.onmessage=h=>{h.data==="registered"&&u(void 0)});let l=new RTCRtpScriptTransform(s,{name:"tx",port:c.port2},[c.port2]);e.transform=l,await new _e(u=>s.onmessage=h=>{h.data==="started"&&u(void 0)}),t.on("sei-to-send",u=>{c.port1.postMessage({sei:u})}),c.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==r.track.id&&(v.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i))},r.worker=s}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}let s=vg.get(e);if(s){vg.delete(e);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(u){v.warning(u&&u.message)}}}vg.set(e,r),e.track.addEventListener("ended",i)}let Lf=new Map;async function ire(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!at().supportWebRTCEncodedTransform)return void v.warning("browser not support video encoded transform");if(!e.track)return;if(Lf.has(e)){let s=Lf.get(e);return void(s&&(s.onSei=t.onSei))}let r={track:e.track,onSei:t.onSei};if(jc()){if(!e.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(l){return void v.error("create video-encoded-streams error",l&&l.message)}let c=new TransformStream({transform(l,u){r.controller||(r.controller=u),e.track&&e.track.id!==r.track.id&&(v.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i));let h=function(f){let m=new DataView(f.data);if(m.getUint8(0)===0&&m.getUint8(1)===0&&m.getUint8(2)===0&&m.getUint8(3)===1&&m.getUint8(4)===6){let E=6,S=0,y=0;for(;(y=m.getUint8(E++))===255;)S+=255;S+=y;let A=function(T,w,O){let P=new Uint8Array(T,w,O),F=[],W=0;for(;W<O;)W+3<O&&P[W]===0&&P[W+1]===0&&P[W+2]===3&&(P[W+3]===0||P[W+3]===1||P[W+3]===2||P[W+3]===3)?(F.push(P[W],P[W+1],P[W+3]),W+=4):(F.push(P[W]),W++);return new Uint8Array(F)}(f.data,E,S);return new Uint8Array(A)}return null}(l);h&&r.onSei&&r.onSei(h),u.enqueue(l)}});s.readable.pipeThrough(c).pipeTo(s.writable)}else if(Jr()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");let s=gg(),c=new MessageChannel;await new _e(u=>s.onmessage=h=>{h.data==="registered"&&u(void 0)});let l=new RTCRtpScriptTransform(s,{name:"rx",port:c.port2},[c.port2]);e.transform=l,await new _e(u=>s.onmessage=h=>{h.data==="started"&&u(void 0)}),c.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==r.track.id?(v.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i)):u.data.sei&&r.onSei&&r.onSei(u.data.sei)},r.worker=s}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}(function(s){let c=Lf.get(s);if(c){Lf.delete(s);try{var l,u;(l=c.controller)===null||l===void 0||l.terminate(),(u=c.worker)===null||u===void 0||u.terminate()}catch(h){v.warning(h&&h.message)}}})(e)}Lf.set(e,r),e.track.addEventListener("ended",i)}(function(){let e=dt();Tn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Tn.getStreamFromExtension=e.name===yt.CHROME&&Number(e.version)>34,Tn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r}(),Tn.supportMinBitrate=e.name===yt.CHROME||e.name===yt.EDGE,Tn.supportSetRtpSenderParameters=function(){let t=dt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Bc()||!(!Jr()&&!RE())||t.name===yt.FIREFOX&&Number(t.version)>=64)}(),e.name===yt.SAFARI&&(Number(e.version)>=14?Tn.supportDualStream=!0:Tn.supportDualStream=!1),Tn.webAudioMediaStreamDest=function(){let t=dt();return!(t.name===yt.SAFARI&&Number(t.version)<12)}(),Tn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Tn.supportWebGL=typeof WebGLRenderingContext<"u",Tn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Bc()||(Tn.webAudioWithAEC=!0),Tn.supportShareAudio=function(){let t=dt();return(t.os===Yr.WIN_10||t.os===Yr.WIN_81||t.os===Yr.WIN_7||t.os===Yr.LINUX||t.os===Yr.MAC_OS||t.os===Yr.CHROMIUM_OS)&&t.name===yt.CHROME&&Number(t.version)>=74}(),Tn.supportDataChannel=!!(fR(76)||function(t){let r=dt();return!(r.name!==yt.FIREFOX||!r.osVersion)&&Number(r.version)>=t}(68)||oL(14)),Tn.supportPCSetConfiguration=function(){let t=window.RTCPeerConnection;return!Dt()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Tn.supportWebRTCEncodedTransform=function(){let t=dt();return t.name==="Chrome"&&Number(t.version)>=86||t.name==="Safari"&&Number(t.version)>=15}(),Tn.supportWebRTCInsertableStream=function(){let t=dt();return(t.name===yt.CHROME||t.name===yt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Tn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Tn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,bE(()=>{Tn.supportDualStreamEncoding=function(){let t=dt();return!!x("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&x("CHROME_DUAL_STREAM_USE_ENCODING"))}(),v.info("browser compatibility",JSON.stringify(Tn),JSON.stringify(e))})})();class ore extends Jt{constructor(){super(...arguments),b(this,"resultStorage",new Map)}setLocalAudioStats(t,r,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,r))}setLocalVideoStats(t,r,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,r){let i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){let i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(r))}record(t,r,i){if(x("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let s=this.resultStorage.get(t);if(s&&(s.result.push(i),s.result.length>=5)){var c;let l=ge(c=s.result).call(c,!0);s.isPrevNormal&&!l&&this.emit("exception",YU[t],t,r),!s.isPrevNormal&&l&&this.emit("exception",YU[t]+2e3,t+"_RECOVER",r),s.isPrevNormal=l,s.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof Fr&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let i=null;r._encoderConfig&&r._encoderConfig.frameRate&&(i=vi(r._encoderConfig.frameRate));let s=t.captureFrameRate;return!i||!s||!(i>10&&s<5||i<10&&i>=5&&s<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof Fr&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let YU={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},On=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){let i=r[r.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){let i=r[r.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function e0(e,t){this.v=e,this.k=t}function Ye(e){return new e0(e,0)}var sre=kD,are=ua;Ut({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=are.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var cre=ua,lre=pu;Ut({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=cre.f(this),r=lre(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var t0=p(sre),JU=gu.f("asyncIterator"),dre=p(JU);function Mf(e){var t,r;function i(c,l){try{var u=e[c](l),h=u.value,f=h instanceof e0;t0.resolve(f?h.v:h).then(function(m){if(f){var E=c==="return"?"return":"next";if(!h.k||m.done)return i(E,m);m=e[E](m).value}s(u.done?"return":"normal",m)},function(m){i("throw",m)})}catch(m){s("throw",m)}}function s(c,l){switch(c){case"return":t.resolve({value:l,done:!0});break;case"throw":t.reject(l);break;default:t.resolve({value:l,done:!1})}(t=t.next)?i(t.key,t.arg):r=null}this._invoke=function(c,l){return new t0(function(u,h){var f={key:c,arg:l,resolve:u,reject:h,next:null};r?r=r.next=f:(t=r=f,i(c,l))})},typeof e.return!="function"&&(this.return=void 0)}function Ui(e){return function(){return new Mf(e.apply(this,arguments))}}Mf.prototype[typeof vu=="function"&&dre||"@@asyncIterator"]=function(){return this},Mf.prototype.next=function(e){return this._invoke("next",e)},Mf.prototype.throw=function(e){return this._invoke("throw",e)},Mf.prototype.return=function(e){return this._invoke("return",e)};var XU=p(fo.Object.getOwnPropertySymbols),ure=Ut,hre=tT.indexOf,pre=T_,r0=je([].indexOf),$U=!!r0&&1/r0([1],1,-0)<0;ure({target:"Array",proto:!0,forced:$U||!pre("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return $U?r0(this,e,t)||0:hre(this,e,t)}});var fre=zo("Array").indexOf,mre=M,_re=fre,n0=Array.prototype,Ere=function(e){var t=e.indexOf;return e===n0||mre(n0,e)&&t===n0.indexOf?_re:t},QU=p(Ere);function gre(e,t){if(e==null)return{};var r,i,s=function(l,u){if(l==null)return{};var h,f,m={},E=GL(l);for(f=0;f<E.length;f++)h=E[f],QU(u).call(u,h)>=0||(m[h]=l[h]);return m}(e,t);if(XU){var c=XU(e);for(i=0;i<c.length;i++)r=c[i],QU(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var ZU={exports:{}};(function(e,t){e.exports=(()=>{var r={8:(c,l,u)=>{u.r(l),u.d(l,{Parser:()=>nt,Printer:()=>ps,parse:()=>He,print:()=>_t});let h=`
`,f="".concat("\r").concat(h),m=" ",E;function S(Ee){return Ee>="0"&&Ee<="9"}function y(Ee){return Ee>="!"&&Ee<="~"}function A(Ee){return y(Ee)||Ee>=""&&Ee<="ÿ"}function T(Ee){return Ee==="!"||Ee>="#"&&Ee<="'"||Ee>="*"&&Ee<="+"||Ee>="-"&&Ee<="."||Ee>="0"&&Ee<="9"||Ee>="A"&&Ee<="Z"||Ee>="^"&&Ee<="~"}function w(Ee){return Ee>="1"&&Ee<="9"}function O(Ee){return Ee>="A"&&Ee<="Z"||Ee>="a"&&Ee<="z"}function P(Ee){return Ee==="d"||Ee==="h"||Ee==="m"||Ee==="s"}function F(Ee){return Ee>""&&Ee<"	"||Ee>"\v"&&Ee<"\f"||Ee>""&&Ee<"ÿ"}function W(Ee){return O(Ee)||S(Ee)||Ee==="+"||Ee==="/"}function K(Ee){return S(Ee)||O(Ee)||Ee==="+"||Ee==="/"||Ee==="-"||Ee==="_"}function X(Ee){return O(Ee)||S(Ee)||Ee==="+"||Ee==="/"}function ie(Ee,I){var U=Object.keys(Ee);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(Ee);I&&(j=j.filter(function(de){return Object.getOwnPropertyDescriptor(Ee,de).enumerable})),U.push.apply(U,j)}return U}function ae(Ee){for(var I=1;I<arguments.length;I++){var U=arguments[I]!=null?arguments[I]:{};I%2?ie(Object(U),!0).forEach(function(j){le(Ee,j,U[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ee,Object.getOwnPropertyDescriptors(U)):ie(Object(U)).forEach(function(j){Object.defineProperty(Ee,j,Object.getOwnPropertyDescriptor(U,j))})}return Ee}function le(Ee,I,U){return I in Ee?Object.defineProperty(Ee,I,{value:U,enumerable:!0,configurable:!0,writable:!0}):Ee[I]=U,Ee}(function(Ee){Ee.VERSION="v",Ee.ORIGIN="o",Ee.SESSION_NAME="s",Ee.INFORMATION="i",Ee.URI="u",Ee.EMAIL="e",Ee.PHONE="p",Ee.CONNECTION="c",Ee.BANDWIDTH="b",Ee.TIME="t",Ee.REPEAT="r",Ee.ZONE_ADJUSTMENTS="z",Ee.KEY="k",Ee.ATTRIBUTE="a",Ee.MEDIA="m"})(E||(E={}));class we{consumeText(I,U){let j=U;for(;j<I.length;){let de=I[j];if(de==="\0"||de==="\r"||de===h)break;j+=1}if(j-U==0)throw new Error("Invalid text, at ".concat(I));return j}consumeUnicastAddress(I,U,j){return this.consumeTill(I,U,m)}consumeOneOrMore(I,U,j){let de=U;for(;j(I[de]);)de++;if(de-U==0)throw new Error("Invalid rule at ".concat(U,"."));return de}consumeSpace(I,U){if(I[U]===m)return U+1;throw new Error("Invalid space at ".concat(U,"."))}consumeIP4Address(I,U){let j=U;for(let de=0;de<4;de++)if(j=this.consumeDecimalUChar(I,j),de!==3){if(I[j]!==".")throw new Error("Invalid IP4 address.");j++}return j}consumeDecimalUChar(I,U){let j=U;for(let We=0;We<3&&S(I[j]);We++,j++);if(j-U==0)throw new Error("Invalid decimal uchar.");let de=parseInt(I.slice(U,j));if(de>=0&&de<=255)return j;throw new Error("Invalid decimal uchar")}consumeIP6Address(I,U){let j=this.consumeHexpart(I,U);return I[j]===":"&&(j+=1,j=this.consumeIP4Address(I,j)),j}consumeHexpart(I,U){let j=U;if(I[j]===":"&&I[j+1]===":"){j+=2;try{j=this.consumeHexseq(I,j)}catch{}return j}if(j=this.consumeHexseq(I,j),I[j]===":"&&I[j+1]===":"){j+=2;try{j=this.consumeHexseq(I,j)}catch{}return j}return j}consumeHexseq(I,U){let j=U;for(;j=this.consumeHex4(I,j),I[j]===":"&&I[j+1]!==":";)j+=1;return j}consumeHex4(I,U){let j=0;for(;j<4;j++)if(!((de=I[U+j])>="0"&&de<="9"||de>="a"&&de<="f"||de>="A"&&de<="F")){if(j===0)throw new Error("Invalid hex 4");break}var de;return U+j}consumeFQDN(I,U){let j=U;for(;S(I[j])||O(I[j])||I[j]==="-"||I[j]===".";)j+=1;if(j-U<4)throw new Error("Invalid FQDN");return j}consumeExtnAddr(I,U){return this.consumeOneOrMore(I,U,A)}consumeMulticastAddress(I,U,j){switch(j){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(I,U);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(I,U);default:try{return this.consumeFQDN(I,U)}catch{return this.consumeExtnAddr(I,U)}}}consumeIP6MulticastAddress(I,U){let j=this.consumeHexpart(I,U);return I[j]==="/"?this.consumeInteger(I,j+1):j}consumeIP4MulticastAddress(I,U){let j=U+3,de=I.slice(U,j),We=parseInt(de);if(We<224||We>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let xt=0;xt<3;xt++){if(I[j]!==".")throw new Error("Invalid IP4 multicast address.");j+=1,j=this.consumeDecimalUChar(I,j)}return I[j]==="/"&&(j+=1),j=this.consumeTTL(I,j),I[j]==="/"&&(j=this.consumeInteger(I,j)),j}consumeInteger(I,U){if(!w(I[U]))throw new Error("Invalid integer.");for(U+=1;S(I[U]);)U+=1;return U}consumeTTL(I,U){if(I[U]==="0")return U+1;if(!w(I[U]))throw new Error("Invalid TTL.");U+=1;for(let j=0;j<2&&S(I[U]);j++)U+=1;return U}consumeToken(I,U){return this.consumeOneOrMore(I,U,T)}consumeTime(I,U){let j=U;if(I[j]==="0")return j+1;for(w(I[j])&&(j+=1);S(I[j]);)j++;if(j-U<10)throw new Error("Invalid time");return j}consumeAddress(I,U){return this.consumeTill(I,U,m)}consumeTypedTime(I,U){let j=U;return j=this.consumeOneOrMore(I,j,S),P(I[j])?j+1:j}consumeRepeatInterval(I,U){if(!w(I[U]))throw new Error("Invalid repeat interval");for(U+=1;S(I[U]);)U+=1;return P(I[U])&&(U+=1),U}consumePort(I,U){return this.consumeOneOrMore(I,U,S)}consume(I,U,j){for(let de=0;de<j.length;de++){if(U+de>=I.length)throw new Error("consume exceeding value length");if(I[U+de]!==j[de])throw new Error("consume ".concat(j," failed at ").concat(de))}return U+j.length}consumeTill(I,U,j){let de=U;for(;de<I.length&&(typeof j!="string"||I[de]!==j)&&(typeof j!="function"||!j(I[de]));)de++;return de}}class nt extends we{constructor(){super(),le(this,"records",[]),le(this,"currentLine",0)}parse(I){let U=this.probeEOL(I);this.records=I.split(U).filter(xr=>!!Wn(xr).call(xr)).map(this.parseLine),this.currentLine=0;let j=this.parseVersion(),de=this.parseOrigin(),We=this.parseSessionName(),xt=this.parseInformation(),Hr=this.parseUri(),wi=this.parseEmail(),cc=this.parsePhone(),Kg=this.parseConnection(),zg=this.parseBandWidth(),Io=this.parseTimeFields(),hl=this.parseKey(),mh=this.parseSessionAttribute(),Sr=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:j,origin:de,sessionName:We,information:xt,uri:Hr,emails:wi,phones:cc,connection:Kg,bandwidths:zg,timeFields:Io,key:hl,attributes:mh,mediaDescriptions:Sr}}getCurrentRecord(){let I=this.records[this.currentLine];if(!I)throw new Error("Record doesn't exit.");return I}probeEOL(I){for(let U=0;U<I.length;U++)if(I[U]===h)return I[U-1]==="\r"?f:h;throw new Error("Invalid newline character.")}parseLine(I,U){if(I.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let j=I[0];if(I[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:j,value:I.slice(2),line:U,cur:0}}parseSessionAttribute(){let I=new jt;for(;this.currentLine<this.records.length;){let U=this.getCurrentRecord();if(U.type!==E.ATTRIBUTE)break;let j={attField:this.extractOneOrMore(U,de=>T(de)&&de!==":"),_cur:0};U.value[U.cur]===":"&&(U.cur+=1,j.attValue=this.extractOneOrMore(U,F)),I.parse(j),this.currentLine++}return I.digest()}parseMediaAttributes(I){let U=new wr(I);for(;this.currentLine<this.records.length;){let j=this.getCurrentRecord();if(j.type!==E.ATTRIBUTE)break;let de={attField:this.extractOneOrMore(j,We=>T(We)&&We!==":"),_cur:0};j.value[j.cur]===":"&&(j.cur+=1,de.attValue=this.extractOneOrMore(j,F)),U.parse(de),this.currentLine++}return U.digest()}parseKey(){let I=this.getCurrentRecord();if(I.type===E.KEY){if(I.value==="prompt"||I.value==="clear:"||I.value==="base64:"||I.value==="uri:")return I.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let I=this.getCurrentRecord();if(I.type===E.ZONE_ADJUSTMENTS){let U=[];for(;;)try{let j=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);let de=!1;I.value[I.cur]==="-"&&(de=!0,I.cur+=1);let We=this.extract(I,this.consumeTypedTime);U.push({time:j,typedTime:We,back:de})}catch{break}if(U.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,U}return[]}parseRepeat(){let I=[];for(;;){let U=this.getCurrentRecord();if(U.type!==E.REPEAT)break;{let j=this.extract(U,this.consumeRepeatInterval),de=this.parseTypedTime(U);I.push({repeatInterval:j,typedTimes:de}),this.currentLine++}}return I}parseTypedTime(I){let U=[];for(;;)try{this.consumeSpaceForRecord(I),U.push(this.extract(I,this.consumeTypedTime))}catch{break}if(U.length===0)throw new Error("Invalid typed time.");return U}parseTime(){let I=this.getCurrentRecord(),U=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);let j=this.extract(I,this.consumeTime);return this.currentLine++,{startTime:U,stopTime:j}}parseBandWidth(){let I=[];for(;this.currentLine<this.records.length;){let U=this.getCurrentRecord();if(U.type!==E.BANDWIDTH)break;{let j=this.extractOneOrMore(U,T);if(U.value[U.cur]!==":")throw new Error("Invalid bandwidth field.");U.cur++;let de=this.extractOneOrMore(U,S);I.push({bwtype:j,bandwidth:de}),this.currentLine++}}return I}parseVersion(){let I=this.getCurrentRecord();if(I.type!==E.VERSION)throw new Error("first sdp record must be version");let U=I.value.slice(0,this.consumeOneOrMore(I.value,0,S));if(U.length!==I.value.length)throw new Error('invalid proto version, "v='.concat(I.value,'"'));return this.currentLine++,U}parseOrigin(){let I=this.getCurrentRecord();if(I.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");let U=this.extractOneOrMore(I,A);this.consumeSpaceForRecord(I);let j=this.extractOneOrMore(I,S);this.consumeSpaceForRecord(I);let de=this.extractOneOrMore(I,S);this.consumeSpaceForRecord(I);let We=this.extractOneOrMore(I,T);this.consumeSpaceForRecord(I);let xt=this.extractOneOrMore(I,T);this.consumeSpaceForRecord(I);let Hr=this.extract(I,this.consumeUnicastAddress);return this.currentLine++,{username:U,sessId:j,sessVersion:de,nettype:We,addrtype:xt,unicastAddress:Hr}}parseSessionName(){let I=this.getCurrentRecord();if(I.type===E.SESSION_NAME){let U=this.extract(I,this.consumeText);return this.currentLine++,U}}parseInformation(){let I=this.getCurrentRecord();if(I.type!==E.INFORMATION)return;let U=this.extract(I,this.consumeText);return this.currentLine++,U}parseUri(){let I=this.getCurrentRecord();if(I.type===E.URI)return this.currentLine++,I.value}parseEmail(){let I=[];for(;;){let U=this.getCurrentRecord();if(U.type!==E.EMAIL)break;I.push(U.value),this.currentLine++}return I}parsePhone(){let I=[];for(;;){let U=this.getCurrentRecord();if(U.type!==E.PHONE)break;I.push(U.value),this.currentLine++}return I}parseConnection(){let I=this.getCurrentRecord();if(I.type===E.CONNECTION){let U=this.extractOneOrMore(I,T);this.consumeSpaceForRecord(I);let j=this.extractOneOrMore(I,T);this.consumeSpaceForRecord(I);let de=this.extract(I,this.consumeAddress);return this.currentLine++,{nettype:U,addrtype:j,address:de}}}parseMedia(){let I=this.getCurrentRecord(),U=this.extract(I,this.consumeToken);this.consumeSpaceForRecord(I);let j=this.extract(I,this.consumePort);I.value[I.cur]==="/"&&(I.cur+=1,j+=this.extract(I,this.consumeInteger)),this.consumeSpaceForRecord(I);let de=[];for(de.push(this.extract(I,this.consumeToken));I.value[I.cur]==="/";)I.cur+=1,de.push(this.extract(I,this.consumeToken));if(de.length===0)throw new Error("Invalid proto");let We=this.parseFmt(I);return this.currentLine++,{mediaType:U,port:j,protos:de,fmts:We}}parseTimeFields(){let I=[];for(;this.getCurrentRecord().type===E.TIME;){let U=this.parseTime(),j=this.parseRepeat(),de=this.parseZone();I.push({time:U,repeats:j,zones:de})}return I}parseMediaDescription(){let I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){let U=this.parseMedia(),j=this.parseInformation(),de=this.parseConnections(),We=this.parseBandWidth(),xt=this.parseKey(),Hr=this.parseMediaAttributes(U);I.push({media:U,information:j,connections:de,bandwidths:We,key:xt,attributes:Hr})}return I}parseConnections(){let I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)I.push(this.parseConnection());return I}parseFmt(I){let U=[];for(;;)try{this.consumeSpaceForRecord(I),U.push(this.extract(I,this.consumeToken))}catch{break}if(U.length===0)throw new Error("Invalid fmts");return U}extract(I,U){for(var j=arguments.length,de=new Array(j>2?j-2:0),We=2;We<j;We++)de[We-2]=arguments[We];let xt=U.call(this,I.value,I.cur,...de),Hr=I.value.slice(I.cur,xt);return I.cur=xt,Hr}extractOneOrMore(I,U){let j=this.consumeOneOrMore(I.value,I.cur,U),de=I.value.slice(I.cur,j);return I.cur=j,de}consumeSpaceForRecord(I){if(I.value[I.cur]!==m)throw new Error("Invalid space at ".concat(I.cur,"."));I.cur+=1}}class gt extends we{constructor(){super(...arguments),le(this,"attributes",void 0),le(this,"digested",!1)}extractOneOrMore(I,U,j){let de=this.consumeOneOrMore(I.attValue,I._cur,U),We=I.attValue.slice(I._cur,de),[xt,Hr]=j||[];if(typeof xt=="number"&&We.length<xt)throw new Error("error in length, should be more or equal than ".concat(xt," characters."));if(typeof Hr=="number"&&We.length>Hr)throw new Error("error in length, should be less or equal than ".concat(Hr," characters."));return I._cur=de,We}consumeAttributeSpace(I){if(I.attValue[I._cur]!==m)throw new Error("Invalid space at ".concat(I._cur,"."));I._cur+=1}extract(I,U){if(!I.attValue)throw new Error("Nothing to extract from attValue.");for(var j=arguments.length,de=new Array(j>2?j-2:0),We=2;We<j;We++)de[We-2]=arguments[We];let xt=U.call(this,I.attValue,I._cur,...de),Hr=I.attValue.slice(I._cur,xt);return I._cur=xt,Hr}atEnd(I){if(!I.attValue)throw new Error;return I._cur>=I.attValue.length}peekChar(I){if(!I.attValue)throw new Error;return I.attValue[I._cur]}peek(I,U){if(!I.attValue)throw new Error;for(let j=0;j<U.length;j++)if(U[j]!==I.attValue[I._cur+j])return!1;return!0}parseIceUfrag(I){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(I,W,[4,256])}parseIcePwd(I){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(I,W,[22,256])}parseIceOptions(I){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let U=[];for(;!this.atEnd(I);){U.push(this.extractOneOrMore(I,W));try{this.consumeAttributeSpace(I)}catch(j){if(this.atEnd(I))break;throw j}}this.attributes.iceOptions=U}parseFingerprint(I){let U=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);let j=this.extract(I,this.consumeTill);this.attributes.fingerprints.push({hashFunction:U,fingerprint:j})}parseExtmap(I){let U=this.extractOneOrMore(I,S),j;this.peekChar(I)==="/"&&(this.extract(I,this.consume,"/"),j=this.extract(I,this.consumeToken)),this.consumeAttributeSpace(I);let de=this.extract(I,this.consumeTill,m),We=ae(ae({entry:parseInt(U,10)},j&&{direction:j}),{},{extensionName:de});this.peekChar(I)===m&&(this.consumeAttributeSpace(I),We.extensionAttributes=this.extract(I,this.consumeTill)),this.attributes.extmaps.push(We)}parseSetup(I){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let U=this.extract(I,this.consumeTill);if(U!=="active"&&U!=="passive"&&U!=="actpass"&&U!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=U}}class jt extends gt{constructor(){super(...arguments),le(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"group":this.parseGroup(I);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"fingerprint":this.parseFingerprint(I);break;case"setup":this.parseSetup(I);break;case"tls-id":this.parseTlsId(I);break;case"identity":this.parseIdentity(I);break;case"extmap":this.parseExtmap(I);break;case"msid-semantic":this.parseMsidSemantic(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(U){throw console.error("parsing session attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),U}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(I){let U=this.extract(I,this.consumeToken),j=[];for(;!this.atEnd(I)&&this.peekChar(I)===m;)this.consumeAttributeSpace(I),j.push(this.extract(I,this.consumeToken));this.attributes.groups.push({semantic:U,identificationTag:j})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(I){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(I,K)}parseIdentity(I){let U=this.extractOneOrMore(I,X),j=[];for(;!this.atEnd(I)&&this.peekChar(I)===m;){this.consumeAttributeSpace(I);let de=this.extract(I,this.consumeToken);this.extract(I,this.consume,"=");let We=this.extractOneOrMore(I,xt=>xt!==m&&F(xt));j.push({name:de,value:We})}this.attributes.identities.push({assertionValue:U,extensions:j})}parseMsidSemantic(I){this.peekChar(I)===m&&this.consumeAttributeSpace(I);let U={semantic:this.extract(I,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(I)}catch{break}if(this.peekChar(I)==="*"){this.extract(I,this.consume,"*"),U.applyForAll=!0;break}{let j=this.extract(I,this.consumeTill,m);U.identifierList.push(j)}}this.attributes.msidSemantic=U}}class wr extends gt{constructor(I){super(),le(this,"attributes",void 0),I.protos.indexOf("RTP")!==-1||I.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"extmap":this.parseExtmap(I);break;case"setup":this.parseSetup(I);break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"candidate":this.parseCandidate(I);break;case"remote-candidate":this.parseRemoteCandidate(I);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(I);break;case"rtpmap":this.parseRtpmap(I);break;case"ptime":this.parsePtime(I);break;case"maxptime":this.parseMaxPtime(I);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(I);break;case"ssrc":this.parseSSRC(I);break;case"fmtp":this.parseFmtp(I);break;case"rtcp-fb":this.parseRtcpFb(I);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(I);break;case"mid":this.parseMid(I);break;case"msid":this.parseMsid(I);break;case"imageattr":this.parseImageAttr(I);break;case"rid":this.parseRid(I);break;case"simulcast":this.parseSimulcast(I);break;case"sctp-port":this.parseSctpPort(I);break;case"max-message-size":this.parseMaxMessageSize(I);break;case"ssrc-group":this.parseSSRCGroup(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(U){throw console.error("parsing media attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),U}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}parseCandidate(I){let U=this.extractOneOrMore(I,W,[1,32]);this.consumeAttributeSpace(I);let j=this.extractOneOrMore(I,S,[1,5]);this.consumeAttributeSpace(I);let de=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);let We=this.extractOneOrMore(I,S,[1,10]);this.consumeAttributeSpace(I);let xt=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);let Hr=this.extract(I,this.consumePort);this.consumeAttributeSpace(I),this.extract(I,this.consume,"typ"),this.consumeAttributeSpace(I);let wi={foundation:U,componentId:j,transport:de,priority:We,connectionAddress:xt,port:Hr,type:this.extract(I,this.consumeToken),extension:{}};for(this.peek(I," raddr")&&(this.extract(I,this.consume," raddr"),this.consumeAttributeSpace(I),wi.relAddr=this.extract(I,this.consumeAddress)),this.peek(I," rport")&&(this.extract(I,this.consume," rport"),this.consumeAttributeSpace(I),wi.relPort=this.extract(I,this.consumePort));this.peekChar(I)===m;){this.consumeAttributeSpace(I);let cc=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I),wi.extension[cc]=this.extractOneOrMore(I,y)}this.attributes.candidates.push(wi)}parseRemoteCandidate(I){let U=[];for(;;){let j=this.extractOneOrMore(I,S,[1,5]);this.consumeAttributeSpace(I);let de=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);let We=this.extract(I,this.consumePort);U.push({componentId:j,connectionAddress:de,port:We});try{this.consumeAttributeSpace(I)}catch{break}}this.attributes.remoteCandidatesList.push(U)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(I){let U=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);let j=this.extract(I,this.consumeTill,"/");this.extract(I,this.consume,"/");let de={encodingName:j,clockRate:this.extractOneOrMore(I,S)};this.atEnd(I)||this.peekChar(I)!=="/"||(this.extract(I,this.consume,"/"),de.encodingParameters=parseInt(this.extract(I,this.consumeTill),10));let We=this.attributes.payloads.find(xt=>xt.payloadType===parseInt(U,10));We?We.rtpMap=de:this.attributes.payloads.push({payloadType:parseInt(U,10),rtpMap:de,rtcpFeedbacks:[]})}parsePtime(I){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(I,this.consumeTill)}parseMaxPtime(I){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(I,this.consumeTill)}parseDirection(I){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=I.attField}parseSSRC(I){let U=this.extractOneOrMore(I,S);this.consumeAttributeSpace(I);let j=this.extract(I,this.consumeTill,":"),de;this.peekChar(I)===":"&&(this.extract(I,this.consume,":"),de=this.extract(I,this.consumeTill));let We=this.attributes.ssrcs.find(xt=>xt.ssrcId===parseInt(U,10));We?We.attributes[j]=de:this.attributes.ssrcs.push({ssrcId:parseInt(U,10),attributes:{[j]:de}})}parseFmtp(I){let U=this.extract(I,this.consumeTill,m);this.consumeAttributeSpace(I);let j=this.extract(I,this.consumeTill),de={};j.split(";").forEach(xt=>{let[Hr,wi]=xt.split("=");Hr=Wn(Hr).call(Hr);let cc=typeof wi=="string"?Wn(wi).call(wi):null;typeof Hr=="string"&&Hr.length>0&&(de[Hr]=cc)});let We=this.attributes.payloads.find(xt=>xt.payloadType===parseInt(U,10));We?We.fmtp={parameters:de}:this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[],fmtp:{parameters:de}})}parseFmtParameters(I){let U={},j=this.extract(I,this.consumeTill,"=");I._cur++;let de=this.extract(I,this.consumeTill,";");for(U[j]=de;I.attValue[I._cur]===";";){let We=this.extract(I,this.consumeTill,"=");I._cur++;let xt=this.extract(I,this.consumeTill,";");U[We]=xt}return U}parseRtcpFb(I){let U="";U=this.peekChar(I)==="*"?this.extract(I,this.consume,"*"):this.extract(I,this.consumeTill,m),this.consumeAttributeSpace(I);let j=this.extract(I,this.consumeTill,m),de;if(j==="trr-int")de={type:j,interval:this.extract(I,this.consumeTill)};else{let We={type:j};this.peekChar(I)===m&&(this.consumeAttributeSpace(I),We.parameter=this.extract(I,this.consumeToken),this.peekChar(I)===m&&(We.additional=this.extract(I,this.consumeTill))),de=We}if(U==="*")this.attributes.rtcpFeedbackWildcards.push(de);else{let We=this.attributes.payloads.find(xt=>xt.payloadType===parseInt(U,10));We?We.rtcpFeedbacks.push(de):this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[de]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(I){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let U={port:this.extract(I,this.consumePort)};this.peekChar(I)===m&&(this.consumeAttributeSpace(I),U.netType=this.extractOneOrMore(I,T),this.consumeAttributeSpace(I),U.addressType=this.extractOneOrMore(I,T),this.consumeAttributeSpace(I),U.address=this.extract(I,this.consumeAddress)),this.attributes.rtcp=U}parseMsid(I){let U={id:this.extractOneOrMore(I,T,[1,64])};this.peekChar(I)===m&&(this.consumeAttributeSpace(I),U.appdata=this.extractOneOrMore(I,T,[1,64])),this.attributes.msids.push(U)}parseImageAttr(I){this.attributes.imageattr.push(I.attValue)}parseRid(I){let U=this.extractOneOrMore(I,de=>O(de)||S(de)||de==="_"||de==="-");this.consumeAttributeSpace(I);let j={id:U,direction:this.extract(I,this.consumeToken),params:[]};if(this.peekChar(I)===m){if(this.consumeAttributeSpace(I),this.peek(I,"pt=")){this.extract(I,this.consume,"pt=");let de=[];for(;;){let We=this.extract(I,this.consumeToken);de.push(We);try{this.extract(I,this.consume,",")}catch{break}}j.payloads=de,this.peekChar(I)===m&&this.extract(I,this.consume,m)}for(;;){let de=this.extract(I,this.consumeToken);switch(de){case"depend":{let We={type:de,rids:this.extract(I,this.consume,"=").split(",")};j.params.push(We);break}default:{let We={type:de};this.peekChar(I)==="="&&(this.extract(I,this.consume,"="),We.val=this.extract(I,this.consumeTill,";")),j.params.push(We)}}try{this.extract(I,this.consume,";")}catch{break}}}this.attributes.rids.push(j)}parseSimulcast(I){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=I.attValue,this.extract(I,this.consumeTill)}parseSctpPort(I){this.attributes.sctpPort=this.extractOneOrMore(I,S,[1,5])}parseMaxMessageSize(I){this.attributes.maxMessageSize=this.extractOneOrMore(I,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(I){this.attributes.mid=this.extract(I,this.consumeToken)}parseSSRCGroup(I){let U=this.extract(I,this.consumeToken),j=[];for(;;)try{this.consumeAttributeSpace(I);let de=this.extract(I,this.consumeInteger);j.push(parseInt(de,10))}catch{break}this.attributes.ssrcGroups.push({semantic:U,ssrcIds:j})}}function ir(Ee,I,U){return I in Ee?Object.defineProperty(Ee,I,{value:U,enumerable:!0,configurable:!0,writable:!0}):Ee[I]=U,Ee}class ps{constructor(){ir(this,"eol",f)}print(I,U){let j="";return U&&(this.eol=U),j+=this.printVersion(I.version),j+=this.printOrigin(I.origin),j+=this.printSessionName(I.sessionName),j+=this.printInformation(I.information),j+=this.printUri(I.uri),j+=this.printEmail(I.emails),j+=this.printPhone(I.phones),j+=this.printConnection(I.connection),j+=this.printBandwidth(I.bandwidths),j+=this.printTimeFields(I.timeFields),j+=this.printKey(I.key),j+=this.printSessionAttributes(I.attributes),j+=this.printMediaDescription(I.mediaDescriptions),j}printVersion(I){return"v=".concat(I).concat(this.eol)}printOrigin(I){return"o=".concat(I.username," ").concat(I.sessId," ").concat(I.sessVersion," ").concat(I.nettype," ").concat(I.addrtype," ").concat(I.unicastAddress).concat(this.eol)}printSessionName(I){return I?"s=".concat(I).concat(this.eol):""}printInformation(I){return I?"i=".concat(I).concat(this.eol):""}printUri(I){return I?"u=".concat(I).concat(this.eol):""}printEmail(I){let U="";for(let j of I)U+="e=".concat(j).concat(this.eol);return U}printPhone(I){let U="";for(let j of I)U+="e=".concat(j).concat(this.eol);return U}printConnection(I){return I?"c=".concat(I.nettype," ").concat(I.addrtype," ").concat(I.address).concat(this.eol):""}printBandwidth(I){let U="";for(let j of I)U+="b=".concat(j.bwtype,":").concat(j.bandwidth).concat(this.eol);return U}printTimeFields(I){let U="";for(let j of I){U+="t=".concat(j.time.startTime," ").concat(j.time.startTime).concat(this.eol);for(let de of j.repeats)U+="r=".concat(de.repeatInterval," ").concat(de.typedTimes.join(" ")).concat(this.eol);j.zoneAdjustments&&(U+="z=",U+="z=".concat(j.zoneAdjustments.map(de=>"".concat(de.time," ").concat(de.back?"-":""," ").concat(de.typedTime)).join(" ")).concat(this.eol),U+=this.eol)}return U}printKey(I){return I?"k=".concat(I).concat(this.eol):""}printAttributes(I){let U="";for(let j of I)U+="a=".concat(j.attField).concat(j.attValue?":".concat(j.attValue):"").concat(this.eol);return U}printMediaDescription(I){let U="";for(let j of I)U+=this.printMedia(j.media),U+=this.printInformation(j.information),U+=this.printConnections(j.connections),U+=this.printBandwidth(j.bandwidths),U+=this.printKey(j.key),U+=this.printMediaAttributes(j);return U}printConnections(I){let U="";for(let j of I)U+=this.printConnection(j);return U}printMedia(I){return"m=".concat(I.mediaType," ").concat(I.port," ").concat(I.protos.join("/")," ").concat(I.fmts.join(" ")).concat(this.eol)}printSessionAttributes(I){return new me(this.eol).print(I)}printMediaAttributes(I){return new Re(this.eol).print(I)}}class ne{constructor(I){ir(this,"eol",void 0),this.eol=I}printIceUfrag(I){return I===void 0?"":"a=ice-ufrag:".concat(I).concat(this.eol)}printIcePwd(I){return I===void 0?"":"a=ice-pwd:".concat(I).concat(this.eol)}printIceOptions(I){return I===void 0?"":"a=ice-options:".concat(I.join(m)).concat(this.eol)}printFingerprints(I){return I.length>0?I.map(U=>"a=fingerprint:".concat(U.hashFunction).concat(m).concat(U.fingerprint)).join(this.eol)+this.eol:""}printExtmap(I){return I.map(U=>"a=extmap:".concat(U.entry).concat(U.direction?"/".concat(U.direction):"").concat(m).concat(U.extensionName).concat(U.extensionAttributes?"".concat(m).concat(U.extensionAttributes):"").concat(this.eol)).join("")}printSetup(I){return I===void 0?"":"a=setup:".concat(I).concat(this.eol)}printUnrecognized(I){return I.map(U=>"a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol)).join("")}}class me extends ne{print(I){let U="";return U+=this.printGroups(I.groups),U+=this.printMsidSemantic(I.msidSemantic),U+=this.printIceLite(I.iceLite),U+=this.printIceUfrag(I.iceUfrag),U+=this.printIcePwd(I.icePwd),U+=this.printIceOptions(I.iceOptions),U+=this.printFingerprints(I.fingerprints),U+=this.printSetup(I.setup),U+=this.printTlsId(I.tlsId),U+=this.printIdentity(I.identities),U+=this.printExtmap(I.extmaps),U+=this.printUnrecognized(I.unrecognized),U}printGroups(I){let U="";return I.length>0&&(U+=I.map(j=>"a=group:".concat(j.semantic).concat(j.identificationTag.map(de=>"".concat(m).concat(de)).join("")).concat(this.eol)).join("")),U}printIceLite(I){return I===void 0?"":"a=ice-lite"+this.eol}printTlsId(I){return I?"a=tls-id:".concat(I).concat(this.eol):""}printIdentity(I){return I.length===0?"":I.map(U=>"a=identity:".concat(U.assertionValue).concat(U.extensions.map(j=>"".concat(m).concat(j.name).concat(j.value?"=".concat(j.value):"")))).join(this.eol)+this.eol}printMsidSemantic(I){if(!I)return"";let U="a=msid-semantic:".concat(I.semantic);return I.applyForAll?U+="".concat(m,"*"):I.identifierList.length>0&&(U+=I.identifierList.map(j=>"".concat(m).concat(j))),U+this.eol}}class Re extends ne{print(I){let U=I.attributes,j="";return j+=this.printRTCP(U.rtcp),j+=this.printIceUfrag(U.iceUfrag),j+=this.printIcePwd(U.icePwd),j+=this.printIceOptions(U.iceOptions),j+=this.printCandidates(U.candidates),j+=this.printRemoteCandidatesList(U.remoteCandidatesList),j+=this.printEndOfCandidates(U.endOfCandidates),j+=this.printFingerprints(U.fingerprints),j+=this.printSetup(U.setup),j+=this.printMid(U.mid),j+=this.printExtmap(U.extmaps),j+=this.printRTPRelated(U),j+=this.printPtime(U.ptime),j+=this.printMaxPtime(U.maxPtime),j+=this.printDirection(U.direction),j+=this.printSSRCGroups(U.ssrcGroups),j+=this.printSSRC(U.ssrcs),j+=this.printRTCPMux(U.rtcpMux),j+=this.printRTCPMuxOnly(U.rtcpMuxOnly),j+=this.printRTCPRsize(U.rtcpRsize),j+=this.printMSId(U.msids),j+=this.printImageattr(U.imageattr),j+=this.printRid(U.rids),j+=this.printSimulcast(U.simulcast),j+=this.printSCTPPort(U.sctpPort),j+=this.printMaxMessageSize(U.maxMessageSize),j+=this.printUnrecognized(U.unrecognized),j}printCandidates(I){return I.map(U=>"a=candidate:".concat(U.foundation).concat(m).concat(U.componentId).concat(m).concat(U.transport).concat(m).concat(U.priority).concat(m).concat(U.connectionAddress).concat(m).concat(U.port).concat(m,"typ").concat(m).concat(U.type).concat(U.relAddr?"".concat(m,"raddr").concat(m).concat(U.relAddr):"").concat(U.relPort?"".concat(m,"rport").concat(m).concat(U.relPort):"").concat(Object.keys(U.extension).map(j=>"".concat(m).concat(j).concat(m).concat(U.extension[j])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(I){return I.map(U=>"a=remote-candidates:".concat(U.join(m)).concat(this.eol)).join("")}printEndOfCandidates(I){return I===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(I){if(!I.payloads)return"";let U=I.payloads,j="";j+=I.rtcpFeedbackWildcards.map(de=>this.printRTCPFeedback("*",de)).join("");for(let de of U)j+=this.printRtpMap(de.payloadType,de.rtpMap),j+=this.printFmtp(de.payloadType,de.fmtp),j+=de.rtcpFeedbacks.map(We=>this.printRTCPFeedback(de.payloadType,We)).join("");return j}printFmtp(I,U){if(!U)return"";let j=Object.keys(U.parameters);return j.length===1&&U.parameters[j[0]]===null?"a=fmtp:".concat(I).concat(m).concat(j[0]).concat(this.eol):"a=fmtp:".concat(I).concat(m).concat(Object.keys(U.parameters).map(de=>"".concat(de,"=").concat(U.parameters[de])).join(";")).concat(this.eol)}printRtpMap(I,U){return U?"a=rtpmap:".concat(I).concat(m).concat(U.encodingName,"/").concat(U.clockRate).concat(U.encodingParameters?"/".concat(U.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(I,U){let j="a=rtcp-fb:".concat(I).concat(m),de=U;return de.type==="trr-int"?j+="ttr-int".concat(m).concat(de.interval):(j+="".concat(de.type),de.parameter&&(j+="".concat(m).concat(de.parameter),de.additional&&(j+="".concat(m).concat(de.additional)))),j+this.eol}printPtime(I){return I===void 0?"":"a=ptime:".concat(I).concat(this.eol)}printMaxPtime(I){return I===void 0?"":"a=maxptime:".concat(I).concat(this.eol)}printDirection(I){return I===void 0?"":"a=".concat(I).concat(this.eol)}printSSRC(I){return I.map(U=>Object.keys(U.attributes).map(j=>"a=ssrc:".concat(U.ssrcId.toString(10)).concat(m).concat(j).concat(U.attributes[j]?":".concat(U.attributes[j]):"").concat(this.eol)).join("")).join("")}printRTCPMux(I){return I===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(I){return I===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(I){return I===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(I){if(I===void 0)return"";let U="a=rtcp:".concat(I.port);return I.netType&&(U+="".concat(m).concat(I.netType)),I.addressType&&(U+="".concat(m).concat(I.addressType)),I.address&&(U+="".concat(m).concat(I.address)),U+this.eol}printMSId(I){return I.map(U=>"a=msid:".concat(U.id).concat(U.appdata?"".concat(m).concat(U.appdata):"").concat(this.eol)).join("")}printImageattr(I){return I.map(U=>"a=imageattr:".concat(U).concat(this.eol)).join("")}printRid(I){return I.map(U=>{let j="a=rid:".concat(U.id).concat(m).concat(U.direction);return U.payloads&&(j+="".concat(m,"pt=").concat(U.payloads.join(","))),U.params.length>0&&(j+="".concat(m).concat(U.params.map(de=>de.type==="depend"?"depend=".concat(de.rids.join(",")):"".concat(de.type,"=").concat(de.val)).join(";"))),j+this.eol}).join("")}printSimulcast(I){return I===void 0?"":"a=simulcast:".concat(I).concat(this.eol)}printSCTPPort(I){return I===void 0?"":"a=sctp-port:".concat(I).concat(this.eol)}printMaxMessageSize(I){return I===void 0?"":"a=max-message-size:".concat(I).concat(this.eol)}printMid(I){return I===void 0?"":"a=mid:".concat(I).concat(this.eol)}printSSRCGroups(I){return I.map(U=>"a=ssrc-group:".concat(U.semantic).concat(U.ssrcIds.map(j=>"".concat(m).concat(j.toString(10))).join("")).concat(this.eol)).join("")}}function He(Ee){return new nt().parse(Ee)}function _t(Ee,I){return new ps().print(Ee,I)}}},i={};function s(c){if(i[c])return i[c].exports;var l=i[c]={exports:{}};return r[c](l,l.exports,s),l.exports}return s.d=(c,l)=>{for(var u in l)s.o(l,u)&&!s.o(c,u)&&Object.defineProperty(c,u,{enumerable:!0,get:l[u]})},s.o=(c,l)=>Object.prototype.hasOwnProperty.call(c,l),s.r=c=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},s(8)})()})(ZU);var $t=ZU.exports;function cs(e){if(Array.isArray(e))return e.map(r=>r);if(!eV(e))return e;let t={};for(let r in e){let i=e[r];eV(i)||Array.isArray(i)?t[r]=cs(i):t[r]=i}return t}function eV(e){return!(typeof e!="object"||Array.isArray(e)||!e)}class i0{constructor(t){b(this,"input",[]),b(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}let ba={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},xf={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:ba,remoteCandidate:ba}},tV={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},rV={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},nV={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},iV={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function oV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function sV(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?oV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class o0{constructor(t,r){b(this,"onFirstVideoReceived",void 0),b(this,"onFirstVideoDecoded",void 0),b(this,"onFirstAudioReceived",void 0),b(this,"onFirstVideoDecodedTimeout",void 0),b(this,"onFirstAudioDecoded",void 0),b(this,"onSelectedLocalCandidateChanged",void 0),b(this,"onSelectedRemoteCandidateChanged",void 0),b(this,"videoIsReady",!1),b(this,"videoIsReady2",{}),b(this,"pc",void 0),b(this,"options",void 0),b(this,"intervalTimer",void 0),b(this,"stats",cs(xf)),b(this,"isFirstVideoReceived",{}),b(this,"isFirstVideoDecoded",{}),b(this,"isFirstAudioReceived",{}),b(this,"isFirstAudioDecoded",{}),b(this,"isFirstVideoDecodedTimeout",{}),b(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new _e(t=>{t({local:sV({},ba),remote:sV({},ba)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"],s=0,c=0,l=0,u=0;for(let h of i)t[h].forEach((f,m)=>{if(!this.lossRateWindowStats[r-1][h][m]||!this.lossRateWindowStats[0][h][m])return;let E=this.lossRateWindowStats[r-1][h][m].packets-this.lossRateWindowStats[0][h][m].packets,S=this.lossRateWindowStats[r-1][h][m].packetsLost-this.lossRateWindowStats[0][h][m].packetsLost;h==="videoSend"||h==="audioSend"?(s+=E,l+=S):(c+=E,u+=S),Number.isNaN(E)||Number.isNaN(E)?f.packetLostRate=0:f.packetLostRate=E<=0||S<=0?0:S/(E+S)});t.sendPacketLossRate=s<=0||l<=0?0:l/(s+l),t.recvPacketLossRate=c<=0||u<=0?0:u/(c+u)}}function aV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function Sre(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?aV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):aV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class yre extends o0{constructor(){super(...arguments),b(this,"_stats",xf),b(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=cs(xf);let i=r.filter(c=>c.type==="ssrc");this.processSSRCStats(i);let s=r.find(c=>c.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var i;let s=ge(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(s?"send":"recv")){case"video_send":{let c=cs(rV);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{let c=cs(tV),l=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),l){let u=l.stats,h=Date.now()-l.lts;c.framesDecodeFreezeTime=u.framesDecodeFreezeTime,c.framesDecodeInterval=u.framesDecodeInterval,c.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(l.lts=Date.now(),c.framesDecodeInterval=h,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<l.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Sre({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{let c=cs(iV);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{let c=cs(nV);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new _e((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){let r=[];return t.result().forEach(i=>{let s={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{s[c]=i.stat(c)}),r.push(s)}),r}}function cV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function yd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class lV extends o0{constructor(){super(...arguments),b(this,"_stats",xf),b(this,"report",void 0),b(this,"lastDecodeVideoReceiverStats",new Map),b(this,"lastVideoFramesRecv",new Map),b(this,"lastVideoFramesSent",new Map),b(this,"lastVideoFramesDecode",new Map),b(this,"lastVideoFramesOutput",new Map),b(this,"lastVideoJBDelay",new Map),b(this,"lastAudioJBDelay",new Map),b(this,"mediaBytesSent",new Map),b(this,"mediaBytesRetransmit",new Map),b(this,"mediaBytesTargetEncode",new Map),b(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=cs(xf),this.report.forEach(t=>{switch(t.type){case Ji.OUTBOUND:case Ji.INBOUND:{let r=t.mediaType||t.kind,i=!r&&"frameWidth"in t,s=!r&&!("frameWidth"in t);t.type===Ji.OUTBOUND?r==="audio"||s?this.processAudioOutboundStats(t):(r==="video"||i)&&this.processVideoOutboundStats(t):t.type===Ji.INBOUND&&(r==="audio"||s?this.processAudioInboundStats(t):(r==="video"||i)&&this.processVideoInboundStats(t));break}case Ji.TRANSPORT:{let r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Ji.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let t=await this.pc.getStats(),r={local:yd({},ba),remote:yd({},ba)};return t.forEach(i=>{let s;if(i.type===Ji.TRANSPORT&&(s=t.get(i.selectedCandidatePairId)),i.type===Ji.CANDIDATE_PAIR&&i.selected&&(s=i),s){let c=(l,u)=>{l.type=u.type,l.id=u.id,u.address&&(l.address=u.address),u.candidateType&&(l.candidateType=u.candidateType),u.port&&(l.port=u.port),u.priority&&(l.priority=u.priority),u.protocol&&(l.protocol=u.protocol),u.relayProtocol&&(l.relayProtocol=u.relayProtocol)};if(s.localCandidateId){let l=t.get(s.localCandidateId);l&&c(r.local,l)}if(s.remoteCandidateId){let l=t.get(s.remoteCandidateId);l&&c(r.remote,l)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){let r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){let r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===Ji.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===Ji.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===Ji.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(yd({},r),yd({},this.stats.selectedCandidatePair.localCandidate)),t.type===Ji.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(yd({},r),yd({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);r||(r=cs(iV),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let r=this._stats.videoRecv.find(u=>u.ssrc===t.ssrc);r||(r=cs(tV),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration;let i=this.lastDecodeVideoReceiverStats.get(r.ssrc),s=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),l=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){let u=r.decodedFrame?r.decodedFrame.width:0,h=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,u,h),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){let u=i.stats,h=l-i.lts;r.framesDecodeFreezeTime=u.framesDecodeFreezeTime,r.framesDecodeInterval=u.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&h>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=h,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<u.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}s&&l-s.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-s.count)/((l-s.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:l,rate:r.decodeFrameRate})):s?r.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:l,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&l-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((l-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:l,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:l,rate:0})),t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:yd({},r),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(s=>s.ssrc===t.ssrc);r||(r=cs(rV),this._stats.videoSend.push(r));let i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{let s=new i0(10);s.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,s)}if(t.retransmittedBytesSent!==void 0){let s=this.mediaBytesRetransmit.get(t.ssrc);if(s)s.add(t.retransmittedBytesSent);else{let c=new i0(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){let s=this.mediaBytesTargetEncode.get(t.ssrc);if(s)s.add(t.totalEncodedBytesTarget);else{let c=new i0(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){let s=this.lastEncoderMs.get(t.ssrc);if(!s||s.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{let c=t.framesEncoded-s.lastFrameCount,l=t.totalEncodeTime-s.lastEncoderTime;r.avgEncodeMs=1e3*l/c}}if(t.framesEncoded&&t.qpSum){let s=this.lastEncoderMs.get(t.ssrc);!s||s.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-s.lastQpSum)/(t.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{let s=this.findRemoteStatsId(t.ssrc,Ji.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(r||(r=cs(nV),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{let i=this.findRemoteStatsId(t.ssrc,Ji.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}findRemoteStatsId(t,r){var i;let s=Array.from(Ms(i=this.report).call(i)).find(c=>c.type===r&&c.ssrc===t);return s?s.id:null}processVideoMediaSource(t,r){let i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,r){let i=this.report.get(t);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,r,i){var s,c,l,u;let h=r?this.report.get(r):void 0,f=(s=h==null?void 0:h.framesSent)!==null&&s!==void 0?s:t.framesSent;if(typeof f!="number")return;let m=(c=h==null?void 0:h.frameWidth)!==null&&c!==void 0?c:t.frameWidth,E=(l=h==null?void 0:h.frameHeight)!==null&&l!==void 0?l:t.frameHeight,S=(u=h==null?void 0:h.framesPerSecond)!==null&&u!==void 0?u:t.framesPerSecond;if(typeof m=="number"&&typeof E=="number"||(m=0,E=0),S==null){let y=Date.now(),A=this.lastVideoFramesSent.get(i.ssrc);A&&y-A.lts>=800?(S=Math.round((f-A.count)/((y-A.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:f,lts:y,rate:S})):A?S=A.rate:this.lastVideoFramesSent.set(i.ssrc,{count:f,lts:y,rate:0})}i.sentFrame={width:m,height:E,frameRate:Math.max(0,S)}}processVideoTrackReceiverStats(t,r,i){var s,c,l,u,h;let f=r?this.report.get(r):void 0,m=(s=f==null?void 0:f.framesReceived)!==null&&s!==void 0?s:t.framesReceived,E=(c=f==null?void 0:f.frameWidth)!==null&&c!==void 0?c:t.frameWidth,S=(l=f==null?void 0:f.frameHeight)!==null&&l!==void 0?l:t.frameHeight,y=(u=f==null?void 0:f.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,A=(h=f==null?void 0:f.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount;if(typeof m=="number"){let T=this.lastVideoFramesRecv.get(i.ssrc),w=Date.now();i.framesReceivedCount=m;let O=0;T&&w-T.lts>=800?(O=Math.round((m-T.count)/((w-T.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:m,lts:w,rate:O})):T?O=T.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:m,lts:w,rate:0}),i.receivedFrame={width:E||0,height:S||0,frameRate:O||0},i.decodedFrame={width:E||0,height:S||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:E||0,height:S||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(y&&A){let T=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},w=T.jitterBufferMs,O=A-T.jitterBufferEmittedCount;O>0&&(w=1e3*(y-T.jitterBufferDelay)/O),i.jitterBufferMs=w,i.currentDelayMs=Math.round(w),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:y,jitterBufferEmittedCount:A,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(t,r,i){var s,c,l,u;let h=r?this.report.get(r):void 0,f=(s=(c=h==null?void 0:h.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&s!==void 0?s:0,m=(l=(u=h==null?void 0:h.echoReturnLossEnhancement)!==null&&u!==void 0?u:t.echoReturnLossEnhancement)!==null&&l!==void 0?l:0;i.aecReturnLoss=f,i.aecReturnLossEnhancement=m}processAudioTrackReceiverStats(t,r,i){var s,c,l,u,h,f,m;let E=r?this.report.get(r):void 0,S=(s=E==null?void 0:E.removedSamplesForAcceleration)!==null&&s!==void 0?s:t.removedSamplesForAcceleration,y=(c=E==null?void 0:E.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,A=(l=E==null?void 0:E.jitterBufferDelay)!==null&&l!==void 0?l:t.jitterBufferDelay,T=(u=E==null?void 0:E.jitterBufferEmittedCount)!==null&&u!==void 0?u:t.jitterBufferEmittedCount,w=(h=E==null?void 0:E.audioLevel)!==null&&h!==void 0?h:t==null?void 0:t.audioLevel,O=(f=E==null?void 0:E.totalSamplesDuration)!==null&&f!==void 0?f:t==null?void 0:t.totalSamplesDuration,P=(m=E==null?void 0:E.concealedSamples)!==null&&m!==void 0?m:t.concealedSamples;if(S&&y&&(i.accelerateRate=S/y),A&&T){let W=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},K=W.jitterBufferMs,X=T-W.jitterBufferEmittedCount;X>0&&(K=1e3*(A-W.jitterBufferDelay)/X),i.jitterBufferMs=Math.round(K),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:T,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=w;let F=1920;O&&y&&(F=y/O/50,i.receivedFrames=Math.round(y/F)),P&&(i.droppedFrames=Math.round(P/F))}processRemoteInboundStats(t,r){let i=this.report.get(t);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(t){let r=this.report.get(t);if(!r)return"";let i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,r=null,i=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});let s=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}}class vre extends o0{updateStats(){return _e.resolve()}}function Tg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,c=function(){let l=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return l&&l[0]?Number(l[0].split("/")[1]):null}();return c?c<76?new yre(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new lV(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:s}):function(l){return!!window.RTCStatsReport&&l.getStats()instanceof _e}(e)?new lV(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new vre(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:s})}function dV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function uV(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Uf(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,{filterRTX:s,filterVideoFec:c,filterAudioFec:l,filterAudioCodec:u,filterVideoCodec:h}=t,{useXR:f}=r,m=[],E=[],S=[],y=[],A=!1,T=!1;if($t.parse(e).mediaDescriptions.forEach(O=>{i&&i!==O.attributes.direction||(O.media.mediaType!=="video"||A||(E=O.attributes.payloads,y=O.attributes.extmaps,A=!0),O.media.mediaType!=="audio"||T||(m=O.attributes.payloads,S=O.attributes.extmaps,T=!0))}),!y||E.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!S||m.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(E.forEach(O=>{var P;(P=O.rtpMap)!==null&&P!==void 0&&P.clockRate&&(O.rtpMap.clockRate=parseInt(O.rtpMap.clockRate)),f&&O.rtcpFeedbacks.push({type:"rrtr"})}),m.forEach(O=>{var P;(P=O.rtpMap)!==null&&P!==void 0&&P.clockRate&&(O.rtpMap.clockRate=parseInt(O.rtpMap.clockRate)),f&&O.rtcpFeedbacks.push({type:"rrtr"})}),s&&(m=m.filter(O=>{var P;return((P=O.rtpMap)===null||P===void 0?void 0:P.encodingName.toLowerCase())!=="rtx"}),E=E.filter(O=>{var P;return((P=O.rtpMap)===null||P===void 0?void 0:P.encodingName.toLowerCase())!=="rtx"})),c&&(E=E.filter(O=>{var P;return!/(red)|(ulpfec)|(flexfec)/i.test(((P=O.rtpMap)===null||P===void 0?void 0:P.encodingName)||"")})),l&&(m=m.filter(O=>{var P;return!/(red)|(ulpfec)|(flexfec)/i.test(((P=O.rtpMap)===null||P===void 0?void 0:P.encodingName)||"")})),u&&(u==null?void 0:u.length)>0&&(m=m.filter(O=>{var P;return ge(u).call(u,((P=O.rtpMap)===null||P===void 0?void 0:P.encodingName.toLowerCase())||"")})),h&&(h==null?void 0:h.length)>0){let O=E.filter(P=>{var F;return ge(h).call(h,((F=P.rtpMap)===null||F===void 0?void 0:F.encodingName.toLowerCase())||"")});E=O.concat(s?[]:d0(O,E))}let w=x("UNSUPPORTED_VIDEO_CODEC");return w&&w.length>0&&(E=E.filter(O=>!(O.rtpMap&&ge(w).call(w,O.rtpMap.encodingName.toLowerCase())))),{audioCodecs:m,videoCodecs:E,audioExtensions:S,videoExtensions:y}}function Bs(e){let t=$t.parse(e),r,i;for(let s of t.mediaDescriptions){if(!r){let c=s.attributes.iceUfrag,l=s.attributes.icePwd;if(!c||!l)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:c,icePwd:l}}if(!i){let c=s.attributes.fingerprints;c.length>0&&(i={fingerprints:c})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:i}}function s0(e,t){let r=[],i=e.attributes.ssrcGroups.filter(l=>l.semantic==="FID"),s=e.attributes.ssrcGroups.find(l=>l.semantic==="SIM"),c=e.attributes.ssrcs;if(s)s.ssrcIds.forEach(l=>{var u;let h=(u=i.find(f=>f.ssrcIds[0]===l))===null||u===void 0?void 0:u.ssrcIds[1];r.push({ssrcId:l,rtx:t?h:void 0})});else if(i.length>0){let l=i[0].ssrcIds[0],u=i[0].ssrcIds[1];r.push({ssrcId:l,rtx:t?u:void 0})}else{if(c.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:c[0].ssrcId})}return r}function hV(e,t){let{cname:r}=e,i;t&&t.ip&&typeof t.port=="number"?(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):i=e.iceParameters.candidates.map(u=>({foundation:u.foundation,componentId:"1",transport:u.protocol,priority:u.priority.toString(),connectionAddress:u.ip,port:u.port.toString(),type:u.type,extension:{}}));let s={fingerprints:e.dtlsParameters.fingerprints.map(u=>({hashFunction:u.algorithm,fingerprint:u.fingerprint}))},c={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},l;switch(e.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}return{dtlsParameters:s,iceParameters:c,candidates:i,rtpCapabilities:ch(e.rtpCapabilities),setup:l,cname:r}}function io(e,t,r){let i=[],s=[];return e.forEach(c=>{let{ssrcId:l,rtx:u}=c,h=kt(8,"track-"),f={ssrcId:l,attributes:uV({label:h,mslabel:r=r||kt(10,""),msid:"".concat(r," ").concat(h)},t&&{cname:t})};if(i.push(f),u!==void 0){let m={ssrcId:u,attributes:uV({label:h,mslabel:r,msid:"".concat(r," ").concat(h)},t&&{cname:t})};i.push(m),s.push({semantic:"FID",ssrcIds:[l,u]})}}),e.length>1&&s.push({semantic:"SIM",ssrcIds:e.map(c=>{let{ssrcId:l}=c;return l})}),{ssrcs:i,ssrcGroups:s}}function rl(e,t){t instanceof lr&&e.attributes.payloads.forEach(r=>{var i;let s=(i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";let c=t._encoderConfig;c&&s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(c.bitrate&&!Dt()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*c.bitrate))),c.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(c.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(c.sampleRate)),c.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"))})}function Cg(e){let t=e.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function Rg(e,t){var r;if(!(t instanceof Lt&&t._encoderConfig&&t._hints.indexOf(Ft.SCREEN_TRACK)===-1))return;let i=t._encoderConfig;at().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(s=>{var c,l;ge(c=["h264","h265","vp8","vp9","av1"]).call(c,((l=s.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),at().supportMinBitrate&&!ge(r=t._hints).call(r,Ft.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(s=>{var c,l;ge(c=["h264","h265","vp8","vp9","av1"]).call(c,((l=s.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(x("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function a0(e){if(e.media.mediaType!=="video")return;let t=dt();if(t.name!==yt.SAFARI&&t.os!==Yr.IOS)return;let r=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));r!==-1&&e.attributes.extmaps.splice(r,1)}function ah(e,t,r){if(!t)return;let i,s;if(e.media.mediaType==="video"?(i=r.videoExtensions,s=r.videoCodecs):(i=r.audioExtensions,s=r.audioCodecs),t.twcc===!0){let c=i.find(l=>l.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");c&&(e.attributes.extmaps.find(l=>l.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:c.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(l,u){return u.filter(h=>!!l.find(f=>f.payloadType===h.payloadType&&!!f.rtcpFeedbacks.find(m=>m.type==="transport-cc")))}(s,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(u=>u.type==="transport-cc")||l.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){let c=e.attributes.extmaps.findIndex(l=>l.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(l=>{let u=l.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}if(t.remb===!0){let c=i.find(l=>l.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");c&&(e.attributes.extmaps.find(l=>l.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:c.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(l,u){return u.filter(h=>!!l.find(f=>f.payloadType===h.payloadType&&!!f.rtcpFeedbacks.find(m=>m.type==="goog-remb")))}(s,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(u=>u.type==="goog-remb")||l.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){let c=e.attributes.extmaps.findIndex(l=>l.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(l=>{let u=l.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}}function c0(e,t,r){if(Dt()||e.media.mediaType!=="video"||!(t instanceof Lt)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!x("SIMULCAST")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let i=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,s=e.attributes.ssrcs[0],c=e.attributes.ssrcGroups.find(u=>u.semantic==="FID"&&u.ssrcIds[0]===s.ssrcId),l={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let u=1;u<i;u++)e.attributes.ssrcs.push({ssrcId:s.ssrcId+u,attributes:Vt(s.attributes)}),l.ssrcIds.push(s.ssrcId+u),c&&(e.attributes.ssrcs.push({ssrcId:c.ssrcIds[1]+u,attributes:Vt(s.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+u,c.ssrcIds[1]+u]}));e.attributes.ssrcGroups.unshift(l)}async function l0(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});let i=(await r.createOffer()).sdp,{send:s,recv:c,sendrecv:l}=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0,m=Uf(f,u,h,"sendonly"),E=Uf(f,u,h,"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ls(m,E,"videoExtensions",S,y,A),ls(m,E,"videoCodecs",S,y,A),ls(m,E,"audioExtensions",S,y,A),ls(m,E,"audioCodecs",S,y,A),x("RAISE_H264_BASELINE_PRIORITY")){let T=A.videoCodecs.findIndex(w=>{var O,P;return((O=w.rtpMap)===null||O===void 0?void 0:O.encodingName.toLocaleLowerCase())==="h264"&&((P=w.fmtp)===null||P===void 0?void 0:P.parameters["profile-level-id"])==="42001f"});if(T!==-1){let w=A.videoCodecs.findIndex(O=>{var P;return((P=O.rtpMap)===null||P===void 0?void 0:P.encodingName.toLocaleLowerCase())==="h264"});if(w<T){v.debug("raising H264 baseline profile priority");let O=A.videoCodecs[T];A.videoCodecs.splice(T,1),A.videoCodecs.splice(w,0,O)}w!==-1&&(y.videoCodecs=y.videoCodecs.filter(O=>{var P,F;return!(((P=O.rtpMap)===null||P===void 0?void 0:P.encodingName.toLocaleLowerCase())==="h264"&&((F=O.fmtp)===null||F===void 0?void 0:F.parameters["profile-level-id"])!=="42001f")})),w!==-1&&x("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(O=>{var P,F;return!(((P=O.rtpMap)===null||P===void 0?void 0:P.encodingName.toLocaleLowerCase())==="h264"&&((F=O.fmtp)===null||F===void 0?void 0:F.parameters["profile-level-id"])!=="42001f")}))}}return{send:S,recv:y,sendrecv:A}}(e,t,i);try{r.close()}catch{}return{send:s,recv:c,sendrecv:l}}function pV(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Uf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ls(e,t,"videoExtensions",r,i,s),ls(e,t,"videoCodecs",r,i,s),ls(e,t,"audioExtensions",r,i,s),ls(e,t,"audioCodecs",r,i,s),x("RAISE_H264_BASELINE_PRIORITY")){let c=s.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]==="42001f");if(c!==-1){let l=s.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(l<c){v.debug("raising H264 baseline profile priority");let u=s.videoCodecs[c];s.videoCodecs.splice(c,1),s.videoCodecs.splice(l,0,u)}l!==-1&&(i.videoCodecs=i.videoCodecs.filter(u=>!(u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:i,sendrecv:s}}function ls(e,t,r,i,s,c){if(r==="videoExtensions"||r==="audioExtensions"){let l=[];return e[r].forEach(u=>{t[r].some((h,f)=>{if(u.entry===h.entry&&u.extensionName===h.extensionName)return l.push(f),!0})?c[r].push(u):i[r].push(u)}),void t[r].forEach((u,h)=>{l.indexOf(h)===-1&&s[r].push(u)})}if(r==="videoCodecs"||r==="audioCodecs"){let l=[];return e[r].forEach(u=>{t[r].some((h,f)=>{if(u.payloadType===h.payloadType&&JSON.stringify(u)===JSON.stringify(h))return l.push(f),!0})?c[r].push(u):i[r].push(u)}),void t[r].forEach((u,h)=>{l.indexOf(h)===-1&&s[r].push(u)})}}function ch(e){let{send:t,recv:r,sendrecv:i}=e;if(!i){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let s,c;return t?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...t.audioCodecs,...i.audioCodecs],s.videoCodecs=[...t.videoCodecs,...i.videoCodecs],s.audioExtensions=[...t.audioExtensions,...i.audioExtensions],s.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):s=i,r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...i.audioCodecs],c.videoCodecs=[...r.videoCodecs,...i.videoCodecs],c.audioExtensions=[...r.audioExtensions,...i.audioExtensions],c.videoExtensions=[...r.videoExtensions,...i.videoExtensions]):c=i,{send:s,recv:c}}function Ws(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function wg(e){e.mediaDescriptions.forEach(t=>{t.media.mediaType!=="video"&&t.media.mediaType!=="audio"||t.attributes.payloads.forEach(r=>{r.rtcpFeedbacks.findIndex(i=>i.type==="rrtr")===-1&&r.rtcpFeedbacks.push({type:"rrtr"})})})}function vd(e,t,r,i){let s=[];if(e===Ie.VIDEO){if(x("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(s=t.videoCodecs.filter(c=>{var l;return ge(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,i)&&c&&c.fmtp&&c.fmtp.parameters["profile-level-id"]===x("H264_PROFILE_LEVEL_ID")})),!Array.isArray(s)||s.length===0){let c=[],l=[],u=[],h=[];if(r.videoCodecs.forEach(f=>{let m=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"";ge(m).call(m,i)?c.push(f):ge(m).call(m,"vp9")?l.push(f):ge(m).call(m,"vp8")?u.push(f):ge(m).call(m,"h264")&&h.push(f)}),c.length===0){let f="";l.length!==0?(c=l,f="vp9"):u.length!==0?(c=u,f="vp8"):h.length!==0&&(c=h,f="h264"),v.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(f))}c.length!==0&&(s=t.videoCodecs.filter(f=>c.some(m=>m.payloadType===f.payloadType)))}if(s.length===0&&(v.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),s=t.videoCodecs),x("USE_PUB_RTX")||x("USE_SUB_RTX")){let c=d0(s,t.videoCodecs);s=[...s,...c]}}else s=t.audioCodecs.filter(c=>{var l;return ge(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,i)}),s.length===0&&(v.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),s=t.audioCodecs.filter(c=>{var l;return ge(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,"opus")}));return s}function d0(e,t){let r=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&ge(r).call(r,i.fmtp&&i.fmtp.parameters.apt))}let fV=class{get localCapabilities(){return Vt(this._localCapabilities)}get rtpCapabilities(){return Vt(this._rtpCapabilities)}get candidates(){return Vt(this._candidates)}get iceParameters(){return Vt(this._iceParameters)}get dtlsParameters(){return Vt(this._dtlsParameters)}constructor(e){b(this,"sessionDesc",void 0),b(this,"_localCapabilities",void 0),b(this,"_rtpCapabilities",void 0),b(this,"_candidates",void 0),b(this,"_iceParameters",void 0),b(this,"_dtlsParameters",void 0),b(this,"setup",void 0),b(this,"currentMidIndex",void 0),b(this,"cname","o/i14u9pJrxRKAsu"),b(this,"firefoxSsrcMidMap",new Map),e=Vt(e);let{remoteIceParameters:t,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:s,localCapabilities:c,direction:l,setup:u,videoCodec:h,audioCodec:f}=e,m;this.setup=u,m=l===Zn.RECEIVE_ONLY?$t.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):$t.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=s,this._candidates=i,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=c;let E=l===Zn.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,S=l===Zn.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,y=l===Zn.RECEIVE_ONLY?s.send.videoCodecs:vd(Ie.VIDEO,E,S,h),A=l===Zn.RECEIVE_ONLY?s.send.audioCodecs:vd(Ie.AUDIO,E,S,f);for(let T of m.mediaDescriptions)T.attributes.iceUfrag=t.iceUfrag,T.attributes.icePwd=t.icePwd,T.attributes.fingerprints=r.fingerprints,T.attributes.candidates=i,T.attributes.setup=this.setup,T.media.mediaType==="application"&&(T.attributes.sctpPort="5000"),T.media.mediaType==="video"&&(T.media.fmts=y.map(w=>w.payloadType.toString(10)),T.attributes.payloads=y,T.attributes.extmaps=E.videoExtensions),T.media.mediaType==="audio"&&(T.media.fmts=A.map(w=>w.payloadType.toString(10)),T.attributes.payloads=A,T.attributes.extmaps=E.audioExtensions,Ws(T));this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return $t.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,i,s){r=r.replace(/ /g,"-");let{ssrcs:c,ssrcGroups:l}=io(t,this.cname,x("SYNC_GROUP")?r:void 0),u=this.findPreloadMediaDesc(c);if(u){if(Dt()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,u.attributes.mid),s&&(s.twcc||s.remb)){let h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,s),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{let h=this.findAvailableMediaIndex(e,c,i),f;return h===-1?(f=this.createOrRecycleSendMedia(e,c,l,"sendonly",i,s),this.updateBundleMids()):(f=Vt(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="sendonly",f.attributes.ssrcs=c,f.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(f,s)),Dt()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,f.attributes.mid),{needExchangeSDP:!0,mid:f.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){let i=[];return e.forEach(s=>{let c=s._mediaStreamTrack.kind,l=this.findAvailableRecvMediaIndex(c),u,h=!1;l===-1?(h=!0,u=this.createOrRecycleRecvMedia(s,[],"recvonly",t,r),this.updateBundleMids()):(u=Vt(this.sessionDesc.mediaDescriptions[l]),u.attributes.direction="recvonly"),i.push({mid:u.attributes.mid,needCreateTransceiver:h})}),i}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:r,address:i,port:s,type:c,relatedAddress:l,relatedPort:u,priority:h}=new RTCIceCandidate(e),f={foundation:t??"",componentId:"1",transport:r??"",priority:h?h+"":"",connectionAddress:i??"",port:s?s+"":"",type:c?c+"":"",relAddr:l??"",relPort:u?u+"":"",extension:{}};this.candidates.some(m=>m.priority===f.priority&&m.connectionAddress===f.connectionAddress&&m.port===f.port)||(this._candidates.push(f),this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,i,s){let c=e._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,u=vd(c,l,this.localCapabilities.send,c===Ie.AUDIO?s:i),h=c===Ie.VIDEO?l.videoExtensions:l.audioExtensions,f="".concat(++this.currentMidIndex),m={media:{mediaType:c,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};m=this.mungRecvMediaDsec(m,e);let E=this.findFirstClosedMedia(c);if(E){let S=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[S]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>ge(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>ge(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(i=>{let s=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Dt()){if(s){let c=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(c||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!c||c!==i.attributes.mid)}return!1}return s&&i.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=Vt(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,i,s,c){let l=this.rtpCapabilities.send,u=e===Ie.VIDEO?l.videoCodecs:l.audioCodecs,h=e===Ie.VIDEO?l.videoExtensions:l.audioExtensions;Dt()&&(s="".concat(++this.currentMidIndex));let f={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:s}};f=this.mungSendMediaDesc(f,c);let m=this.findFirstClosedMedia(e);if(m){let E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}mungRecvMediaDsec(e,t,r){let i=Vt(e);return Cg(i),rl(i,t),Rg(i,t),a0(i),ah(i,r,this.localCapabilities.send),i}mungSendMediaDesc(e,t){let r=Vt(e);return ah(r,t,this.localCapabilities.recv),Ws(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(r!==-1){let i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Dt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},Tre=["sdp"];var Wt;function mV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function nl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let _V=(Wt=class Rh extends $L{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,i){super(t,r),b(this,"direction",void 0),b(this,"name",void 0),b(this,"store",void 0),b(this,"spec",void 0),b(this,"peerConnection",void 0),b(this,"initialOffer",void 0),b(this,"transport",void 0),b(this,"statsFilter",void 0),b(this,"localCandidateCount",0),b(this,"_isInRestartIce",!1),b(this,"mutex",new rn("P2PConnection-mutex")),b(this,"onLocalCandidate",void 0),b(this,"remoteSDP",void 0),b(this,"pendingCandidates",[]),b(this,"localCapabilities",void 0),b(this,"isReady",!1),b(this,"restartCnt",0),b(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.peerConnection=new RTCPeerConnection(Rh.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Zn.SEND_ONLY,this.name=this.direction===Zn.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Tg(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,Dt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let r=await l0();if(this.localCapabilities=ch(r),t){let{sdp:i}=t,s=gre(t,Tre),c=function(){let m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=Uf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ls(E,m,"videoExtensions",S,y,A),ls(E,m,"videoCodecs",S,y,A),ls(E,m,"audioExtensions",S,y,A),ls(E,m,"audioCodecs",S,y,A),x("RAISE_H264_BASELINE_PRIORITY")){let T=A.videoCodecs.findIndex(w=>w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&w.fmtp&&w.fmtp.parameters["profile-level-id"]==="42001f");if(T!==-1){let w=A.videoCodecs.findIndex(O=>O.rtpMap&&O.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(w<T){v.debug("raising H264 baseline profile priority");let O=A.videoCodecs[T];A.videoCodecs.splice(T,1),A.videoCodecs.splice(w,0,O)}w!==-1&&x("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(O=>!(O.rtpMap&&O.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&O.fmtp&&O.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:S,recv:y,sendrecv:A}}({},{},i);this.remoteSDP=new fV({remoteIceParameters:s.iceParameters,remoteDtlsParameters:s.dtlsParameters,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let l=await this.peerConnection.createAnswer();if(!l.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let u=Bs(l.sdp);await this.peerConnection.setLocalDescription(l);let h=await pV({},{},l.sdp);this.localCapabilities=ch(h);let f=this.peerConnection.getTransceivers()[0];return f!=null&&f.receiver&&f.receiver.transport&&this.tryBindTransportEvents(f.receiver.transport),nl(nl({},u),{},{sdp:l.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let s=Bs(i.sdp);return this.initialOffer=i,nl(nl({},s),{},{sdp:i.sdp})}}catch(r){throw new ee(N.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:r,iceParameters:i,dtlsParameters:s}=t,c=await pV({},{},r);this.remoteSDP=new fV({remoteIceParameters:i,remoteDtlsParameters:s,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let l=this.peerConnection.getTransceivers()[0];l!=null&&l.sender&&l.sender.transport&&this.tryBindTransportEvents(l.sender.transport)}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new ee(N.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,i){var s=this;return Ui(function*(){let c=yield Ye(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let l=[],u=s.remoteSDP.receive(t,r,i);t.forEach((w,O)=>{if(u[O].needCreateTransceiver){let P=s.peerConnection.addTransceiver(w._mediaStreamTrack,{direction:"sendonly"});l.push(P),w._updateRtpTransceiver(P)}else{let P=s.peerConnection.getTransceivers().find(F=>F.mid===u[O].mid);if(!P)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(u[O].mid));l.push(P),w._updateRtpTransceiver(P)}}),Dt()&&x("SIMULCAST")===!0&&(yield Ye(s.applySimulcastForFirefox(l,t)));let h=u.map(w=>w.mid),f=yield Ye(s.peerConnection.createOffer()),m=s.mungSendOfferSDP(f.sdp,t,h),E=$t.parse(m),S=h.map(w=>{let O=E.mediaDescriptions.find(P=>P.attributes.mid===w);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return s0(O,x("USE_PUB_RTX"))}),y=l.map((w,O)=>{let P=h[O];return{localSSRC:S[O],id:P}});yield Ye(s.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield y}catch(w){let O=s.remoteSDP.toString();throw yield Ye(s.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Ye(s.peerConnection.setRemoteDescription({type:"answer",sdp:O})),yield Ye(s.stopSending(h,!0)),w}yield Ye(s.applySimulcastEncodings(l,t)),yield Ye(s.applySendEncodings(l,t));let A=s.remoteSDP.toString(),T=s.logSDPExchange(m,"offer","local","send");return T==null||T(A),yield Ye(s.setRemoteDescription({type:"answer",sdp:A})),l.map((w,O)=>{let P=h[O];return{localSSRC:S[O],id:P}})}catch(l){throw l instanceof ee?l:new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{c()}})()}async stopSending(t,r){let i=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let s=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length (".concat(s.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));s.map(h=>{var f;h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});let c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);let u=this.remoteSDP.toString();l==null||l(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,r,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:c,needExchangeSDP:l}=this.remoteSDP.send(t,r,i,s);if(l){let h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});let m=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(m.sdp,c,t);f==null||f(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u||u.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,mid:u.mid,transceiver:u}}catch(c){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async mockReceive(t,r,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:c,needExchangeSDP:l}=this.remoteSDP.send(t,r,i,s);if(l){let u=this.remoteSDP.toString(),h=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});let f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,c,t);h==null||h(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(c){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});let s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===id.Auto&&(this.store.p2pTransport=id.SdRtn,at().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Rh.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,at().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Rh.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:i}=Bs(r.sdp);return this.store.descriptionStart(),this.direction===Zn.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Zn.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:i}=Bs(r.sdp);return await this.peerConnection.setLocalDescription(r),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let c=this.remoteSDP.toString(),l=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),l==null||l(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new ee(N.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){let i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(r)?Dt()||await this.applySimulcastEncodings(i,[r]):await this.applySendEncodings(i,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let i=this.peerConnection.getTransceivers().find(s=>s.mid===r);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:i,remote:s}=r.getSelectedCandidatePair();return{local:nl(nl({},ba),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:nl(nl({},ba),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;ge(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s={iceServers:[]};var c;return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Au(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...Rh.turnServerConfigToIceServers(t.turnServer.servers,r,i)),x("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Rh.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,i)),ge(c=[id.Relay,id.SdRtn]).call(c,r)&&(s.iceTransportPolicy="relay"),x("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(l=>{l.forceturn&&(s.iceTransportPolicy="relay")}))),x("ENABLE_ENCODED_TRANSFORM")&&at().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),v.debug("P2PConnection p2pTransport is ".concat(r)),s}static turnServerConfigToIceServers(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=[],c=t.filter(u=>u.tcpport);v.debug("P2PConnection turnServers is ".concat(c,", current index is ").concat(i));let l=c.length>i?c[i]:c[0];switch(r){case id.SdRtn:let u=t.filter(f=>{var m;return ge(m=f.username).call(m,"glb:")&&f.turnServerURL==f.turnServerURL}),h=u.length>i?u[i]:u[0];h&&(s.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(Yc(h.turnServerURL),":").concat(h.tcpport,"?transport=udp")}),s.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Yc(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;case id.Relay:l&&(s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Yc(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;default:l&&(s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Yc(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}),s.push({username:l.username,credential:l.password,credentialType:"password",urls:"stun:".concat(l.turnServerURL,":").concat(l.tcpport)}))}return s}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};let r=t.iceTransport;r&&(r.onstatechange=()=>{let i=t==null?void 0:t.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:i,remote:s}=r.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var i;if(r||(r=this.peerConnection.getSenders().find(m=>m.track===t._mediaStreamTrack)),!r)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!at().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let s={},c={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(t._encoderConfig){var l;let{bitrateMax:m,frameRate:E,scaleResolutionDownBy:S}=t._encoderConfig;m&&(c.maxBitrate=1e3*m),ge(l=t._hints).call(l,Ft.LOW_STREAM)&&(E&&(c.maxFramerate=vi(E)),S&&S>=1&&(c.scaleResolutionDownBy=S))}if(x("DSCP_TYPE")&&Bc()){var u;let m=x("DSCP_TYPE");ge(u=["very-low","low","medium","high"]).call(u,m)&&(c.networkPriority=m)}let h=r.getParameters(),f=(i=h.encodings)===null||i===void 0?void 0:i[0];Dt()&&!f&&(s.encodings=[c]),f&&Object.assign(f,c),Object.assign(h,s),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await r.setParameters(h)}async applySendEncodings(t,r){try{if(!at().supportSetRtpSenderParameters||t.length!==r.length)return;for(let i=0;i<t.length;i++){let s=t[i],c=r[i];c instanceof Lt&&!this.isVP8Simulcast(c)&&await this.updateRtpSenderEncodings(c,s.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,i){let s=$t.parse(t);return r.forEach((c,l)=>{let u=i[l],h=s.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(rl(h,c),c0(h,c,this.store.codec))}),$t.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,r,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let h=0;h<t.length;h++){var i,s,c,l,u;let f=t[h],m=r[h];if(m instanceof Lt&&!ge(i=m._hints).call(i,Ft.LOW_STREAM)&&(s=m._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=m._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=m._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=m._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){let E={},S={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];let y=f.sender.getParameters();await f.sender.setParameters(Object.assign(y,E))}}}async applySimulcastEncodings(t,r){if(!Dt()&&t.length===r.length)for(let i=0;i<t.length;i++){let s=r[i];if(s instanceof Lt&&this.isVP8Simulcast(s)){let c=t[i],l={},u={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];let h=c.sender.getParameters();await c.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(t){var r,i,s,c,l;return!!(t instanceof Lt&&x("SIMULCAST")&&this.store.codec==="vp8"&&!ge(r=t._hints).call(r,Ft.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,r,i,s){if(x("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(r," SDP during P2PConnection.").concat(s,`
`),t),r==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",s)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(l=>{l.direction="inactive"});let i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);let c=this.remoteSDP.toString();s==null||s(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async l=>{l.direction="sendonly"});let i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);let c=this.remoteSDP.toString();s==null||s(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var i,s;if(r=(i=r)!==null&&i!==void 0?i:(s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp){var c;let l=(c=$t.parse(r).mediaDescriptions.find(u=>u.attributes.mid===t))===null||c===void 0?void 0:c.attributes.ssrcs;return l==null?void 0:l[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),ge(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,i){let s=$t.parse(t),c=s.mediaDescriptions.find(l=>l.attributes.mid===r);return c&&i===Ie.AUDIO&&c.media.mediaType==="audio"&&Ws(c),$t.print(s)}},fe(Wt.prototype,"establish",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"establish"),Wt.prototype),fe(Wt.prototype,"connect",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"connect"),Wt.prototype),fe(Wt.prototype,"receive",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"receive"),Wt.prototype),fe(Wt.prototype,"mockReceive",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"mockReceive"),Wt.prototype),fe(Wt.prototype,"stopReceiving",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"stopReceiving"),Wt.prototype),fe(Wt.prototype,"restartICE",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"restartICE"),Wt.prototype),fe(Wt.prototype,"close",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"close"),Wt.prototype),fe(Wt.prototype,"updateEncoderConfig",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"updateEncoderConfig"),Wt.prototype),fe(Wt.prototype,"updateSendParameters",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"updateSendParameters"),Wt.prototype),fe(Wt.prototype,"replaceTrack",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"replaceTrack"),Wt.prototype),fe(Wt.prototype,"muteLocal",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"muteLocal"),Wt.prototype),fe(Wt.prototype,"unmuteLocal",[ds],Object.getOwnPropertyDescriptor(Wt.prototype,"unmuteLocal"),Wt.prototype),Wt);function ds(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let s=this.mutex,c=await s.lock("From P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{c()}},r}function u0(e,t){let r=document.createElement("video"),i=document.createElement("canvas");r.setAttribute("style","display:none"),i.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),i.width=vi(t.width),i.height=vi(t.height);let s=vi(t.framerate||15);document.body.append(r),document.body.append(i);let c=e._mediaStreamTrack;r.srcObject=new MediaStream([c]),r.play();let l=i.getContext("2d");if(!l)throw new H(N.UNEXPECTED_ERROR,"can not get canvas context");let u=at(),h=i.captureStream(u.supportRequestFrame?0:s).getVideoTracks()[0];h.canvas||(h.canvas=i),i.startCapture=()=>{if(!r)return i.stopCapture&&i.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){let m=r.videoWidth,E=r.videoHeight/m,S=i.width*E;Math.abs(S-i.height)>=2&&(v.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(S)),i.height=S)}l.drawImage(r,0,0,i.width,i.height),h.requestFrame&&h.requestFrame(),c!==e._mediaStreamTrack&&(c=e._mediaStreamTrack,r.srcObject=new MediaStream([c]))},i.stopCapture=zw(()=>i.startCapture&&i.startCapture(),s);let f=h.stop;return h.stop=()=>{f.call(h),r&&(r.remove(),r.srcObject=null,r=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),v.debug("clean low stream renderer")},h}var Ig=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(Ig||{}),Qr=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(Qr||{}),Td=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Td||{}),Ln=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(Ln||{}),Cd=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(Cd||{}),EV=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(EV||{}),il=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(il||{}),us=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(us||{}),gV=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(gV||{}),Co=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(Co||{});let sc=1e3,Rd=3;function Xe(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function SV(e){let t={[Co.CONN_TYPE]:0,[Co.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[Co.CONN_TYPE]=1),r==="tcp"&&(t[Co.CONN_TYPE]=3),r==="tls"&&(t[Co.CONN_TYPE]=4);break}case"srflx":t[Co.CONN_TYPE]=2}return t}function yV(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class vV extends Jt{constructor(t){super(),b(this,"store",void 0),b(this,"uploadWRTCStatsTimer",void 0),b(this,"uploadOutboundDenoiserStatsTimer",void 0),b(this,"uploadExtStatsTimer",void 0),b(this,"uploadExtUsageStatsTimer",void 0),b(this,"uploadInboundExtStatsTimer",void 0),b(this,"requestStats",void 0),b(this,"requestTransportStats",void 0),b(this,"requestLocalMedia",void 0),b(this,"requestRemoteMedia",void 0),b(this,"requestAllTracks",void 0),b(this,"requestVideoIsReady",void 0),b(this,"requestUploadStats",void 0),b(this,"requestUpload",void 0),b(this,"uploadOutboundStarted",!1),b(this,"uploadInboundStarted",!1),b(this,"uploadTransportStarted",!1),b(this,"uploadExtensionUsageStarted",!1),b(this,"lastRecvStats",void 0),b(this,"lastSendStats",void 0),b(this,"lastFullRecvStats",void 0),b(this,"lastFullSendStats",void 0),b(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let r,i;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(i=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!i&&this.uploadInboundStarted&&(i=this.requestStats(!0)),r||i){let s={};if(this.uploadTransportStarted&&r){let c=this.getTransportStats(r,i,t);c&&(s.misc=[c])}if(this.uploadOutboundStarted&&r){let c=this.getOutboundStats(r,t?this.lastSendStats:this.lastFullSendStats,t);c&&(s.outbound=[c])}if(this.uploadInboundStarted&&i){let c=this.getInboundStats(i,t?this.lastRecvStats:this.lastFullRecvStats,t);c&&(s.inbound=c)}this.requestUploadStats(s)}this.lastRecvStats=i,this.lastSendStats=r,t||(this.lastFullRecvStats=i,this.lastFullSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(t!==Rd),++t===Rd+1&&(t=1)},sc)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,r,i){if(!this.requestStats)return;if(i)return t.rtt==null?void 0:{addition:{[Co.RTT]:t.rtt,[Co.CONN_TYPE]:void 0}};let s=SV(t);if(this.store.useP2P){if(r){let c=SV(r);s[Co.CONN_TYPE]+=c[Co.CONN_TYPE]<<3}s[Co.CONN_TYPE]+=110}else s[Co.CONN_TYPE]+=100;return{addition:s}}getOutboundStats(t,r,i){if(!this.requestUploadStats||!this.requestLocalMedia)return;let s=this.requestLocalMedia();if(!s||s.length===0)return;let c,l,u;return s.forEach(h=>{let[f,{track:m,ssrcs:E}]=h;switch(f){case ce.LocalVideoLowTrack:case ce.LocalVideoTrack:if(f===ce.LocalVideoTrack){let S=function(T,w,O,P,F){let W=w.videoSend.find(we=>we.ssrc===T);if(!W)return;let K={},{sentFrame:X,inputFrame:ie}=W;if(ie&&X){let we=ie.frameRate,nt=X.frameRate;K[Qr.FREEZE]=function(gt,jt){let wr=!0;return wr=!(gt<=5)&&(gt<=10?jt<3:gt<=20?jt<4:jt<5),wr}(we,nt)?1:0}if(Xe(K,Qr.QP_SUM,W.qpSumPerFrame),F)return K;switch(X&&(Xe(K,Qr.HEIGHT,X.height),Xe(K,Qr.WIDTH,X.width),Xe(K,Qr.FRAME_RATE,X.frameRate)),K[Qr.DISABLED]=P._originMediaStreamTrack&&!P._originMediaStreamTrack.enabled||P._mediaStreamTrack&&!P._mediaStreamTrack.enabled?1:0,W.adaptionChangeReason){case"none":K[Qr.ADAPTATION]=0;break;case"cpu":K[Qr.ADAPTATION]=1;break;case"bandwidth":K[Qr.ADAPTATION]=2;break;case"other":K[Qr.ADAPTATION]=3}let ae=0;W.adaptionChangeReason&&(ae+=yV(W.adaptionChangeReason)),w.qualityLimitationReason&&(ae+=yV(w.qualityLimitationReason)<<3),K[Qr.ADAPTATION]=ae,K[Qr.PLAYER_STATUS]=Hw[P._player?P._player.videoElementStatus:"uninit"],Xe(K,Qr.NACKS,W.nacksCount),Xe(K,Qr.PLIS,W.plisCount),Xe(K,Qr.FIRS,W.firsCount),Xe(K,Qr.AVG_ENCODE,W.avgEncodeMs);let le=O&&O.videoSend.find(we=>we.ssrc===T);if(le){let we=F?sc:sc*Rd;le.timestamp&&W.timestamp&&(we=W.timestamp-le.timestamp),le.packets!=null&&W.packets!=null&&Xe(K,Qr.PACKAGE_RATE,1e3*(W.packets-le.packets)/we),W.packetsLost!=null&&le.packetsLost!=null&&Xe(K,Qr.PACKAGE_LOST,W.packetsLost-le.packetsLost),le.bytes!=null&&W.bytes!=null&&Xe(K,Qr.BITRATE,8*(W.bytes-le.bytes)/we)}return K}(E[0].ssrcId,t,r,m,i),y=i?null:function(T,w,O){let P=w.videoSend.find(ae=>ae.ssrc===T);if(!P)return null;let F={},W=P.inputFrame,K=W&&W.height||O&&O.videoHeight||0,X=W&&W.width||O&&O.videoWidth||0,ie=W&&W.frameRate||0;return Xe(F,Ig.HEIGHT,K),Xe(F,Ig.WIDTH,X),Xe(F,Ig.FRAME_RATE,ie),F}(E[0].ssrcId,t,m),A=i?null:function(T){let w={};return Xe(w,Qr.RETRANSMIT,T.bitrate.retransmit),Xe(w,Qr.TARGET_ENCODED,T.bitrate.targetEncoded),Xe(w,Qr.ACTUAL_ENCODED,T.bitrate.actualEncoded),Xe(w,Qr.TRANSMIT,T.bitrate.transmit),Xe(w,Qr.BANDWIDTH,T.sendBandwidth),w}(t);l=Object.assign({},S,y,A)}else u=i?void 0:function(S,y,A){let T=y.videoSend.find(P=>P.ssrc===S);if(!T)return;let w={},O=T.sentFrame;if(O&&(Xe(w,Td.HEIGHT,O.height),Xe(w,Td.WIDTH,O.width),Xe(w,Td.FRAME_RATE,O.frameRate)),A){let P=A.videoSend.find(F=>F.ssrc===S);if(P){let F=sc*Rd;P.timestamp&&T.timestamp&&(F=T.timestamp-P.timestamp),P.packets!=null&&T.packets!=null&&Xe(w,Td.PACKAGE_RATE,1e3*(T.packets-P.packets)/F),T.packetsLost!=null&&P.packetsLost!=null&&Xe(w,Td.PACKAGE_LOST,T.packetsLost-P.packetsLost),P.bytes!=null&&T.bytes!=null&&Xe(w,Td.BITRATE,8*(T.bytes-P.bytes)/F)}}return w}(E[0].ssrcId,t,r);break;case ce.LocalAudioTrack:c=i?void 0:function(S,y,A,T){let w=y.audioSend.find(K=>K.ssrc===S);if(!w)return;let O={};O[il.DISABLED]=T._originMediaStreamTrack&&!T._originMediaStreamTrack.enabled||T._mediaStreamTrack&&!T._mediaStreamTrack.enabled?1:0;let P=100*T._source.getAccurateVolumeLevel(),F=w.inputLevel;if(F!=null){let K=Math.ceil(50*Math.log10(100*F+1));Xe(O,il.LEVEL,K)}Xe(O,EV.PCM_LEVEL,P),Xe(O,il.AEC_RETURN_LOSS,w.aecReturnLoss),Xe(O,il.AEC_RETURN_LOSS_ENH,w.aecReturnLossEnhancement),O[il.FREEZE]=0;let W=A&&A.audioSend.find(K=>K.ssrc===S);if(W){let K=sc*Rd;W.timestamp&&w.timestamp&&(K=w.timestamp-W.timestamp),W.bytes!=null&&w.bytes!=null&&Xe(O,il.BITRATE,8*(w.bytes-W.bytes)/K),W.packets!=null&&w.packets!=null&&Xe(O,il.PACKAGE_RATE,1e3*(w.packets-W.packets)/K)}return O}(E[0].ssrcId,t,r,m)}}),{high:l,low:u,audio:c}}getInboundStats(t,r,i){if(!this.requestRemoteMedia)return;let s=this.requestRemoteMedia()||[],c=[];return s.forEach(l=>{let[u,h]=l,f={peer:u.uid};if(h.has(Ie.VIDEO)&&u.videoTrack){let m=u._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(u._videoSSRC)||!1,E=u.videoTrack?function(S,y,A,T,w,O,P){var F;let W=y.videoRecv.find(nt=>nt.ssrc===S);if(!W)return;let K={},{receivedFrame:X,outputFrame:ie,decodeFrameRate:ae}=W,le=A&&A.videoRecv.find(nt=>nt.ssrc===S);if(K[Ln.FREEZE]=w&&Vf.isRemoteVideoFreeze(T,W,le)?1:0,Xe(K,Cd.FRAME_RATE_DECODE,ae),Xe(K,Ln.QP_SUM,W.qpSumPerFrame),W.framesRateFirefox&&Xe(K,Ln.FRAME_RATE,W.framesRateFirefox),X&&Xe(K,Ln.FRAME_RATE,X.frameRate),le){let nt=y.timestamp-A.timestamp||(P?sc:Rd*sc);W.packetsLost!=null&&le.packetsLost!=null&&Xe(K,Ln.PACKAGE_LOST,W.packetsLost-le.packetsLost),le.bytes!=null&&W.bytes!=null&&Xe(K,Ln.BITRATE,8*(W.bytes-le.bytes)/nt),le.packets!=null&&W.packets!=null&&Xe(K,Ln.PACKAGE_RATE,1e3*(W.packets-le.packets)/nt)}if(P)return K;X?(Xe(K,Ln.HEIGHT,X.height),Xe(K,Ln.WIDTH,X.width)):T&&(Xe(K,Ln.HEIGHT,T._videoHeight||0),Xe(K,Ln.WIDTH,T._videoWidth||0)),ie&&Xe(K,Cd.FRAME_RATE_OUTPUT,ie.frameRate);let we=(F=T._player)===null||F===void 0?void 0:F.rendFrameRate.toFixed(0);if(we&&Xe(K,Cd.FRAME_RATE_RENDER,+we),Xe(K,Ln.JITTER_BUFFER,W.jitterBufferMs),Xe(K,Ln.CURRENT_DELAY,W.currentDelayMs),Xe(K,Ln.FIRS,W.firsCount),Xe(K,Ln.NACKS,W.nacksCount),Xe(K,Ln.PLIS,W.plisCount),T){K[Ln.DISABLED]=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?0:1;let nt=T._player;if(nt){let{freezeTimeCounterList:gt,renderFreezeAccTime:jt,videoElementStatus:wr}=nt;if(gt&&gt.length>0&&Xe(K,Cd.FREEZE_TIME,gt.splice(0,1)[0]),O&&oc.visibility==="visible"&&wr===Kn.PLAYING&&at().supportRequestVideoFrameCallback){let ir=Math.min(6e3,jt);nt.renderFreezeAccTime=Math.max(0,jt-ir),Xe(K,Cd.FREEZE_TIME_RENDER,ir)}if(typeof W.totalFreezesDuration=="number"){let ir=le&&le.totalFreezesDuration?W.totalFreezesDuration-le.totalFreezesDuration:W.totalFreezesDuration;Xe(K,Cd.FREEZE_DURATION,1e3*ir)}}}if(K[Ln.PLAYER_STATUS]=Hw[T._player?T._player.videoElementStatus:"uninit"],le&&W.totalInterFrameDelay!==void 0&&W.totalSquaredInterFrameDelay!==void 0&&le.totalInterFrameDelay!==void 0&&le.totalSquaredInterFrameDelay!==void 0){let nt=W.totalInterFrameDelay-le.totalInterFrameDelay,gt=W.totalSquaredInterFrameDelay-le.totalSquaredInterFrameDelay,jt=W.framesDecodeCount-le.framesDecodeCount,wr=nt/jt*1e3,ir=Math.round(1e3*Math.sqrt((gt-Math.pow(nt,2)/jt)/jt));!isNaN(ir)&&wr+ir>Math.max(3*wr,wr+150)&&(K[Ln.I_FRAME_DELAY]=ir)}return K}(u._videoSSRC,t,r,u.videoTrack,m===!0,this.needUploadRenderFreezeTime,i):void 0;E&&(f.video=E)}if(h.has(Ie.AUDIO)&&u.audioTrack){let m=u.audioTrack?function(E,S,y,A,T){let w=S.audioRecv.find(le=>le.ssrc===E);if(!w)return;let O={},P=y&&y.audioRecv.find(le=>le.ssrc===E),{receivedFrames:F,droppedFrames:W}=w;var K,X;if(Xe(O,us.JITTER,w.jitterMs),F!=null&&W!=null&&(O[us.FREEZE]=(X=W,(K=F)===0||100*X/K>20?1:0)),P){let le=S.timestamp-y.timestamp||(T?sc:sc*Rd);w.packets!=null&&P.packets!=null&&Xe(O,us.PACKAGE_RATE,1e3*(w.packets-P.packets)/le),P.bytes!=null&&w.bytes!=null&&Xe(O,us.BITRATE,8*(w.bytes-P.bytes)/le),w.packetsLost!=null&&P.packetsLost!=null&&Xe(O,us.PACKAGE_LOST,w.packetsLost-P.packetsLost)}if(T)return O;let ie=100*A._source.getAccurateVolumeLevel(),ae=w.outputLevel;if(ae!=null){let le=Math.ceil(50*Math.log10(100*ae+1));Xe(O,gV.LEVEL,le)}if(Xe(O,us.PCM_LEVEL,ie),A&&(O[us.DISABLED]=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?0:1),Xe(O,us.JITTER_BUFFER,w.jitterBufferMs),Xe(O,us.CURRENT_DELAY,w.jitterBufferMs),O[us.PLAYER_STATUS]=Hw[ci.getPlayerState(A.getTrackId())],P){let le=w.concealedSamples-P.concealedSamples;le>0&&Xe(O,us.CONCEALED_SAMPLES,le)}return O}(u._audioSSRC,t,r,u.audioTrack,i):void 0;m&&(f.audio=m)}(f.video||f.audio)&&c.push(f)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(r=>r instanceof Eg);if(t&&t._external.getDenoiserStats){let r=t._external.getDenoiserStats();r&&this.requestUpload(sd.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[r,i]=t;i.has(Ie.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)}),i.has(Ie.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let r=Date.now(),i={connectionInterval:x("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r},s=[],c=this.requestAllTracks&&this.requestAllTracks()||[];for(let f of c)!f.muted&&f.enabled&&(s=s.concat(await f.getProcessorUsage()));let l=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[f,m]of l)m.has(Ie.VIDEO)&&f.videoTrack&&(s=s.concat(await f.videoTrack.getProcessorUsage())),m.has(Ie.AUDIO)&&f.audioTrack&&(s=s.concat(await f.audioTrack.getProcessorUsage()));if(s.length===0)return;i.details=function(f,m){let E={};for(let{id:T,value:w,level:O,direction:P}of f){var S;let F=(S=m.get(T))!==null&&S!==void 0?S:0,W=w===2?F+x("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:F;var y,A;m.set(T,W),E[T]?(w===2&&(E[T].value=w),O>E[T].level&&(E[T].level=O),P==="remote"&&(E[T].remoteUidCount+=1),E[T].totalTs=(y=m.get(T))!==null&&y!==void 0?y:0):E[T]={value:w,level:O,remoteUidCount:P==="local"?0:1,totalTs:(A=m.get(T))!==null&&A!==void 0?A:0}}return Object.keys(E).map(T=>{let{level:w,value:O,totalTs:P}=E[T];return{id:T,level:w,value:O,totalTs:P}})}(s,t);let u=Date.now(),h=u>r?u:r+1;this.requestUpload&&this.requestUpload(sd.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:h})},x("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class ol{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,r){b(this,"uid",void 0),b(this,"_uintid",void 0),b(this,"_trust_in_room_",!0),b(this,"_trust_audio_enabled_state_",!0),b(this,"_trust_video_enabled_state_",!0),b(this,"_trust_audio_mute_state_",!0),b(this,"_trust_video_mute_state_",!0),b(this,"_audio_muted_",!1),b(this,"_video_muted_",!1),b(this,"_audio_enabled_",!0),b(this,"_video_enabled_",!0),b(this,"_audio_added_",!1),b(this,"_video_added_",!1),b(this,"_is_pre_created",!1),b(this,"_video_pre_subscribed",!1),b(this,"_audio_pre_subscribed",!1),b(this,"_trust_video_stream_added_state_",!0),b(this,"_trust_audio_stream_added_state_",!0),b(this,"_audioTrack",void 0),b(this,"_videoTrack",void 0),b(this,"_dataChannels",[]),b(this,"_audioSSRC",void 0),b(this,"_videoSSRC",void 0),b(this,"_audioOrtc",void 0),b(this,"_videoOrtc",void 0),b(this,"_cname",void 0),b(this,"_rtxSsrcId",void 0),b(this,"_videoMid",void 0),b(this,"_audioMid",void 0),this.uid=t,this._uintid=r}}let Gs=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function Cre(e,t){var r;let i;switch(t){case ce.LocalAudioTrack:i=vt.Audio;break;case ce.LocalVideoTrack:i=ge(r=e._hints).call(r,Ft.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:i=vt.Low}return i}function h0(e){let t=at();if(e.some(r=>r._bypassWebAudio))throw new ee(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new ee(N.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function p0(e,t){h0(e);let r=new Fr;return e.forEach(i=>r.addAudioTrack(i)),r}var TV,CV,RV,wV,IV,bV,AV,OV,NV,DV,PV,Qt;function kV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function bg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let Vi=(TV=Hs(Gs.SEND_ONLY),CV=Hs(Gs.SEND_ONLY),RV=Hs(),wV=Hs(Gs.RECEIVE_ONLY),IV=Hs(Gs.RECEIVE_ONLY),bV=Hs(Gs.RECEIVE_ONLY),AV=Hs(Gs.RECEIVE_ONLY),OV=Hs(Gs.RECEIVE_ONLY),NV=Hs(Gs.RECEIVE_ONLY),DV=Hs(),PV=Hs(Gs.RECEIVE_ONLY),Qt=class extends Jt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Le.StateChange,t,this._state)}constructor(e,t){super(),b(this,"store",void 0),b(this,"statsUploader",void 0),b(this,"sendConnection",void 0),b(this,"recvConnection",void 0),b(this,"localTrackMap",new Map),b(this,"remoteUserMap",new Map),b(this,"localDataChannels",[]),b(this,"pendingLocalTracks",[]),b(this,"pendingRemoteTracks",[]),b(this,"statsCollector",void 0),b(this,"dtlsFailedCount",0),b(this,"sendMutex",new rn("P2PChannel2-send-mutex")),b(this,"recvMutex",new rn("P2PChannel2-recv-mutex")),b(this,"_state",Ct.Disconnected),b(this,"_restartStates",["disconnected","failed"]),b(this,"reconnectInterval",void 0),b(this,"uploadUnplinkStarted",!1),b(this,"uploadDownlinkStarted",!1),b(this,"uplinkStateUploadInterval",void 0),b(this,"downlinkStatsUploadInterval",void 0),b(this,"handleMuteLocalTrack",async(r,i,s)=>{let c=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Ct.Connected)return void s(new ee(N.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let h=this.filterTobeMutedTracks(r);if(h.length===0)return void i();let f=h.find(y=>y[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(h.map(y=>{let[,{id:A}]=y;return A}));let m=!1;var l,u;r.trackMediaType==="video"?m=!((l=this.localTrackMap.get(ce.LocalAudioTrack))===null||l===void 0||!l.track._muted):m=((u=this.localTrackMap.get(ce.LocalVideoTrack))===null||u===void 0?void 0:u.id)===void 0;let E=this.createMuteMessage(h);await Pt(this,Le.RequestMuteLocal,E);let S=r.trackMediaType==="video"?qc.MUTE_LOCAL_VIDEO:qc.MUTE_LOCAL_AUDIO;await Pt(this,Le.RequestP2PMuteLocal,{action:S,message:E,isMuteAll:m}),i()}catch(h){s(h)}finally{c()}}),b(this,"handleUnmuteLocalTrack",async(r,i,s)=>{let c=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Ct.Connected)return void s(new ee(N.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let l=this.filterTobeUnmutedTracks(r);if(l.length===0)return void i();await this.sendConnection.unmuteLocal(l.map(f=>{let[,{id:m}]=f;return m}));let u=this.createUnmuteMessage(l),h=r.trackMediaType==="video"?qc.UNMUTE_LOCAL_VIDEO:qc.UNMUTE_LOCAL_AUDIO;await Pt(this,Le.RequestP2PMuteLocal,{action:h,message:u}),i()}catch(l){s(l)}finally{c()}}),b(this,"handleUpdateVideoEncoder",async(r,i,s)=>{let c=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{let l=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==r||this.state!==Ct.Connected)return void i();let{id:u,track:h}=l;u&&(await this.sendConnection.updateSendParameters(u,h),await this.sendConnection.updateEncoderConfig(u,h),this.emit(Le.UpdateVideoEncoder,h)),i()}catch(l){s(l)}finally{c()}}),b(this,"handleUpdateVideoSendParameters",async(r,i,s)=>{let c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let l=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==r||this.state!==Ct.Connected)return void i();let{id:u,track:h}=l;u&&await this.sendConnection.updateSendParameters(u,h),i()}catch(l){s(l)}finally{c()}}),b(this,"handleReplaceTrack",async(r,i,s,c)=>{let l;v.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof c=="boolean"&&c||(l=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var u;let f=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return r===E});if(!this.sendConnection||!f||f[1].id===void 0||this.state!==Ct.Connected)return void i();if(await((u=this.sendConnection)===null||u===void 0?void 0:u.replaceTrack(r,f[1].id)),f[0]===ce.LocalVideoTrack&&at().supportDualStreamEncoding){let m=this.localTrackMap.get(ce.LocalVideoLowTrack);if(m){let E=r._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,await new _e((S,y)=>{this.handleReplaceTrack(m.track,S,y,!0)})}}i()}catch(f){s(f)}finally{var h;(h=l)===null||h===void 0||h()}}),b(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),b(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),b(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),b(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new vV(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},x("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new ee(N.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e,t,r,i,s,c){throw new ee(N.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new _V(e,this.store,Zn.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Ct.New,this.sendConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new _V(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new ee(N.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ct.Connected}async addRemoteCandidate(e,t){if(t===Zn.RECEIVE_ONLY){if(!this.sendConnection)throw new ee(N.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new ee(N.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var i=this;return Ui(function*(){let s=yield Ye(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Ct.Connected){i.throwIfTrackTypeNotMatch(e);let f=e.filter(m=>i.pendingLocalTracks.indexOf(m)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(f))}i.store.pubId=i.store.pubId+1,On.markPublishStart(i.store.clientId,i.store.pubId);let c=i.filterTobePublishedTracks(e,t,r);if(c.length===0)return void(yield Ye(i.tryToUnmuteAudio(e)));c.forEach(f=>{let{track:m,type:E}=f,S=Date.now();i.store.publish(m.getTrackId(),E===ce.LocalAudioTrack?"audio":"video",S)}),i.bindLocalTrackEvents(c);let l=yield Ye(i.sendConnection.send(c.map(f=>{let{track:m}=f;return m}),i.store.codec,i.store.audioCodec)),u=(yield Ye(l.next())).value,h=i.createGatewayPublishMessage(c,u);try{yield h}catch(f){throw l.throw(f),(f==null?void 0:f.code)===N.WS_ABORT&&c.forEach(m=>{let{track:E}=m;i.pendingLocalTracks.indexOf(E)===-1&&i.pendingLocalTracks.push(E)}),i.unbindLocalTrackEvents(c),f}yield Ye(l.next()),c.forEach(f=>{let{type:m}=f;i.statsCollector.addLocalStats(m)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(c,u),c.forEach(f=>{let{track:m,type:E}=f,S=Date.now();i.store.publish(m.getTrackId(),E===ce.LocalAudioTrack?"audio":"video",void 0,S)}),i.startUploadUplinkState()}finally{s()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Ct.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(s=>!ge(e).call(e,s)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(s=>s[0]==="videoLowTrack");r&&r[1].track.close();let i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(s=>{let[,{id:c}]=s;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(s=>{let[c,{track:l}]=s;return{type:c,track:l}})),t.forEach(s=>{let[c]=s;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Ct.Connected)return r&&r[1].track.close(),i;e.forEach(s=>{let c=this.pendingLocalTracks.indexOf(s);c!==-1&&this.pendingLocalTracks.splice(c,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],r=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[s,{track:c,ssrcs:l}]=i,u={stream_type:Cre(c,s),ssrcs:l};c._muted||!c._enabled?t.push(u):r.push(u)}),t.length>0&&t.forEach(i=>{Pt(this,Le.RequestMuteLocal,[i])}),r.length>0&&r.forEach(i=>{Pt(this,Le.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Ui(function*(){throw new ee(N.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await kr(this,Le.RequestRePublish,this.pendingLocalTracks),this.emit(Le.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ee(N.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,i){var s;if(!this.recvConnection)throw new ee(N.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let{track:c,mid:l,transceiver:u}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),i);t===Ie.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new sh(c,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new oh(c,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack));let h=this.remoteUserMap.get(e);h?h.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let f=this.pendingRemoteTracks.findIndex(m=>{let{user:E,kind:S}=m;return E.uid===e.uid&&t===S});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Le.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,i){if(!this.recvConnection)throw new ee(N.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),i)}async unsubscribe(e,t,r){let i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return t!==void 0?l.uid===e.uid&&t===u:l.uid===e.uid});if(i.forEach(c=>{let l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.recvConnection||r||i.forEach(c=>{let{kind:l}=c;var u;if(l===Ie.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(l===Ie.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let s=this.filterTobeUnSubscribedTracks(e,t);s.length!==0&&(await this.recvConnection.stopReceiving(s.map(c=>{let[,{id:l}]=c;return l})),this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),s.forEach(c=>{let[l,{kind:u}]=c;var h,f;if(u===Ie.VIDEO&&l._videoSSRC&&((h=this.recvConnection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===Ie.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),r||((f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0);else if(u===Ie.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),!r&&((m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0)}}),s.forEach(c=>{let[,{kind:l}]=c;Pt(this,Le.RequestP2PMuteRemote,l)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,r]=t;[Ie.VIDEO,Ie.AUDIO].forEach(i=>{r.has(i)?Pt(this,Le.RequestP2PUnmuteRemote,i):Pt(this,Le.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new ee(N.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new ee(N.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new ee(N.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new ee(N.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let i=t===Ie.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(ce.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Fr){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return s!==ce.LocalAudioTrack}).filter(i=>{let[s]=i;return!(e&&s===ce.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return!(e&&i===ce.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i})}reportPublishEvent(e,t,r,i,s){if(e){let l=this.localTrackMap.get(ce.LocalAudioTrack),u=i?this.localTrackMap.get(ce.LocalVideoLowTrack):this.localTrackMap.get(ce.LocalVideoTrack);be.publish(this.store.sessionId,{eventElapse:On.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(Ft.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var c;r||(r=[]);let l=r.find(h=>h instanceof lr),u=i?(c=this.localTrackMap.get(ce.LocalVideoTrack))===null||c===void 0?void 0:c.track:r.find(h=>h instanceof Lt);be.publish(this.store.sessionId,{eventElapse:On.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(Ft.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,r,i){let s=i===Ie.VIDEO?r._videoSSRC:r._audioSSRC;s&&be.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Ie.VIDEO,audio:i===Ie.AUDIO,peerid:r.uid,subscribeRequestid:i===Ie.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:On.measureFromSubscribeStart(this.store.clientId,s)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new rn("P2PChannel2-send-mutex"),this.sendMutex=new rn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(ce.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Fr){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Ct.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(ce.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(ce.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof Lt||t&&t.track instanceof lr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(qi(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[i]=r;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(ce.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Mp(e).call(e,(r,i)=>r.level-i.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Ct.Reconnecting,x("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:i}]=e;switch(r){case ce.LocalVideoTrack:ge(t=i._hints).call(t,Ft.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ce.LocalAudioTrack:i instanceof Fr?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ce.LocalVideoLowTrack:}}),this.emit(Le.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(qi(r).call(r)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Le.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:i,kind:s}=r;if((e instanceof ol?e.uid:e)===i.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,i;if(e===Zn.SEND_ONLY){if(!this.sendConnection)throw new ee(N.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new ee(N.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){let s=await i.restartICE(t);return i.isInRestartIce=!1,s}{let s=await i.restartICE();if(s){let c=await kr(this,Le.RequestP2PRestartICE,{direction:Zn.RECEIVE_ONLY,iceParameter:s});await i.restartICE(c),i.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(ce.LocalVideoTrack),r=this.localTrackMap.get(ce.LocalAudioTrack),i=e.videoSend.find(y=>{var A;return y.ssrc===(t==null||(A=t.ssrcs)===null||A===void 0?void 0:A[0].ssrcId)}),s=e.audioSend.find(y=>{var A;return y.ssrc===(r==null||(A=r.ssrcs)===null||A===void 0?void 0:A[0].ssrcId)});if(!i||!s)return 1;let c=Mi(this,Le.NeedSignalRTT),l=i?i.rttMs:void 0,u=s?s.rttMs:void 0,h=l&&u?(l+u)/2:l||u,f=(h&&c?(h+c)/2:h||c)||0,m=100*e.sendPacketLossRate*.7/50+.3*f/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,S=t==null?void 0:t.track;if(S&&S._encoderConfig&&S._hints.indexOf(Ft.SCREEN_TRACK)===-1){let y=S._encoderConfig.bitrateMax,A=e.bitrate.actualEncoded;if(y&&A){let T=(1e3*y-A)/(1e3*y);return jL[T<.15?0:T<.3?1:T<.45?2:T<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i]=r,s=i._audioSSRC,c=i._videoSSRC,l=e.audioRecv.find(A=>A.ssrc===s),u=e.videoRecv.find(A=>A.ssrc===c);if(!l&&!u)return void(t+=1);let h=Mi(this,Le.NeedSignalRTT),f=e.rtt,m=(f&&h?(f+h)/2:f||h)||0,E=l?l.jitterMs:void 0,S=e.recvPacketLossRate,y=.7*S*100/50+.3*m/1500;E&&(y=.6*S*100/50+.2*m/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new _e((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){let i=[],s=at(),c=this.getAllTracks();e=Ou(e=e.filter(h=>c.indexOf(h)===-1));let l=!1,u=!1;for(let h of e){if(h instanceof Lt&&(this.localTrackMap.has(ce.LocalVideoTrack)||l?new ee(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:h,type:ce.LocalVideoTrack}),l=!0),t)){let f=this.getLowVideoTrack(h,r);i.push({track:f,type:ce.LocalVideoLowTrack})}if(h instanceof lr){let f=this.localTrackMap.get(ce.LocalAudioTrack);if(f){if(!(f.track instanceof Fr))throw new ee(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new ee(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0)}else if(u){let m=i.find(E=>{let{type:S}=E;return S===ce.LocalAudioTrack});if(!(m.track instanceof Fr))throw new ee(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new ee(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(h)}else{if(!s.webAudioMediaStreamDest||h instanceof Fr||h._bypassWebAudio)i.push({track:h,type:ce.LocalAudioTrack});else{let m=new Fr;m.addAudioTrack(h),i.push({track:m,type:ce.LocalAudioTrack})}u=!0}}}return i}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=Ou(e=e.filter(i=>r.indexOf(i)!==-1));for(let i of e){if(i instanceof lr){let s=this.localTrackMap.get(ce.LocalAudioTrack);if(!s)continue;s.track instanceof Fr?(s.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),s.track.trackList.length===0&&(t.push([ce.LocalAudioTrack,s]),s.track.close())):t.push([ce.LocalAudioTrack,s])}if(i instanceof Lt){let s=this.localTrackMap.get(ce.LocalVideoTrack);if(!s)continue;t.push([ce.LocalVideoTrack,s]);let c=this.localTrackMap.get(ce.LocalVideoLowTrack);c&&t.push([ce.LocalVideoLowTrack,c])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:i}=t;switch(i){case ce.LocalVideoTrack:r.addListener(ve.GET_STATS,this.handleGetLocalVideoStats),r.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case ce.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Fr?e.trackList.forEach(r=>{r.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),r.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:i}]=t;return{track:i,type:r}})),e.forEach(t=>{let{track:r,type:i}=t;switch(i){case ce.LocalVideoTrack:r.off(ve.GET_STATS,this.handleGetLocalVideoStats),r.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case ce.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Fr?e.trackList.forEach(t=>{t.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ve.GET_STATS,this.handleGetLocalAudioStats),t.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ve.GET_STATS,this.handleGetLocalAudioStats),e.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof oh&&t.addListener(ve.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof sh&&t.addListener(ve.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Ie.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Ie.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,i)=>{var s;let c,{track:l,type:u}=r;switch(u){case ce.LocalAudioTrack:c=vt.Audio;break;case ce.LocalVideoTrack:c=ge(s=l._hints).call(s,Ft.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:c=vt.Low}return{kind:u===ce.LocalAudioTrack?Ie.AUDIO:Ie.VIDEO,stream_type:c,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:l.muted||!l.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let i,[s,{track:c,ssrcs:l,id:u}]=t;switch(s){case ce.LocalVideoTrack:i=ge(r=c._hints).call(r,Ft.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalAudioTrack:i=vt.Audio;break;case ce.LocalVideoLowTrack:i=vt.Low}return{stream_type:i,ssrcs:l,mid:u}})}assignLocalTracks(e,t){e.forEach((r,i)=>{let{track:s,type:c}=r;this.localTrackMap.set(c,{track:s,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Le.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ge(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Xr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),be.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:sr.TRACER}).onSuccess(),this.emit(Le.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let i=Array.from(qi(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);var s;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(s=i.audioTrack)===null||s===void 0||s.emit(th.FIRST_FRAME_DECODED),be.firstRemoteFrame(this.store.sessionId,nn.FIRST_AUDIO_DECODE,rr.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:On.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let i=Array.from(qi(r=this.remoteUserMap).call(r)).find(s=>s._audioSSRC===t);i&&be.firstRemoteFrame(this.store.sessionId,nn.FIRST_AUDIO_RECEIVED,rr.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:On.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,i)=>{this.reportVideoFirstFrameDecoded(t,r,i)},e.onFirstVideoReceived=t=>{var r;let i=Array.from(qi(r=this.remoteUserMap).call(r)).find(s=>s._videoSSRC===t);i&&be.firstRemoteFrame(this.store.sessionId,nn.FIRST_VIDEO_RECEIVED,rr.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:On.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{let i=t.candidateType==="relay",s=r.candidateType==="relay";r.candidateType!=="unknown"&&i===s||this.emit(Le.ConnectionTypeChange,i),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Jc(r))," -> ").concat(JSON.stringify(Jc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Jc(r))," -> ").concat(JSON.stringify(Jc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Le.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===Zn.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,v.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Zn.SEND_ONLY?this.restartICE(e):kr(this,Le.RequestP2PRestartICE,{direction:Zn.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof lr&&(r==null?void 0:r.track)instanceof Fr)return r.track.isActive||t.push([ce.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return e===c});if(i&&(t.push(i),i[0]===ce.LocalVideoTrack)){let s=this.localTrackMap.get(ce.LocalVideoLowTrack);s&&t.push([ce.LocalVideoLowTrack,s])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof lr&&(r==null?void 0:r.track)instanceof Fr)return r.track.isActive&&t.push([ce.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return e===c});if(i)if(i[0]===ce.LocalVideoTrack){t.push(i);let s=this.localTrackMap.get(ce.LocalVideoLowTrack);s&&t.push([ce.LocalVideoLowTrack,s])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var r;let i,[s,{track:c,ssrcs:l,id:u}]=t;switch(s){case ce.LocalAudioTrack:i=vt.Audio;break;case ce.LocalVideoTrack:i=ge(r=c._hints).call(r,Ft.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:i=vt.Low}return{stream_type:i,ssrcs:l,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var r;let i,[s,{track:c,ssrcs:l,id:u}]=t;switch(s){case ce.LocalAudioTrack:i=vt.Audio;break;case ce.LocalVideoTrack:i=ge(r=c._hints).call(r,Ft.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:i=vt.Low}return{stream_type:i,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(e,t){let r=[],i=this.remoteUserMap.get(e);if(!i)return r;if(t){let s=i.get(t);if(!s)return r;r.push([e,{kind:t,id:s}])}else Array.from(i.entries()).forEach(s=>{let[c,l]=s;r.push([e,{kind:c,id:l}])});return r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[i,{kind:s,id:c}]=r;switch(s){case Ie.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Ie.VIDEO,ssrcId:i._videoSSRC}));case Ie.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Ie.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:i}]=t,s=this.remoteUserMap.get(r);s&&(s.delete(i),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(ce.LocalVideoTrack),r=this.localTrackMap.get(ce.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),r&&e.low_stream_uplink&&await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof lr){let r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;let i=this.createUnmuteMessage(r);return void await Pt(this,Le.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Le.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Le.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Xr(NE(this.dtlsFailedCount,Tr)),this.emit(Le.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ce.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Lt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Lt).length>1)throw new ee(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof lr).length>1&&(e.some(t=>t instanceof lr&&t._bypassWebAudio)||!at().webAudioMediaStreamDest))throw new ee(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof Lt&&this.pendingLocalTracks.some(r=>r instanceof Lt))throw new ee(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof lr&&this.pendingLocalTracks.some(r=>r instanceof lr)&&(!at().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof lr&&r._bypassWebAudio)))throw new ee(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let r=!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&at().supportDualStreamEncoding,i=bg(bg({},{width:160,height:120,framerate:15,bitrate:50}),t),s;s=r?e._mediaStreamTrack.clone():u0(e,i);let c=kt(8,"track-low-"),l=new Lt(s,bg(bg({},r&&{scaleResolutionDownBy:BR(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,c);return l.on(Ed.TRANSCEIVER_UPDATED,u=>{e._updateRtpTransceiver(u,Zu.LOW_STREAM)}),l._hints.push(Ft.LOW_STREAM),e.addListener(ve.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,i){var s;let c=Array.from(qi(s=this.remoteUserMap).call(s)).find(l=>l._videoSSRC===e);if(c){i||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());let l=this.store.keyMetrics,u=l.subscribe.find(h=>h.userId===c.uid&&h.type==="video");be.firstRemoteVideoDecode(this.store.sessionId,nn.FIRST_VIDEO_DECODE,rr.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:r,subscribeElapse:On.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;let i=this.remoteUserMap.get(e);if(!i)return!1;let s=i.get(t);if(!s)return!1;let c=await this.recvConnection.getRemoteSSRC(s);return c!==void 0&&c!==r}resetConnection(e){v.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(e)),this.state===Ct.Connected?(v.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(e){throw new ee(N.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new ee(N.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new ee(N.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new ee(N.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new ee(N.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new ee(N.NOT_SUPPORTED)}async preConnect(e,t,r,i,s,c){throw new ee(N.NOT_SUPPORTED)}getEstablishParams(){throw new ee(N.NOT_SUPPORTED)}async reSubscribe(e){throw new ee(N.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new ee(N.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===ce.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Zu.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},fe(Qt.prototype,"p2pConnect",[TV],Object.getOwnPropertyDescriptor(Qt.prototype,"p2pConnect"),Qt.prototype),fe(Qt.prototype,"unpublish",[CV],Object.getOwnPropertyDescriptor(Qt.prototype,"unpublish"),Qt.prototype),fe(Qt.prototype,"unpublishLowStream",[RV],Object.getOwnPropertyDescriptor(Qt.prototype,"unpublishLowStream"),Qt.prototype),fe(Qt.prototype,"subscribe",[wV],Object.getOwnPropertyDescriptor(Qt.prototype,"subscribe"),Qt.prototype),fe(Qt.prototype,"mockSubscribe",[IV],Object.getOwnPropertyDescriptor(Qt.prototype,"mockSubscribe"),Qt.prototype),fe(Qt.prototype,"unsubscribe",[bV],Object.getOwnPropertyDescriptor(Qt.prototype,"unsubscribe"),Qt.prototype),fe(Qt.prototype,"muteRemote",[AV],Object.getOwnPropertyDescriptor(Qt.prototype,"muteRemote"),Qt.prototype),fe(Qt.prototype,"unmuteRemote",[OV],Object.getOwnPropertyDescriptor(Qt.prototype,"unmuteRemote"),Qt.prototype),fe(Qt.prototype,"hasRemoteMediaWithLock",[NV],Object.getOwnPropertyDescriptor(Qt.prototype,"hasRemoteMediaWithLock"),Qt.prototype),fe(Qt.prototype,"disconnectForReconnect",[DV],Object.getOwnPropertyDescriptor(Qt.prototype,"disconnectForReconnect"),Qt.prototype),fe(Qt.prototype,"remoteMediaSsrcChanged",[PV],Object.getOwnPropertyDescriptor(Qt.prototype,"remoteMediaSsrcChanged"),Qt.prototype),Qt);function Hs(e){return function(t,r,i){let s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];switch(e){case Gs.SEND_ONLY:{let h=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await s.apply(this,l)}finally{h()}}case Gs.RECEIVE_ONLY:{let h=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await s.apply(this,l)}finally{h()}}default:{let h=await this.sendMutex.lock("From P2PChannel2.".concat(r)),f=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await s.apply(this,l)}finally{h(),f()}}}},i}}function LV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function wd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class Vf{constructor(t){b(this,"store",void 0),b(this,"onStatsException",void 0),b(this,"onUploadPublishDuration",void 0),b(this,"onStatsChanged",void 0),b(this,"localStats",new Map),b(this,"remoteStats",new Map),b(this,"updateStatsInterval",void 0),b(this,"trafficStats",void 0),b(this,"trafficStatsPeerList",[]),b(this,"uplinkStats",void 0),b(this,"exceptionMonitor",void 0),b(this,"p2pChannel",void 0),b(this,"scalabilityMode",nZ.L1T1),b(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new ore,this.exceptionMonitor.on("exception",(r,i,s)=>{this.onStatsException&&this.onStatsException(r,i,s)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ce.LocalAudioTrack)||wd({},Ww)}getLocalVideoTrackStats(){return this.localStats.get(ce.LocalVideoTrack)||wd({},Gw)}getRemoteAudioTrackStats(t){let r=(c,l)=>{if(!this.trafficStats)return l;let u=this.trafficStats.peer_delay.find(h=>h.peer_uid===c);return u&&(l.publishDuration=u.B_ppad+(Date.now()-this.trafficStats.timestamp)),l},i={};if(t){var s;let c=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.audioStats;c&&(i[t]=r(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[l,{audioStats:u}]=c;u&&(i[l]=r(l,u))});return i}getRemoteNetworkQualityStats(t){let r={};if(t){var i;let s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;s&&(r[t]=s)}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{networkStats:l}]=s;l&&(r[c]=l)});return r}getRemoteVideoTrackStats(t){let r=(c,l)=>{if(!this.trafficStats)return l;let u=this.trafficStats.peer_delay.find(h=>h.peer_uid===c);return u&&(l.publishDuration=u.B_ppvd+(Date.now()-this.trafficStats.timestamp)),l},i={};if(t){var s;let c=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.videoStats;c&&(i[t]=r(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[l,{videoStats:u}]=c;u&&(i[l]=r(l,u))});return i}getRTCStats(){let t=0,r=0,i=0,s=0,c=this.localStats.get(ce.LocalAudioTrack);c&&(t+=c.sendBytes,r+=c.sendBitrate);let l=this.localStats.get(ce.LocalVideoTrack);l&&(t+=l.sendBytes,r+=l.sendBitrate);let u=this.localStats.get(ce.LocalVideoLowTrack);u&&(t+=u.sendBytes,r+=u.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:m,videoStats:E}=f;m&&(i+=m.receiveBytes,s+=m.receiveBitrate),E&&(i+=E.receiveBytes,s+=E.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:r,SendBytes:t,RecvBytes:i,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),t.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var i;let s=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(r.peer_uid),c=s!=null&&s.videoSSRC?On.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,l=s!=null&&s.audioSSRC?On.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,c>l?c:l),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&v.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,i){if(!t)return!1;let s=!!i&&r.framesDecodeFreezeTime>i.framesDecodeFreezeTime,c=!i||r.framesDecodeCount>i.framesDecodeCount;return s||!c}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(r=>{let[i,s]=r;switch(i){case ce.LocalVideoTrack:case ce.LocalVideoLowTrack:{let l=s,u=wd({},Gw),h=t.getStats(),f=t.getLocalMedia(i);if(h){let m=h.videoSend.find(E=>E.ssrc===(f==null?void 0:f.ssrcs[0].ssrcId));if(m){let E=t.getLocalVideoSize(),S=t.getEncoderConfig(ce.LocalVideoTrack);m.codec!=="H264"&&m.codec!=="H265"&&m.codec!=="VP8"&&m.codec!=="VP9"&&m.codec!=="AV1X"&&m.codec!=="AV1"||(u.codecType=m.codec),u.sendBytes=m.bytes,u.sendBitrate=l?8*Math.max(0,u.sendBytes-l.sendBytes):0,m.inputFrame?(u.captureFrameRate=m.inputFrame.frameRate,u.captureResolutionHeight=m.inputFrame.height,u.captureResolutionWidth=m.inputFrame.width):E&&(u.captureResolutionWidth=E.width,u.captureResolutionHeight=E.height),m.sentFrame?(u.sendFrameRate=m.sentFrame.frameRate,u.sendResolutionHeight=m.sentFrame.height,u.sendResolutionWidth=m.sentFrame.width):E&&(u.sendResolutionWidth=E.width,u.sendResolutionHeight=E.height),m.avgEncodeMs&&(u.encodeDelay=m.avgEncodeMs),S&&S.bitrateMax&&(u.targetSendBitrate=1e3*S.bitrateMax),u.sendPackets=m.packets,u.sendPacketsLost=m.packetsLost,u.sendJitterMs=m.jitterMs,u.sendRttMs=m.rttMs,u.totalDuration=l?l.totalDuration+1:1,u.totalFreezeTime=l?l.totalFreezeTime:0,this.isLocalVideoFreeze(m)&&(u.totalFreezeTime+=1),m.scalabilityMode&&this.scalabilityMode!==m.scalabilityMode&&(v.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(m.scalabilityMode)),this.scalabilityMode=m.scalabilityMode)}this.trafficStats&&(u.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var c;this.localStats.set(i,u),((l==null?void 0:l.sendResolutionWidth)!==u.sendResolutionWidth||(l==null?void 0:l.sendResolutionHeight)!==u.sendResolutionHeight)&&((c=this.onStatsChanged)===null||c===void 0||c.call(this,"resolution",{width:u.sendResolutionWidth,height:u.sendResolutionHeight})),u&&f&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,f.track,u);break}case ce.LocalAudioTrack:{let l=s,u=wd({},Ww),h=t.getStats(),f=t.getLocalMedia(i);if(h){let m=h.audioSend.find(E=>E.ssrc===(f==null?void 0:f.ssrcs[0].ssrcId));if(m){if(m.codec!=="opus"&&m.codec!=="aac"&&m.codec!=="PCMU"&&m.codec!=="PCMA"&&m.codec!=="G722"||(u.codecType=m.codec),m.inputLevel)u.sendVolumeLevel=Math.round(32767*m.inputLevel);else{let E=t.getLocalAudioVolume();E&&(u.sendVolumeLevel=Math.round(32767*E))}u.sendBytes=m.bytes,u.sendPackets=m.packets,u.sendPacketsLost=m.packetsLost,u.sendJitterMs=m.jitterMs,u.sendRttMs=m.rttMs,u.sendBitrate=l?8*Math.max(0,u.sendBytes-l.sendBytes):0}}this.trafficStats&&(u.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ce.LocalAudioTrack,u),u&&f&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,f.track,u);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(r=>{var i,s;let[c,{videoStats:l,audioStats:u,videoPcStats:h}]=r,f=u,m=l,E=h,S=wd({},q2),y=wd({},Y2),A=wd({},qte),{audioTrack:T,videoTrack:w,audioSSRC:O,videoSSRC:P}=t.getRemoteMedia(c),F;F=t instanceof Vi?t.getStats(!0):t.getStats();let W=(i=F)===null||i===void 0?void 0:i.audioRecv.find(ie=>ie.ssrc===O),K=(s=F)===null||s===void 0?void 0:s.videoRecv.find(ie=>ie.ssrc===P),X=this.trafficStats&&this.trafficStats.peer_delay.find(ie=>ie.peer_uid===c);if(W&&(W.codec!=="opus"&&W.codec!=="aac"&&W.codec!=="PCMU"&&W.codec!=="PCMA"&&W.codec!=="G722"||(S.codecType=W.codec),W.outputLevel?S.receiveLevel=Math.round(32767*W.outputLevel):T&&(S.receiveLevel=Math.round(32767*T.getVolumeLevel())),S.receiveBytes=W.bytes,S.receivePackets=W.packets,S.receivePacketsLost=W.packetsLost,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.receiveBitrate=f?8*Math.max(0,S.receiveBytes-f.receiveBytes):0,S.totalDuration=f?f.totalDuration+1:1,S.totalFreezeTime=f?f.totalFreezeTime:0,S.freezeRate=S.totalFreezeTime/S.totalDuration,S.receiveDelay=W.jitterBufferMs,S.totalDuration>10&&Vf.isRemoteAudioFreeze(T)&&(S.totalFreezeTime+=1)),K){K.codec!=="H264"&&K.codec!=="H265"&&K.codec!=="VP8"&&K.codec!=="VP9"&&K.codec!=="AV1X"&&K.codec!=="AV1"||(y.codecType=K.codec),y.receiveBytes=K.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,y.renderFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,K.outputFrame&&(y.renderFrameRate=K.outputFrame.frameRate),K.receivedFrame?(y.receiveFrameRate=K.receivedFrame.frameRate,y.receiveResolutionHeight=K.receivedFrame.height,y.receiveResolutionWidth=K.receivedFrame.width):w&&(y.receiveResolutionHeight=w._videoHeight||0,y.receiveResolutionWidth=w._videoWidth||0),K.framesRateFirefox!==void 0&&(y.receiveFrameRate=Math.round(K.framesRateFirefox)),y.receivePackets=K.packets,y.receivePacketsLost=K.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost),y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=m?m.totalFreezeTime:0,y.receiveDelay=K.jitterBufferMs||0;let ie=!!P&&t.getRemoteVideoIsReady(P);w&&ie&&Vf.isRemoteVideoFreeze(w,K,E)&&(y.totalFreezeTime+=1),y.freezeRate=y.totalFreezeTime/y.totalDuration}X&&(S.end2EndDelay=X.B_ad,y.end2EndDelay=X.B_vd,S.transportDelay=X.B_ed,y.transportDelay=X.B_ed,S.currentPacketLossRate=X.B_ealr4/100,y.currentPacketLossRate=X.B_evlr4/100,A.uplinkNetworkQuality=X.B_punq?X.B_punq:0,A.downlinkNetworkQuality=X.B_pdnq?X.B_pdnq:0),this.remoteStats.set(c,{audioStats:S,videoStats:y,videoPcStats:K,networkStats:A}),T&&this.exceptionMonitor.setRemoteAudioStats(T,S),w&&this.exceptionMonitor.setRemoteVideoStats(w,y)})}}function MV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function Ff(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?MV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):MV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class Rre extends Jt{constructor(t,r,i,s){super(),b(this,"spec",void 0),b(this,"token",void 0),b(this,"websocket",void 0),b(this,"pingpongTimer",void 0),b(this,"reconnectMode","retry"),b(this,"serviceMode",void 0),b(this,"reqId",0),b(this,"commandReqId",0),b(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),b(this,"handleWebSocketMessage",c=>{if(!c.data)return;let l=JSON.parse(c.data);l.requestId?this.emit("@".concat(l.requestId,"-").concat(l.sid),l):this.serviceMode===on.INJECT?this.emit(Ea.INJECT_STREAM_STATUS,l):(be.workerEvent(this.spec.sid,{actionType:"status",serverCode:l.code,workerType:this.serviceMode===on.TRANSCODE?1:2}),this.emit(Ea.PUBLISH_STREAM_STATUS,l))}),this.spec=r,this.token=t,this.serviceMode=s,this.websocket=new of("live-streaming",i),this.websocket.on(Ue.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ue.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ue.REQUEST_NEW_URLS,(c,l)=>{kr(this,Ea.REQUEST_NEW_ADDRESS).then(c).catch(l)}),this.websocket.on(Ue.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,r,i,s){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let c=this.commandReqId,l=this.reqId;if(!l||!this.websocket)throw new H(N.UNEXPECTED_ERROR);let u=Ff({command:t,sdkVersion:Eo==="4.21.0"?"0.0.1":Eo,seq:l,requestId:l,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new H(N.WS_DISCONNECT);let h=()=>new _e((S,y)=>{this.websocket.once(Ue.CLOSED,()=>y(new H(N.WS_ABORT))),this.websocket.once(Ue.CONNECTED,S)});this.websocket.state!=="connected"&&await h(),u.clientRequest&&(u.clientRequest.workerToken=this.token);let f=new _e((S,y)=>{let A=()=>{y(new H(N.WS_ABORT))};this.websocket.once(Ue.RECONNECTING,A),this.websocket.once(Ue.CLOSED,A),this.once("@".concat(l,"-").concat(this.spec.sid),T=>{S(T)})});s&&be.workerEvent(this.spec.sid,Ff(Ff({},s),{},{requestId:c,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));let m=Date.now();this.websocket.sendMessage(u);let E=null;try{E=await f}catch(S){if(this.websocket.state==="closed")throw S;return await h(),await this.request(t,r,i)}return s&&be.workerEvent(this.spec.sid,Ff(Ff({},s),{},{requestId:c,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-m})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=Eo==="4.21.0"?"0.0.1":Eo;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Vr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void v.warning("live stream response already exists stream");case Vr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Vr.LIVE_STREAM_RESPONSE_BAD_STREAM:case Vr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new H(N.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Vr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new H(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Vr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new H(N.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Vr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let r=new H(N.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ea.WARNING,r,t.serverResponse.url)}case Vr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let r=new H(N.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ea.WARNING,r,t.serverResponse.url)}case Vr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new H(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Vr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new H(N.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Vr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let r=new H(N.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ea.WARNING,r,t.serverResponse.url)}case Vr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new H(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Vr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new H(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Vr.LIVE_STREAM_RESPONSE_WORKER_LOST:case Vr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new H(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Vr.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new H(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new H(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Vr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new H(N.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(AE)},6e3)}}function xV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function li(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class wre extends Jt{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Tr,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Tr;super(),b(this,"onLiveStreamWarning",void 0),b(this,"onLiveStreamError",void 0),b(this,"onInjectStatusChange",void 0),b(this,"spec",void 0),b(this,"retryTimeout",1e4),b(this,"connection",void 0),b(this,"httpRetryConfig",void 0),b(this,"wsRetryConfig",void 0),b(this,"streamingTasks",new Map),b(this,"isStartingStreamingTask",!1),b(this,"taskMutex",new rn("live-streaming")),b(this,"cancelToken",si.CancelToken.source()),b(this,"transcodingConfig",void 0),b(this,"injectConfig",li({},sZ)),b(this,"injectLoopTimes",0),b(this,"uapResponse",void 0),b(this,"lastTaskId",1),b(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=r}async setTranscodingConfig(t){let r=li(li({},oZ),t);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(v.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map(l=>li(li(li({},iZ),l),{},{zOrder:l.zOrder?l.zOrder+1:1}))),function(l){or(l.width)||At(l.width,"config.width",0,1e4),or(l.height)||At(l.height,"config.height",0,1e4),or(l.videoBitrate)||At(l.videoBitrate,"config.videoBitrate",1,1e6),or(l.videoFrameRate)||At(l.videoFrameRate,"config.videoFrameRate"),or(l.lowLatency)||Ja(l.lowLatency,"config.lowLatency"),or(l.audioSampleRate)||Gr(l.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),or(l.audioBitrate)||At(l.audioBitrate,"config.audioBitrate",1,128),or(l.audioChannels)||Gr(l.audioChannels,"config.audioChannels",[1,2,3,4,5]),or(l.videoGop)||At(l.videoGop,"config.videoGop"),or(l.videoCodecProfile)||Gr(l.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),or(l.userCount)||At(l.userCount,"config.userCount",0,17),or(l.backgroundColor)||At(l.backgroundColor,"config.backgroundColor",0,16777215),or(l.userConfigExtraInfo)||dn(l.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),l.transcodingUsers&&!or(l.transcodingUsers)&&(Xa(l.transcodingUsers,"config.transcodingUsers"),l.transcodingUsers.forEach((u,h)=>{xE(u.uid),or(u.x)||At(u.x,"transcodingUser[".concat(h,"].x"),0,1e4),or(u.y)||At(u.y,"transcodingUser[".concat(h,"].y"),0,1e4),or(u.width)||At(u.width,"transcodingUser[".concat(h,"].width"),0,1e4),or(u.height)||At(u.height,"transcodingUser[".concat(h,"].height"),0,1e4),or(u.zOrder)||At(u.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),or(u.alpha)||At(u.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),or(l.watermark)||UR(l.watermark,"watermark"),or(l.backgroundImage)||UR(l.backgroundImage,"backgroundImage"),l.images&&!or(l.images)&&(Xa(l.images,"config.images"),l.images.forEach((u,h)=>{UR(u,"images[".concat(h,"]"))}))}(r);let i=[];r.images&&i.push(...r.images.map(l=>li(li(li({},xR),l),{},{zOrder:255}))),r.backgroundImage&&(i.push(li(li(li({},xR),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(i.push(li(li(li({},xR),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=i,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map(l=>li({},l)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);let s=(r.userConfigs||[]).map(l=>typeof l.uid=="number"?_e.resolve(l.uid):yM(l.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await _e.all(s)).forEach((l,u)=>{r.userConfigs&&r.userConfigs[u]&&(r.userConfigs[u].uid=l)}),this.transcodingConfig=r,this.connection)try{var c;let l=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Ms(c=this.streamingTasks).call(c)).map(u=>u.taskId).join("#")});v.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(l.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(l){if(!l.data||!l.data.retry)throw l;l.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(u=>{v.warning("[".concat(this.spec.clientId,"] live streaming receive error"),l.toString(),"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,l).then(()=>{v.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(u.url," success"))}).catch(h=>{v.error("[".concat(this.spec.clientId,"] live streaming republish failed"),u.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)})})}}setInjectStreamConfig(t,r){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=r}async startLiveStreamingTask(t,r,i){var s;if(Array.from(Ms(s=this.streamingTasks).call(s)).find(h=>h.mode===on.INJECT)&&r===on.INJECT)return new H(N.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&r===on.TRANSCODE)throw new H(N.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};v.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(r));let l=await this.taskMutex.lock();if(!this.connection&&i)return void l();if(this.streamingTasks.get(t)&&!i)return l(),new H(N.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(h){throw l(),h}switch(r){case on.TRANSCODE:c.transcodingConfig=li({},this.transcodingConfig);break;case on.RAW:break;case on.INJECT:c={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let u=this.lastTaskId++;try{let h=new _e((m,E)=>{Xr(this.retryTimeout).then(()=>{if(i)return E(i);let S=this.statusError.get(t);return S?(this.statusError.delete(t),E(S)):void 0})}),f=await _e.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:r===on.TRANSCODE?1:2,requestByUser:!i,tid:u.toString()}),h]);this.isStartingStreamingTask=!1,v.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(f.code)),this.streamingTasks.set(t,{clientRequest:c,mode:r,url:t,taskId:u}),l()}catch(h){if(l(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||i)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,h)):await this.startLiveStreamingTask(t,r,h)}}stopLiveStreamingTask(t){return new _e((r,i)=>{let s=this.streamingTasks.get(t);if(!s||!this.connection)return new H(N.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let c=s.mode;s.abortTask=()=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:c===on.INJECT?"UninjectStream":"UnpublishStream",url:s.url}},!1,{url:t,command:"UnPublishStream",workerType:c===on.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(l=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(l.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&c!==on.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),r(),c===on.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(ku.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(i)})}async controlInjectStream(t,r,i,s){let c=this.streamingTasks.get(t);if(!c||!this.connection||c.mode!==on.INJECT)throw new H(N.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:r,audioVolume:i,position:s}})).serverResponse}resetAllTask(){var t;let r=Array.from(Ms(t=this.streamingTasks).call(t));this.terminate();for(let i of r)this.startLiveStreamingTask(i.url,i.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=si.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new H(N.UNEXPECTED_ERROR,"live streaming connection has already connected");let r=await kr(this,UE.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new Rre(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Ea.WARNING,(i,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,i)),this.connection.on(Ea.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Ea.INJECT_STREAM_STATUS,i=>this.handleInjectStreamServerStatus(i)),this.connection.on(Ea.REQUEST_NEW_ADDRESS,(i,s)=>{if(!this.connection)return s(new H(N.UNEXPECTED_ERROR,"can not get new live streaming address list"));kr(this,UE.REQUEST_WORKER_MANAGER_LIST,t).then(c=>{this.uapResponse=c,i(c.addressList)}).catch(s)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){let r=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(r),s=t.reason;switch(t.code){case Vr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let l=new H(N.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return v.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,l);if(!this.isStartingStreamingTask)return;this.statusError.set(r,l)}case Vr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let l=new H(N.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,l)}case Vr.LIVE_STREAM_RESPONSE_WORKER_LOST:case Vr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var c;if(!this.connection)return;this.connection.tryNextAddress();let l=Array.from(Ms(c=this.streamingTasks).call(c));for(let u of l)u.abortTask?u.abortTask():(v.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,new H(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{v.debug("[".concat(this.spec.clientId,"] republish live stream success"),u.url)}).catch(h=>{v.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)}));return}}}handleInjectStreamServerStatus(t){let r=Number(t.uid),i=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(ku.INJECT_STREAM_STATUS_START_SUCCESS,r,i));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(ku.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,r,i),void this.streamingTasks.delete(i);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(ku.INJECT_STREAM_STATUS_START_UNAUTHORIZED,r,i),void this.streamingTasks.delete(i);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(ku.INJECT_STREAM_STATUS_BROKEN,r,i),void this.streamingTasks.delete(i);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(ku.INJECT_STREAM_STATUS_START_TIMEOUT,r,i),void this.streamingTasks.delete(i);default:return void v.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class UV{constructor(){b(this,"destChannelMediaInfos",new Map),b(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){YL(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){YL(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){ME(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function VV(e){if(!(e instanceof UV))return new H(N.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new H(N.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new H(N.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Ire extends Jt{constructor(t,r,i){super(),b(this,"ws",void 0),b(this,"requestId",1),b(this,"heartBeatTimer",void 0),b(this,"joinInfo",void 0),b(this,"clientId",void 0),b(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),b(this,"onClose",s=>{this.emit("close"),this.dispose()}),b(this,"onMessage",s=>{let c=JSON.parse(s.data);if(!c||c.command!=="serverResponse"||!c.requestId)return c&&c.command==="serverStatus"&&c.serverStatus&&c.serverStatus.command?(this.emit("status",c.serverStatus),void this.emit(c.serverStatus.command,c.serverStatus)):void 0;this.emit("req_".concat(c.requestId),c)}),this.joinInfo=t,this.clientId=r,this.ws=new of("cross-channel-".concat(this.clientId),i),this.ws.on(Ue.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ue.CONNECTED,this.onOpen),this.ws.on(Ue.ON_MESSAGE,this.onMessage),this.ws.on(Ue.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new _e((r,i)=>{let s=window.setTimeout(()=>{i(new H(N.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,c=>{window.clearTimeout(s),c.state&&c.state!==0?i(new H(N.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),i(new H(N.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new H(N.WS_DISCONNECT);let r=()=>new _e((l,u)=>{this.ws.once(Ue.CLOSED,()=>u(new H(N.WS_ABORT))),this.ws.once(Ue.CONNECTED,l)});this.ws.state!=="connected"&&await r();let i=this.sendMessage(t),s=new _e((l,u)=>{let h=()=>{u(new H(N.WS_ABORT))};this.ws.once(Ue.RECONNECTING,h),this.ws.once(Ue.CLOSED,h),this.once("req_".concat(i),l),Xr(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Ue.RECONNECTING,h),this.ws.off(Ue.CLOSED,h),u(new H(N.TIMEOUT,"cross channel ws request timeout"))})}),c=await s;if(!c||c.code!==200)throw new H(N.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(c)));return c}async connect(t){this.ws.removeAllListeners(Ue.REQUEST_NEW_URLS),this.ws.on(Ue.REQUEST_NEW_URLS,r=>{r(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class bre extends Jt{set state(t){t!==this._state&&(t!==yi.RELAY_STATE_FAILURE&&(this.errorCode=Lu.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,r,i,s,c){super(),b(this,"joinInfo",void 0),b(this,"sid",void 0),b(this,"clientId",void 0),b(this,"cancelToken",si.CancelToken.source()),b(this,"workerToken",void 0),b(this,"requestId",0),b(this,"signal",void 0),b(this,"prevChannelMediaConfig",void 0),b(this,"httpRetryConfig",void 0),b(this,"_resolution",void 0),b(this,"_state",yi.RELAY_STATE_IDLE),b(this,"errorCode",Lu.RELAY_OK),b(this,"onStatus",l=>{v.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(l))),l&&l.command&&(l.command==="onAudioPacketReceived"&&this.emit("event",$a.PACKET_RECEIVED_AUDIO_FROM_SRC),l.command==="onVideoPacketReceived"&&this.emit("event",$a.PACKET_RECEIVED_VIDEO_FROM_SRC),l.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Lu.SRC_TOKEN_EXPIRED,this.state=yi.RELAY_STATE_FAILURE),l.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Lu.DEST_TOKEN_EXPIRED,this.state=yi.RELAY_STATE_FAILURE))}),b(this,"onReconnect",async()=>{v.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",$a.NETWORK_DISCONNECTED),this.state=yi.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(l=>{this.state!==yi.RELAY_STATE_IDLE&&(v.error("auto restart channel media relay failed",l.toString()),this.errorCode=Lu.SERVER_CONNECTION_LOST,this.state=yi.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=r,this.sid=Zp(),this.signal=new Ire(this.joinInfo,this.clientId,i),this.httpRetryConfig=s,this._resolution=c}async startChannelMediaRelay(t){if(this.state!==yi.RELAY_STATE_IDLE)throw new H(N.INVALID_OPERATION);this.state=yi.RELAY_STATE_CONNECTING,await this.connect(),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new H(N.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new H(N.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new H(N.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==yi.RELAY_STATE_RUNNING)throw new H(N.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==yi.RELAY_STATE_RUNNING)throw new H(N.INVALID_OPERATION);let r=this.genMessage(ei.SetVideoProfile);await this.signal.request(r),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),v.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=yi.RELAY_STATE_IDLE,this.dispose()}dispose(){v.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=si.CancelToken.source(),this.state=yi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let t=await IZ(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",$a.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){let r=this.genMessage(ei.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let i=this.genMessage(ei.SetSdkProfile,t);await this.signal.request(i),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let s=this.genMessage(ei.SetSourceChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",$a.PACKET_JOINED_SRC_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let c=this.genMessage(ei.SetSourceUserId,t);await this.signal.request(c),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let l=this.genMessage(ei.SetDestChannel,t);await this.signal.request(l),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",$a.PACKET_JOINED_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let u=this.genMessage(ei.StartPacketTransfer,t);await this.signal.request(u),this.emit("event",$a.PACKET_SENT_TO_DEST_CHANNEL),this.state=yi.RELAY_STATE_RUNNING,v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){let r=this.genMessage(ei.UpdateDestChannel,t);await this.signal.request(r),this.emit("event",$a.PACKET_UPDATE_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let t=this.genMessage(ei.StopPacketTransfer);await this.signal.request(t),v.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){let i=[],s=[],c=[];this.requestId+=1;let l={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Eo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};l.sdkVersion==="4.21.0"&&(l.sdkVersion="0.0.1");let u=null,h=null;switch(t){case ei.SetSdkProfile:return l.clientRequest={command:"SetSdkProfile",type:"multi_channel"},l;case ei.SetSourceChannel:if(h=r&&r.getSrcChannelMediaInfo(),!h)throw new H(N.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},l;case ei.SetSourceUserId:if(h=r&&r.getSrcChannelMediaInfo(),!h)throw new H(N.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceUserId",uid:h.uid+""},l;case ei.SetDestChannel:if(u=r&&r.getDestChannelMediaInfo(),!u)throw new H(N.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{i.push(f.channelName),s.push(f.uid+""),c.push(f.token||this.joinInfo.appId)}),l.clientRequest={command:"SetDestChannel",channelName:i,uid:s,token:c},l;case ei.StartPacketTransfer:return l.clientRequest={command:"StartPacketTransfer"},l;case ei.Reconnect:return l.clientRequest={command:"Reconnect"},l;case ei.StopPacketTransfer:return l.clientRequest={command:"StopPacketTransfer"},l;case ei.UpdateDestChannel:if(u=r&&r.getDestChannelMediaInfo(),!u)throw new H(N.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{i.push(f.channelName),s.push(f.uid+""),c.push(f.token||this.joinInfo.appId)}),l.clientRequest={command:"UpdateDestChannel",channelName:i,uid:s,token:c},l;case ei.SetVideoProfile:l.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return l}}function Ag(e){var t={},r=!1;function i(s,c){return r=!0,{done:!1,value:new e0(c=new t0(function(l){l(e[s](c))}),1)}}return t[vu!==void 0&&s1||"@@iterator"]=function(){return this},t.next=function(s){return r?(r=!1,s):i("next",s)},typeof e.throw=="function"&&(t.throw=function(s){if(r)throw r=!1,s;return i("throw",s)}),typeof e.return=="function"&&(t.return=function(s){return r?(r=!1,s):i("return",s)}),t}var FV=p(JU);function jV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function BV(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Mt;function WV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function GV(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?WV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):WV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let lh=(Mt=class pm extends FE{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return ge(r=Object.keys(Du)).call(r,t)}))]}constructor(t,r){super(t,r),b(this,"store",void 0),b(this,"peerConnection",void 0),b(this,"remoteSDP",void 0),b(this,"initialOffer",void 0),b(this,"statsFilter",void 0),b(this,"useRTX",!1),b(this,"localCapabilities",void 0),b(this,"localCandidateCount",0),b(this,"allCandidatesReceived",!1),b(this,"establishPromise",void 0),b(this,"mutex",new rn("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(pm.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Tg(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,Dt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=Bs(t.sdp),i=Uf(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:x("FILTER_VIDEO_FEC"),filterAudioFec:x("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,GV(GV({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new ee(N.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,r,i,s,c,l){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(h){b(this,"sessionDesc",void 0),b(this,"localCapabilities",void 0),b(this,"rtpCapabilities",void 0),b(this,"candidates",void 0),b(this,"iceParameters",void 0),b(this,"dtlsParameters",void 0),b(this,"setup",void 0),b(this,"currentMidIndex",void 0),b(this,"cname",void 0),h=Vt(h);let{remoteIceParameters:f,remoteDtlsParameters:m,candidates:E,remoteRTPCapabilities:S,remoteSetup:y,localCapabilities:A,sdkCodec:T,cname:w}=h,O=$t.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=S,this.candidates=E,this.iceParameters=f,this.dtlsParameters=m,this.setup=y,this.localCapabilities=A,this.cname=w;for(let P=0;P<O.mediaDescriptions.length;P++){let F=O.mediaDescriptions[P];if(F.attributes.iceUfrag=f.iceUfrag,F.attributes.icePwd=f.icePwd,F.attributes.fingerprints=m.fingerprints,F.attributes.candidates=E,F.attributes.setup=y,F.media.mediaType==="video"){F.media.fmts=S.videoCodecs.map(K=>K.payloadType.toString(10));let W=S.videoCodecs.filter(K=>{var X,ie;return(X=K.rtpMap)===null||X===void 0?void 0:ge(ie=X.encodingName.toLowerCase()).call(ie,T)});W.length===0&&(W=S.videoCodecs),F.attributes.payloads=W,F.attributes.extmaps=S.videoExtensions}F.media.mediaType==="audio"&&(F.media.fmts=S.audioCodecs.map(W=>W.payloadType.toString(10)),F.attributes.payloads=S.audioCodecs,F.attributes.extmaps=S.audioExtensions),O.mediaDescriptions[P]=this.mungMediaDesc(F)}this.sessionDesc=O,this.currentMidIndex=O.mediaDescriptions.length-1}toString(){return $t.print(this.sessionDesc)}send(h,f,m){let{ssrcs:E,ssrcGroups:S}=io(f,this.cname),y=this.sessionDesc.mediaDescriptions.find(w=>h===Ie.VIDEO?w.media.mediaType==="video":w.media.mediaType==="audio"),A=E[0].attributes.label,T=E[0].attributes.mslabel;return y.attributes.ssrcs=y.attributes.ssrcs.concat(E),y.attributes.ssrcGroups=y.attributes.ssrcGroups.concat(S),{id:A,mslabel:T}}batchSend(h){return h.map(f=>{let{kind:m,ssrcMsg:E}=f;return this.send(m,E,void 0)})}stopSending(h){this.sessionDesc.mediaDescriptions.forEach(f=>{let m=[],E=[],S=[];f.attributes.ssrcs.forEach(y=>{ge(h).call(h,y.attributes.label||"")?S.push(y):m.push(y)}),f.attributes.ssrcGroups.forEach(y=>{var A;ge(A=S.map(T=>T.ssrcId)).call(A,y.ssrcIds[0])||E.push(y)}),f.attributes.ssrcs=m,f.attributes.ssrcGroups=E})}mute(h){let f=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!f)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));f.attributes.direction="inactive"}unmute(h){let f=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!f)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));f.attributes.direction="sendonly"}receive(h,f,m){h.forEach((E,S)=>{let y=E._mediaStreamTrack,A=this.sessionDesc.mediaDescriptions.findIndex(w=>w.attributes.mid===y.kind),T=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[A],E);this.sessionDesc.mediaDescriptions[A]=T})}stopReceiving(h){}updateCandidates(h){h===Gn.TCP?this.candidates.forEach(f=>{this.candidates.findIndex(m=>m.transport==="tcp"&&m.connectionAddress===f.connectionAddress&&m.port===f.port)===-1&&this.candidates.push(BV(BV({},f),{},{foundation:"tcpcandidate",priority:Number(f.priority)-1+"",transport:"tcp",port:Number(f.port)+90+""}))}):this.candidates=this.candidates.filter(f=>f.transport!=="tcp");for(let f of this.sessionDesc.mediaDescriptions)f.attributes.candidates=this.candidates}restartICE(h){h=Vt(h),this.iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(f=>{f.attributes.iceUfrag=h.iceUfrag,f.attributes.icePwd=h.icePwd})}predictReceivingMids(h){let f=[];for(let m=0;m<h;m++)f.push((this.currentMidIndex+m+1).toString(10));return f}mungRecvMediaDsec(h,f){let m=Vt(h);return rl(m,f),Rg(m,f),m}updateRecvMedia(h,f){let m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h);if(m!==-1){let E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],f);this.sessionDesc.mediaDescriptions[m]=E}}bumpMid(h){this.currentMidIndex+=h}updateTrackLabel(h,f,m){let E=this.sessionDesc.mediaDescriptions.find(y=>h===Ie.VIDEO?y.attributes.mid==="video":y.attributes.mid==="audio");if(E){let y=E.attributes.ssrcs.find(A=>A.attributes.label===f);var S;y&&(y.attributes.label=m,(S=y.attributes.msid)===null||S===void 0||S.replace(f,m))}}mungMediaDesc(h){let f=Vt(h);return Cg(f),function(m){let E=m.attributes.extmaps.find(S=>S.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");E&&m.attributes.extmaps.splice(m.attributes.extmaps.indexOf(E),1),m.attributes.payloads.forEach(S=>{let y=S.rtcpFeedbacks.findIndex(A=>A.type==="transport-cc");y!==-1&&S.rtcpFeedbacks.splice(y,1)})}(f),f}getSSRC(h){for(let f of this.sessionDesc.mediaDescriptions)for(let m of f.attributes.ssrcs)if(m.attributes.label===h)return[m]}}({remoteIceParameters:t,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:s.send,remoteSetup:c,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:l});let u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(u){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(u.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new ee(N.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(t,r){var i=this;return Ui(function*(){let s=yield Ye(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let c=t.map(S=>i.peerConnection.addTrack(S._mediaStreamTrack)),l=yield Ye(i.peerConnection.createOffer()),u=$t.parse(l.sdp),h=t.map(S=>{let y=S._mediaStreamTrack,A=u.mediaDescriptions.find(T=>T.attributes.mid===y.kind);if(!A)throw new Error("Cannot extract ssrc from mediaDescription.");return function(T,w,O){let P=T.attributes.ssrcs.filter(W=>W.attributes.label===w),F=T.attributes.ssrcGroups;if(P.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(F&&P.length>1){let W=F.find(K=>K.ssrcIds.indexOf(P[0].ssrcId)!==-1);return W?[{ssrcId:W.ssrcIds[0],rtx:O?W.ssrcIds[1]:void 0}]:[{ssrcId:P[0].ssrcId}]}return[{ssrcId:P[0].ssrcId}]}(A,y.id,i.useRTX)}),f;try{f=yield h}catch(S){throw c.forEach(y=>{Jr()&&y.replaceTrack(null),i.peerConnection.removeTrack(y)}),S}let m=i.mungSendOfferSDP(l.sdp,t);i.remoteSDP.receive(t,r,f);let E=i.remoteSDP.toString();return yield Ye(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Ye(i.applySendEncodings(c,t)),yield Ye(i.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map((S,y)=>{let A=S._mediaStreamTrack.id;return{localSSRC:h[y],id:A}})}catch(c){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let r=this.peerConnection.getSenders().filter(c=>{var l;return t.indexOf(((l=c.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(c=>{Jr()&&c.replaceTrack(null),this.peerConnection.removeTrack(c)});let i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:c,mslabel:l}=this.remoteSDP.send(t,r,s),u=new _e((m,E)=>{let S=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(c)))},1e4),y=A=>{let T=dt();if((T.name==="Safari"&&Number(T.version)===11||bn())&&A.track.id!==c&&A.streams[0].id===l){var w;let O=A.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(t,c,A.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(S),void m(O)}if(A.track.id===c)return this.peerConnection.removeEventListener("track",y),clearTimeout(S),void m(A.track)};this.peerConnection.addEventListener("track",y)}),h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});let f=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(f),{track:await u,id:c}}catch(c){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(i=>{var s;return t.indexOf(((s=i.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map(i=>{if(Jr()&&i.track)i.track.enabled=!1;else{let s=i.getParameters();s.encodings.forEach(c=>c.active=!1),i.setParameters(s)}})}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(c=>{var l;return t.indexOf(((l=c.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async c=>{if(Jr()&&c.track)c.track.enabled=!0;else{let l=c.getParameters();l.encodings.forEach(u=>u.active=!0),await c.setParameters(l)}});let i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Ui(function*(){let i=yield Ye(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(at().supportPCSetConfiguration){let h=r.peerConnection.getConfiguration(),f=t===Gn.RELAY?"relay":"all";h.iceTransportPolicy!==f&&(v.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(f,"]")),h.iceTransportPolicy=f,r.peerConnection.setConfiguration(h))}else if(t===Gn.RELAY)return;t!==Gn.RELAY&&r.remoteSDP.updateCandidates(t);let s=yield Ye(r.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let c=Bs(s.sdp),{remoteIceParameters:l}=yield c.iceParameters;r.remoteSDP.restartICE(l);let u=r.remoteSDP.toString();yield Ye(r.peerConnection.setLocalDescription(s)),yield Ye(r.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(s){v.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);let c=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new ee(N.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){let i=this.peerConnection.getSenders().filter(s=>{var c;return((c=s.track)===null||c===void 0?void 0:c.id)===t});i.length===1&&await this.applySendEncodings(i,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let i=this.peerConnection.getSenders().find(s=>{var c;return((c=s.track)===null||c===void 0?void 0:c.id)===r});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new ee(N.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new ee(N.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Au(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...pm.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...pm.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(i=>{i.security?i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(t,r){var i;if(r||(r=this.peerConnection.getSenders().find(f=>{var m;return((m=f.track)===null||m===void 0?void 0:m.id)===t._mediaStreamTrack.id})),!r)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!at().supportSetRtpSenderParameters)return v.warn("Browser not support set rtp-sender parameters");let s={},c={};if(t instanceof Lt)switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(x("DSCP_TYPE")&&Bc()){var l;let f=x("DSCP_TYPE");ge(l=["very-low","low","medium","high"]).call(l,f)&&(c.networkPriority=f)}let u=r.getParameters(),h=(i=u.encodings)===null||i===void 0?void 0:i[0];h&&Object.assign(h,c),Object.assign(u,s),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await r.setParameters(u)}async applySendEncodings(t,r){try{if(!at().supportSetRtpSenderParameters||t.length!==r.length)return;for(let i=0;i<t.length;i++){let s=t[i],c=r[i];s&&c&&await this.updateRtpSenderEncodings(c,s)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){let i=$t.parse(t);return r.forEach((s,c)=>{let l=s._mediaStreamTrack,u=i.mediaDescriptions.find(h=>h.attributes.mid===l.kind);u&&rl(u,s)}),$t.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,r,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let r=this.remoteSDP.batchSend(t).map((c,l)=>{let{id:u,mslabel:h}=c,{kind:f}=t[l];return new _e((m,E)=>{let S=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(u)))},1e4),y=A=>{let T=dt();if(T.name==="Safari"&&Number(T.version)===11&&A.track.id!==u&&A.streams[0].id===h){var w;let O=A.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(f,u,A.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(S),void m({track:O,id:u})}if(A.track.id===u)return this.peerConnection.removeEventListener("track",y),clearTimeout(S),void m({track:A.track,id:u})};this.peerConnection.addEventListener("track",y)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await _e.all(r)}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(at().supportPCSetConfiguration){let r=pm.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},fe(Mt.prototype,"connect",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"connect"),Mt.prototype),fe(Mt.prototype,"stopSending",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"stopSending"),Mt.prototype),fe(Mt.prototype,"receive",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"receive"),Mt.prototype),fe(Mt.prototype,"stopReceiving",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"stopReceiving"),Mt.prototype),fe(Mt.prototype,"muteRemote",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"muteRemote"),Mt.prototype),fe(Mt.prototype,"unmuteRemote",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteRemote"),Mt.prototype),fe(Mt.prototype,"muteLocal",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"muteLocal"),Mt.prototype),fe(Mt.prototype,"unmuteLocal",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteLocal"),Mt.prototype),fe(Mt.prototype,"close",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"close"),Mt.prototype),fe(Mt.prototype,"updateEncoderConfig",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"updateEncoderConfig"),Mt.prototype),fe(Mt.prototype,"updateSendParameters",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"updateSendParameters"),Mt.prototype),fe(Mt.prototype,"replaceTrack",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"replaceTrack"),Mt.prototype),fe(Mt.prototype,"getRemoteSSRC",[Ro],Object.getOwnPropertyDescriptor(Mt.prototype,"getRemoteSSRC"),Mt.prototype),Mt);function Ro(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let s=this.mutex,c=await s.lock("Locking from P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{c()}},r}function HV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function sl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?HV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):HV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let jf="9",KV=4e4;function zV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function ac(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let Og=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({});var dh=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(dh||{});let Ng=new Map;function qV(e,t,r,i){let{scale:s}=e;if(s===0&&i===dh.UP||s>=t.length-1&&i===dh.DOWN)return e;let c=ac(ac({},e),{},{scale:i===dh.DOWN?++s:--s});switch(r){case"maintain-framerate":c=ac(ac({},c),t[s].motion);break;case"maintain-resolution":c=ac(ac({},c),t[s].detail);break;case"balanced":c=ac(ac({},c),t[s].balanced)}return c}function YV(e,t){if(t){let r={overUse:0,underUse:0,adaptationList:JV(t)};Ng.set(e,r)}else Ng.delete(e)}function JV(e){let t=ac({},e),{bitrateMax:r,frameRate:i,scaleResolutionDownBy:s,bitrateMin:c}=t,{MIN_FRAME_RATE:l,MAX_THRESHOLD_FRAMERATE:u,MAX_SCALE:h,BITRATE_MIN_THRESHOLD:f,BITRATE_MAX_THRESHOLD:m,BWE_SCALE_UP_THRESHOLD:E,BWE_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_UP_THRESHOLD:A,BALANCE_BITRATE_FACTOR:T,BALANCE_FRAMERATE_FACTOR:w,BALANCE_RESOLUTION_FACTOR:O,MOTION_RESOLUTION_FACTOR:P,MOTION_BITRATE_FACTOR:F,DETAIL_FRAMERATE_FACTOR:W,DETAIL_BITRATE_FACTOR:K}=bR,X=Math.min(t.frameRate,u),ie=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(S,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(y,1)*X),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:c},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:c},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:c}}];for(let ae=1;ae<=h;ae++){let le={bwe_up:Math.round(Math.pow(E,ae)*r),bwe_down:Math.round(Math.pow(S,ae+1)*r),fps_up:Math.round(Math.pow(A,ae)*X),fps_down:Math.round(Math.pow(y,ae+1)*X)},we={scaleResolutionDownBy:s/Math.pow(O,ae),frameRate:Math.max(Math.round(Math.pow(w,ae)*i),l),bitrateMax:Math.max(Math.round(Math.pow(T,ae)*r),m),bitrateMin:Math.max(Math.round(Math.pow(T,ae)*c),f)},nt={scaleResolutionDownBy:s/Math.pow(P,ae),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(F,ae)*r),m),bitrateMin:Math.max(Math.round(Math.pow(F,ae)*c),f)},gt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(W,ae)*i),l),bitrateMax:Math.max(Math.round(Math.pow(K,ae)*r),m),bitrateMin:Math.max(Math.round(Math.pow(K,ae)*c),f)};ie.push({scale:ae,threshold:le,balanced:we,motion:nt,detail:gt})}return ie}function Are(e,t,r,i,s,c){let l=Ng.get(e)||{overUse:0,underUse:0,adaptationList:JV(s)},{adaptationList:u}=l;Ng.set(e,l);let{OVERUSE_TIMES_THRESHOLD:h,UNDERUSE_TIMES_THRESHOLD:f}=bR,{scale:m}=i,E,S;return typeof t=="number"&&t>0&&function(y,A,T,w){if(A>=T.length)return!1;let{threshold:{fps_down:O}}=T[A];return x("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(O=T[0].threshold.fps_down),y<O}(t,m,u,c)&&(l.overUse++,S=Og.CPU,l.overUse>h)||typeof r=="number"&&r>0&&function(y,A,T){if(A>=T.length)return!1;let{threshold:{bwe_down:w}}=T[A];return y<w}(r,m,u)&&(l.overUse++,S=Og.BANDWIDTH,l.overUse>h)?(l.overUse=0,l.underUse=0,E=qV(i,u,c,dh.DOWN),[E,S]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&function(y,A,T,w){if(A===0)return;let{threshold:{fps_up:O}}=T[A];return x("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(O=T[1].threshold.fps_up),y>O}(t,m,u,c)&&function(y,A,T){if(A===0)return;let{threshold:{bwe_up:w}}=T[A];return y>w}(r,m,u)&&(l.underUse++,l.underUse>f&&(l.overUse=0,l.underUse=0,E=qV(i,u,c,dh.UP),E.scale===0&&(S=Og.NONE))),[E,S])}function XV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function f0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Ore(e){var t;return!!x("ENABLE_AG_ADAPTATION")&&!!(e instanceof Qw||ge(t=e._hints).call(t,Ft.CUSTOM_TRACK))&&(!!x("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(r){let i=dt();if(i.os!==Yr.IOS||!i.osVersion)return!1;let s=i.osVersion.split(".");return Number(s[0])>=r}(14)&&sL(17,4)||oL(14)&&aL(17,4)))}let Dg=new Map;function Pg(e){let t=Dg.get(e);if(t){let{timer:r,adaptationFunc:i,originConfig:s}=t;window.clearTimeout(r),i(s),Dg.delete(e)}YV(e)}var pt;function $V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function al(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$V(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$V(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let Ks=(pt=class fm extends FE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return ge(r=Object.keys(Du)).call(r,t)}))]}constructor(t,r){super(t,r),b(this,"store",void 0),b(this,"peerConnection",void 0),b(this,"id",kt(5,"connection-")),b(this,"remoteSDP",void 0),b(this,"initialOffer",void 0),b(this,"transportEventReceiver",void 0),b(this,"statsFilter",void 0),b(this,"useXR",x("USE_XR")),b(this,"localCapabilities",void 0),b(this,"remoteCodecs",void 0),b(this,"localCandidateCount",0),b(this,"allCandidatesReceived",!1),b(this,"dataStreamChannelMap",new Map),b(this,"establishPromise",void 0),b(this,"recoveredDataChannelIds",[]),b(this,"currentDataChannelId",1),b(this,"mutex",new rn("P2PConnection-mutex")),b(this,"qualityLimitationReason",Og.NONE),this.store=r,this.peerConnection=new RTCPeerConnection(fm.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Tg(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,Dt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void v.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){let i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);let c=this.remoteSDP.toString();s==null||s(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}else v.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=Bs(t.sdp),i=await l0({filterRTX:!x("USE_PUB_RTX")&&!x("USE_SUB_RTX"),filterVideoFec:x("FILTER_VIDEO_FEC"),filterAudioFec:x("FILTER_AUDIO_FEC"),filterVideoCodec:x("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=ch(i),this.initialOffer=t,al(al({},r),{},{rtpCapabilities:i,offerSDP:t.sdp})}catch(t){throw new ee(N.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,r,i,s,c,l){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return Vt(this._localCapabilities)}get rtpCapabilities(){return Vt(this._rtpCapabilities)}get candidates(){return Vt(this._candidates)}get iceParameters(){return Vt(this._iceParameters)}get dtlsParameters(){return Vt(this._dtlsParameters)}constructor(y){b(this,"sessionDesc",void 0),b(this,"_localCapabilities",void 0),b(this,"_rtpCapabilities",void 0),b(this,"_candidates",void 0),b(this,"_iceParameters",void 0),b(this,"_dtlsParameters",void 0),b(this,"setup",void 0),b(this,"currentMidIndex",void 0),b(this,"cname",void 0),b(this,"firefoxSsrcMidMap",new Map),y=Vt(y);let{remoteIceParameters:A,remoteDtlsParameters:T,candidates:w,remoteRTPCapabilities:O,remoteSetup:P,localCapabilities:F,cname:W}=y,K=$t.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=O,this._candidates=w,this._iceParameters=A,this._dtlsParameters=T,this._localCapabilities=F,this.setup=P,this.cname=W;let X=this.rtpCapabilities.send;for(let ie of K.mediaDescriptions){if(ie.attributes.iceUfrag=A.iceUfrag,ie.attributes.icePwd=A.icePwd,ie.attributes.fingerprints=T.fingerprints,ie.attributes.candidates=w,ie.attributes.setup=P,ie.media.mediaType==="video"&&(ie.media.fmts=X.videoCodecs.map(ae=>ae.payloadType.toString(10)),ie.attributes.payloads=X.videoCodecs,ie.attributes.extmaps=X.videoExtensions,x("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:ae,ssrcGroups:le}=io([{ssrcId:KV,rtx:x("USE_SUB_RTX")?40001:void 0}],this.cname);ie.attributes.ssrcs=ae,ie.attributes.ssrcGroups=le}if(ie.media.mediaType==="audio"&&(ie.media.fmts=X.audioCodecs.map(ae=>ae.payloadType.toString(10)),ie.attributes.payloads=X.audioCodecs,ie.attributes.extmaps=X.audioExtensions,Ws(ie),x("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:ae,ssrcGroups:le}=io([{ssrcId:2e4}],this.cname);ie.attributes.ssrcs=ae,ie.attributes.ssrcGroups=le}}this.sessionDesc=K,this.currentMidIndex=K.mediaDescriptions.length-1}preloadRemoteMedia(){let y=x("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;let A=this.candidates,T=this.dtlsParameters,w=this.iceParameters,O=this.rtpCapabilities.send;for(let P=1;P<y;P++){let F=2*P+2e4,W=2*P+KV,{ssrcs:K,ssrcGroups:X}=io([{ssrcId:F}],this.cname),{ssrcs:ie,ssrcGroups:ae}=io([{ssrcId:W,rtx:x("USE_SUB_RTX")?W+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:jf,protos:["UDP","TLS","RTP","SAVPF"],fmts:O.videoCodecs.map(le=>le.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:w.iceUfrag,icePwd:w.icePwd,unrecognized:[],candidates:A,extmaps:O.videoExtensions,fingerprints:T.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ie,ssrcGroups:ae,rtcpFeedbackWildcards:[],payloads:O.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*P)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:jf,protos:["UDP","TLS","RTP","SAVPF"],fmts:O.audioCodecs.map(le=>le.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:w.iceUfrag,icePwd:w.icePwd,unrecognized:[],candidates:A,extmaps:O.audioExtensions,fingerprints:T.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:K,ssrcGroups:X,rtcpFeedbackWildcards:[],payloads:O.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*P+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return $t.print(this.sessionDesc)}send(y,A,T,w){let{ssrcs:O,ssrcGroups:P}=io(A,this.cname,x("SYNC_GROUP")?T:void 0),F=this.findPreloadMediaDesc(O);if(F){if(Dt()&&this.firefoxSsrcMidMap.set(O[0].ssrcId,F.attributes.mid),w&&(w.twcc||w.remb)){let W=this.sessionDesc.mediaDescriptions.indexOf(F);return this.sessionDesc.mediaDescriptions[W]=this.mungSendMediaDesc(F,w),{mid:F.attributes.mid,needExchangeSDP:!0}}return{mid:F.attributes.mid,needExchangeSDP:!1}}{let W=this.findAvailableMediaIndex(y,O),K;return W===-1||W===1&&(Jr()||lL())||W===0&&x("USE_SUB_RTX")||dL()?(K=this.createOrRecycleSendMedia(y,O,P,"sendonly",w),this.updateBundleMids()):(K=Vt(this.sessionDesc.mediaDescriptions[W]),K.attributes.direction="sendonly",K.attributes.ssrcs=O,K.attributes.ssrcGroups=P,this.sessionDesc.mediaDescriptions[W]=this.mungSendMediaDesc(K,w)),Dt()&&this.firefoxSsrcMidMap.set(O[0].ssrcId,K.attributes.mid),{mid:K.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:y,needExchangeSDP:A}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:y.attributes.mid,needExchangeSDP:A}}batchSend(y){let A=y.map(O=>{let{kind:P,ssrcMsg:F,mslabel:W}=O;return this.send(P,F,W)}),T=[],w=!1;return A.forEach(O=>{let{mid:P,needExchangeSDP:F}=O;F&&(w=!0),T.push(P)}),{mids:T,needExchangeSDP:w}}stopSending(y){let A=this.sessionDesc.mediaDescriptions.filter(T=>T.attributes.mid&&y.indexOf(T.attributes.mid)!==-1);if(A.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");A.forEach(T=>{T.attributes.mid==="0"||Dt()||dL()?T.attributes.ssrcs=[]:(T.attributes.ssrcs=[],T.attributes.direction="inactive",T.media.port="0")}),this.updateBundleMids()}mute(y){let A=this.sessionDesc.mediaDescriptions.find(T=>T.attributes.mid===y);if(!A)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.mute."));A.attributes.direction="inactive"}unmute(y){let A=this.sessionDesc.mediaDescriptions.find(T=>T.attributes.mid===y);if(!A)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.unmute."));A.attributes.direction="sendonly"}muteRemote(y){let A=this.sessionDesc.mediaDescriptions.filter(T=>ge(y).call(y,T.attributes.mid||""));if(A.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");A.forEach(T=>{T.attributes.direction="inactive"})}unmuteRemote(y){let A=this.sessionDesc.mediaDescriptions.filter(T=>ge(y).call(y,T.attributes.mid||""));if(A.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");A.forEach(T=>{T.attributes.direction="recvonly"})}receive(y,A,T,w){y.forEach((O,P)=>{this.createOrRecycleRecvMedia(O,[],"recvonly",A,T,w[P])}),this.updateBundleMids()}stopReceiving(y){let A=this.sessionDesc.mediaDescriptions.filter(T=>y.indexOf(T.attributes.mid)!==-1);if(A.length!==y.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");A.forEach(T=>{T.media.port="0",T.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(y){let A=this._candidates.filter(T=>T.transport==="udp");if(y===Gn.TCP){if(A.length===0)return;if(x("TCP_CANDIDATE_ONLY")){let T=this._candidates.filter(w=>w.transport==="tcp");A.forEach(w=>{T.findIndex(O=>O.connectionAddress===w.connectionAddress)===-1&&T.push(sl(sl({},w),{},{foundation:"tcpcandidate",priority:Number(w.priority)-1+"",transport:"tcp",port:Number(w.port)+90+""}))}),this._candidates=T}else{let T=[];A.forEach(w=>{T.push(sl(sl({},w),{},{foundation:"tcpcandidate",priority:Number(w.priority)-1+"",transport:"tcp",port:Number(w.port)+90+""}))}),this._candidates=[...A,...T]}}else if(y===Gn.RELAY){if(A.length!==0)return;{let T=this._candidates.filter(w=>w.transport==="tcp");T.forEach(w=>{A.push(sl(sl({},w),{},{foundation:"udpcandidate",priority:Number(w.priority)+1+"",transport:"udp",port:Number(w.port)-90+""}))}),this._candidates=[...A,...T]}}else A.length===0?(this._candidates.filter(T=>T.transport==="tcp").forEach(T=>{A.push(sl(sl({},T),{},{foundation:"udpcandidate",priority:Number(T.priority)+1+"",transport:"udp",port:Number(T.port)-90+""}))}),this._candidates=A):this._candidates=this._candidates.filter(T=>T.transport!=="tcp");for(let T of this.sessionDesc.mediaDescriptions)T.attributes.candidates=this.candidates}restartICE(y){y=Vt(y),this._iceParameters=y,this.sessionDesc.mediaDescriptions.forEach(A=>{A.attributes.iceUfrag=y.iceUfrag,A.attributes.icePwd=y.icePwd})}predictReceivingMids(y){let A=[];for(let T=0;T<y;T++)A.push((this.currentMidIndex+T+1).toString(10));return A}findAvailableMediaIndex(y,A){return this.sessionDesc.mediaDescriptions.findIndex(T=>{let w=T.media.mediaType===y&&T.media.port!=="0"&&(T.attributes.direction==="sendonly"||T.attributes.direction==="sendrecv")&&T.attributes.ssrcs.length===0;if(Dt()){if(w){let O=this.firefoxSsrcMidMap.get(A[0].ssrcId);return!(O||T.attributes.mid!=="0"&&T.attributes.mid!=="1")||!(!O||O!==T.attributes.mid)}return!1}return w})}createOrRecycleDataChannel(){for(let T of this.sessionDesc.mediaDescriptions)if(T.media.mediaType==="application")return{mediaDesc:T,needExchangeSDP:!1};this.currentMidIndex+=1;let y="".concat(this.currentMidIndex),A={media:{mediaType:"application",port:jf,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(y),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(A),{mediaDesc:A,needExchangeSDP:!0}}createOrRecycleRecvMedia(y,A,T,w,O,P){let F=y._mediaStreamTrack.kind,W=this.rtpCapabilities.recv,K=vd(F,W,this.localCapabilities.send,F===Ie.VIDEO?w:O),X=F===Ie.VIDEO?W.videoExtensions:W.audioExtensions;this.currentMidIndex+=1;let ie="".concat(this.currentMidIndex),ae={media:{mediaType:F,port:jf,protos:["UDP","TLS","RTP","SAVPF"],fmts:K.map(we=>we.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:X,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:A,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:K,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:T,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ie)}};ae=this.mungRecvMediaDsec(ae,y,P);let le=this.findFirstClosedMedia(F);if(le){let we=this.sessionDesc.mediaDescriptions.indexOf(le);this.sessionDesc.mediaDescriptions[we]=ae}else this.sessionDesc.mediaDescriptions.push(ae);return ae}updateRemoteCodec(y,A,T){let w=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ae=>ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"").filter(ae=>{var le;return ge(le=Object.keys(Du)).call(le,ae)}))],O=new Set(A);if(w.every(ae=>O.has(ae)))return v.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(A)),!1;let P=this._rtpCapabilities.recv.videoCodecs.filter(ae=>A.some(le=>{var we;return ge(we=ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"").call(we,le)}));if(P.length===0)return v.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(w," codecs: ").concat(A)),!1;let F=[...new Set(P.map(ae=>ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||""))],W;if(v.debug("updateRemoteCodec, from ".concat(w," to ").concat(F)),y.length===0)W=this.sessionDesc.mediaDescriptions.filter(ae=>ae.media.mediaType==="video"&&ae.attributes.direction==="recvonly");else if(W=this.sessionDesc.mediaDescriptions.filter(ae=>ae.attributes.mid&&ge(y).call(y,ae.attributes.mid)&&ae.attributes.direction==="recvonly"),W.length!==y.length)return v.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(y,", codecs: ").concat(A)),!1;if(x("USE_PUB_RTX")||x("USE_SUB_RTX")){let ae=d0(P,this.rtpCapabilities.recv.videoCodecs);P.push(...ae)}this._rtpCapabilities.recv.videoCodecs=P;let K=this.localCapabilities.send,X=this.rtpCapabilities.recv,ie=vd(Ie.VIDEO,X,K,T);return W.forEach(ae=>{let le=ie.map(we=>we.payloadType.toString(10));v.debug("updateRemoteCodec mid: ".concat(ae.attributes.mid,", from ").concat(ae.attributes.payloads," to ").concat(ie)),ae.attributes.payloads=ie,ae.media.fmts=le}),!0}createOrRecycleSendMedia(y,A,T,w,O){let P=this.rtpCapabilities.send,F=y===Ie.VIDEO?P.videoCodecs:P.audioCodecs,W=y===Ie.VIDEO?P.videoExtensions:P.audioExtensions;this.currentMidIndex+=1;let K="".concat(this.currentMidIndex),X={media:{mediaType:y,port:jf,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map(ae=>ae.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:W,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:A,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:w,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(K)}};X=this.mungSendMediaDesc(X,O);let ie=this.findFirstClosedMedia(y);if(ie){let ae=this.sessionDesc.mediaDescriptions.indexOf(ie);this.sessionDesc.mediaDescriptions[ae]=X}else this.sessionDesc.mediaDescriptions.push(X);return X}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(y=>y.media.port!=="0").map(y=>y.attributes.mid)}mungRecvMediaDsec(y,A,T){let w=Vt(y);return Cg(w),rl(w,A),Rg(w,A),a0(w),ah(w,T,this.localCapabilities.send),w}mungSendMediaDesc(y,A){let T=Vt(y);return ah(T,A,this.localCapabilities.recv),Ws(T),T}updateRecvMedia(y,A){let T=this.sessionDesc.mediaDescriptions.findIndex(w=>w.attributes.mid===y);if(T!==-1){let w=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[T],A);this.sessionDesc.mediaDescriptions[T]=w}}bumpMid(y){this.currentMidIndex+=y}findFirstClosedMedia(y){return this.sessionDesc.mediaDescriptions.find(A=>Dt()?A.media.port==="0"&&A.media.mediaType===y:A.media.port==="0")}findPreloadMediaDesc(y){return this.sessionDesc.mediaDescriptions.find(A=>{var T;return((T=A.attributes)===null||T===void 0||(T=T.ssrcs[0])===null||T===void 0?void 0:T.ssrcId)===y[0].ssrcId})}getSSRC(y){var A;return(A=this.sessionDesc.mediaDescriptions.find(T=>T.attributes.mid===y))===null||A===void 0?void 0:A.attributes.ssrcs}}({remoteIceParameters:t,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:s,remoteSetup:c,localCapabilities:this.localCapabilities,cname:l}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let u=this.remoteSDP.toString(),h=$t.parse(this.initialOffer.sdp),f=h.mediaDescriptions.find(y=>y.media.mediaType==="audio");f&&Ws(f),this.useXR&&wg(h);let m=$t.print(h),E=this.logSDPExchange(m||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:m}),E==null||E(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u});let S=this.peerConnection.getTransceivers()[0];if(S!=null&&S.receiver&&this.tryBindTransportEvents(S.receiver),x("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();let y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});let A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A)}}catch(u){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(u.toString()))}}send(t,r,i){var s=this;return Ui(function*(){let c=yield Ye(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let l=[];t.forEach(T=>{let w=s.peerConnection.addTransceiver(T._mediaStreamTrack,{direction:"sendonly"});l.push(w),T._updateRtpTransceiver(w)}),Dt()&&x("SIMULCAST")===!0&&(yield Ye(s.applySimulcastForFirefox(l,t)));let u=yield Ye(s.peerConnection.createOffer()),h=s.remoteSDP.predictReceivingMids(t.length),f=s.mungSendOfferSDP(u.sdp,t,h),m=$t.parse(f),E=h.map(T=>{let w=m.mediaDescriptions.find(O=>O.attributes.mid===T);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return s0(w,x("USE_PUB_RTX"))}),S;try{S=yield E}catch(T){S=[],s.remoteSDP.receive(t,r,i,S);let w=s.remoteSDP.toString();throw yield Ye(s.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Ye(s.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield Ye(s.stopSending(h,!0)),T}s.remoteSDP.receive(t,r,i,S);let y=s.remoteSDP.toString(),A=s.logSDPExchange(f,"offer","local","send");return yield Ye(s.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Ye(s.applySimulcastEncodings(l,t)),yield Ye(s.applySendEncodings(l,t)),A==null||A(y),yield Ye(s.peerConnection.setRemoteDescription({type:"answer",sdp:y})),l.map((T,w)=>{let O=h[w];return{localSSRC:E[w],id:O,transceiver:T}})}catch(l){throw l instanceof ee?l:new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{c()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")v.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let c=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof c!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:c,negotiated:!0,ordered:!1,maxRetransmits:x("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}r.forEach(c=>{c._updateOriginDataChannel(i)});let{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){let c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});let l=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(l),v.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else v.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof ee?i:new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{let r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof ee?r:new ee(N.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){let i=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let s=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(h=>{var f;Pg(this.id+h.mid),h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});let c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);let u=this.remoteSDP.toString();l==null||l(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,r,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:c,needExchangeSDP:l}=this.remoteSDP.send(t,r,i,s);if(l){let h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});let m=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(m.sdp,c,t);f==null||f(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}}catch(c){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:r,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){let s=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let l=await this.peerConnection.createAnswer();c==null||c(l.sdp||""),await this.peerConnection.setLocalDescription(l),v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return r.map(s=>{let c=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s,transceiver:c}})}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(l=>{l.direction="inactive"});let i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);let c=this.remoteSDP.toString();s==null||s(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(l,u)=>{l.direction="sendonly"});let i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);let c=this.remoteSDP.toString();s==null||s(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new ee(N.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Ui(function*(){let i=yield Ye(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(at().supportPCSetConfiguration){let f=r.peerConnection.getConfiguration(),m=t===Gn.RELAY?"relay":"all";f.iceTransportPolicy!==m&&(v.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(m,"]")),f.iceTransportPolicy=m,r.peerConnection.setConfiguration(f))}else if(t===Gn.RELAY)return;r.remoteSDP.updateCandidates(t);let s=yield Ye(r.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let c=Bs(s.sdp),{remoteIceParameters:l}=yield c.iceParameters;r.remoteSDP.restartICE(l);let u=r.remoteSDP.toString(),h=r.logSDPExchange(s.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Ye(r.peerConnection.setLocalDescription(s)),h==null||h(u),yield Ye(r.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(s){v.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{Pg(this.id+r.mid)}),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return al(al({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let c=this.remoteSDP.toString(),l=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),l==null||l(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new ee(N.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){let i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(r)?Dt()||await this.applySimulcastEncodings(i,[r]):await this.applySendEncodings(i,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let i=this.peerConnection.getTransceivers().find(s=>s.mid===r);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:i,remote:s}=r.getSelectedCandidatePair();return{local:al(al({},ba),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:al(al({},ba),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Au(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...fm.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...fm.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(r.iceTransportPolicy="relay")}))),x("ENABLE_ENCODED_TRANSFORM")&&at().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(i=>{i.security?i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Yc(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!x("FORCE_TURN_TCP")&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),r}tryBindTransportEvents(t){let r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var s;r!=null&&r.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,r.state))},r.onerror=s=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in s?s.error:s)};let i=r.iceTransport;i&&(i.onstatechange=()=>{let s=r==null?void 0:r.iceTransport.state;var c;s&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){let{local:s,remote:c}=i.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var i,s;if(r||(r=this.peerConnection.getSenders().find(T=>T.track===t._mediaStreamTrack)),!r)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!at().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let c={},l={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;case"balanced":c.degradationPreference="balanced"}let u=function(T,w){return T.getTransceivers().find(O=>O.sender.track===w||O.receiver.track===w)}(this.peerConnection,t._mediaStreamTrack),h=Qte(t);if(Ore(t)&&u&&r&&h&&this.getLocalVideoStats&&ge(i=["vp8","vp9"]).call(i,this.store.codec)){var f;let T=c.degradationPreference||(ge(f=t._hints).call(f,Ft.CUSTOM_TRACK)?x("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(w,O,P,F,W,K){if(Pg(w),F!=="balanced"&&F!=="maintain-framerate"&&F!=="maintain-resolution")return;let X=-1;YV(w,O);let ie=window.setInterval(()=>{let le=Dg.get(w);if(!x("ENABLE_AG_ADAPTATION")||!le)return void Pg(w);let we=K();if(we.sendPackets>0&&we.OutgoingAvailableBandwidth>0){if(X===-1)return void(X=Date.now());if(Date.now()-X<1e3)return;let nt=we.sendFrameRate,gt=we.OutgoingAvailableBandwidth,[jt,wr]=Are(w,nt,gt,le.adaptationConfig,O,F);wr&&(P.qualityLimitationReason=wr),jt&&le.adaptationConfig.scale!==jt.scale&&(v.debug("[".concat(w,"] applyAdaptation: ").concat(P.qualityLimitationReason,`
           sendFps `).concat(nt,", bwe ").concat(gt,", switch from ").concat(le.adaptationConfig.scale," to ").concat(jt.scale," ")),le.adaptationConfig=f0(f0({},le.adaptationConfig),jt),W(jt))}},x("CHECK_LOCAL_STATS_INTERVAL")),ae=f0({},O);Dg.set(w,{timer:ie,adaptationConfig:ae,originConfig:O,adaptationFunc:W}),v.debug("[".concat(w,"] start adaptation, originConfig: ").concat(JSON.stringify(O),", degradationPreference: ").concat(F))})(this.id+u.mid,h,this,T,w=>{r&&this.updateAdaptation(r,w)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var m;let{bitrateMax:T,frameRate:w,scaleResolutionDownBy:O}=t._encoderConfig;T&&(l.maxBitrate=1e3*T),(ge(m=t._hints).call(m,Ft.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(w&&(l.maxFramerate=vi(w)),O&&O>=1&&(l.scaleResolutionDownBy=O))}let{maxFramerate:E}=x("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(l.maxFramerate=l.maxFramerate?Math.min(l.maxFramerate,E):E),x("DSCP_TYPE")&&Bc()){var S;let T=x("DSCP_TYPE");ge(S=["very-low","low","medium","high"]).call(S,T)&&(l.networkPriority=T)}let y=r.getParameters(),A=(s=y.encodings)===null||s===void 0?void 0:s[0];Dt()&&!A&&(c.encodings=[l]),A&&Object.assign(A,l),Object.assign(y,c),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await r.setParameters(y)}async updateAdaptation(t,r){var i,s;if(!t)return v.debug("[updateAdaptation] no rtpSender found");if(!at().supportSetRtpSenderParameters)return v.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let c={},{bitrateMax:l,frameRate:u,scaleResolutionDownBy:h}=r;l&&(c.maxBitrate=1e3*l),u&&(c.maxFramerate=vi(u)),h&&h>=1&&ge(i=["vp8","vp9"]).call(i,this.store.codec)&&(c.scaleResolutionDownBy=h);let f=t.getParameters(),m=(s=f.encodings)===null||s===void 0?void 0:s[0];m&&Object.assign(m,c),Object.assign(f,{});try{await t.setParameters(f),v.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(E){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?v.debug("[updateAdaptation] peerConnection not connected}"):v.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):v.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!at().supportSetRtpSenderParameters||t.length!==r.length)return;for(let i=0;i<t.length;i++){let s=t[i],c=r[i];c instanceof Lt&&!this.isVP8Simulcast(c)&&await this.updateRtpSenderEncodings(c,s.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,i){let s=$t.parse(t);return r.forEach((c,l)=>{let u=i[l],h=s.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(rl(h,c),c0(h,c,this.store.codec))}),$t.print(s)}mungReceiveAnswerSDP(t,r,i){let s=$t.parse(t),c=s.mediaDescriptions.find(l=>l.attributes.mid===r);return c&&(i===Ie.AUDIO&&c.media.mediaType==="audio"&&Ws(c),this.useXR&&wg(s)),$t.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,r,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let h=0;h<t.length;h++){var i,s,c,l,u;let f=t[h],m=r[h];if(m instanceof Lt&&!ge(i=m._hints).call(i,Ft.LOW_STREAM)&&(s=m._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=m._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=m._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=m._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){let E={},S={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];let y=f.sender.getParameters();await f.sender.setParameters(Object.assign(y,E))}}}async applySimulcastEncodings(t,r){if(!Dt()&&t.length===r.length)for(let i=0;i<t.length;i++){let s=r[i];if(s instanceof Lt&&this.isVP8Simulcast(s)){let c=t[i],l={},u={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];let h=c.sender.getParameters();await c.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(t){var r,i,s,c,l;return!!(t instanceof Lt&&x("SIMULCAST")&&this.store.codec==="vp8"&&!ge(r=t._hints).call(r,Ft.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,r,i,s){if(x("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(r," SDP during P2PConnection.").concat(s,`
`),t),r==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(at().supportPCSetConfiguration){let r=fm.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},fe(pt.prototype,"updateRemoteRTPCapabilities",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"updateRemoteRTPCapabilities"),pt.prototype),fe(pt.prototype,"connect",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"connect"),pt.prototype),fe(pt.prototype,"createDataChannels",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"createDataChannels"),pt.prototype),fe(pt.prototype,"receive",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"receive"),pt.prototype),fe(pt.prototype,"batchReceive",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"batchReceive"),pt.prototype),fe(pt.prototype,"stopReceiving",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"stopReceiving"),pt.prototype),fe(pt.prototype,"muteRemote",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"muteRemote"),pt.prototype),fe(pt.prototype,"unmuteRemote",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteRemote"),pt.prototype),fe(pt.prototype,"muteLocal",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"muteLocal"),pt.prototype),fe(pt.prototype,"unmuteLocal",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteLocal"),pt.prototype),fe(pt.prototype,"close",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"close"),pt.prototype),fe(pt.prototype,"updateEncoderConfig",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"updateEncoderConfig"),pt.prototype),fe(pt.prototype,"updateSendParameters",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"updateSendParameters"),pt.prototype),fe(pt.prototype,"replaceTrack",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"replaceTrack"),pt.prototype),fe(pt.prototype,"updateAdaptation",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"updateAdaptation"),pt.prototype),fe(pt.prototype,"getRemoteSSRC",[Ti],Object.getOwnPropertyDescriptor(pt.prototype,"getRemoteSSRC"),pt.prototype),pt);function Ti(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let s=this.mutex,c=await s.lock("From P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{c()}},r}function QV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function ZV(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QV(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let eF=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,kg="9",m0=2e4,_0=4e4;class Nre{get localCapabilities(){return Vt(this._localCapabilities)}get rtpCapabilities(){return Vt(this._rtpCapabilities)}get candidates(){return Vt(this._candidates)}get iceParameters(){return Vt(this._iceParameters)}get dtlsParameters(){return Vt(this._dtlsParameters)}constructor(t){b(this,"sessionDesc",void 0),b(this,"_localCapabilities",void 0),b(this,"_rtpCapabilities",void 0),b(this,"_candidates",void 0),b(this,"_iceParameters",void 0),b(this,"_dtlsParameters",void 0),b(this,"setup",void 0),b(this,"currentMidIndex",void 0),b(this,"cname",void 0),b(this,"firefoxSsrcMidMap",new Map),t=Vt(t);let{remoteIceParameters:r,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c,remoteSetup:l,localCapabilities:u,cname:h}=t,f=$t.parse(eF);this._rtpCapabilities=c,this._candidates=s,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u,this.setup=l,this.cname=h;let m=this.rtpCapabilities.send;for(let E of f.mediaDescriptions){if(E.attributes.iceUfrag=r.iceUfrag,E.attributes.icePwd=r.icePwd,E.attributes.fingerprints=i.fingerprints,E.attributes.candidates=s,E.attributes.setup=l,E.media.mediaType==="application"&&(E.attributes.sctpPort="5000"),E.media.mediaType==="video"&&(E.media.fmts=m.videoCodecs.map(S=>S.payloadType.toString(10)),E.attributes.payloads=m.videoCodecs,E.attributes.extmaps=m.videoExtensions,x("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:S,ssrcGroups:y}=io([{ssrcId:_0,rtx:x("USE_SUB_RTX")?40001:void 0}],this.cname);E.attributes.ssrcs=S,E.attributes.ssrcGroups=y}if(E.media.mediaType==="audio"&&(E.media.fmts=m.audioCodecs.map(S=>S.payloadType.toString(10)),E.attributes.payloads=m.audioCodecs,E.attributes.extmaps=m.audioExtensions,Ws(E),x("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:S,ssrcGroups:y}=io([{ssrcId:m0}],this.cname);E.attributes.ssrcs=S,E.attributes.ssrcGroups=y}}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){let r=$t.parse(eF);this._rtpCapabilities=t;let i=this.rtpCapabilities.send;for(let s of r.mediaDescriptions){if(s.attributes.iceUfrag=this._iceParameters.iceUfrag,s.attributes.icePwd=this._iceParameters.icePwd,s.attributes.fingerprints=this._dtlsParameters.fingerprints,s.attributes.candidates=this._candidates,s.attributes.setup=this.setup,s.media.mediaType==="application"&&(s.attributes.sctpPort="5000"),s.media.mediaType==="video"&&(s.media.fmts=i.videoCodecs.map(c=>c.payloadType.toString(10)),s.attributes.payloads=i.videoCodecs,s.attributes.extmaps=i.videoExtensions,x("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:c,ssrcGroups:l}=io([{ssrcId:_0,rtx:x("USE_SUB_RTX")?40001:void 0}],this.cname);s.attributes.ssrcs=c,s.attributes.ssrcGroups=l}if(s.media.mediaType==="audio"&&(s.media.fmts=i.audioCodecs.map(c=>c.payloadType.toString(10)),s.attributes.payloads=i.audioCodecs,s.attributes.extmaps=i.audioExtensions,x("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:c,ssrcGroups:l}=io([{ssrcId:m0}],this.cname);s.attributes.ssrcs=c,s.attributes.ssrcGroups=l}}this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;let r=this.candidates,i=this.dtlsParameters,s=this.iceParameters,c=this.rtpCapabilities.send;for(let l=1;l<t;l++){let u=2*l+m0,h=2*l+_0,{ssrcs:f,ssrcGroups:m}=io([{ssrcId:u}],this.cname),{ssrcs:E,ssrcGroups:S}=io([{ssrcId:h,rtx:x("USE_SUB_RTX")?h+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:kg,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.videoCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:r,extmaps:c.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:S,rtcpFeedbackWildcards:[],payloads:c.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*l-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:kg,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.audioCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:r,extmaps:c.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:c.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*l)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return $t.print(this.sessionDesc)}send(t,r,i,s){let{ssrcs:c,ssrcGroups:l}=io(r,this.cname,x("SYNC_GROUP")?i:void 0),u=this.findPreloadMediaDesc(c);if(u){if(Dt()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,u.attributes.mid),s&&(s.twcc||s.remb)){let h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,s),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{let h=this.findAvailableMediaIndex(t,c),f;return h===-1||Jr()||bn()||lL()||h===0&&x("USE_SUB_RTX")?(f=this.createOrRecycleSendMedia(t,c,l,"sendonly",s),this.updateBundleMids()):(f=Vt(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="sendonly",f.attributes.ssrcs=c,f.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(f,s)),Dt()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,f.attributes.mid),{mid:f.attributes.mid,needExchangeSDP:!0}}}batchSend(t){let r=t.map(c=>{let{kind:l,ssrcMsg:u,mslabel:h}=c;return this.send(l,u,h)}),i=[],s=!1;return r.forEach(c=>{let{mid:l,needExchangeSDP:u}=c;u&&(s=!0),i.push(l)}),{mids:i,needExchangeSDP:s}}stopSending(t){let r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.mid==="0"||Dt()||Jr()||bn()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){let r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){let r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(t){let r=this.sessionDesc.mediaDescriptions.filter(i=>ge(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){let r=this.sessionDesc.mediaDescriptions.filter(i=>ge(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,r,i,s){t.forEach((c,l)=>{this.createOrRecycleRecvMedia(c,[],"recvonly",r,i,s[l])}),this.updateBundleMids()}stopReceiving(t){let r=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===Gn.TCP?this._candidates.forEach(r=>{this._candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===r.connectionAddress&&i.port===r.port)===-1&&this._candidates.push(ZV(ZV({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}):this._candidates=this._candidates.filter(r=>r.transport!=="tcp");for(let r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(t){t=Vt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}findAvailableMediaIndex(t,r){return this.sessionDesc.mediaDescriptions.findIndex(i=>{let s=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Dt()){if(s){let c=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(c||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!c||c!==i.attributes.mid)}return!1}return s})}createOrRecycleRecvMedia(t,r,i,s,c,l){let u=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=vd(u,h,this.localCapabilities.send,u===Ie.VIDEO?s:c),m=u===Ie.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;let E="".concat(this.currentMidIndex),S={media:{mediaType:u,port:kg,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};S=this.mungRecvMediaDsec(S,t,l);let y=this.findFirstClosedMedia(u);if(y){let A=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[A]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}updateRemoteCodec(t,r,i){let s=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(S=>S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"").filter(S=>{var y;return ge(y=Object.keys(Du)).call(y,S)}))],c=new Set(r);if(s.every(S=>c.has(S)))return v.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r)),!1;let l=this._rtpCapabilities.recv.videoCodecs.filter(S=>r.some(y=>{var A;return ge(A=S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"").call(A,y)}));if(l.length===0)return v.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(s," codecs: ").concat(r)),!1;let u=[...new Set(l.map(S=>S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||""))],h;if(v.debug("updateRemoteCodec, from ".concat(s," to ").concat(u)),t.length===0)h=this.sessionDesc.mediaDescriptions.filter(S=>S.media.mediaType==="video"&&S.attributes.direction==="recvonly");else if(h=this.sessionDesc.mediaDescriptions.filter(S=>S.attributes.mid&&ge(t).call(t,S.attributes.mid)&&S.attributes.direction==="recvonly"),h.length!==t.length)return v.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(r)),!1;this._rtpCapabilities.recv.videoCodecs=l;let f=this.localCapabilities.send,m=this.rtpCapabilities.recv,E=vd(Ie.VIDEO,m,f,i);return h.forEach(S=>{let y=E.map(A=>A.payloadType.toString(10));v.debug("updateRemoteCodec mid: ".concat(S.attributes.mid,", from ").concat(S.attributes.payloads," to ").concat(E)),S.attributes.payloads=E,S.media.fmts=y}),!0}createOrRecycleSendMedia(t,r,i,s,c){let l=this.rtpCapabilities.send,u=t===Ie.VIDEO?l.videoCodecs:l.audioCodecs,h=t===Ie.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;let f="".concat(this.currentMidIndex),m={media:{mediaType:t,port:kg,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};m=this.mungSendMediaDesc(m,c);let E=this.findFirstClosedMedia(t);if(E){let S=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[S]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,r,i){let s=Vt(t);return Cg(s),rl(s,r),Rg(s,r),a0(s),ah(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,r){let i=Vt(t);return ah(i,r,this.localCapabilities.recv),Ws(i),i}updateRecvMedia(t,r){let i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){let s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>Dt()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}getSSRC(t){var r;return(r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs}}var ft;function tF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function Lg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tF(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tF(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let Dre=(ft=class qS extends FE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let t;return this.localCapabilities&&(t=ch(this.localCapabilities)),[...new Set(t&&t.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return ge(i=Object.keys(Du)).call(i,r)}))]}constructor(t,r,i){super(t,r),b(this,"store",void 0),b(this,"peerConnection",void 0),b(this,"remoteSDP",void 0),b(this,"initialOffer",void 0),b(this,"transportEventReceiver",void 0),b(this,"statsFilter",void 0),b(this,"useXR",x("USE_XR")),b(this,"localCapabilities",void 0),b(this,"localCandidateCount",0),b(this,"allCandidatesReceived",!1),b(this,"remoteCodecs",void 0),b(this,"dataStreamChannelMap",new Map),b(this,"establishPromise",void 0),b(this,"mutex",new rn("NVExtentionsConnection-mutex")),b(this,"rtcMedia",void 0),this.store=r,this.peerConnection=i,this.statsFilter=Tg(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,Dt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{let r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=Bs(r.sdp),s=await l0({filterRTX:!x("USE_PUB_RTX")&&!x("USE_SUB_RTX"),filterVideoFec:x("FILTER_VIDEO_FEC"),filterAudioFec:x("FILTER_AUDIO_FEC"),filterVideoCodec:x("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=s,this.initialOffer=r,Lg(Lg({},i),{},{rtpCapabilities:s,offerSDP:r.sdp})}catch(r){throw new H(N.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t,r,i,s,c,l){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new Nre({remoteIceParameters:t,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:s,remoteSetup:c,localCapabilities:ch(this.localCapabilities),cname:l});let u=this.remoteSDP.toString(),h=$t.parse(this.initialOffer.sdp),f=h.mediaDescriptions.find(S=>S.media.mediaType==="audio");f&&Ws(f),this.useXR&&wg(h);let m=$t.print(h),E=this.logSDPExchange(m||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:m}),E==null||E(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(u){throw new H(N.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(u.toString()))}}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void v.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){let i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);let c=this.remoteSDP.toString();s==null||s(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}else v.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async updateRemoteConnect(t){var r,i,s,c;(r=this.remoteSDP)===null||r===void 0||r.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&((c=this.remoteSDP)===null||c===void 0||c.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),(i=this.remoteSDP)===null||i===void 0||i.preloadRemoteMedia(2);let l=(s=this.remoteSDP)===null||s===void 0?void 0:s.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});let u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u),v.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,r,i){var s=this;return Ui(function*(){let c=yield Ye(s.mutex.lock("From NVExtentionsConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");let l=[];t.forEach(T=>{let w=s.peerConnection.addTransceiver(T._mediaStreamTrack,{direction:"sendonly"});l.push(w)}),Dt()&&x("SIMULCAST")===!0&&(yield Ye(s.applySimulcastForFirefox(l,t)));let u=yield Ye(s.peerConnection.createOffer()),h=s.remoteSDP.predictReceivingMids(t.length),f=s.mungSendOfferSDP(u.sdp,t,h),m=$t.parse(f),E=h.map(T=>{let w=m.mediaDescriptions.find(O=>O.attributes.mid===T);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return s0(w,x("USE_PUB_RTX"))}),S;try{S=yield E}catch(T){S=[],s.remoteSDP.receive(t,r,i,S);let w=s.remoteSDP.toString();throw yield Ye(s.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Ye(s.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield Ye(s.stopSending(h,!0)),T}s.remoteSDP.receive(t,r,i,S);let y=s.remoteSDP.toString(),A=s.logSDPExchange(f,"offer","local","send");return yield Ye(s.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Ye(s.applySimulcastEncodings(l,t)),yield Ye(s.applySendEncodings(l,t)),A==null||A(y),yield Ye(s.peerConnection.setRemoteDescription({type:"answer",sdp:y})),l.map((T,w)=>{let O=h[w];return{localSSRC:E[w],id:O,transceiver:T}})}catch(l){throw l instanceof H?l:new H(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(l.toString()))}finally{c()}})()}async stopSending(t,r){let i=r?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");let s=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");s.map(h=>{var f;h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});let c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);let u=this.remoteSDP.toString();l==null||l(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new H(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);return i&&i.readyState==="open"?v.debug("[P2PConnection] Channels are already available and can be reused directly."):(i=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:x("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)),void r.forEach(s=>{s._updateOriginDataChannel(i)})}catch(i){throw i instanceof H?i:new H(N.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{let r=this.dataStreamChannelMap.get(t);return r==null||r.close(),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof H?r:new H(N.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(r.toString()))}}async receive(t,r,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));let{mid:c,needExchangeSDP:l}=this.remoteSDP.send(t,r,i,s);if(l){let h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});let m=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(m.sdp,c,t);f==null||f(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),v.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else v.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));let u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c}}catch(c){throw new H(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(c.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");let{mids:r,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){let s=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let l=await this.peerConnection.createAnswer();c==null||c(l.sdp||""),await this.peerConnection.setLocalDescription(l),v.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else v.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return r.map(s=>{let c=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s}})}catch(r){throw new H(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(r){throw new H(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(r){throw new H(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(r){throw new H(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(l=>{l.direction="inactive"});let i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);let c=this.remoteSDP.toString();s==null||s(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new H(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(l,u)=>{l.direction="sendonly"});let i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);let c=this.remoteSDP.toString();s==null||s(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new H(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Ui(function*(){let i=yield Ye(r.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(at().supportPCSetConfiguration){let f=r.peerConnection.getConfiguration(),m=t===Gn.RELAY?"relay":"all";f.iceTransportPolicy!==m&&(v.debug("restartICE change iceTransportPolicy from [".concat(f.iceTransportPolicy,"] to [").concat(m,"]")),f.iceTransportPolicy=m,r.peerConnection.setConfiguration(f))}else if(t===Gn.RELAY)return;t!==Gn.RELAY&&r.remoteSDP.updateCandidates(t);let s=yield Ye(r.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let c=Bs(s.sdp),{remoteIceParameters:l}=yield c.iceParameters;r.remoteSDP.restartICE(l);let u=r.remoteSDP.toString(),h=r.logSDPExchange(s.sdp||"","offer","local","restartICE");yield Ye(r.peerConnection.setLocalDescription(s)),h==null||h(u),yield Ye(r.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(s){v.warning("restart ICE failed, abort operation",s)}finally{i()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let c=this.remoteSDP.toString(),l=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),l==null||l(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new H(N.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){let i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(r)?Dt()||await this.applySimulcastEncodings(i,[r]):await this.applySendEncodings(i,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let i=this.peerConnection.getTransceivers().find(s=>s.mid===r);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return Lg(Lg({},Bs(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Au(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...qS.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...qS.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(i=>{i.security?i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Yc(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!x("FORCE_TURN_TCP")&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),r}async applySendEncodings(t,r){try{if(!at().supportSetRtpSenderParameters||t.length!==r.length)return;for(let E=0;E<t.length;E++){let S=t[E],y=r[E];if(y&&y instanceof Lt){var i,s,c;if(this.isVP8Simulcast(y))continue;let A={},T={};switch(y._optimizationMode){case"motion":A.degradationPreference="maintain-framerate";break;case"detail":A.degradationPreference="maintain-resolution";break;default:A.degradationPreference="balanced"}var l,u,h,f;if((i=y._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(T.maxBitrate=1e3*((l=y._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)),ge(s=y._hints).call(s,Ft.LOW_STREAM)&&((u=y._encoderConfig)!==null&&u!==void 0&&u.frameRate&&(T.maxFramerate=vi(y._encoderConfig.frameRate)),(h=y._encoderConfig)!==null&&h!==void 0&&h.scaleResolutionDownBy&&((f=y._encoderConfig)===null||f===void 0?void 0:f.scaleResolutionDownBy)>1&&(T.scaleResolutionDownBy=y._encoderConfig.scaleResolutionDownBy)),x("DSCP_TYPE")&&Bc()){var m;let P=x("DSCP_TYPE");ge(m=["very-low","low","medium","high"]).call(m,P)&&(T.networkPriority=P)}let w=S.sender.getParameters(),O=(c=w.encodings)===null||c===void 0?void 0:c[0];Dt()&&!O&&(A.encodings=[T]),O&&Object.assign(O,T),Object.assign(w,A),await S.sender.setParameters(w)}}}catch{v.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,r,i){let s=$t.parse(t);return r.forEach((c,l)=>{let u=i[l],h=s.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(rl(h,c),c0(h,c,this.store.codec))}),$t.print(s)}mungReceiveAnswerSDP(t,r,i){let s=$t.parse(t),c=s.mediaDescriptions.find(l=>l.attributes.mid===r);return c&&i===Ie.AUDIO&&c.media.mediaType==="audio"&&Ws(c),this.useXR&&wg(s),$t.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,r,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let h=0;h<t.length;h++){var i,s,c,l,u;let f=t[h],m=r[h];if(m instanceof Lt&&!ge(i=m._hints).call(i,Ft.LOW_STREAM)&&(s=m._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=m._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=m._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=m._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){let E={},S={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];let y=f.sender.getParameters();await f.sender.setParameters(Object.assign(y,E))}}}async applySimulcastEncodings(t,r){if(!Dt()&&t.length===r.length)for(let i=0;i<t.length;i++){let s=r[i];if(s instanceof Lt&&this.isVP8Simulcast(s)){let c=t[i],l={},u={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];let h=c.sender.getParameters();await c.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(t){var r,i,s,c,l;return!!(t instanceof Lt&&x("SIMULCAST")&&this.store.codec==="vp8"&&!ge(r=t._hints).call(r,Ft.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,r,i,s){if(x("SDP_LOGGING"))return v.upload("exchanging ".concat(i," ").concat(r," SDP during NVExtentionsConnection.").concat(s,`
`),t),r==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(at().supportPCSetConfiguration){let r=qS.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},fe(ft.prototype,"connect",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"connect"),ft.prototype),fe(ft.prototype,"updateRemoteRTPCapabilities",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"updateRemoteRTPCapabilities"),ft.prototype),fe(ft.prototype,"updateRemoteConnect",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"updateRemoteConnect"),ft.prototype),fe(ft.prototype,"createDataChannels",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"createDataChannels"),ft.prototype),fe(ft.prototype,"receive",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"receive"),ft.prototype),fe(ft.prototype,"batchReceive",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"batchReceive"),ft.prototype),fe(ft.prototype,"stopReceiving",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"stopReceiving"),ft.prototype),fe(ft.prototype,"muteRemote",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"muteRemote"),ft.prototype),fe(ft.prototype,"unmuteRemote",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"unmuteRemote"),ft.prototype),fe(ft.prototype,"muteLocal",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"muteLocal"),ft.prototype),fe(ft.prototype,"unmuteLocal",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"unmuteLocal"),ft.prototype),fe(ft.prototype,"close",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"close"),ft.prototype),fe(ft.prototype,"updateEncoderConfig",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"updateEncoderConfig"),ft.prototype),fe(ft.prototype,"updateSendParameters",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"updateSendParameters"),ft.prototype),fe(ft.prototype,"replaceTrack",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"replaceTrack"),ft.prototype),fe(ft.prototype,"getRemoteSSRC",[Ci],Object.getOwnPropertyDescriptor(ft.prototype,"getRemoteSSRC"),ft.prototype),ft);function Ci(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let s=this.mutex,c=await s.lock("From NVExtentionsConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{c()}},r}var Rt;function rF(e){var t,r,i,s=2;for(typeof Symbol<"u"&&(r=FV,i=Symbol.iterator);s--;){if(r&&(t=e[r])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new Mg(t.call(e));r="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Mg(e){function t(r){if(Object(r)!==r)return _e.reject(new TypeError(r+" is not an object."));var i=r.done;return _e.resolve(r.value).then(function(s){return{value:s,done:i}})}return Mg=function(r){this.s=r,this.n=r.next},Mg.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var i=this.s.return;return i===void 0?_e.resolve({value:r,done:!0}):t(i.apply(this.s,arguments))},throw:function(r){var i=this.s.return;return i===void 0?_e.reject(r):t(i.apply(this.s,arguments))}},new Mg(e)}let cl=(Rt=class YS extends FE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,r){super(t,r),b(this,"store",void 0),b(this,"peerConnection",void 0),b(this,"cname",void 0),b(this,"mutex",new rn("DataChannelConnection-mutex")),b(this,"dataChannel",void 0),b(this,"_p2pConnection",void 0),b(this,"establishPromise",void 0),b(this,"_nvMedia",void 0),this.store=r,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(YS.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Dre(t,r,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;let r=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(r)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,r,i,s,c,l){return this.cname=l,await this._p2pConnection.connect(t,r,i,s,c,l),await new _e((u,h)=>{let f=setTimeout(()=>{this.closeSignal(),h(new H(N.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(i))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(f),void u()},this.dataChannel.onerror=m=>{this.closeSignal(),h(m)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,r){return this._p2pConnection.updateRemoteRTPCapabilities(t,r)}send(t,r,i){var s=this;return Ui(function*(){let c=yield Ye(s.mutex.lock("From DataChannelConnection.send"));try{return yield*Ag(rF(s._p2pConnection.send(t,r,i)))}finally{c()}})()}async stopSending(t,r){return this._p2pConnection.stopSending(t,r)}async createDataChannels(t,r){return this._p2pConnection.createDataChannels(t,r)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,r,i,s){return this._nvMedia?(v.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,r,this.cname)):(v.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,r,i,s))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var r=this;return Ui(function*(){return yield*Ag(rF(r._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var r;(r=this._nvMedia)===null||r===void 0||r.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,r){return await this._p2pConnection.updateEncoderConfig(t,r)}async updateSendParameters(t,r){return await this._p2pConnection.updateSendParameters(t,r)}setStatsRemoteVideoIsReady(t,r){this._p2pConnection.setStatsRemoteVideoIsReady(t,r)}async replaceTrack(t,r){return await this._p2pConnection.replaceTrack(t,r)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,r,i,s){if(x("SDP_LOGGING"))return v.upload("exchanging ".concat(i," ").concat(r," SDP during DataChannelConnection.").concat(s,`
`),t),r==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",s)}:void 0}static resolvePCConfiguration(t){let r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Au(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...YS.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...YS.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(i=>{i.security?i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Yc(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!x("FORCE_TURN_TCP")&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),r}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var r;return(r=this.onICEConnectionStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var r;return(r=this.onConnectionStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var r;return(r=this.onDTLSTransportStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var r;return(r=this.onDTLSTransportError)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var r;return(r=this.onICETransportStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var r;return(r=this.onFirstAudioReceived)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var r;return(r=this.onFirstVideoReceived)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var r;return(r=this.onFirstAudioDecoded)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,r,i)=>{var s;return(s=this.onFirstVideoDecoded)===null||s===void 0?void 0:s.call(this,t,r,i)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var r;return(r=this.onFirstVideoDecodedTimeout)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,r)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,t,r)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,r)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,t,r)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},fe(Rt.prototype,"connect",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"connect"),Rt.prototype),fe(Rt.prototype,"updateRemoteRTPCapabilities",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"updateRemoteRTPCapabilities"),Rt.prototype),fe(Rt.prototype,"createDataChannels",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"createDataChannels"),Rt.prototype),fe(Rt.prototype,"receive",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"receive"),Rt.prototype),fe(Rt.prototype,"stopReceiving",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"stopReceiving"),Rt.prototype),fe(Rt.prototype,"muteRemote",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"muteRemote"),Rt.prototype),fe(Rt.prototype,"unmuteRemote",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"unmuteRemote"),Rt.prototype),fe(Rt.prototype,"muteLocal",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"muteLocal"),Rt.prototype),fe(Rt.prototype,"unmuteLocal",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"unmuteLocal"),Rt.prototype),fe(Rt.prototype,"close",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"close"),Rt.prototype),fe(Rt.prototype,"updateEncoderConfig",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"updateEncoderConfig"),Rt.prototype),fe(Rt.prototype,"updateSendParameters",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"updateSendParameters"),Rt.prototype),fe(Rt.prototype,"replaceTrack",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"replaceTrack"),Rt.prototype),fe(Rt.prototype,"getRemoteSSRC",[oo],Object.getOwnPropertyDescriptor(Rt.prototype,"getRemoteSSRC"),Rt.prototype),Rt);function oo(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let s=this.mutex,c=await s.lock("From DataChannelConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{c()}},r}var Je;function nF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function Aa(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nF(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nF(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function iF(e){var t,r,i,s=2;for(typeof Symbol<"u"&&(r=FV,i=Symbol.iterator);s--;){if(r&&(t=e[r])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new xg(t.call(e));r="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function xg(e){function t(r){if(Object(r)!==r)return _e.reject(new TypeError(r+" is not an object."));var i=r.done;return _e.resolve(r.value).then(function(s){return{value:s,done:i}})}return xg=function(r){this.s=r,this.n=r.next},xg.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var i=this.s.return;return i===void 0?_e.resolve({value:r,done:!0}):t(i.apply(this.s,arguments))},throw:function(r){var i=this.s.return;return i===void 0?_e.reject(r):t(i.apply(this.s,arguments))}},new xg(e)}let Ug=(Je=class extends Jt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Le.StateChange,t,this._state)}constructor(e,t){super(),b(this,"store",void 0),b(this,"statsUploader",void 0),b(this,"connection",void 0),b(this,"localTrackMap",new Map),b(this,"remoteUserMap",new Map),b(this,"localDataChannels",[]),b(this,"remoteDataChannelMap",new Map),b(this,"pendingLocalTracks",[]),b(this,"pendingRemoteTracks",[]),b(this,"pendingLocalDataChannels",[]),b(this,"pendingRemoteDataChannels",[]),b(this,"statsCollector",void 0),b(this,"isPlanB",!1),b(this,"shouldForwardP2PCreation",void 0),b(this,"iceFailedCount",0),b(this,"dtlsFailedCount",0),b(this,"mutex",new rn("P2PChannel-mutex")),b(this,"_state",Ct.Disconnected),b(this,"_pcStatsUploadType",x("NEW_ICE_RESTART")?Qa.FIRST_CONNECTION:Qa.OLD_FIRST_CONNECTION),b(this,"_isInRestartIce",!1),b(this,"_isStartRestartIce",!1),b(this,"_restartStates",["disconnected","failed"]),b(this,"_restartTimer",void 0),b(this,"_isFirstConnected",!0),b(this,"handleMuteLocalTrack",async(r,i,s)=>{let c=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ct.Connected)return void s(new ee(N.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let l=this.filterTobeMutedTracks(r);if(l.length===0)return void i();let u=l.find(f=>f[0]==="videoLowTrack");u&&u[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(l.map(f=>{let[,{id:m}]=f;return m}));let h=this.createMuteMessage(l);await Pt(this,Le.RequestMuteLocal,h),i()}catch(l){s(l)}finally{c()}}),b(this,"handleUnmuteLocalTrack",async(r,i,s)=>{let c=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ct.Connected)return void s(new ee(N.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let l=this.filterTobeUnmutedTracks(r);if(l.length===0)return void i();let u=l.find(f=>f[0]==="videoLowTrack");if(u){let f=u[1];if(f.track._originMediaStreamTrack.stop(),!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&at().supportDualStreamEncoding){let m=r._mediaStreamTrack.clone();f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m}else{let m=u0(r,td(this,Le.RequestLowStreamParameter));f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m}await new _e((m,E)=>{this.handleReplaceTrack(f.track,m,E,!0)})}await this.connection.unmuteLocal(l.map(f=>{let[,{id:m}]=f;return m}));let h=this.createUnmuteMessage(l);await Pt(this,Le.RequestUnmuteLocal,h),i()}catch(l){s(l)}finally{c()}}),b(this,"handleUpdateVideoEncoder",async(r,i,s)=>{let c=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{let l=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.connection||!l||l.track!==r||this.state!==Ct.Connected)return void i();let{id:u,track:h}=l;await this.connection.updateSendParameters(u,h),await this.connection.updateEncoderConfig(u,h),this.emit(Le.UpdateVideoEncoder,h),i()}catch(l){s(l)}finally{c()}}),b(this,"handleUpdateVideoSendParameters",async(r,i,s)=>{let c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let l=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.connection||!l||l.track!==r||this.state!==Ct.Connected)return void i();let{id:u,track:h}=l;await this.connection.updateSendParameters(u,h),i()}catch(l){s(l)}finally{c()}}),b(this,"handleReplaceMixingTrack",async(r,i,s,c)=>{if(!this.connection||this.state!==Ct.Connected)return void i();let l=p0([r]),u;v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l.getTrackId(),"]")),typeof c=="boolean"&&c||(u=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,l),i()}catch(f){s(f)}finally{var h;(h=u)===null||h===void 0||h()}}),b(this,"handleReplaceTrack",async(r,i,s,c)=>{let l;v.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof c=="boolean"&&c||(l=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var u;let f=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return r===E});if(!this.connection||!f||this.state!==Ct.Connected)return void i();if(await((u=this.connection)===null||u===void 0?void 0:u.replaceTrack(r,f[1].id)),this.isPlanB){let m=f[1];m.id=r._mediaStreamTrack.id,this.localTrackMap.set(f[0],m)}if(f[0]===ce.LocalVideoTrack&&!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&at().supportDualStreamEncoding){let m=this.localTrackMap.get(ce.LocalVideoLowTrack);if(m){let E=r._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,await new _e((S,y)=>{this.handleReplaceTrack(m.track,S,y,!0)})}}i()}catch(f){s(f)}finally{var h;(h=l)===null||h===void 0||h()}}),b(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),b(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),b(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),b(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),b(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new vV(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!at().supportUnifiedPlan||x("CHROME_FORCE_PLAN_B")&&Bc(),this.shouldForwardP2PCreation=x("FORWARD_P2P_CREATION")&&at().supportPCSetConfiguration&&_R(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new cl({},this.store):this.isPlanB?new lh({},this.store):new Ks({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var r;this.state=Ct.New;let i=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new cl(e,this.store):this.isPlanB?new lh(e,this.store):new Ks(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new ee(N.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=x("NEW_ICE_RESTART")?Qa.FIRST_CONNECTION:Qa.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,r,i,s,c){if(!this.connection)throw new ee(N.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof cl?this.connection.updateRemoteConnect(i):(this.store.peerConnectionStart(),await this.connection.connect(e,t,r,i,s,c),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ct.Connected)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(s=>{var c;let[l]=s;return ge(c=[ce.LocalVideoLowTrack,ce.LocalVideoTrack]).call(c,l)}),r=t.map(s=>{let[,{id:c}]=s;return c}),i=t.map(s=>{let[c]=s;return c});if(this.connection instanceof Ks){if(be.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ge(e).call(e,this.store.codec)){let s=["vp9","vp8","h264"].find(c=>ge(e).call(e,c));s&&(this.store.codec=s,v.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(s,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async preConnect(e,t,r,i,s,c){if(!this.connection)throw new ee(N.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();let l=await this.connection.connect(e,t,r,i,s,c);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ct.Connected,l}getEstablishParams(){if(this.connection instanceof cl)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(e){if(!this.connection||this.state!==Ct.Connected){if(this.state===Ct.Disconnected)throw new ee(N.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return void e.forEach(r=>{var i;ge(i=this.pendingLocalDataChannels).call(i,r)||this.pendingLocalDataChannels.push(r)})}let t=this.filterTobePublishedDataChannels(e);t.length!==0&&(t.forEach(r=>{let i=Date.now();this.store.publish(r.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(r=>{this.localDataChannels.push(r);let i=Date.now();this.store.publish(r.id+"","datachannel",void 0,i)}))}publish(e,t,r){var i=this;return Ui(function*(){let s=yield Ye(i.mutex.lock("From P2PChannel.publish"));try{if(!i.connection||i.state!==Ct.Connected){if(i.state===Ct.Disconnected)throw new ee(N.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);let l=e.filter(u=>i.pendingLocalTracks.indexOf(u)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(l))}i.store.pubId=i.store.pubId+1,On.markPublishStart(i.store.clientId,i.store.pubId);let c=i.filterTobePublishedTracks(e,t,r);if(c.length===0)return void(yield Ye(i.tryToUnmuteAudio(e)));yield*Ag(iF(i.doPublish(i.connection,c)))}finally{s()}})()}doPublish(e,t){var r=this;return Ui(function*(){t.forEach(E=>{let{track:S,type:y}=E,A=Date.now();r.store.publish(S.getTrackId(),y===ce.LocalAudioTrack?"audio":"video",A)}),r.bindLocalTrackEvents(t);let i=t.map(E=>{let{track:S}=E;return S}),s=yield Ye(e.send(t.map(E=>{let{track:S}=E;return S}),r.store.codec,r.store.audioCodec)),c=(yield Ye(s.next())).value,l=r.createGatewayPublishMessage(t,c),u;try{u=yield l}catch(E){throw s.throw(E),(E==null?void 0:E.code)===N.WS_ABORT&&t.forEach(S=>{let{track:y}=S;r.pendingLocalTracks.indexOf(y)===-1&&r.pendingLocalTracks.push(y)}),r.unbindLocalTrackEvents(t),E}let h=r.mapPubResToRemoteConfig(l,u),f=(yield Ye(s.next(h))).value,m=x("ENABLE_VIDEO_SEI");i.forEach(async E=>{let S=E.getRTCRtpTransceiver();S&&m&&(E.trackMediaType===Ie.VIDEO?await nre(S.sender,E):E.trackMediaType===Ie.AUDIO&&await async function(y){if(!at().supportWebRTCEncodedTransform)return void v.warning("browser not support audio encoded transform");if(Sg.has(y)||!y.track)return;let A={track:y.track};if(jc()){if(!y.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let w=null;try{w=y.createEncodedStreams()}catch(P){return void v.error("create audio-encoded-streams error",P&&P.message)}let O=new TransformStream({transform(P,F){A.controller||(A.controller=F),y.track&&y.track.id!==A.track.id&&(v.debug("audio track changed: ".concat(A.track.id," => ").concat(y.track.id)),A.track.removeEventListener("ended",T),A.track=y.track,A.track.addEventListener("ended",T)),F.enqueue(P)}});w.readable.pipeThrough(O).pipeTo(w.writable)}else if(Jr()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");let w=gg(),O=new MessageChannel;await new _e(F=>w.onmessage=W=>{W.data==="registered"&&F(void 0)});let P=new RTCRtpScriptTransform(w,{name:"tx",port:O.port2},[O.port2]);y.transform=P,await new _e(F=>w.onmessage=W=>{W.data==="started"&&F(void 0)}),O.port1.onmessage=F=>{var W;F.data.transformed&&y.track&&((W=y.track)===null||W===void 0?void 0:W.id)!==A.track.id&&(v.debug("audio track changed: ".concat(A.track.id," => ").concat(y.track.id)),A.track.removeEventListener("ended",T),A.track=y.track,A.track.addEventListener("ended",T))},A.worker=w}function T(){if(y.track){if(this.id!==y.track.id)return;y.track.removeEventListener("ended",T)}let w=Sg.get(y);if(w){Sg.delete(y);try{var O,P;(O=w.controller)===null||O===void 0||O.terminate(),(P=w.worker)===null||P===void 0||P.terminate()}catch(F){v.warning(F&&F.message)}}}Sg.set(y,A),y.track.addEventListener("ended",T)}(S.sender))}),t.forEach(E=>{let{type:S}=E;r.statsCollector.addLocalStats(S)}),r.assignLocalTracks(t,f),r.statsUploader.startUploadOutboundStats(),t.forEach(E=>{let{track:S,type:y}=E,A=Date.now();r.store.publish(S.getTrackId(),y===ce.LocalAudioTrack?"audio":"video",void 0,A)})})()}async updateVideoStreamParameter(e,t){let r=this.localTrackMap.get(t);if(!r)return;if(!(r.track instanceof Lt))return v.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof Ks||this.connection instanceof lh))return v.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");let{track:i}=r,s=function(c,l){let u={};return c.height&&c.width&&(u.scaleResolutionDownBy=BR(c,l)),u.maxFramerate=c.framerate?vi(c.framerate):void 0,u.maxBitrate=c.bitrate?1e3*c.bitrate:void 0,u}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==ce.LocalVideoLowTrack||!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&at().supportDualStreamEncoding)s.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=s.scaleResolutionDownBy);else{let c=i._originMediaStreamTrack;if(!c.canvas)return v.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(l,u){let h=l.canvas;u.width&&(h.width=vi(u.width)),u.height&&(h.height=vi(u.height)),u.framerate&&(h.stopCapture&&h.stopCapture(),h.stopCapture=zw(()=>{!h.startCapture&&h.stopCapture&&h.stopCapture(),h.startCapture&&h.startCapture()},vi(u.framerate)))})(c,e)}s.maxBitrate!=null&&(i._encoderConfig.bitrateMax=s.maxBitrate/1e3),s.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=s.maxFramerate:i._encoderConfig.frameRate={max:s.maxFramerate}),v.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return Ui(function*(){if(!t.connection||t.state!==Ct.Connected)return;let r=yield Ye(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let s=t.localTrackMap.get(ce.LocalVideoTrack);if(!s)throw new ee(N.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ce.LocalVideoLowTrack))throw new ee(N.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let c=[{track:t.getLowVideoTrack(s.track,e),type:ce.LocalVideoLowTrack}];if(yield*Ag(iF(t.doPublish(t.connection,c))),s.track.muted||!s.track.enabled){var i;let l=(i=t.localTrackMap.get(ce.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;l!==void 0&&(yield Ye(t.connection.muteLocal([l])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await kr(this,Le.RequestRePublish,this.pendingLocalTracks),this.emit(Le.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(v.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await kr(this,Le.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:r,kind:i}=this.pendingRemoteTracks[t];(i!==Ie.AUDIO||r._audio_added_&&r._audioSSRC)&&(i!==Ie.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await kr(this,Le.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===Ie.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:r}=t;this.emit(Le.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Ct.Connected)return void e.forEach(i=>{let s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(i=>i[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Ct.Connected)return void e.forEach(r=>{let i=this.pendingLocalDataChannels.indexOf(r);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(r=>{let i=this.localDataChannels.indexOf(r);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Ct.Connected)return;let e=this.localTrackMap.get(ce.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[ce.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[s,{track:c}]=i;return{type:s,track:c}})),t.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Ct.Connected)throw new ee(N.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let r=t.filter(i=>{var s;return!((s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.get(i.id))});if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach(i=>{var s;this.remoteDataChannelMap.has(e)?(s=this.remoteDataChannelMap.get(e))===null||s===void 0||s.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));let c=this.pendingRemoteDataChannels.findIndex(l=>{let{user:u,id:h}=l;return u.uid===e.uid&&h===i.id});c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),r.map(i=>i.id)}async subscribe(e,t,r,i,s){var c;if(!this.connection||this.state!==Ct.Connected)throw new ee(N.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;let l,u,h;if(s){let E=s.find(y=>{let{stream_type:A}=y;return A===t});if(!E)throw new ee(N.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let S=await this.connection.receive(t,E.ssrcs,String(e._uintid),E.attributes);this.connection instanceof Ks&&(h=S.transceiver),l=S.track,u=S.id}else{let E=await this.connection.receive(t,[{ssrcId:r,rtx:i}],String(e._uintid),void 0);this.connection instanceof Ks&&(h=E.transceiver),l=E.track,u=E.id}t===Ie.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new sh(l,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new oh(l,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack)),x("ENABLE_VIDEO_SEI")&&h&&(t==Ie.VIDEO?await ire(h.receiver,{onSei:E=>{var S;(S=e._videoTrack)===null||S===void 0||S._onSei(E)}}):t==Ie.AUDIO&&await async function(E){if(!at().supportWebRTCEncodedTransform)return void v.warning("browser not support audio encoded transform");if(yg.has(E))return;let S={track:E.track};if(jc()){if(!E.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let A=null;try{A=E.createEncodedStreams()}catch(w){return void v.error("create audio-encoded-streams error",w&&w.message)}let T=new TransformStream({transform(w,O){S.controller||(S.controller=O),E.track&&E.track.id!==S.track.id&&(v.debug("audio track changed: ".concat(S.track.id," => ").concat(E.track.id)),S.track.removeEventListener("ended",y),S.track=E.track,S.track.addEventListener("ended",y)),O.enqueue(w)}});A.readable.pipeThrough(T).pipeTo(A.writable)}else if(Jr()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");let A=gg(),T=new MessageChannel;await new _e(O=>A.onmessage=P=>{P.data==="registered"&&O(void 0)});let w=new RTCRtpScriptTransform(A,{name:"rx",port:T.port2},[T.port2]);E.transform=w,await new _e(O=>A.onmessage=P=>{P.data==="started"&&O(void 0)}),T.port1.onmessage=O=>{var P;O.data.transformed&&E.track&&((P=E.track)===null||P===void 0?void 0:P.id)!==S.track.id&&(v.debug("audio track changed: ".concat(S.track.id," => ").concat(E.track.id)),S.track.removeEventListener("ended",y),S.track=E.track,S.track.addEventListener("ended",y))},S.worker=A}function y(){E.track.removeEventListener("ended",y),function(A){let T=yg.get(A);if(T){yg.delete(A);try{var w,O;(w=T.controller)===null||w===void 0||w.terminate(),(O=T.worker)===null||O===void 0||O.terminate()}catch(P){v.warning(P&&P.message)}}}(E)}yg.set(E,S),E.track.addEventListener("ended",y)}(h.receiver));let f=this.remoteUserMap.get(e);f?f.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let m=this.pendingRemoteTracks.findIndex(E=>{let{user:S,kind:y}=E;return S.uid===e.uid&&t===y});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(Le.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Ct.Connected)throw new ee(N.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(r=>{var i;let{user:s,mediaType:c}=r;return!((i=this.remoteUserMap.get(s))!==null&&i!==void 0&&i.has(c))});let t=await this.connection.batchReceive(e.map(r=>{let{user:i,mediaType:s,ssrcId:c,rtxSsrcId:l}=r;return{kind:s,ssrcMsg:[{ssrcId:c,rtx:l}],mslabel:String(i._uintid)}}));e.forEach((r,i)=>{let{user:s,mediaType:c}=r,{track:l,id:u,transceiver:h}=t[i];c===Ie.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(l):(s._audioTrack=new sh(l,s.uid,s._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),h&&s._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(l):(s._videoTrack=new oh(l,s.uid,s._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),h&&s._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(s,s._videoTrack));let f=this.remoteUserMap.get(s);f?f.set(c,u):this.remoteUserMap.set(s,new Map([[c,u]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();let m=this.pendingRemoteTracks.findIndex(E=>{let{user:S,kind:y}=E;return S.uid===s.uid&&c===y});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(Le.MediaReconnectEnd,s.uid))})}async unsubscribe(e,t,r){let i=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return t!==void 0?u.uid===e.uid&&t===h:u.uid===e.uid});if(i.forEach(l=>{let u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.connection&&this.state===Ct.Connected||r||i.forEach(l=>{let{kind:u}=l;var h;if(u===Ie.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(u===Ie.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Ct.Connected)return;let s=this.filterTobeUnSubscribedTracks(e,t);if(s.length===0)return;await this.connection.stopReceiving(s.map(l=>{let[,{id:u}]=l;return u}));let c=this.createUnsubscribeMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(l=>{let[u,{kind:h}]=l;var f,m;if(h===Ie.VIDEO&&u._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===Ie.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),r||((m=u._videoTrack)===null||m===void 0||m._destroy(),u._videoTrack=void 0);else if(h===Ie.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),!r&&((E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0)}}),c}async unsubscribeDataChannel(e,t){if(t.forEach(s=>{let c=this.pendingRemoteDataChannels.findIndex(l=>l.id===s.id);c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),!this.connection)return;let r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach(s=>{s._close()});let i=this.remoteDataChannelMap.get(e);return r.forEach(s=>{i&&i.delete(s.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(s=>s.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:s,mediaType:c}of e){let l=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:f}=u;return c!==void 0?h.uid===s.uid&&c===f:h.uid===s.uid});l.forEach(u=>{let h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),t=t.concat(l)}if(!this.connection||this.state!==Ct.Connected)return void t.forEach(s=>{let{user:c,kind:l}=s;var u;if(l===Ie.AUDIO)(u=c._audioTrack)===null||u===void 0||u._destroy(),c._audioTrack=void 0;else if(l===Ie.VIDEO){var h;(h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0}});let r=Ds(e).call(e,(s,c)=>{let{user:l,mediaType:u}=c,h=this.filterTobeUnSubscribedTracks(l,u);return s.concat(h)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(s=>{let[,{id:c}]=s;return c}));let i=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(s=>{let[c,{kind:l}]=s;var u,h;if(l===Ie.VIDEO&&c._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===Ie.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),(h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0;else if(l===Ie.AUDIO){var f;this.unbindRemoteTrackEvents(c._audioTrack),(f=c._audioTrack)===null||f===void 0||f._destroy(),c._audioTrack=void 0}}),i}async muteRemote(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let i=t===Ie.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(ce.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Fr){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return s!==ce.LocalAudioTrack}).filter(i=>{let[s]=i;return!(e&&s===ce.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return!(e&&i===ce.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,i,s){if(e){let l=this.localTrackMap.get(ce.LocalAudioTrack),u=i?this.localTrackMap.get(ce.LocalVideoLowTrack):this.localTrackMap.get(ce.LocalVideoTrack);be.publish(this.store.sessionId,{eventElapse:On.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(Ft.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var c;r||(r=[]);let l=r.find(h=>h instanceof lr),u=i?(c=this.localTrackMap.get(ce.LocalVideoTrack))===null||c===void 0?void 0:c.track:r.find(h=>h instanceof Lt);be.publish(this.store.sessionId,{eventElapse:On.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(Ft.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,r,i){let s=i===Ie.VIDEO?r._videoSSRC:r._audioSSRC;s&&be.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Ie.VIDEO,audio:i===Ie.AUDIO,peerid:r.uid,subscribeRequestid:i===Ie.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:On.measureFromSubscribeStart(this.store.clientId,s)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new rn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new cl({},this.store):this.isPlanB?new lh({},this.store):new Ks({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(ce.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Fr){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Ct.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(ce.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(ce.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof Lt||t&&t.track instanceof lr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(qi(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[i]=r;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(ce.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Mp(e).call(e,(r,i)=>r.level-i.level),e}async disconnectForReconnect(){this.connection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ct.Reconnecting,x("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new cl({},this.store):this.isPlanB?new lh({},this.store):new Ks({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:i}]=e;switch(r){case ce.LocalVideoTrack:ge(t=i._hints).call(t,Ft.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ce.LocalAudioTrack:i instanceof Fr?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ce.LocalVideoLowTrack:}}),this.emit(Le.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(qi(r).call(r)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Le.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(qi(r).call(r)).forEach(i=>{this.setPendingRemoteDataChannel(t,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let r of this.pendingRemoteDataChannels){let{user:i,id:s}=r;if((e instanceof ol?e.uid:e)===i.uid&&s===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:i,kind:s}=r;if((e instanceof ol?e.uid:e)===i.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Ui(function*(){if(!t.connection||t.state!==Ct.Connected||t.connection instanceof cl)return;let r=yield Ye(t.mutex.lock("From P2PChannel.restartICE")),i;try{i=yield Ye(t.connection.restartICE(e));let c=yield Ye(i.next());if(c.done)return;let l=c.value,u=yield l;switch(t.reportPCDisconnectedOrFailed(e),e){case Gn.TCP:t._pcStatsUploadType=Qa.TCP_RESTART;break;case Gn.RELAY:t._pcStatsUploadType=Qa.RELAY_RESTART;break;default:t._pcStatsUploadType=Qa.OLD_RESTART}t._isInRestartIce=!0,i.next(u)}catch(c){var s;(s=i)===null||s===void 0||s.throw(c)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(ce.LocalVideoTrack),r=this.localTrackMap.get(ce.LocalAudioTrack),i=e.videoSend.find(y=>y.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),s=e.audioSend.find(y=>y.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId));if(!i||!s)return 1;let c=Mi(this,Le.NeedSignalRTT),l=i?i.rttMs:void 0,u=s?s.rttMs:void 0,h=l&&u?(l+u)/2:l||u,f=(h&&c?(h+c)/2:h||c)||0,m=100*e.sendPacketLossRate*.7/50+.3*f/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,S=t==null?void 0:t.track;if(S&&S._encoderConfig&&S._hints.indexOf(Ft.SCREEN_TRACK)===-1){let y=S._encoderConfig.bitrateMax,A=e.bitrate.actualEncoded;if(y&&A){let T=(1e3*y-A)/(1e3*y);return jL[T<.15?0:T<.3?1:T<.45?2:T<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i]=r,s=i._audioSSRC,c=i._videoSSRC,l=e.audioRecv.find(A=>A.ssrc===s),u=e.videoRecv.find(A=>A.ssrc===c);if(!l&&!u)return void(t+=1);let h=Mi(this,Le.NeedSignalRTT),f=e.rtt,m=(f&&h?(f+h)/2:f||h)||0,E=l?l.jitterMs:void 0,S=e.recvPacketLossRate,y=.7*S*100/50+.3*m/1500;E&&(y=.6*S*100/50+.2*m/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new _e((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(v.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Ct.Connected)return;let i=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:l}]=c;return e===l});if(!i)return;let s=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:s}]),this.bindLocalTrackEvents([{track:t,type:s}]),i[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,i[1].id)),this.isPlanB){let c=i[1];c.id=t._mediaStreamTrack.id,this.localTrackMap.set(s,c)}if(s===ce.LocalVideoTrack&&!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&at().supportDualStreamEncoding){let c=this.localTrackMap.get(ce.LocalVideoLowTrack);if(c){let l=e._mediaStreamTrack.clone();c.track._originMediaStreamTrack.stop(),c.track._mediaStreamTrack=l,c.track._originMediaStreamTrack=l,await new _e((u,h)=>{this.handleReplaceTrack(c.track,u,h,!0)})}}}filterTobePublishedTracks(e,t,r){let i=[],s=this.getAllTracks();e=Ou(e=e.filter(h=>s.indexOf(h)===-1));let c,l=!1,u=this.localTrackMap.get(ce.LocalAudioTrack);for(let h of e){if(h instanceof Lt&&(this.localTrackMap.has(ce.LocalVideoTrack)||l?new ee(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:h,type:ce.LocalVideoTrack}),l=!0),t)){let f=this.getLowVideoTrack(h,r);i.push({track:f,type:ce.LocalVideoLowTrack})}if(h instanceof lr)if(u){let f=u.track;if(f instanceof Fr)h0([h]),f.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0);else{let m=p0([f,h]);v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),this.replaceTrack(f,m)}}else c instanceof Fr?(h0([h]),c.addAudioTrack(h)):c||!h._useAudioElement&&at().webAudioMediaStreamDest&&!h._bypassWebAudio?c=p0(c?[h,c]:[h]):c=h}return c&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(c.getTrackId(),"]")),i.push({track:c,type:ce.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=Ou(e=e.filter(i=>r.indexOf(i)!==-1));for(let i of e){if(i instanceof lr){let s=this.localTrackMap.get(ce.LocalAudioTrack);if(!s)continue;s.track instanceof Fr?(s.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),s.track.trackList.length===0&&(t.push([ce.LocalAudioTrack,s]),s.track.close())):t.push([ce.LocalAudioTrack,s])}if(i instanceof Lt){let s=this.localTrackMap.get(ce.LocalVideoTrack);if(!s)continue;t.push([ce.LocalVideoTrack,s]);let c=this.localTrackMap.get(ce.LocalVideoLowTrack);c&&t.push([ce.LocalVideoLowTrack,c])}}return t}filterTobePublishedDataChannels(e){return e=(e=Ou(e)).filter(t=>this.localDataChannels.findIndex(r=>r.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Ou(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:i}=t;switch(i){case ce.LocalVideoTrack:r.addListener(ve.GET_STATS,this.handleGetLocalVideoStats),r.addListener(ve.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case ce.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Fr?e.trackList.forEach(r=>{r.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),r.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(ve.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:i}]=t;return{track:i,type:r}})),e.forEach(t=>{let{track:r,type:i}=t;switch(i){case ce.LocalVideoTrack:r.off(ve.GET_STATS,this.handleGetLocalVideoStats),r.off(ve.GET_RTC_STATS,this.handleGetRTCStats),r.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case ce.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Fr?e.trackList.forEach(t=>{t.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ve.GET_STATS,this.handleGetLocalAudioStats),t.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ve.GET_STATS,this.handleGetLocalAudioStats),e.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ve.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof oh&&t.addListener(ve.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof sh&&t.addListener(ve.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Ie.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Ie.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,i)=>{var s;let c,l,{track:u,type:h}=r;switch(h){case ce.LocalAudioTrack:c=vt.Audio,l={dtx:u instanceof Eg&&u._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ce.LocalVideoTrack:c=ge(s=u._hints).call(s,Ft.SCREEN_TRACK)?vt.Screen:vt.High,l=Aa(Aa({},oM(u)),{},{codec:this.store.codec});break;case ce.LocalVideoLowTrack:c=vt.Low,l=Aa(Aa({},oM(u)),{},{codec:this.store.codec})}return{stream_type:c,attributes:l,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let i,[s,{track:c,ssrcs:l,id:u}]=t;switch(s){case ce.LocalVideoTrack:i=ge(r=c._hints).call(r,Ft.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalAudioTrack:i=vt.Audio;break;case ce.LocalVideoLowTrack:i=vt.Low}return{stream_type:i,ssrcs:l,mid:u}})}assignLocalTracks(e,t){e.forEach((r,i)=>{let{track:s,type:c}=r;this.localTrackMap.set(c,{track:s,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Le.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),x("NEW_ICE_RESTART")){var r;if(ge(r=this._restartStates).call(r,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let i=l=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(v.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(l)),Mi(this,Le.QueryClientConnectionState)==="CONNECTED"&&this.emit(Le.RequestRestartICE,l))},s=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),v.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Le.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},c=x("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(x("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&at().supportPCSetConfiguration)i(Gn.RELAY),this._restartTimer=window.setTimeout(s,c);else if(Dt())i(Gn.UDP),this._restartTimer=window.setTimeout(s,4e3);else{if(i(Gn.TCP),at().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{i(Gn.RELAY),this._restartTimer=window.setTimeout(s,c)},c));this._restartTimer=window.setTimeout(s,c)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&x("ICE_RESTART")&&Mi(this,Le.QueryClientConnectionState)==="CONNECTED"&&this.emit(Le.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Le.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Le.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),be.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:sr.TRACER}).onSuccess(),this.emit(Le.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let i=Array.from(qi(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);var s;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(s=i.audioTrack)===null||s===void 0||s.emit(th.FIRST_FRAME_DECODED),be.firstRemoteFrame(this.store.sessionId,nn.FIRST_AUDIO_DECODE,rr.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:On.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let i=Array.from(qi(r=this.remoteUserMap).call(r)).find(s=>s._audioSSRC===t);i&&be.firstRemoteFrame(this.store.sessionId,nn.FIRST_AUDIO_RECEIVED,rr.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:On.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,i)=>{this.reportVideoFirstFrameDecoded(t,r,i)},e.onFirstVideoReceived=t=>{var r;let i=Array.from(qi(r=this.remoteUserMap).call(r)).find(s=>s._videoSSRC===t);i&&be.firstRemoteFrame(this.store.sessionId,nn.FIRST_VIDEO_RECEIVED,rr.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:On.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{let i=t.candidateType==="relay",s=r.candidateType==="relay";r.candidateType!=="unknown"&&i===s||this.emit(Le.ConnectionTypeChange,i),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Jc(r))," -> ").concat(JSON.stringify(Jc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Jc(r))," -> ").concat(JSON.stringify(Jc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return Aa(Aa({},t),r)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof lr&&(r==null?void 0:r.track)instanceof Fr)return r.track.isActive||t.push([ce.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return e===c});if(i&&(t.push(i),i[0]===ce.LocalVideoTrack)){let s=this.localTrackMap.get(ce.LocalVideoLowTrack);s&&t.push([ce.LocalVideoLowTrack,s])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof lr&&(r==null?void 0:r.track)instanceof Fr)return r.track.isActive&&t.push([ce.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return e===c});if(i)if(i[0]===ce.LocalVideoTrack){t.push(i);let s=this.localTrackMap.get(ce.LocalVideoLowTrack);s&&t.push([ce.LocalVideoLowTrack,s])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var r;let i,[s,{track:c,ssrcs:l,id:u}]=t;switch(s){case ce.LocalAudioTrack:i=vt.Audio;break;case ce.LocalVideoTrack:i=ge(r=c._hints).call(r,Ft.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:i=vt.Low}return{stream_type:i,ssrcs:l,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var r;let i,[s,{track:c,ssrcs:l,id:u}]=t;switch(s){case ce.LocalAudioTrack:i=vt.Audio;break;case ce.LocalVideoTrack:i=ge(r=c._hints).call(r,Ft.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:i=vt.Low}return{stream_type:i,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(e,t){let r=[],i=this.remoteUserMap.get(e);if(!i)return r;if(t){let s=i.get(t);if(!s)return r;r.push([e,{kind:t,id:s}])}else Array.from(i.entries()).forEach(s=>{let[c,l]=s;r.push([e,{kind:c,id:l}])});return r}filterTobeUnSubscribedDataChannels(e,t){let r=[];return t.forEach(i=>{var s;(s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.has(i.id)&&r.push(i)}),r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[i,{kind:s,id:c}]=r;switch(s){case Ie.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Ie.VIDEO,ssrcId:i._videoSSRC}));case Ie.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Ie.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(r=>{let[i,{kind:s}]=r;if(t.has(i)){let c=t.get(i);s===Ie.VIDEO?c|=$r.Video:c|=$r.Audio,t.set(i,c)}else s===Ie.VIDEO?t.set(i,$r.Video):t.set(i,$r.Audio)}),{users:Array.from(t.entries()).map(r=>{let[i,s]=r;return{stream_id:i.uid,stream_type:s}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:i}]=t,s=this.remoteUserMap.get(r);s&&(s.delete(i),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(ce.LocalVideoTrack),r=this.localTrackMap.get(ce.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),r&&e.low_stream_uplink&&await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((r,i)=>{var s;let{stream_type:c}=r;return(s=t.find(l=>{let{stream_type:u}=l;return c===u}))===null||s===void 0?void 0:s.attributes})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof lr){var t;let i=this.filterTobeUnmutedTracks(e[r]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(c=>{let[,{id:l}]=c;return l})));let s=this.createUnmuteMessage(i);return void await Pt(this,Le.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Le.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Le.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Xr(NE(this.dtlsFailedCount,Tr)),this.emit(Le.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await kr(this,Le.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Le.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ce.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Lt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Lt).length>1)throw new ee(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof lr).length>1&&(e.some(t=>t instanceof lr&&t._bypassWebAudio)||!at().webAudioMediaStreamDest))throw new ee(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof Lt&&this.pendingLocalTracks.some(r=>r instanceof Lt))throw new ee(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof lr&&this.pendingLocalTracks.some(r=>r instanceof lr)&&(!at().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof lr&&r._bypassWebAudio)))throw new ee(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let r=!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&at().supportDualStreamEncoding,i=Aa(Aa({},{width:160,height:120,framerate:15,bitrate:50}),t),s;s=r?e._mediaStreamTrack.clone():u0(e,i);let c=kt(8,"track-low-"),l=new Lt(s,Aa(Aa({},r&&{scaleResolutionDownBy:BR(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,c);return l.on(Ed.TRANSCEIVER_UPDATED,u=>{e._updateRtpTransceiver(u,Zu.LOW_STREAM)}),l._hints.push(Ft.LOW_STREAM),e.on("sei-to-send",u=>{l.emit("sei-to-send",u)}),e.addListener(ve.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ks){var s,c,l,u;let h=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:f,dtlsTransportState:m,peerConnectionState:E}=this.connection,{local:S,remote:y}=await this.connection.getSelectedCandidatePair();be.pcStats(this.store.sessionId,{startTime:h,eventElapse:e-h||0,iceconnectionsate:f,dtlsstate:m,connectionstate:E,intSucc:t?1:2,error:i,selectedLocalCandidateProtocol:(s=S==null?void 0:S.protocol)!==null&&s!==void 0?s:"",selectedLocalCandidateType:(c=S.candidateType)!==null&&c!==void 0?c:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(l=y.protocol)!==null&&l!==void 0?l:"",selectedRemoteCandidateType:(u=y.candidateType)!==null&&u!==void 0?u:"",selectedRemoteCandidateAddress:"".concat(y.address,":").concat(y.port),restartCnt:r})}}reportVideoFirstFrameDecoded(e,t,r,i){var s;let c=Array.from(qi(s=this.remoteUserMap).call(s)).find(l=>l._videoSSRC===e);if(c){i||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());let l=this.store.keyMetrics,u=l.subscribe.find(h=>h.userId===c.uid&&h.type==="video");be.firstRemoteVideoDecode(this.store.sessionId,nn.FIRST_VIDEO_DECODE,rr.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:r,subscribeElapse:On.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;let i=this.remoteUserMap.get(e);if(!i)return!1;let s=i.get(t);if(!s)return!1;let c=await this.connection.getRemoteSSRC(s);return c!==void 0&&c!==r}resetConnection(e){v.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===Ct.Connected?(v.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===JL.datachannel?new cl({},this.store):this.isPlanB?new lh({},this.store):new Ks({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===ce.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Zu.LOW_STREAM):r._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof Ks&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Qa.TCP_RESTART&&e===Gn.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Qa.DISCONNECTED_OR_FAILED)))}},fe(Je.prototype,"startP2PConnection",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"startP2PConnection"),Je.prototype),fe(Je.prototype,"connect",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"connect"),Je.prototype),fe(Je.prototype,"updateRemoteRTPCapabilities",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"updateRemoteRTPCapabilities"),Je.prototype),fe(Je.prototype,"preConnect",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"preConnect"),Je.prototype),fe(Je.prototype,"publishDataChannel",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"publishDataChannel"),Je.prototype),fe(Je.prototype,"unpublish",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"unpublish"),Je.prototype),fe(Je.prototype,"unpublishDataChannel",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"unpublishDataChannel"),Je.prototype),fe(Je.prototype,"unpublishLowStream",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"unpublishLowStream"),Je.prototype),fe(Je.prototype,"subscribeDataChannel",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"subscribeDataChannel"),Je.prototype),fe(Je.prototype,"subscribe",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"subscribe"),Je.prototype),fe(Je.prototype,"massSubscribe",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"massSubscribe"),Je.prototype),fe(Je.prototype,"unsubscribe",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"unsubscribe"),Je.prototype),fe(Je.prototype,"unsubscribeDataChannel",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"unsubscribeDataChannel"),Je.prototype),fe(Je.prototype,"massUnsubscribe",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"massUnsubscribe"),Je.prototype),fe(Je.prototype,"muteRemote",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"muteRemote"),Je.prototype),fe(Je.prototype,"unmuteRemote",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"unmuteRemote"),Je.prototype),fe(Je.prototype,"hasRemoteMediaWithLock",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"hasRemoteMediaWithLock"),Je.prototype),fe(Je.prototype,"disconnectForReconnect",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"disconnectForReconnect"),Je.prototype),fe(Je.prototype,"updateBitrateLimit",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"updateBitrateLimit"),Je.prototype),fe(Je.prototype,"remoteMediaSsrcChanged",[Mn],Object.getOwnPropertyDescriptor(Je.prototype,"remoteMediaSsrcChanged"),Je.prototype),Je);function Mn(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let s=this.mutex,c=await s.lock("From P2PChannel.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{c()}},r}function Pre(e){let t=aF();return function(r,i){let s=r.appId;s!==void 0&&(wt(i,10),Oa(i,s));let c=r.cid;c!==void 0&&(wt(i,16),wt(i,c));let l=r.cname;l!==void 0&&(wt(i,26),Oa(i,l));let u=r.deviceId;u!==void 0&&(wt(i,34),Oa(i,u));let h=r.elapse;h!==void 0&&(wt(i,40),ll(i,h));let f=r.fileSize;f!==void 0&&(wt(i,48),ll(i,uh(f)));let m=r.height;m!==void 0&&(wt(i,56),ll(i,uh(m)));let E=r.jpg;E!==void 0&&(wt(i,66),wt(i,E.length),function(ps,ne){let me=hh(ps,ne.length);ps.bytes.set(ne,me)}(i,E));let S=r.networkType;S!==void 0&&(wt(i,72),ll(i,uh(S)));let y=r.osType;y!==void 0&&(wt(i,80),ll(i,uh(y)));let A=r.requestId;A!==void 0&&(wt(i,90),Oa(i,A));let T=r.sdkVersion;T!==void 0&&(wt(i,98),Oa(i,T));let w=r.sequence;w!==void 0&&(wt(i,104),ll(i,uh(w)));let O=r.sid;O!==void 0&&(wt(i,114),Oa(i,O));let P=r.timestamp;P!==void 0&&(wt(i,120),ll(i,P));let F=r.uid;F!==void 0&&(wt(i,128),wt(i,F));let W=r.vid;W!==void 0&&(wt(i,136),wt(i,W));let K=r.width;K!==void 0&&(wt(i,144),ll(i,uh(K)));let X=r.service;X!==void 0&&(wt(i,152),wt(i,X));let ie=r.callbackData;ie!==void 0&&(wt(i,162),Oa(i,ie));let ae=r.jpgEncryption;ae!==void 0&&(wt(i,168),wt(i,ae));let le=r.requestType;le!==void 0&&(wt(i,176),wt(i,le));let we=r.scorePorn;we!==void 0&&(wt(i,185),v0(i,we));let nt=r.scoreSexy;nt!==void 0&&(wt(i,193),v0(i,nt));let gt=r.scoreNeutral;gt!==void 0&&(wt(i,201),v0(i,gt));let jt=r.scene;jt!==void 0&&(wt(i,208),wt(i,jt));let wr=r.ossFilePrefix;wr!==void 0&&(wt(i,218),Oa(i,wr));let ir=r.serviceVendor;if(ir!==void 0)for(let ps of ir){wt(i,226);let ne=aF();Mre(ps,ne),wt(i,ne.limit),Fre(i,ne),Vre(ne)}}(e,t),function(r){let i=r.bytes,s=r.limit;return i.length===s?i:i.subarray(0,s)}(t)}function kre(e){return function(r){let i={};e:for(;!cF(r);){let s=Na(r);switch(s>>>3){case 0:break e;case 1:i.code=Na(r);break;case 2:i.msg=lF(r,Na(r));break;case 3:{let c=xre(r);i.data=Lre(r),r.limit=c;break}default:oF(r,7&s)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function Lre(e){let t={};e:for(;!cF(e);){let r=Na(e);switch(r>>>3){case 0:break e;case 1:t.requestId=lF(e,Na(e));break;case 2:t.requestType=Na(e)>>>0;break;case 3:t.scorePorn=y0(e);break;case 4:t.scoreSexy=y0(e);break;case 5:t.scoreNeutral=y0(e);break;case 6:t.requestScene=Na(e)>>>0;break;case 7:t.scene=Na(e)>>>0;break;default:oF(e,7&r)}}return t}function Mre(e,t){let r=e.service;r!==void 0&&(wt(t,8),wt(t,r));let i=e.vendor;i!==void 0&&(wt(t,16),wt(t,i));let s=e.token;s!==void 0&&(wt(t,26),Oa(t,s));let c=e.callbackUrl;c!==void 0&&(wt(t,34),Oa(t,c))}function xre(e){let t=Na(e),r=e.limit;return e.limit=e.offset+t,r}function oF(e,t){switch(t){case 0:for(;128&dF(e););break;case 2:g0(e,Na(e));break;case 5:g0(e,4);break;case 1:g0(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Ure=new Float32Array(1);new Uint8Array(Ure.buffer);let E0=new Float64Array(1),Ri=new Uint8Array(E0.buffer);function uh(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let sF=[];function aF(){let e=sF.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Vre(e){sF.push(e)}function g0(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function cF(e){return e.offset>=e.limit}function hh(e,t){let r=e.bytes,i=e.offset,s=e.limit,c=i+t;if(c>r.length){let l=new Uint8Array(2*c);l.set(r),e.bytes=l}return e.offset=c,c>s&&(e.limit=c),i}function S0(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function lF(e,t){let r=S0(e,t),i=String.fromCharCode,s=e.bytes,c="�",l="";for(let u=0;u<t;u++){let h,f,m,E,S=s[u+r];128&S?(224&S)==192?u+1>=t?l+=c:(h=s[u+r+1],(192&h)!=128?l+=c:(E=(31&S)<<6|63&h,E<128?l+=c:(l+=i(E),u++))):(240&S)==224?u+2>=t?l+=c:(h=s[u+r+1],f=s[u+r+2],(49344&(h|f<<8))!=32896?l+=c:(E=(15&S)<<12|(63&h)<<6|63&f,E<2048||E>=55296&&E<=57343?l+=c:(l+=i(E),u+=2))):(248&S)==240?u+3>=t?l+=c:(h=s[u+r+1],f=s[u+r+2],m=s[u+r+3],(12632256&(h|f<<8|m<<16))!=8421504?l+=c:(E=(7&S)<<18|(63&h)<<12|(63&f)<<6|63&m,E<65536||E>1114111?l+=c:(E-=65536,l+=i(55296+(E>>10),56320+(1023&E)),u+=3))):l+=c:l+=i(S)}return l}function Oa(e,t){let r=t.length,i=0;for(let l=0;l<r;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<r&&(u=(u<<10)+t.charCodeAt(++l)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}wt(e,i);let s=hh(e,i),c=e.bytes;for(let l=0;l<r;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<r&&(u=(u<<10)+t.charCodeAt(++l)-56613888),u<128?c[s++]=u:(u<2048?c[s++]=u>>6&31|192:(u<65536?c[s++]=u>>12&15|224:(c[s++]=u>>18&7|240,c[s++]=u>>12&63|128),c[s++]=u>>6&63|128),c[s++]=63&u|128)}}function Fre(e,t){let r=hh(e,t.limit),i=e.bytes,s=t.bytes;for(let c=0,l=t.limit;c<l;c++)i[c+r]=s[c]}function dF(e){return e.bytes[S0(e,1)]}function uF(e,t){let r=hh(e,1);e.bytes[r]=t}function y0(e){let t=S0(e,8),r=e.bytes;return Ri[0]=r[t++],Ri[1]=r[t++],Ri[2]=r[t++],Ri[3]=r[t++],Ri[4]=r[t++],Ri[5]=r[t++],Ri[6]=r[t++],Ri[7]=r[t++],E0[0]}function v0(e,t){let r=hh(e,8),i=e.bytes;E0[0]=t,i[r++]=Ri[0],i[r++]=Ri[1],i[r++]=Ri[2],i[r++]=Ri[3],i[r++]=Ri[4],i[r++]=Ri[5],i[r++]=Ri[6],i[r++]=Ri[7]}function Na(e){let t,r=0,i=0;do t=dF(e),r<32&&(i|=(127&t)<<r),r+=7;while(128&t);return i}function wt(e,t){for(t>>>=0;t>=128;)uF(e,127&t|128),t>>>=7;uF(e,t)}function ll(e,t){let r=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,c=s===0?i===0?r<16384?r<128?1:2:r<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,l=hh(e,c),u=e.bytes;switch(c){case 10:u[l+9]=s>>>7&1;case 9:u[l+8]=c!==9?128|s:127&s;case 8:u[l+7]=c!==8?i>>>21|128:i>>>21&127;case 7:u[l+6]=c!==7?i>>>14|128:i>>>14&127;case 6:u[l+5]=c!==6?i>>>7|128:i>>>7&127;case 5:u[l+4]=c!==5?128|i:127&i;case 4:u[l+3]=c!==4?r>>>21|128:r>>>21&127;case 3:u[l+2]=c!==3?r>>>14|128:r>>>14&127;case 2:u[l+1]=c!==2?r>>>7|128:r>>>7&127;case 1:u[l]=c!==1?128|r:127&r}}function hF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}let jre=new Map([["moderation",1],["supervise",2]]);class Vg extends Jt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let r=this._connectionState;this._connectionState=t,this.emit(sn.CONNECTION_STATE_CHANGE,r,t)}get inspectType(){return this._inspectType}set inspectType(t){var r;this._inspectMode=Ds(r=t.map(i=>jre.get(i)||0)).call(r,(i,s)=>i+s),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),b(this,"name","AgoraRTCVideoContentInspect"),b(this,"_connectionState",$o.CONNECTING),b(this,"_innerConnectionState",void 0),b(this,"sequence",0),b(this,"inspectStartTime",void 0),b(this,"workerManagerConnection",void 0),b(this,"workerConnection",void 0),b(this,"workerMessageLengthLimit",void 0),b(this,"inspectIntervalMinimum",void 0),b(this,"qualityRatio",void 0),b(this,"_connectInfo",void 0),b(this,"_cancelTokenSource",si.CancelToken.source()),b(this,"_retryConfig",void 0),b(this,"wmSequence",0),b(this,"inspectInterval",void 0),b(this,"inspectTimer",null),b(this,"ossFilePrefix",void 0),b(this,"extraInfo",void 0),b(this,"_inspectType",void 0),b(this,"_inspectMode",void 0),b(this,"_quality",1),b(this,"qualityTimer",null),b(this,"_inspectId",void 0),b(this,"_needWorkUrlOnly",!1),b(this,"inspectImage",()=>{if(this.connectionState!==$o.CONNECTED)throw new H(N.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===$o.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=kt(5,"inspect-"),this.workerMessageLengthLimit=x("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=x("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=x("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new of("worker-manager-"+this._inspectId,Tr),this.on(sn.STATE_CHANGE,(r,i)=>{this._innerConnectionState=r,v.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Qo[r]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new of("worker-"+this._inspectId,Tr),this.handleWorkerEvents()}async init(t,r){this.emit(sn.STATE_CHANGE,Qo.CONNECT_AP),this._connectInfo=t;let i=this._cancelTokenSource.token;return this._retryConfig=r,new _e((s,c)=>{this.on(sn.CONNECTION_STATE_CHANGE,(l,u)=>{u===$o.CONNECTED&&s()}),this.requestAP(t,i,r).then(l=>{this.connectWorkerManager(l)}).catch(l=>{c(l)})})}async requestAP(t,r,i){let s=x("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),c=await function(u,h,f,m){let{appId:E,areaCode:S,cname:y,sid:A,token:T,uid:w}=h;Vu++;let O="image_moderation_api",P={service_name:O,json_body:JSON.stringify({appId:E,areaCode:S,cname:y,command:"allocateEdge",requestId:Vu,seq:Vu,sid:A,token:T,ts:Date.now(),uid:w+""})},F,W,K=u[0];return Ls(async()=>{F=Date.now();let X=await Vs(K,{data:P,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(W=Date.now()-F,X.code!==0){let we=new H(N.UNEXPECTED_RESPONSE,"image inspect ap error, code"+X.code,{retry:!0,responseTime:W});throw v.error(we.toString()),we}let ie=JSON.parse(X.json_body);if(ie.code!==200){let we=new H(N.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ie.code,", reason: ").concat(ie.reason),{code:ie.code,responseTime:W});throw v.error(we.toString()),we}if(!ie.servers||!Array.isArray(ie.servers)||ie.servers.length===0){let we=new H(N.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ie.code,responseTime:W});throw v.error(we.toString()),we}let ae=x("VIDEO_INSPECT_WORKER_MANAGER_HOST"),le=x("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ie.servers.map(we=>{let{address:nt,wss:gt}=we;if(nt&&gt)return"wss://".concat(nt.replace(/\./g,"-"),".").concat(ae,":").concat(le||gt)}).filter(we=>!!we),workerToken:ie.workerToken,vid:ie.vid,responseTime:W}},(X,ie)=>(be.apworkerEvent(A,{success:!0,sc:200,serviceName:O,responseDetail:JSON.stringify(X.addressList),firstSuccess:ie===0,responseTime:W,serverIp:u[ie%u.length]}),!1),(X,ie)=>(be.apworkerEvent(A,{success:!1,sc:X.data&&X.data.code||200,serviceName:O,responseTime:W,serverIp:u[ie%u.length]}),!!(X.code!==N.OPERATION_ABORTED&&X.code!==N.UNEXPECTED_RESPONSE||X.data&&X.data.retry)&&(K=u[(ie+1)%u.length],!0)),m)}(s,t,r,i);this.emit(sn.STATE_CHANGE,Qo.AP_CONNECTED);let{addressList:l}=c;return this.wmSequence++,l}async connectWorkerManager(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(sn.STATE_CHANGE,Qo.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ue.CONNECTED,async()=>{this.emit(sn.STATE_CHANGE,Qo.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.21.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ue.CLOSED,()=>{this._innerConnectionState<Qo.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ue.FAILED,()=>{this._innerConnectionState<Qo.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ue.RECONNECTING,()=>{this._innerConnectionState<Qo.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ue.ON_MESSAGE,async t=>{this.emit(sn.STATE_CHANGE,Qo.GET_WORKER_MANAGER_RESPONSE);let r=this.workerManagerConnection.url;this.workerManagerConnection.close();let i=JSON.parse(t.data);if(i.code!==200)throw v.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new H(N.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&r))throw v.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new H(N.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{let s=x("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,c=r.replace(/:\d+\/?$/,":".concat(s));this.emit(sn.STATE_CHANGE,Qo.CONNECT_WORKER,c),this._needWorkUrlOnly?this.emit(sn.REQUEST_NEW_WORKER_URL,c):await this.connectWorker(c)}}),this.workerManagerConnection.on(Ue.WILL_RECONNECT,(t,r,i)=>{i(t)}),this.workerManagerConnection.on(Ue.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}handleWorkerEvents(){this.workerConnection.on(Ue.CONNECTED,async()=>{this.emit(sn.STATE_CHANGE,Qo.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=$o.CONNECTED}),this.workerConnection.on(Ue.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let i=kre(new Uint8Array(t.data));if(x("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&v.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(sn.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var r;let s={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},c=Ds(r=Object.keys(s)).call(r,(u,h)=>s[u]>s[h]?u:h,"porn"),l=Object.keys(s).find(u=>u===c);this.emit(sn.INSPECT_RESULT,l)}else this.emit(sn.INSPECT_RESULT,void 0,new H(N.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(sn.INSPECT_RESULT,void 0,new H(N.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else v.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(sn.INSPECT_RESULT,void 0,new H(N.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ue.CLOSED,()=>{this.connectionState=$o.CLOSED}),this.workerConnection.on(Ue.FAILED,()=>{this.connectionState=$o.CLOSED}),this.workerConnection.on(Ue.RECONNECTING,()=>{this.connectionState=this.connectionState===$o.CONNECTED?$o.RECONNECTING:$o.CONNECTING}),this.workerConnection.on(Ue.WILL_RECONNECT,(t,r,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(Ue.REQUEST_NEW_URLS,(t,r)=>{this.workerManagerConnection.close(),this.once(sn.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{r(i)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;let t=Mi(this,sn.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(sn.INSPECT_RESULT,void 0,new H(N.INVALID_OPERATION,"Only the track being played can be inspected"));let i=await this.generateRequestData(t,r);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(sn.INSPECT_RESULT,void 0,new H(N.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,r){let{appId:i,cname:s,cid:c,vid:l,sid:u,uid:h}=r,f=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await px(m,i,s),S=this.sequence+"-"+c+"-"+h+"-"+f+"-"+kt(12,""),y={appId:i,cid:c,cname:s,deviceId:"",elapse:Vg.intToLong(Number(f-this.inspectStartTime)),fileSize:E.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:S,sdkVersion:"4.21.0",sequence:this.sequence,sid:u,timestamp:Vg.intToLong(f),uid:h,vid:l,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;let A=Pre(y);if(A.byteLength<this.workerMessageLengthLimit){if(x("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let T=function(w){for(var O=1;O<arguments.length;O++){var P=arguments[O]!=null?arguments[O]:{};O%2?hF(Object(P),!0).forEach(function(F){b(w,F,P[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(P)):hF(Object(P)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(P,F))})}return w}({},y);delete T.jpg,v.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(T))}return A}{let T=this.quality*this.qualityRatio;return this.quality=T,await this.generateRequestData(t,{appId:i,cname:s,cid:c,vid:l,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=si.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=$o.CLOSED,this.emit(sn.STATE_CHANGE,Qo.CLOSED)}}function Bre(e){let t=function(){let r=Hre.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,i){let s=r.appId;s!==void 0&&(Rr(i,10),dl(i,s));let c=r.cid;c!==void 0&&(Rr(i,16),Rr(i,c));let l=r.cname;l!==void 0&&(Rr(i,26),dl(i,l));let u=r.deviceId;u!==void 0&&(Rr(i,34),dl(i,u));let h=r.elapse;h!==void 0&&(Rr(i,40),ul(i,h));let f=r.fileSize;f!==void 0&&(Rr(i,48),ul(i,ph(f)));let m=r.height;m!==void 0&&(Rr(i,56),ul(i,ph(m)));let E=r.jpg;E!==void 0&&(Rr(i,66),Rr(i,E.length),fF(i,E));let S=r.networkType;S!==void 0&&(Rr(i,72),ul(i,ph(S)));let y=r.osType;y!==void 0&&(Rr(i,80),ul(i,ph(y)));let A=r.requestId;A!==void 0&&(Rr(i,90),dl(i,A));let T=r.sdkVersion;T!==void 0&&(Rr(i,98),dl(i,T));let w=r.sequence;w!==void 0&&(Rr(i,104),ul(i,ph(w)));let O=r.sid;O!==void 0&&(Rr(i,114),dl(i,O));let P=r.timestamp;P!==void 0&&(Rr(i,120),ul(i,P));let F=r.uid;F!==void 0&&(Rr(i,128),Rr(i,F));let W=r.vid;W!==void 0&&(Rr(i,136),Rr(i,W));let K=r.width;K!==void 0&&(Rr(i,144),ul(i,ph(K)));let X=r.service;X!==void 0&&(Rr(i,152),Rr(i,X));let ie=r.callbackData;ie!==void 0&&(Rr(i,162),Rr(i,ie.length),fF(i,ie));let ae=r.ticket;ae!==void 0&&(Rr(i,170),dl(i,ae));let le=r.vendorConfigs;le!==void 0&&(Rr(i,178),dl(i,le))}(e,t),function(r){let i=r.bytes,s=r.limit;return i.length===s?i:i.subarray(0,s)}(t)}function Wre(e){return function(r){let i={};e:for(;!Kre(r);){let s=Bf(r);switch(s>>>3){case 0:break e;case 1:i.code=Bf(r);break;case 2:i.msg=mF(r,Bf(r));break;case 3:i.requestId=mF(r,Bf(r));break;case 4:i.timestamp=zre(r,!1);break;default:Gre(r,7&s)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function Gre(e,t){switch(t){case 0:for(;128&hs(e););break;case 2:T0(e,Bf(e));break;case 5:T0(e,4);break;case 1:T0(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function ph(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Hre=[];function T0(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Kre(e){return e.offset>=e.limit}function Fg(e,t){let r=e.bytes,i=e.offset,s=e.limit,c=i+t;if(c>r.length){let l=new Uint8Array(2*c);l.set(r),e.bytes=l}return e.offset=c,c>s&&(e.limit=c),i}function pF(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function fF(e,t){let r=Fg(e,t.length);e.bytes.set(t,r)}function mF(e,t){let r=pF(e,t),i=String.fromCharCode,s=e.bytes,c="�",l="";for(let u=0;u<t;u++){let h,f,m,E,S=s[u+r];128&S?(224&S)==192?u+1>=t?l+=c:(h=s[u+r+1],(192&h)!=128?l+=c:(E=(31&S)<<6|63&h,E<128?l+=c:(l+=i(E),u++))):(240&S)==224?u+2>=t?l+=c:(h=s[u+r+1],f=s[u+r+2],(49344&(h|f<<8))!=32896?l+=c:(E=(15&S)<<12|(63&h)<<6|63&f,E<2048||E>=55296&&E<=57343?l+=c:(l+=i(E),u+=2))):(248&S)==240?u+3>=t?l+=c:(h=s[u+r+1],f=s[u+r+2],m=s[u+r+3],(12632256&(h|f<<8|m<<16))!=8421504?l+=c:(E=(7&S)<<18|(63&h)<<12|(63&f)<<6|63&m,E<65536||E>1114111?l+=c:(E-=65536,l+=i(55296+(E>>10),56320+(1023&E)),u+=3))):l+=c:l+=i(S)}return l}function dl(e,t){let r=t.length,i=0;for(let l=0;l<r;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<r&&(u=(u<<10)+t.charCodeAt(++l)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}Rr(e,i);let s=Fg(e,i),c=e.bytes;for(let l=0;l<r;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<r&&(u=(u<<10)+t.charCodeAt(++l)-56613888),u<128?c[s++]=u:(u<2048?c[s++]=u>>6&31|192:(u<65536?c[s++]=u>>12&15|224:(c[s++]=u>>18&7|240,c[s++]=u>>12&63|128),c[s++]=u>>6&63|128),c[s++]=63&u|128)}}function hs(e){return e.bytes[pF(e,1)]}function _F(e,t){let r=Fg(e,1);e.bytes[r]=t}function Bf(e){let t,r=0,i=0;do t=hs(e),r<32&&(i|=(127&t)<<r),r+=7;while(128&t);return i}function Rr(e,t){for(t>>>=0;t>=128;)_F(e,127&t|128),t>>>=7;_F(e,t)}function zre(e,t){let r,i=0,s=0,c=0;return r=hs(e),i=127&r,128&r&&(r=hs(e),i|=(127&r)<<7,128&r&&(r=hs(e),i|=(127&r)<<14,128&r&&(r=hs(e),i|=(127&r)<<21,128&r&&(r=hs(e),s=127&r,128&r&&(r=hs(e),s|=(127&r)<<7,128&r&&(r=hs(e),s|=(127&r)<<14,128&r&&(r=hs(e),s|=(127&r)<<21,128&r&&(r=hs(e),c=127&r,128&r&&(r=hs(e),c|=(127&r)<<7))))))))),{low:i|s<<28,high:s>>>4|c<<24,unsigned:t}}function ul(e,t){let r=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,c=s===0?i===0?r<16384?r<128?1:2:r<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,l=Fg(e,c),u=e.bytes;switch(c){case 10:u[l+9]=s>>>7&1;case 9:u[l+8]=c!==9?128|s:127&s;case 8:u[l+7]=c!==8?i>>>21|128:i>>>21&127;case 7:u[l+6]=c!==7?i>>>14|128:i>>>14&127;case 6:u[l+5]=c!==6?i>>>7|128:i>>>7&127;case 5:u[l+4]=c!==5?128|i:127&i;case 4:u[l+3]=c!==4?r>>>21|128:r>>>21&127;case 3:u[l+2]=c!==3?r>>>14|128:r>>>14&127;case 2:u[l+1]=c!==2?r>>>7|128:r>>>7&127;case 1:u[l]=c!==1?128|r:127&r}}let EF={},gF={},jg=4294967296,qre=jg*jg,SF=qre/2;vF(0,!0);let yF=vF(0),Yre=Wf(0,-2147483648,!1),Jre=Wf(-1,2147483647,!1);function vF(e,t){let r,i,s;return t?(s=0<=(e>>>=0)&&e<256)&&(i=gF[e],i)?i:(r=Wf(e,0,!0),s&&(gF[e]=r),r):(s=-128<=(e|=0)&&e<128)&&(i=EF[e],i)?i:(r=Wf(e,e<0?-1:0,!1),s&&(EF[e]=r),r)}function Wf(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function Xre(e,t){if(isNaN(e))return yF;{if(e<=-SF)return Yre;if(e+1>=SF)return Jre}return e<0?yF:Wf(e%jg|0,e/jg|0,t)}function TF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}class C0 extends Jt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let r=this._connectionState;this._connectionState=t,this.emit(xs.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var r;super(),b(this,"name","AgoraRTCImageModeration"),b(this,"_connectionState",So.CONNECTING),b(this,"_sequence",0),b(this,"_moderationStartTime",void 0),b(this,"_workerConnection",void 0),b(this,"_workerMessageLengthLimit",void 0),b(this,"_qualityRatio",void 0),b(this,"_connectInfo",void 0),b(this,"_cancelTokenSource",si.CancelToken.source()),b(this,"_retryConfig",void 0),b(this,"_moderationInterval",void 0),b(this,"_moderationTimer",null),b(this,"_moderationMode",1),b(this,"_quality",1),b(this,"_qualityTimer",null),b(this,"_ticket",void 0),b(this,"_moderationIntervalMinimum",void 0),b(this,"_uploadFailedNum",0),b(this,"_uploadNum",0),b(this,"_uploadTimer",null),b(this,"_extraInfo",void 0),b(this,"_vendor",""),b(this,"_encoder",new TextEncoder),b(this,"_moderationId",void 0),b(this,"inspectImage",()=>{if(this.connectionState!==So.CONNECTED)throw new H(N.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===So.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=kt(5,"image-moderation-"),this._workerMessageLengthLimit=x("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=x("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=x("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new of("worker-"+this._moderationId,Tr),this.on(xs.STATE_CHANGE,(i,s)=>{v.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Mu[i]," ").concat(s||""))}),this.handleWorkerEvents()}async init(t,r){this.emit(xs.STATE_CHANGE,Mu.CONNECT_AP),this._connectInfo=t;let i=this._cancelTokenSource.token;return this._retryConfig=r,new _e((s,c)=>{this.on(xs.CONNECTION_STATE_CHANGE,(l,u)=>{l===So.CONNECTED&&s()}),this.requestAP(t,i,r).then(l=>{this.connectWorker(l)}).catch(l=>{c(l)})})}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),v.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===So.CONNECTED&&this.inspectImage()}async requestAP(t,r,i){let s=x("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),c=await function(h,f,m,E){let{appId:S,areaCode:y,cname:A,sid:T,token:w,uid:O}=f;Vu++;let P="moderation_plugin",F={service_name:P,json_body:JSON.stringify({appId:S,areaCode:y,cname:A,command:"allocateEdge",requestId:Vu,seq:Vu,sid:T,appToken:w,ts:Date.now(),uid:O+""})},W,K,X=h[0];return Ls(async()=>{W=Date.now();let ie=await Vs(X,{data:F,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-W,ie.code!==0){let we=new H(N.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ie.code,{retry:!0,responseTime:K});throw v.error(we.toString()),we}let ae=JSON.parse(ie.json_body);if(ae.code!==200){let we=new H(N.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ae.code,", reason: ").concat(ae.reason),{code:ae.code,responseTime:K});throw v.error(we.toString()),we}if(!ae.servers||!Array.isArray(ae.servers)||ae.servers.length===0){let we=new H(N.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ae.code,responseTime:K});throw v.error(we.toString()),we}if(!ae.servers.some(we=>!!we.wss)){let we=new H(N.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ae.code,responseTime:K});throw v.error(we.toString()),we}let le=x("IMAGE_MODERATION_WORKER_HOST");return{addressList:ae.servers.map(we=>{let{address:nt,wss:gt}=we;if(nt&&gt)return"wss://".concat(nt.replace(/\./g,"-"),".").concat(le,":").concat(gt,"/moderation")}).filter(we=>!!we),workerToken:ae.workerToken,vid:ae.vid,ticket:ae.appTicket,responseTime:K}},(ie,ae)=>(be.apworkerEvent(T,{success:!0,sc:200,serviceName:P,responseDetail:JSON.stringify(ie.addressList),firstSuccess:ae===0,responseTime:K,serverIp:h[ae%h.length]}),!1),(ie,ae)=>(be.apworkerEvent(T,{success:!1,sc:ie.data&&ie.data.code||200,serviceName:P,responseTime:K,serverIp:h[ae%h.length]}),!!(ie.code!==N.OPERATION_ABORTED&&ie.code!==N.UNEXPECTED_RESPONSE||ie.data&&ie.data.retry)&&(X=h[(ae+1)%h.length],!0)),E)}(s,t,r,i);this.emit(xs.STATE_CHANGE,Mu.AP_CONNECTED);let{addressList:l,ticket:u}=c;return this._ticket=u,l}async connectWorker(t){this.emit(xs.STATE_CHANGE,Mu.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Ue.CONNECTED,async()=>{this.emit(xs.STATE_CHANGE,Mu.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=So.CONNECTED}),this._workerConnection.on(Ue.CLOSED,()=>{this.connectionState=So.CLOSED}),this._workerConnection.on(Ue.FAILED,()=>{this.connectionState=So.CLOSED}),this._workerConnection.on(Ue.RECONNECTING,()=>{this.connectionState=this.connectionState===So.CONNECTED?So.RECONNECTING:So.CONNECTING}),this._workerConnection.on(Ue.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let r=Wre(new Uint8Array(t.data));x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,v.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{be.reportApiInvoke(this._connectInfo.sid||null,{name:Pr.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:sr.TRACER}).onError(new H(N.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},x("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else v.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Ue.WILL_RECONNECT,(t,r,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(Ue.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=Mi(this,xs.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being played can be inspected"));this._sequence++;let i=await this.generateRequestData(t,r);this._workerConnection.sendMessage(i,!0,!0)}else x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:i,cname:s,cid:c,vid:l,sid:u,uid:h}=r,f=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await px(m,i,s),S=this._sequence+"-"+c+"-"+h+"-"+f+"-"+kt(12,""),y={appId:i,cid:c,cname:s,deviceId:"",elapse:C0.intToLong(Number(f-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:S,sdkVersion:"4.21.0",sequence:this._sequence,sid:u,timestamp:Xre(f),uid:h,vid:l,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete y.callbackData;let A=Bre(y);if(A.byteLength<this._workerMessageLengthLimit){if(x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let T=function(w){for(var O=1;O<arguments.length;O++){var P=arguments[O]!=null?arguments[O]:{};O%2?TF(Object(P),!0).forEach(function(F){b(w,F,P[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(P)):TF(Object(P)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(P,F))})}return w}({},y);delete T.jpg,v.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(T))}return A}{let T=this.quality*this._qualityRatio;return this.quality=T,await this.generateRequestData(t,{appId:i,cname:s,cid:c,vid:l,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=si.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=So.CLOSED,this.emit(xs.STATE_CHANGE,Mu.CLOSED)}}function CF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function RF(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CF(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CF(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let $re=Date.now(),Qre=20,R0=new Map,Bg=new Map;async function wF(e){let t=R0.get(e),r=Array.isArray(t)&&t[t.length-1],i=Bg.get(e);if(!r)return void(i.isSyncing=!1);let s={uid:r.uid,payload:r.payload};i.firstRecvTs===0&&(i.firstRecvTs=r.recvTs,i.firstSendTs=r.sendTs);let c=r.sendTs-i.firstSendTs,l=c-(Date.now()-i.firstRecvTs);l>0&&(i.firstRecvTs=Date.now()-c);let u=r.mediaDelay+l;u<=0?(t.pop(),IF(r.context,s),u=0):u=Math.min(u,Qre),setTimeout(()=>t.length&&wF(e),u)}function IF(e,t){e.safeEmit(tt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Zre(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return IF(r,{uid:e.uid,payload:e.payload});let i="".concat(r.id,"-").concat(e.uid),s=R0.get(i)||[],c=s.findIndex(f=>e.sendTs>=f.sendTs),l=RF(RF({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});c===-1?s.push(l):s.splice(c,0,l),R0.set(i,s);let u=!1;var h;Bg.has(i)?u=!((h=Bg.get(i))===null||h===void 0||!h.isSyncing):Bg.set(i,{isSyncing:u,firstRecvTs:0,firstSendTs:0}),u||wF(i)}let ene=dt().name;function bF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function AF(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bF(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bF(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let fh="websdk_ng_cache_parameter",tne=x("MAX_PRELOAD_ASYNC_LENGTH"),rne=1e4,Id=new Map,bd=[],w0=null,I0=0,b0=0,Wg=new Map,nne=function(e,t){let r=[],i=0,s=async()=>{let c=r.shift();c&&await c(),r.length>0&&i<t?s():i--};return async function(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return new _e(async(h,f)=>{r.push(async()=>{try{let m=await e(...l);h(m)}catch(m){f(m)}}),i<t&&(i++,s())})}}(OF,tne),A0=si.CancelToken.source();async function OF(e,t,r,i,s){try{if(!x("ENABLE_PRELOAD"))return;if(!at().supportWebCrypto)return void Wc(()=>{v.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new ee(N.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&dn(r,"token",1,2047),dn(e,"appid",1,2047),ME(t),i&&xE(i);let c=Zp();v.debug("preload channel ".concat(t,", uid is ").concat(i));let l={appId:e,cname:t,token:r||e,uid:typeof i!="string"?i:null,sid:c,proxyServer:s},u,h;typeof i=="string"?(l.stringUid=i,[h,u]=await _e.all([RZ(i,{sid:c,appId:e},A0.token),vM(AF(AF({},l),{},{token:r||e,uid:0}),A0.token)]),l.uid=h.uid,u.gatewayInfo.uid=l.uid,u.gatewayInfo.res.uid=l.uid):u=await vM(l,A0.token);let f={sid:c,appId:e,cname:t,token:r||e,uid:l.stringUid||i,intUid:l.uid||u.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:h,ap:u};await async function(m){let E;try{m.uid&&DF({appId:m.appId,cname:m.cname,token:m.token,uid:m.uid,stringUid:m.stringUid});let S=MF(m),y=await async function(T,w){try{let O=await window.crypto.subtle.importKey("raw",wL(w),"AES-GCM",!1,["encrypt"]),P=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},O,nd(window.btoa(JSON.stringify(T))));return Gc(new Uint8Array(P))}catch{return}}(m,m.token||m.appId);if(!y)return;E=LF(fh);let A=E?JSON.parse(E):[];A.push({[S]:y}),A.length>x("AP_CACHE_NUM")&&A.shift(),Gg(fh,JSON.stringify(A))}catch(S){v.warn("Error caching server parameters:",S.message),Gg(fh,"")}}(f),I0++}catch(c){throw b0++,function(l){w0||(w0=window.setTimeout(()=>{let h="";Wg.forEach((f,m)=>{h+="".concat(m,": ").concat(f," ;")}),be.reportApiInvoke(null,{name:Pr.PRELOAD,options:{success:I0,failed:b0,err:h}}).onError(l),I0=0,b0=0,Wg.clear(),w0=null},rne));let u=Wg.get(l.code)||0;Wg.set(l.code,u+1)}(c),c}}async function NF(e){try{let t=DF(e);if(!t||e.cloudProxyServer!=="disabled")return;let r=await async function(i,s){try{let c=await window.crypto.subtle.importKey("raw",wL(s),"AES-GCM",!1,["decrypt"]),l=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},c,nd(i));return JSON.parse(window.atob(Gc(new Uint8Array(l))))}catch{return}}(t,e.token||e.appId);if(!r||!function(i,s){return i.cname===s.cname&&i.appId===s.appId&&i.token===s.token?s.stringUid?i.stringUid===s.stringUid:typeof s.uid=="number"?i.uid===s.uid:i.uid==s.uid:!1}(r,e))return;if(r&&Date.now()-r.ts<x("AP_CACHE_LIFETIME"))return r}catch(t){v.warn("Error get preloadInfo",t.message)}}function DF(e){let t;try{if(t=LF(fh),!t)return;let r=JSON.parse(t),i=MF(e),s=function(l,u){for(let h=l.length-1;h>=0;h--)if(u(l[h]))return h;return-1}(r,l=>i in l);if(s===-1)return;let c=r.splice(s,1)[0];return Gg(fh,JSON.stringify(r)),c[i]}catch(r){v.warn("Error delete preload info: ".concat(t),r.message),Gg(fh,"")}}function O0(e){if(e){let t=Id.get(e);t&&(window.clearTimeout(t),t=null,Id.delete(e)),ge(bd).call(bd,e)||e.cloudProxyServer!=="disabled"||bd.push(e)}if(Id.size<x("AP_CACHE_NUM")&&bd.length>0){let t=bd.shift();Id.set(t,window.setTimeout(async()=>{let{appId:r,cname:i,token:s,uid:c,proxyServer:l}=t;try{await nne(r,i,s,c,l),Id.has(t)&&O0(t)}catch(u){v.warn("update preload failed",u.message),PF(t)}},x("AP_UPDATE_INTERVAL")))}}function PF(e){let t=bd.indexOf(e);t!==-1&&bd.splice(t,1);let r=Id.get(e);r&&(window.clearTimeout(r),r=null,Id.delete(e),O0())}function kF(e,t){let r=e.sua,i=e.ap;t&&r&&be.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),be.reportResourceTiming(e.ap.url,e.sid),be.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(s=>s.ip).join(","),eventType:"disabled",unilbsServerIds:[Cr.CHOOSE_SERVER,Cr.CLOUD_PROXY_FALLBACK].toString()}),be.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(s=>s.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[Cr.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function LF(e){return window.atob(window.localStorage.getItem(e)||"")}function Gg(e,t){window.localStorage.setItem(e,window.btoa(t))}function MF(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),PL(t)}var xF,UF,VF,FF,jF,BF,WF,GF,HF,KF,zF,qF,YF,JF,XF,$F,QF,ZF,ej,tj,rj,nj,ij,oj,sj,aj,cj,lj,dj,uj,hj,pj,fj,mj,_j,Ej,gj,Sj,yj,vj,Tj,Cj,Se;function Rj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function wo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Rj(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rj(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}rn.setLogger(v);let ine=(xF=ke(),UF=ke({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof rh))return[t];t=[t]}return t.map(r=>r?Object(r).toString():"null")}}),VF=ke({argsMap:(e,t)=>(t||(t=[]),t instanceof qU?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map(r=>r.getTrackId())))}),FF=ke({argsMap:(e,t,r,i)=>[typeof t=="object"?t.uid:t,r,i]}),jF=ke({argsMap:(e,t,r)=>[t,r]}),BF=ke({argsMap:(e,t)=>t.map(r=>{let{user:i,mediaType:s}=r;return[i==null?void 0:i.uid,s]})}),WF=ke({argsMap:(e,t,r,i)=>[typeof t=="object"?t.uid:t,r,i]}),GF=ke({argsMap:(e,t)=>t.map(r=>{let{user:i,mediaType:s}=r;return{uid:i==null?void 0:i.uid,mediaType:s}})}),HF=ke(),KF=ke(),zF=ke(),qF=ke(),YF=ke(),JF=ke(),XF=ke(),$F=ke(),QF=ke(),ZF=ke(),ej=ke(),tj=ke(),rj=ke(),nj=ke(),ij=ke({argsMap:(e,t)=>[t]}),oj=ke(),sj=ke(),aj=ke(),cj=ke(),lj=ke(),dj=ke(),uj=ke(),hj=ke(),pj=ke(),fj=ke(),mj=ke({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),_j=ke(),Ej=ke(),gj=ke(),Sj=ke(),yj=ke(),vj=ke(),Tj=ke({reportResult:!0}),Cj=ke(),Se=class extends Jt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),b(this,"store",void 0),b(this,"_uid",void 0),b(this,"_channelName",void 0),b(this,"_uintUid",void 0),b(this,"_users",[]),b(this,"_config",void 0),b(this,"_clientId",void 0),b(this,"_appId",void 0),b(this,"_sessionId",null),b(this,"_key",void 0),b(this,"_rtmConfig",{}),b(this,"_joinInfo",void 0),b(this,"_gateway",void 0),b(this,"_statsCollector",void 0),b(this,"_configDistribute",void 0),b(this,"_leaveMutex",new rn("client-leave")),b(this,"_publishMutex",new rn("client-publish")),b(this,"_renewTokenMutex",new rn("client-renewtoken")),b(this,"_subscribeMutex",new rn("client-subscribe")),b(this,"_encryptionMode","none"),b(this,"_encryptionSecret",null),b(this,"_encryptionSalt",null),b(this,"_encryptDataStream",!1),b(this,"_encryptDataStreamKey",null),b(this,"_encryptDataStreamIv",null),b(this,"_proxyServer",void 0),b(this,"_turnServer",{servers:[],mode:"auto"}),b(this,"_cloudProxyServerMode","disabled"),b(this,"_isDualStreamEnabled",!1),b(this,"_defaultStreamFallbackType",void 0),b(this,"_lowStreamParameter",void 0),b(this,"_streamFallbackTypeCacheMap",new Map),b(this,"_remoteStreamTypeCacheMap",new Map),b(this,"_axiosCancelSource",si.CancelToken.source()),b(this,"_audioVolumeIndicationInterval",void 0),b(this,"_networkQualityInterval",void 0),b(this,"_userOfflineTimeout",void 0),b(this,"_streamRemovedTimeout",void 0),b(this,"_injectStreamingClient",void 0),b(this,"_liveTranscodeStreamingClient",void 0),b(this,"_liveRawStreamingClient",void 0),b(this,"_channelMediaRelayClient",void 0),b(this,"_networkQualitySensitivity","normal"),b(this,"_p2pChannel",void 0),b(this,"_useLocalAccessPoint",!1),b(this,"_setLocalAPVersion",void 0),b(this,"_joinAndNotLeaveYet",!1),b(this,"_numberOfJoinCount",0),b(this,"_remoteDefaultVideoStreamType",void 0),b(this,"_inspect",void 0),b(this,"_moderation",void 0),b(this,"_license",void 0),b(this,"_pendingPublishedUsers",[]),b(this,"ntpAlignErrorCount",0),b(this,"remoteInboundOffset",0),b(this,"_handleLocalTrackEnable",(r,i,s)=>{this.publish(r,!1).then(i).catch(s)}),b(this,"_handleLocalTrackDisable",(r,i,s)=>{this.unpublish(r).then(i).catch(s)}),b(this,"_handleUserOnline",r=>{if(x("BLOCK_LOCAL_CLIENT")&&od(r.uid,this.channelName))return void v.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&v.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let i=this._users.find(s=>s.uid===r.uid);if(i)i._trust_in_room_=!0,i._is_pre_created&&(i._is_pre_created=!1,this.safeEmit(tt.USER_JOINED,i));else{let s=new ol(r.uid,r.uint_id||r.uid);this._users.push(s),v.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(tt.USER_JOINED,s)}}),b(this,"_handleUserOffline",r=>{if(x("BLOCK_LOCAL_CLIENT")&&od(r.uid,this.channelName))return;let i=this._users.find(s=>s.uid===r.uid);i&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),i._audio_pre_subscribed||i._video_pre_subscribed?i._is_pre_created=!0:IE(this._users,i),this._remoteStreamTypeCacheMap.delete(i.uid),this._streamFallbackTypeCacheMap.delete(i.uid),v.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(tt.USER_LEAVED,i,r.reason))}),b(this,"_handleAddAudioOrVideoStream",(r,i,s,c,l,u,h)=>{if(x("BLOCK_LOCAL_CLIENT")&&od(i,this.channelName))return;let f=this._users.find(E=>E.uid===i);if(!f)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(i,", type ").concat(r)),this.store.subscribe(f.uid,r,void 0,void 0,void 0,Date.now());let m=r==="audio"?f.hasAudio:f.hasVideo;f._uintid||(f._uintid=l||i),r==="audio"?f._trust_audio_stream_added_state_=!0:f._trust_video_stream_added_state_=!0,r==="audio"?(f._audio_added_=!0,s!==void 0&&(f._audioSSRC=s),c!==void 0&&(f._cname=c),u&&(f._audioOrtc=u)):(f._video_added_=!0,s!==void 0&&(f._videoSSRC=s),c!==void 0&&(f._cname=c),h!==void 0&&(f._rtxSsrcId=h),u&&(f._videoOrtc=u)),(r==="audio"?f.hasAudio:f.hasVideo)&&!m&&(v.info("[".concat(this._clientId,"] remote user ").concat(f.uid," published ").concat(r)),this.safeEmit(tt.USER_PUBLISHED,f,r)),r==="video"?be.onGatewayStream(this._sessionId,nn.ON_ADD_VIDEO_STREAM,rr.ON_ADD_VIDEO_STREAM,{peer:l||i,ssrc:f._videoSSRC}):be.onGatewayStream(this._sessionId,nn.ON_ADD_AUDIO_STREAM,rr.ON_ADD_AUDIO_STREAM,{peer:l||i,ssrc:f._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(f,r,s).then(E=>{if(E&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(f.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Ug))return this._p2pChannel.unsubscribe(f,r,!0).then(()=>this._subscribe(f,r,!0).catch(S=>{v.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(f,r)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(f.uid," after reconnect.")),this._subscribe(f,r,!0).catch(E=>{v.error("[".concat(this._clientId,"] resubscribe error"),E.toString())}))}),b(this,"_handleRemoveStream",r=>{if(x("BLOCK_LOCAL_CLIENT")&&od(r.uid,this.channelName))return;let i=this._users.find(c=>c.uid===r.uid);if(!i)return void v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));v.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let s=()=>{};i.hasAudio&&i.hasVideo?s=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.safeEmit(tt.USER_UNPUBLISHED,i,"audio"),v.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.safeEmit(tt.USER_UNPUBLISHED,i,"video")}:i.hasVideo?s=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.safeEmit(tt.USER_UNPUBLISHED,i,"video")}:i.hasAudio&&(s=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.safeEmit(tt.USER_UNPUBLISHED,i,"audio")}),i._video_pre_subscribed||i._audio_pre_subscribed||(i._trust_audio_stream_added_state_=!0,i._trust_video_stream_added_state_=!0,i._audio_added_=!1,i._video_added_=!1,this._p2pChannel instanceof Ug&&this._p2pChannel.unsubscribe(i).then(c=>{if(c)return this._gateway.unsubscribe(c,i.uid)}),i._audioSSRC=void 0,i._videoSSRC=void 0,i._audioOrtc=void 0,i._videoOrtc=void 0,i._rtxSsrcId=void 0),be.onGatewayStream(this._sessionId,nn.ON_REMOVE_STREAM,rr.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),s()}),b(this,"_handleSetStreamLocalEnable",(r,i,s)=>{if(x("BLOCK_LOCAL_CLIENT")&&od(i,this.channelName))return;let c=this._users.find(h=>h.uid===i);if(!c)return void v.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));v.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(s?"enabled":"disabled"," with uid ").concat(i));let l=r==="audio"?c.hasAudio:c.hasVideo;if(r==="audio"){c._trust_audio_enabled_state_=!0;let h=c._audio_enabled_;if(c._audio_enabled_=s,c._audio_enabled_===h)return;{let f=c._audio_enabled_?"enable-local-audio":"disable-local-audio";v.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(i,", msg: ").concat(f)),this.safeEmit(tt.USER_INFO_UPDATED,i,f)}}else{c._trust_video_enabled_state_=!0;let h=c._video_enabled_;if(c._video_enabled_=s,c._video_enabled_===h)return;{let f=c._video_enabled_?"enable-local-video":"disable-local-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(f)),this.safeEmit(tt.USER_INFO_UPDATED,i,f)}}let u=r==="audio"?c.hasAudio:c.hasVideo;return l!==u?!l&&u?(v.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(r)),void this.safeEmit(tt.USER_PUBLISHED,c,r)):(r==="video"&&c._videoTrack&&c._videoTrack._destroy(),r==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,r),v.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(r)),void this.safeEmit(tt.USER_UNPUBLISHED,c,r)):void 0}),b(this,"_handleMuteStream",(r,i,s)=>{if(x("BLOCK_LOCAL_CLIENT")&&od(r,this.channelName))return;v.debug("[".concat(this._clientId,"] receive mute message"),r,i,s);let c=this._users.find(h=>h.uid===r);if(!c)return void v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));let l=i==="audio"?c.hasAudio:c.hasVideo;if(i==="audio"){c._trust_audio_mute_state_=!0;let h=c._audio_muted_;if(c._audio_muted_=s,c._audio_muted_===h)return;{let f=c._audio_muted_?"mute-audio":"unmute-audio";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(f)),this.safeEmit(tt.USER_INFO_UPDATED,r,f)}}else{c._trust_video_mute_state_=!0;let h=c._video_muted_;if(c._video_muted_=s,c._video_muted_===h)return;{let f=c._video_muted_?"mute-video":"unmute-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(f)),this.safeEmit(tt.USER_INFO_UPDATED,r,f)}}let u=i==="audio"?c.hasAudio:c.hasVideo;if(l!==u){if(!l&&u)return(i==="audio"?c._audioSSRC:c._videoSSRC)?(v.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(i)),void this.safeEmit(tt.USER_PUBLISHED,c,i)):void v.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(i," unmute message  before add stream message, ").concat(i," SSRC doesn't exist yet."));i==="video"&&c._videoTrack&&!c._video_pre_subscribed&&c._videoTrack._destroy(),i==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,i),v.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(i)),this.safeEmit(tt.USER_UNPUBLISHED,c,i)}}),b(this,"_handleP2PLost",async r=>{v.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():v.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),b(this,"_handleTokenWillExpire",()=>{v.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(tt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),b(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),v.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),b(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(tt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(tt.NETWORK_QUALITY,r)}),b(this,"_handleP2PAddAudioOrVideoStream",(r,i,s,c)=>{let l=this._users.find(h=>h.uid===i);if(!l)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(i,", type ").concat(r)),this.store.subscribe(l.uid,r,void 0,void 0,void 0,Date.now());let u=r==="audio"?l.hasAudio:l.hasVideo;r==="audio"?l._trust_audio_stream_added_state_=!0:l._trust_video_stream_added_state_=!0,r==="audio"?(l._audio_added_=!0,s!==void 0&&(l._audioSSRC=s),c!==void 0&&(l._audioMid=c)):(l._video_added_=!0,s!==void 0&&(l._videoSSRC=s),c!==void 0&&(l._videoMid=c)),(r==="audio"?l.hasAudio:l.hasVideo)&&!u&&(v.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published ").concat(r)),this.safeEmit(tt.USER_PUBLISHED,l,r)),this._p2pChannel.hasPendingRemoteMedia(l,r)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(l.uid," after reconnect.")),this._subscribe(l,r,!0).catch(h=>{v.error("[".concat(this._clientId,"] resubscribe error"),h.toString())}))}),this._config=e,this._clientId=kt(5,"client-"),this.store=new cQ(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),v.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Eo," build: ").concat(AR,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{CL(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(r){v.warning("[".concat(this._clientId,"] ").concat(r.toString()))}this._statsCollector=new Vf(this.store),this._statsCollector.onStatsException=(r,i,s)=>{v.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(i,", uid: ").concat(s)),this.safeEmit(tt.EXCEPTION,{code:r,msg:i,uid:s})},this._statsCollector.onUploadPublishDuration=(r,i,s,c)=>{let l=this._users.find(u=>u.uid===r);l&&be.peerPublishStatus(this._sessionId,{subscribeElapse:c,audioPublishDuration:i,videoPublishDuration:s,peer:l._uintid})},this.store.useDataChannel=at().supportDataChannel&&x("SIGNAL_CHANNEL"),this.store.useP2P=e.mode==="p2p",this._gateway=new gZ(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Tr,httpRetryConfig:e.httpRetryConfig||Tr,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new AZ,this.store.useP2P?(this._p2pChannel=new Vi(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new Ug(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,i,s){let c=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],l=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Ot("JOIN_GATEWAY_USE_443PORT_ONLY",c),Ot("JOIN_GATEWAY_USE_DUAL_DOMAIN",l);let u=this._gateway.signal.websocket;return u instanceof nf&&(u.use443PortOnly=c,u.tryDoubleDomain=l),async function(h,f,m){vE.get(h)||vE.set(h,[]),TE.get(h)||TE.set(h,f),ma.get(h)||ma.set(h,0);let E=vE.get(h),S=TE.get(h);if(!E||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ma.get(h)===S){let O=Jp();E.push(O),await O.promise}ma.set(h,ma.get(h)+1);for(var y=arguments.length,A=new Array(y>3?y-3:0),T=3;T<y;T++)A[T-3]=arguments[T];let w=await m(...A);return ma.set(h,ma.get(h)-1),ma.get(h)===S-1&&E.length>0&&(E[0].resolve(),E.shift()),ma.get(h)===0&&(vE.set(h,[]),TE.set(h,0),ma.set(h,0)),w}("client.join",x("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,i,s)}async join(e,t,r,i,s){let c=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);let l=(DE||DE||(DE=(window.location.protocol.split(":")[0]||"").toUpperCase(),DE))==="HTTPS",u=kL()?window.isSecureContext:"Browser Not Support";(!kL()&&!l||!window.isSecureContext)&&v.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),v.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),be.setAppId(e);try{if(!r&&r!==null)throw new H(N.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&dn(r,"token",1,2047),dn(e,"appid",1,2047),ME(t),i&&xE(i),s&&dn(s,"optionalInfo",1,2047)}catch(T){throw be.reportApiInvoke(Zp(),{name:Pr.JOIN,options:[e,t,r,i],states:{isHttps:l,isSecureContext:u},tag:sr.TRACER}).onError(T),T}let h=await NF({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode}),f=(h==null?void 0:h.sid)||Zp(),m=be.reportApiInvoke(f,{name:Pr.JOIN,options:[e,t,r,i],states:{isHttps:l,isSecureContext:u},tag:sr.TRACER});if(v.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(c)),this._leaveMutex.isLocked&&(v.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),v.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let T=new H(N.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw m.onError(T),T}this._sessionId||(this._sessionId=f,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";let E=wo(wo({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:s,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!h},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(E.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(E.stringUid=i,this._uintUid?(E.uid=this._uintUid,this._uintUid=void 0):E.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(E.aesmode=this._encryptionMode,E.aespassword=await(async T=>{let w=function(W){let K=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),X=new Uint8Array(new ArrayBuffer(K.length));for(let ie=0;ie<K.length;ie+=1)X[ie]=K.charCodeAt(ie);return X}(),O=await window.crypto.subtle.importKey("spki",w,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),P=SR(T),F=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},O,P);return function(W){let K="";for(let X=0;X<W.length;X+=1)K+=String.fromCharCode(W[X]);return window.btoa(K)}(new Uint8Array(F))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new H(N.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(E.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let T=new TextEncoder,w=x("USE_PURE_ENCRYPTION_MASTER_KEY")?T.encode(E.appId+this._encryptionSecret+this._encryptionSecret):T.encode(E.appId+E.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(O,P,F){let W=await window.crypto.subtle.importKey("raw",P,"PBKDF2",!1,["deriveBits","deriveKey"]),K=O==="aes-128-gcm2"?128:256,X=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:ML,hash:"SHA-256",salt:F},W,K+lQ);return new Uint8Array(X).subarray(K/8)}(this._encryptionMode,w,nd(this._encryptionSalt)),this._encryptDataStreamKey=await async function(O,P,F){let W=await window.crypto.subtle.importKey("raw",P,"PBKDF2",!1,["deriveBits","deriveKey"]),K=O==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:ML,hash:"SHA-256",salt:F},W,{name:"AES-GCM",length:K},!0,["encrypt","decrypt"])}(this._encryptionMode,w,nd(this._encryptionSalt))}else u?v.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):v.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,v.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:E.stringUid,preload:E.preload});let S=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&S===this._sessionId&&be.joinChannelTimeout(this._sessionId,5)},5e3);try{var y;let T,w=E.cloudProxyServer;if(ge(y=["proxy3","proxy4","proxy5"]).call(y,w)){let K=x("PROXY_SERVER_TYPE3");Array.isArray(K)?E.proxyServer=K[0]:E.proxyServer=K}if(be.setProxyServer(E.proxyServer),v.setProxyServer(E.proxyServer),this.store.requestAPStart(),h){if(v.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(E.stringUid?", ".concat(E.stringUid," => ").concat(h.intUid):""," ")),E.stringUid&&!E.uid&&(E.uid=h.intUid),T={gatewayInfo:h.ap.gatewayInfo},x("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&E.turnServer.mode==="auto")if(h.ap.proxyInfo.addresses.length===0)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let K=(await aM(h.ap.proxyInfo,h.ap.gatewayInfo.uid)).map(X=>({turnServerURL:X.address,tcpport:X.tcpport||vn.tcpport,udpport:X.udpport||vn.udpport,username:X.username||vn.username,password:X.password||vn.password,forceturn:!1,security:!0}));E.turnServer={mode:"manual",servers:K}}kF(h,E.stringUid)}else{if(E.stringUid&&!E.uid){let K;[K,T]=await _e.all([yM(E.stringUid,E,this._axiosCancelSource.token,this._config.httpRetryConfig||Tr,this.store),SM(E,this._axiosCancelSource.token,this._config.httpRetryConfig||Tr,!0,this.store)]),v.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(E.stringUid," => ").concat(K)),E.uid=K,T.gatewayInfo.uid=K,T.gatewayInfo.res.uid=K}else T=await SM(E,this._axiosCancelSource.token,this._config.httpRetryConfig||Tr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new H(N.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(E,this._axiosCancelSource.token),this._configDistribute.on(VR.UPDATE_BITRATE_LIMIT,K=>{this._p2pChannel.updateBitrateLimit(K)})},0),this._key=r||e;let O=T.gatewayInfo,P=E.uid?E.uid:O.uid;this._joinInfo=wo(wo({},E),{},{cid:O.cid,uid:P,vid:O.vid,apResponse:O.res,uni_lbs_ip:O.uni_lbs_ip,gatewayAddrs:O.gatewayAddrs}),this.store.intUid=P;let F=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new H(N.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));m.onSuccess(F),this._appId=e,this._channelName=E.cname,this._uid=F,this.store.uid=F,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Jr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let W=E.stringUid?"string uid: ".concat(E.stringUid,",uid: ").concat(E.uid):"uid: ".concat(this._uid);return v.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(W)),setTimeout(()=>{v.startUpload()},5e3),this.store.joinEnd(),A=this,ge(Kc).call(Kc,A)||Kc.push(A),this._cloudProxyServerMode==="disabled"&&at().supportWebCrypto&&x("ENABLE_PRELOAD")&&O0(this._joinInfo),F}catch(T){let w=Array.isArray(T)?T[0]:T;throw w&&w.code===N.OPERATION_ABORTED?v.warning("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),w):v.error("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),w),w.code!==N.OPERATION_ABORTED&&this._numberOfJoinCount===c&&(this._gateway.state="DISCONNECTED",this._reset()),m.onError(w),w}var A}_joinGateway(){if(!this._joinInfo||!this._key)throw new H(N.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!x("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===N.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,et.FALLBACK),e;if(e.code===N.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,et.FALLBACK),e;throw e}).then(e=>{if(e instanceof H){if(e.code===N.INIT_WEBSOCKET_TIMEOUT){if(v.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new H(N.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";let t=x("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){let i=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),s=i.slice(i.length-2).join(".");t.forEach(c=>{this._joinInfo&&ge(c).call(c,s)&&(this._joinInfo.proxyServer=c)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;let r=x("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return r&&r[1]&&r[1]!=="443"&&v.setProxyServer(this._joinInfo.proxyServer),x("STATS_COLLECTOR_PORT").toString()!=="443"&&be.setProxyServer(this._joinInfo.proxyServer),be.reportApiInvoke(this._sessionId,{name:Pr.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:sr.TRACER}).onSuccess(),this.safeEmit(tt.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),x("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(i=>{"forceturn"in i&&(i.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(v.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new H(N.INVALID_OPERATION);return be.reportApiInvoke(this._sessionId,{name:Pr.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:sr.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){v.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Jr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){let r=Kc.indexOf(t);r!==-1&&Kc.splice(r,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return v.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),v.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof rh))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new H(N.INVALID_PARAMS,"param list is empty");let r=e;if(this._gateway.role==="audience")throw new H(N.INVALID_OPERATION,"audience can not publish stream");for(let s of r){if(!(s instanceof rh))throw new H(N.INVALID_PARAMS,"parameter is not local track");if(!s._enabled&&t)throw new H(N.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(s.getTrackId()))}v.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(s=>"".concat(s.getTrackId()," "))));let i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(s=>{let c=this._configDistribute.getBitrateLimit();s instanceof Lt&&c&&s.setBitrateLimit(c.uplink)});try{await this._publishHighStream(r),v.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(s=>"".concat(s.getTrackId()," "))))}catch(s){throw v.error("[".concat(this._clientId,"] publish error"),s.toString()),s}finally{i()}}async _publishDataChannel(e){At(e.id,"id",0,65535,!0),Ja(e.ordered,"ordered"),dn(e.metadata,"metadata",0,512),v.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new H(N.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new H(N.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&x("FORCE_TURN")&&!x("TURN_ENABLE_TCP")&&!x("TURN_ENABLE_UDP"))throw new H(N.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let r=new qU(e);if(await this._p2pChannel.publishDataChannel([r]),!this._p2pChannel.isP2PDisconnected()){if(typeof r._originDataChannelId!="number")throw v.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new H(N.CREATE_DATACHANNEL_ERROR);try{let i={streamId:e.id,ordered:e.ordered,maxRetransmits:x("DATASTREAM_MAX_RETRANSMITS"),metadata:e.metadata,channelId:r._originDataChannelId};await this._gateway.publishDataChannel(this._uid,i,!0),await r._waitTillOpen()}catch(i){if(i.code!==N.DISCONNECT_P2P)throw i}}return v.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw v.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new H(N.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof rh))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);v.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(i=>"".concat(i.getTrackId()," "))," "));let r=await this._publishMutex.lock();try{if(this._p2pChannel instanceof Vi){let i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(Er.UNPUBLISH,{unpubMsg:i},!0)}else{let i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),v.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(s=>"".concat(s.getTrackId()))))}}catch(i){throw v.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),v.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(r=>"".concat(r.id," "))," "));let t=await this._publishMutex.lock();try{let r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),v.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(i=>"".concat(i.id))))}catch(r){throw v.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof ol)){let i=this.remoteUsers.find(s=>s.uid===e);if(!i)throw new H(N.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(Gr(t,"mediaType",["audio","video"]),this._p2pChannel instanceof Vi)throw new H(N.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new H(N.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let r=t===Ie.AUDIO,i=t===Ie.VIDEO,s=await this._subscribeMutex.lock();try{let{ssrcId:c,ortc:l,rtxSsrcId:u,cname:h,uint_id:f}=await this._gateway.presubscribe(e,t,!0);if(c==null)throw new H(N.UNEXPECTED_RESPONSE,"no ssrc id");let m=this._users.find(S=>S.uid===e);m||(m=new ol(e,f||e),m._is_pre_created=!0,this._users.push(m)),h&&(m._cname=h),m._uintid||(m._uintid=f||e),r&&(m._audioSSRC=c,m._audio_pre_subscribed=!0,l&&(m._audioOrtc=l)),i&&(m._videoSSRC=c,m._video_pre_subscribed=!0,l&&(m._videoOrtc=l),u!=null&&(m._rtxSsrcId=u)),v.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(c)),await this._p2pChannel.subscribe(m,t,c,u,l);let E=r?m._audioTrack:m._videoTrack;if(!E)throw new H(N.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(m._trust_audio_stream_added_state_=!0,m._audio_added_=!0),i&&(m._trust_video_stream_added_state_=!0,m._video_added_=!0),E}catch(c){throw v.error("[".concat(this._clientId,"] presub user ").concat(e," error"),c),c}finally{s()}}async _subscribeDataChannel(e,t){var r;if(At(t,"channelId",0,65535,!0),!this._joinInfo)throw new H(N.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e))throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new H(N.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new H(N.INVALID_REMOTE_USER,"user is not published");let i=(r=e._dataChannels)===null||r===void 0?void 0:r.find(l=>l.id===t);if(!i)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new H(N.REMOTE_USER_IS_NOT_PUBLISHED);let s=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let l=await this._p2pChannel.subscribeDataChannel(e,[i]);if(l&&ge(l).call(l,i.id))try{var c;if(typeof i._originDataChannelId!="number")throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new H(N.CREATE_DATACHANNEL_ERROR);let u={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(c=i.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(e.uid,u,!0),await i._waitTillOpen()}catch(u){if((u==null?void 0:u.code)!==N.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),u;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(e,t,r){if(Gr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new H(N.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===e)){let s=new H(N.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){let s=new H(N.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let s=new H(N.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}let i=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let c=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof Vi&&await this._p2pChannel.subscribe(e,t,c,l)}catch(c){throw c}v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(c=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});let s=t==="audio"?e._audioTrack:e._videoTrack;if(!s)throw new H(N.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{i()}}async _subscribe(e,t,r){if(this._p2pChannel instanceof Vi)return this._p2pSubscribe(e,t);if(Gr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new H(N.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e)){let h=new H(N.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),h}if(!e.hasAudio&&!e.hasVideo){let h=new H(N.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),h}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let h=new H(N.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),h}let i=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,l={stream_type:t==="audio"?Ie.AUDIO:Ie.VIDEO,ssrcId:i},u=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let f=t==="audio"?e._audioSSRC:e._videoSSRC;f!==void 0&&f!==i&&(i=f,s=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,l={stream_type:t==="audio"?Ie.AUDIO:Ie.VIDEO,ssrcId:i}),On.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,c,s);try{await this._gateway.subscribe(e.uid,l,!0)}catch(m){if((m==null?void 0:m.code)!==N.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),m;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(f){throw this._p2pChannel.reportSubscribeEvent(!1,f==null?void 0:f.code,e,t),f}v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(f=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});let h=t==="audio"?e._audioTrack:e._videoTrack;if(!h)throw new H(N.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),h),h}finally{u()}}async massSubscribe(e){if(Xa(e,"subscribeList"),!this._joinInfo)throw new H(N.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),r=new Map,i=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(u=>{let{user:h,mediaType:f}=u;return"user: ".concat(h==null?void 0:h.uid,", mediaType: ").concat(f)}).join("; ")));let s=(e=[...e]).map(u=>{let{user:h,mediaType:f}=u;return{user:h,mediaType:f}}),c=await this._p2pChannel.globalLock();try{var l;for(let h=e.length-1;h>=0;h--){let f=e[h],{user:m,mediaType:E}=f;if(Gr(E,"mediaType",["audio","video"]),!m){let A=new H(N.INVALID_PARAMS,"user property does not exist in subscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),A}if(!this._users.find(A=>A===m)){let A=new H(N.INVALID_REMOTE_USER,"user is not in the channel");v.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),s[h].error=A,e.splice(h,1);continue}if(E==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||E==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){let A=new H(N.REMOTE_USER_IS_NOT_PUBLISHED);v.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(E,", remote user is not published")),s[h].error=A,e.splice(h,1);continue}let S=$r.Video|$r.LwoVideo,y=r.get(m);if(y){if(E==="video"?y&S:y&$r.Audio){e.splice(h,1),v.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(E," twice"));continue}r.set(m,y|(E==="video"?S:$r.Audio))}else r.set(m,E==="video"?S:$r.Audio)}for(let h=e.length-1;h>=0;h--){let f=e[h],{user:m,mediaType:E}=f,S=$r.Video|$r.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,E)){await this._p2pChannel.unmuteRemoteNoLock(m,E);let y=r.get(m);r.set(m,E==="video"?y^S:y^$r.Audio),e.splice(h,1)}}this.store.massSubscribe(e.map(h=>({userId:h.user.uid,type:h.mediaType})),t);let u=Ds(l=Array.from(r.entries())).call(l,(h,f)=>{let[m,E]=f;if(E===0)return h;let S={stream_id:m.uid,stream_type:E};return E&$r.Audio&&(S.audio_ssrc=m._audioSSRC),E&$r.Video&&(S.video_ssrc=m._videoSSRC),h.push(S),h},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:m,mediaType:E}=f;return{user:m,mediaType:E,ssrcId:E===Ie.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:E===Ie.VIDEO?m._rtxSsrcId:void 0}}));let h=new Map;if(u.length>0){let f=await this._gateway.subscribeAll(u,!0);((f==null?void 0:f.users)||[]).forEach(m=>{let{stream_id:E,video_error_code:S,audio_error_code:y,error_code:A}=m;(S||y||A)&&h.set(E,{video_error_code:S,audio_error_code:y,error_code:A})})}if(Array.from(h.entries()).length>0){let f=[];Array.from(h.entries()).forEach(m=>{let[E,S]=m,y=this.remoteUsers.find(A=>A.uid===E);if(y){let A;S.error_code||S.video_error_code&&S.audio_error_code?A=void 0:S.video_error_code?A=Ie.VIDEO:S.audio_error_code&&(A=Ie.AUDIO),f.push({user:y,mediaType:A})}}),f.length>0&&await this._p2pChannel.massUnsubscribeNoLock(f)}for(let f of s){let m=h.get(f.user.uid);if(m){let E=m.error_code||f.mediaType==="audio"&&m.audio_error_code||f.mediaType==="video"&&m.video_error_code;if(E){let S=ad(E);v.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(S.desc)),f.error=new H(N.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(S.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(s.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),s.forEach(f=>{var m;be.subscribe(this.store.sessionId,{succ:!!f.error,ec:((m=f.error)===null||m===void 0?void 0:m.code)||null,video:f.mediaType===Ie.VIDEO,audio:f.mediaType===Ie.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===Ie.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),v.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:m,mediaType:E}=f;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(E)}).join("; "))),s}catch(h){throw await this._p2pChannel.massUnsubscribeNoLock(e),h}}finally{c(),i()}}async unsubscribe(e,t,r){if(!(e instanceof ol)){let s=this.remoteUsers.find(c=>c.uid===e);if(!s)throw new H(N.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&Gr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new H(N.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===e)){let s=new H(N.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let i=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof Vi)await this._p2pChannel.unsubscribe(e,t);else{let s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&IE(this._users,e),v.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===N.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&At(t,"id",0,65535,!0),!this._joinInfo)throw new H(N.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){let i=new H(N.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){let i=e._dataChannels.find(s=>s.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){let i=new H(N.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{let i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),v.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===N.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(Xa(e,"unsubscribeList"),!this._joinInfo)throw new H(N.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");v.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(r=>{let{user:i,mediaType:s}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(s,";")}).join())),e=[...e];let t=new Map;for(let r=e.length-1;r>=0;r--){let{user:i,mediaType:s}=e[r];if(!i){let l=new H(N.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(Gr(s,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===i)){v.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(r,1);continue}let c=$r.Video|$r.LwoVideo;if(t.has(i)){let l=t.get(i),u;switch(s){case"video":u=l&c;break;case"audio":u=l&$r.Audio;break;default:u=l&($r.Audio|c)}if(u){v.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(s," twice.")),e.splice(r,1);continue}s?s==="audio"?t.set(i,l|$r.Audio):s==="video"&&t.set(i,l|c):t.set(i,l|$r.Audio|c)}else s?s==="audio"?t.set(i,$r.Audio):s==="video"&&t.set(i,c):t.set(i,$r.Audio|c)}try{let r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),v.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:s,mediaType:c}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(c,";")}).join()))}catch(r){if(r.code===N.DISCONNECT_P2P)return void v.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw v.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new ee(N.INVALID_PARAMS);or(r.width)||ER(r.width,"streamParameter.width"),or(r.height)||ER(r.height,"streamParameter.height"),or(r.framerate)||ER(r.framerate,"streamParameter.framerate"),or(r.bitrate)||At(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&v.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),v.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ce.LocalVideoLowTrack)}async enableDualStream(){if(!at().supportDualStream)throw be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new H(N.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new H(N.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),v.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new H(N.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ce.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),v.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){Gr(r,"role",["audience","host"])}(e),t&&CL(t),this.mode==="rtc"||this.mode==="p2p")throw v.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new H(N.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new H(N.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new H(N.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,v.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(dn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new H(N.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new H(N.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,be.setProxyServer(this._proxyServer),v.setProxyServer(this._proxyServer),v.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new H(N.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new H(N.INVALID_OPERATION,"You have already set the proxy")}if(Au(e))return this._turnServer={servers:e,mode:"original-manual"},void v.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(r=>r.urls).join(","),"."));e.forEach(r=>TL(r)),this._turnServer={servers:e,mode:"manual"},v.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new H(N.INVALID_OPERATION,"you should set license before join channel");if(dn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new H(N.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,v.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new H(N.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new H(N.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new H(N.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new H(N.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new H(N.INVALID_OPERATION,"Stop proxy server after leave channel");be.setProxyServer(),v.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new H(N.INVALID_PARAMS,"accessPoints is required.");Xa(e.accessPoints.serverList,"accessPoints.serverList"),dn(e.accessPoints.domain,"accessPoints.domain");let t=(S,y)=>{At(S,y,0,65535,!0)},r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new H(N.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");x("CLOSE_AFB_FOR_LOCAL_AP")&&(Ot("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Ot("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,s=e.accessPoints.domain,c=e.accessPoints.serverList.map(S=>i.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(s):S),l=c.map(S=>"".concat(S,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Ot("WEBCS_DOMAIN",l),Ot("WEBCS_DOMAIN_BACKUP_LIST",l),Ot("GATEWAY_DOMAINS",[s]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Xa(e.report.hostname,"report.hostname"),Ot("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Ot("EVENT_REPORT_DOMAIN",c[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",c[1]||c[0]));let u=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),u=e.report.port),Ot("STATS_COLLECTOR_PORT",u),e.report?Ot("ENABLE_EVENT_REPORT",!0):Ot("ENABLE_EVENT_REPORT",!1);let h="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Xa(e.log.hostname,"log.hostname"),h=e.log.hostname[0]):h=c[0];let f=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),f=e.log.port),Ot("LOG_UPLOAD_SERVER","".concat(h,":").concat(f));let m=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Xa(e.cds.hostname,"cds.hostname"),m=e.cds.hostname):m=c;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),Ot("CDS_AP",m.map(S=>"".concat(S,":").concat(E))),e.cds?Ot("ENABLE_CONFIG_DISTRIBUTE",!0):Ot("ENABLE_CONFIG_DISTRIBUTE",!1),v.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Xa(e,"serverList"),dn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new H(N.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>r.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Ot("WEBCS_DOMAIN",e),Ot("WEBCS_DOMAIN_BACKUP_LIST",e),Ot("GATEWAY_DOMAINS",[t]),Ot("EVENT_REPORT_DOMAIN",e[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Ot("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),v.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Gr(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw v.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else v.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Gr(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let r=this._users.find(i=>i.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw v.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}v.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Gr(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw v.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}v.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,i){(function(c){Gr(c,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),dn(t,"secret");let s=["aes-128-gcm2","aes-256-gcm2"];if(ge(s).call(s,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new H(N.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new H(N.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(Ja(i,"encryptDataStream"),!ge(s).call(s,e))throw new H(N.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||v.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=Gc(r))}async renewToken(e){if(dn(e,"token",1,2047),!this._key||!this._joinInfo)throw new H(N.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let r=await this._renewTokenMutex.lock();try{if(x("USE_NEW_TOKEN")){v.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let i=await bZ(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Tr);v.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else v.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});v.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,v.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?v.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(tt.VOLUME_INDICATOR,e)},x("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new H(N.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new H(N.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new H(N.LIVE_STREAMING_TASK_CONFLICT);let r=t?on.TRANSCODE:on.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(on.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(e));if(!t.length)throw new H(N.INVALID_PARAMS,"can not find live streaming url to stop");await _e.all(t.map(r=>r&&r.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new H(N.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");let r=this._createLiveStreamingClient(on.INJECT);r.setInjectStreamConfig(t,0),await r.startLiveStreamingTask(e,on.INJECT)}async removeInjectStreamUrl(){var e;let t=this._createLiveStreamingClient(on.INJECT),r=Array.from(Ms(e=t.streamingTasks).call(e)).find(i=>i.mode===on.INJECT);if(!this._joinInfo||!r)throw new H(N.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(r.url)}async startChannelMediaRelay(e){VV(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){VV(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new H(N.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let s=new TextEncoder;e.payload=s.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ge(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(s,c,l){var u;let h=Ds(u=Array.from(l)).call(u,(T,w)=>T+w,0),f={serverTs:0,seq:dQ++,length:l.length,checkSum:h},m=new Uint8Array(DL(h,2)),E=new ArrayBuffer(Pu),S=new DataView(E);S.setUint32(0,f.serverTs),S.setUint16(4,f.seq),S.setUint16(6,f.length),S.setUint16(8,f.checkSum);let y=16-l.length%16;l=IL(l,new Uint8Array(y));let A=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s,tagLength:LL,additionalData:m},c,l);return IL(new Uint8Array(E),new Uint8Array(A))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new H(N.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ne.DATA_STREAM,{payload:Gc(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-$re},!r)}sendMetadata(e){if(!this._joinInfo)throw new H(N.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new H(N.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ne.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Gc(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(hQ),!this._joinInfo)throw new H(N.INVALID_OPERATION,"can not send custom report, not joined");await be.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Gr(t.spatialLayer,"spatialLayer",[0,1,2,3]),Gr(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw v.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:r}=e;if(Ja(t,"apRTM"),At(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,v.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(v.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=si.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&PF(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new rn("client-publish"),this._subscribeMutex=new rn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;let i=e||Zp();e?v.debug("[".concat(this._clientId,"] new Session ").concat(i)):v.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));let s=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i;let c={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:s,clientRole:this.role==="audience"?2:1};t?be.sessionInit(this._sessionId,wo({cname:t.channel,appid:t.appId,preload:t.preload},c)):this._joinInfo?be.sessionInit(this._sessionId,wo({cname:this._joinInfo.cname,appid:this._joinInfo.appId,preload:!!this._joinInfo.recoverPreloadCache},c)):this._gateway.joinInfo&&be.sessionInit(this._sessionId,wo({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},c)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new H(N.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&x("FORCE_TURN")&&!x("TURN_ENABLE_TCP")&&!x("TURN_ENABLE_UDP"))throw new H(N.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");v.debug("[".concat(this._clientId,"] publish high stream"));try{let r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof Vi){let i=(await r.next()).value;if(i){try{await this._gateway.sendExtensionMessage(Er.PUBLISH,i,!0)}catch(s){throw r.throw(s),s}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let i=(await r.next()).value;if(i){var t;let s;try{s=await this._gateway.publish(this._uid,i,!0)}catch(c){if(c.code!==N.DISCONNECT_P2P)throw r.throw(c),c}await r.next(((t=s)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let s of e)s instanceof Lt&&s._encoderConfig&&this._gateway.setVideoProfile(s._encoderConfig),!s.muted&&s.enabled||await this._p2pChannel.muteLocalTrack(s)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,e),(r==null?void 0:r.code)===N.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new H(N.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new H(N.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));v.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await r.next()).value;if(i){var t;let s;try{s=await this._gateway.publish(this._uid,i,!0)}catch(c){if(c.code!==N.DISCONNECT_P2P)throw r.throw(c),c}r.next(((t=s)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,void 0,!0),(r==null?void 0:r.code)===N.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new H(N.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let t=()=>new wre(this._joinInfo,this._config.websocketRetryConfig||Tr,this._config.httpRetryConfig||Tr),r=i=>{i.onLiveStreamError=(s,c)=>{be.reportApiInvoke(this._sessionId,{name:Pr.ON_LIVE_STREAM_ERROR,options:[s,c],tag:sr.TRACER}).onSuccess(),this.safeEmit(tt.LIVE_STREAMING_ERROR,s,c)},i.onLiveStreamWarning=(s,c)=>{be.reportApiInvoke(this._sessionId,{name:Pr.ON_LIVE_STREAM_WARNING,options:[s,c],tag:sr.TRACER}).onSuccess(),this.safeEmit(tt.LIVE_STREAMING_WARNING,s,c)},i.on(UE.REQUEST_WORKER_MANAGER_LIST,(s,c,l)=>{if(!this._joinInfo)return l(new H(N.INVALID_OPERATION,"can not find join info to get worker manager"));CM(s,this._joinInfo,this._axiosCancelSource.token,Tr).then(c).catch(l)})};switch(e){case on.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),r(this._liveRawStreamingClient)),this._liveRawStreamingClient;case on.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),r(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case on.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(UE.REQUEST_WORKER_MANAGER_LIST,(i,s,c)=>{if(!this._joinInfo)return c(new H(N.INVALID_OPERATION,"can not find join info to get worker manager"));CM(i,this._joinInfo,this._axiosCancelSource.token,Tr).then(s).catch(c)}),this._injectStreamingClient.onInjectStatusChange=(i,s,c)=>{this.safeEmit(tt.INJECT_STREAM_STATUS,i,s,c)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new H(N.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),r={width:e,height:t};this._channelMediaRelayClient=new bre(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Tr,this._config.httpRetryConfig||Tr,r),this._channelMediaRelayClient.on("state",i=>{i===yi.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(tt.CHANNEL_MEDIA_RELAY_STATE,i)}),this._channelMediaRelayClient.on("event",i=>{this.safeEmit(tt.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._statsCollector.onStatsChanged=(i,s)=>{var c;i==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(s))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:r,deleted:i}=e,s=[];Array.isArray(r)&&r.length>0&&r.forEach(c=>{let{uid:l,stream_id:u,ordered:h,max_retrans_times:f,metadata:m}=c,E=this._users.find(S=>S._uintid===l);if(!E)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(v.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(l)),ge(s).call(s,E)||s.push(E),E._uintid||(E._uintid=l),E._dataChannels.findIndex(S=>S.id===c.stream_id)===-1){let S={id:u,ordered:!!h,maxRetransmits:f,metadata:m},y=new rre(S);E._dataChannels.push(y),v.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published datachannel")),t||this.safeEmit(tt.USER_PUBLISHED,E,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(E,c.stream_id)&&(v.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(E.uid," after reconnect.")),this._subscribeDataChannel(E,c.stream_id).catch(S=>{v.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),t&&(this.safeEmit(tt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(c=>{let{uid:l,stream_id:u}=c,h=this._users.find(m=>m._uintid===l);if(!h)return void v.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let f=h._dataChannels.find(m=>m.id===c.stream_id);f&&(v.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(l)),this._p2pChannel.unsubscribeDataChannel(h,[f]).then(m=>{if(h._dataChannels=h._dataChannels.filter(E=>E!==f),m)return this._gateway.unsubscribeDataChannel(m,h.uid)}),v.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished datachannel ,id:").concat(f.id)),this.safeEmit(tt.USER_UNPUBLISHED,h,"datachannel",f._config))})}_handleRemoveDataChannels(e){let t=this._users.find(r=>r.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){v.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let r=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(tt.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),r()}}else v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(_r.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(_r.CONNECTION_STATE_CHANGE,(e,t,r)=>{var i;if(r===et.FALLBACK)return;let s=()=>{this.safeEmit(tt.CONNECTION_STATE_CHANGE,e,t,r)};if(be.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Pr.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:sr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),v.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void s();if(e==="RECONNECTING")this._users.forEach(l=>{l._trust_in_room_=!1,l._trust_audio_enabled_state_=!1,l._trust_video_enabled_state_=!1,l._trust_audio_mute_state_=!1,l._trust_video_mute_state_=!1,l._trust_audio_stream_added_state_=!1,l._trust_video_stream_added_state_=!1,l._is_pre_created||(l._audio_pre_subscribed||(l._audioSSRC=void 0,l._audioOrtc=void 0),l._video_pre_subscribed||(l._videoSSRC=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),l._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var c;this._streamFallbackTypeCacheMap.forEach((l,u)=>{this._gateway.setStreamFallbackOption(u,l).catch(h=>{v.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),h)})}),this._remoteStreamTypeCacheMap.forEach((l,u)=>{this._gateway.setRemoteVideoStreamType(u,l).catch(h=>{v.warning("[".concat(this._clientId,"] auto set remote stream type failed"),h)})}),this._remoteDefaultVideoStreamType!==void 0&&((c=this._joinInfo)===null||c===void 0?void 0:c.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{v.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(l=>{v.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(l))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(l=>!l._trust_in_room_).forEach(l=>{v.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(l.uid)),this._handleUserOffline({uid:l.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(l=>{l._trust_audio_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,Ie.AUDIO,!1)),l._trust_video_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,Ie.VIDEO,!1)),l._trust_audio_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(l.uid)),this._handleSetStreamLocalEnable("audio",l.uid,!0)),l._trust_video_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(l.uid)),this._handleSetStreamLocalEnable("video",l.uid,!0)),l._trust_video_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(l.uid)),this._handleResetAddStream(l,"video")),l._trust_audio_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(l.uid)),this._handleResetAddStream(l,"audio")),l._video_added_||l._audio_added_||(v.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(l.uid)),this._handleRemoveStream({uid:l.uid,uint_id:l._uintid}))}))},1e3))}s()}),this._gateway.on(_r.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new H(N.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r;this._joinInfo.recoverPreloadCache?(r=this._joinInfo.recoverPreloadCache.ap,kF(this._joinInfo.recoverPreloadCache),this._joinInfo.recoverPreloadCache=void 0):r=await $R(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Tr,this.store),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);let i=[];r.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:c}=s,[l,u]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:l,port:u}):i.push({host:l,port:u})}),e(i)}catch(r){t(r)}}),this._gateway.on(_r.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(tt.NETWORK_QUALITY,e)}),this._gateway.on(_r.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(tt.STREAM_TYPE_CHANGED,e,t),be.reportApiInvoke(this._sessionId,{name:Pr.STREAM_TYPE_CHANGE,options:[e,t],tag:sr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(_r.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(_r.NEED_RENEW_SESSION,async e=>{if(e==="recover"&&this._joinInfo){let t=await NF(wo(wo({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));this._joinInfo.recoverPreloadCache=t,this._startSession(t==null?void 0:t.sid)}else this._startSession()}),this._gateway.on(_r.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(i){r(i)}}),this._gateway.on(_r.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let{dtlsParameters:r,iceParameters:i,candidates:s,rtpCapabilities:c,setup:l,cname:u}=hV(e.ortc,t);this._p2pChannel.connect(i,r,s,c,l,u)}),this._gateway.on(_r.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(_r.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(_r.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(_r.DATACHANNEL_PRECONNECT,async(e,t,r,i)=>{var s,c,l,u,h,f;await this._p2pChannel.startP2PConnection({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},!0);let m=function(E,S){let y;return S&&S.ip&&typeof S.port=="number"?(y=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:S.ip,port:S.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(S.ip,":").concat(S.port)),S.ip6&&(y.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:S.ip6,port:S.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(S.ip6,":").concat(S.port)))):y=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:E.ip,port:E.port.toString(),type:"host",extension:{}}],y}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((c=this._joinInfo)===null||c===void 0?void 0:c.apResponse.cid,"_").concat((l=this._joinInfo)===null||l===void 0?void 0:l.apResponse.cert),icePwd:"".concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cid,"_").concat((h=this._joinInfo)===null||h===void 0?void 0:h.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(f=x("FINGERPRINT"))!==null&&f!==void 0?f:e.fingerprint}]},m,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(r).catch(i)})}_handleGatewaySignalEvents(){this._gateway.signal.on(Be.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Be.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Be.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Be.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Be.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Be.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams,deleted:[]},!0)}),this._gateway.signal.on(Be.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Be.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Be.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Ie.AUDIO,!0)),this._gateway.signal.on(Be.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Ie.AUDIO,!1)),this._gateway.signal.on(Be.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Ie.VIDEO,!0)),this._gateway.signal.on(Be.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Ie.VIDEO,!1)),this._gateway.signal.on(Be.RECEIVE_METADATA,e=>{let t=nd(e.metadata);this.safeEmit(tt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Be.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=nd(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ge(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Pu)throw new H(N.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Pu));r=await async function(s,c,l){let u=l.subarray(0,Pu),h=u.slice(8,Pu),f=(h[0]<<8)+h[1],m=(u[6]<<8)+u[7],E=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:LL,additionalData:new Uint8Array(DL(f,2))},c,l.subarray(Pu));return new Uint8Array(E).subarray(0,m)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let i=0;if(e.ordered||e.syncWithAudio){let s=this._p2pChannel.getStats(),c=this.remoteUsers.find(u=>u.uid===e.uid),l=s==null?void 0:s.audioRecv.find(u=>u.ssrc===(c==null?void 0:c._audioSSRC));i=l==null?void 0:l.jitterBufferMs}i==null&&(i=0),Zre(wo(wo({},e),{},{payload:r}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Be.ON_CRYPT_ERROR,()=>{Wc(()=>{v.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(tt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Be.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Be.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{v.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,et.TOKEN_EXPIRE),this.safeEmit(tt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Be.ON_STREAM_FALLBACK_UPDATE,e=>{v.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(tt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Be.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),v.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Be.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Be.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Te.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ne.PUBLISH:{if(!t)return;let s=t.ortc;if(s){var r,i;let c=s.some(h=>{let{stream_type:f}=h;return f===vt.Audio}),l=s.some(h=>{let{stream_type:f}=h;return f!==vt.Audio}),u=s.some(h=>{let{stream_type:f}=h;return f===vt.Screen||f===vt.ScreenLow});t.state==="offer"&&be.publish(this._joinInfo.sid,{eventElapse:On.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:N.TIMEOUT,audio:c,video:l,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:u,audioName:c?(r=s.find(h=>{let{stream_type:f}=h;return f===vt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:l?(i=s.find(h=>{let{stream_type:f}=h;return f!==vt.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case Ne.SUBSCRIBE:t&&be.subscribe(this._joinInfo.sid,{succ:!1,ec:N.TIMEOUT,audio:t.stream_type===Ie.AUDIO,video:t.stream_type===Ie.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:On.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(Be.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Be.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;x("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!od(i.string_id||i.stream_id,this.channelName)));let t=[],r=[];for(let i of e.users){let s=this._users.find(m=>m._uintid===i.stream_id);s?s._trust_in_room_=!0:(s=new ol(i.string_id||i.stream_id,i.stream_id),this._users.push(s),this.getListeners(tt.PUBLISHED_USER_LIST).length===0&&(v.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(tt.USER_JOINED,s)));let c=$r.Audio&i.stream_type,l=($r.Video|$r.LwoVideo)&i.stream_type,u=(65280&i.stream_type)!=0,h=c&&s.hasAudio,f=l&&s.hasVideo;l&&(s._trust_video_stream_added_state_=!0,s._video_added_=!0,s._videoSSRC=i.video_ssrc,s._rtxSsrcId=i.video_rtx),c&&(s._trust_audio_stream_added_state_=!0,s._audio_added_=!0,s._audioSSRC=i.audio_ssrc),c&&!h&&this.getListeners(tt.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published audio")),this.safeEmit(tt.USER_PUBLISHED,s,"audio")),l&&!f&&this.getListeners(tt.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published video")),this.safeEmit(tt.USER_PUBLISHED,s,"video")),(c&&!h||l&&!f||u)&&t.push(s),l&&this._p2pChannel.hasPendingRemoteMedia(s,"video")&&r.push({user:s,mediaType:"video"}),c&&this._p2pChannel.hasPendingRemoteMedia(s,"audio")&&r.push({user:s,mediaType:"audio"})}r.length>0&&(v.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(i=>{v.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(tt.PUBLISHED_USER_LIST).length>0?x("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(v.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(tt.PUBLISHED_USER_LIST,t)):v.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(Be.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof Ug&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(r=>r.toLowerCase()).filter(r=>{var i;return ge(i=Object.keys(Du)).call(i,r)}))})}_handleP2PEvents(){this._gateway.signal.on(Be.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Er.PUBLISH,(e,t,r)=>{let{uid:i}=e;e.forEach(s=>{let{kind:c,ssrcs:l,mid:u,isMuted:h}=s;this._handleP2PAddAudioOrVideoStream(c,i,l[0].ssrcId,u);let f=this._users.find(m=>m.uid===i);return f&&this._p2pChannel instanceof Vi?this._p2pChannel.mockSubscribe(f,c,l[0].ssrcId,u).then(()=>{t()}).catch(r):t(),this._handleMuteStream(i,c,!!h)})}),this._gateway.signal.on(Er.CALL,async(e,t,r)=>{if(this._p2pChannel instanceof Vi)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(s){r(s)}}),this._gateway.signal.on(Te.P2P_CONNECTION,async e=>{this._p2pChannel instanceof Vi&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(Er.UNPUBLISH,async(e,t,r)=>{if(this._p2pChannel instanceof Vi){let{unpubMsg:i,uid:s}=e,c=this._users.find(l=>l.uid===s);if(!c)return v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s)),void t();try{i.forEach(async l=>{let{stream_type:u}=l,h=u===vt.Audio?Ie.AUDIO:Ie.VIDEO;await this._p2pChannel.unsubscribe(c,h),this._handleMuteStream(s,h,!0)}),t()}catch(l){r(l)}}}),this._gateway.signal.on(Er.CONTROL,async(e,t)=>{let{action:r}=e;switch(r){case qc.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Ie.VIDEO,!0);break;case qc.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Ie.AUDIO,!0);break;case qc.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Ie.VIDEO,!1);break;case qc.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Ie.AUDIO,!1)}}),this._gateway.signal.on(Er.RESTART_ICE,async(e,t,r)=>{if(this._p2pChannel instanceof Vi)try{let{direction:i,iceParameter:s}=e;i!==Zn.SEND_ONLY||s?t(await this._p2pChannel.restartICE(i,s)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){r(i)}}),this._gateway.signal.on(Er.CANDIDATE,e=>{if(this._p2pChannel instanceof Vi){let{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(Le.RequestP2PRestartICE,async(e,t,r)=>{try{let{direction:i}=e;t(await this._gateway.sendExtensionMessage(Er.RESTART_ICE,e,i===Zn.SEND_ONLY))}catch(i){r(i)}}),this._p2pChannel.on(Le.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Er.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Le.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(Er.CONTROL,e,!0),t()}catch(i){r(i)}}),this._p2pChannel.on(Le.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===N.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(Le.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===N.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(Le.StateChange,(e,t)=>{t===Ct.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Le.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===N.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(Le.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===N.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(Le.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(Le.RequestRePublishDataChannel,(e,t,r)=>{_e.all(e.map(async i=>{await this._p2pChannel.publishDataChannel([i]);let s={streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,s,!0)}catch(c){if(c.code!==N.DISCONNECT_P2P)throw c}})).then(t).catch(r)}),this._p2pChannel.on(Le.RequestReSubscribe,async(e,t,r)=>{try{for(let{user:i,kind:s}of e)s===Ie.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){r(i)}}),this._p2pChannel.on(Le.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Le.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Le.MediaReconnectStart,e=>{this.safeEmit(tt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Le.MediaReconnectEnd,e=>{this.safeEmit(tt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Le.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Le.RequestRestartICE,async e=>{if(this._p2pChannel instanceof Vi)return;let t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;let i=r.value,s;try{s=await this._gateway.restartICE({iceParameters:i})}catch(l){return void t.throw(l)}let{iceParameters:c}=function(l){let u=l.iceParameters;return{iceParameters:{iceUfrag:u.iceUfrag,icePwd:u.icePwd}}}(s);await t.next({remoteIceParameters:c})}),this._p2pChannel.on(Le.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Le.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:r,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:s,gatewayAddress:c}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:i}),{dtlsParameters:l,iceParameters:u,candidates:h,rtpCapabilities:f,setup:m,cname:E}=hV(s,c);await this._p2pChannel.connect(u,l,h,f,m,E),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Le.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(Le.P2PLost,()=>{this.safeEmit(tt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Le.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Le.ConnectionTypeChange,e=>{this.safeEmit(tt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Le.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Le.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new H(N.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new H(N.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new H(N.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new H(N.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{let t=[...new Set(e.inspectType)];t.forEach(r=>{var i;if(!ge(i=["supervise","moderation"]).call(i,r))throw new H(N.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(r," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new H(N.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{let t=new Vg(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Tr)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new H(N.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Ja(e,"enabled"),e){if(!t)throw new H(N.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(At(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new H(N.INVALID_PARAMS,"[".concat(this._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(t&&t.vendor&&t.vendor.length>1024)throw new H(N.INVALID_PARAMS,"[".concat(this._clientId,"] config.vendor length cannot exceed 1024 bytes"));if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new H(N.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);let r=new C0(t);this._moderation=r,this.handleImageModerationEvents(this._moderation),await r.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Tr)}catch(r){throw Array.isArray(r)?r[0]:r}}else{if(!this._moderation)throw new H(N.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}setP2PTransport(e){if(function(t){Gr(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new H(N.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,v.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}handleImageModerationEvents(e){e.on(xs.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(tt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===So.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new H(N.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(xs.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}handleVideoInspectEvents(e){e.on(sn.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(tt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===$o.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(tt.CONTENT_INSPECT_ERROR,new H(N.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(sn.INSPECT_RESULT,(t,r)=>{var i;if((r==null?void 0:r.code)===N.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return v.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(tt.CONTENT_INSPECT_RESULT,t,r)}),e.on(sn.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return v.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Ja(e,"enabled"),Ot("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},fe(Se.prototype,"leave",[xF],Object.getOwnPropertyDescriptor(Se.prototype,"leave"),Se.prototype),fe(Se.prototype,"publish",[UF],Object.getOwnPropertyDescriptor(Se.prototype,"publish"),Se.prototype),fe(Se.prototype,"unpublish",[VF],Object.getOwnPropertyDescriptor(Se.prototype,"unpublish"),Se.prototype),fe(Se.prototype,"subscribe",[FF],Object.getOwnPropertyDescriptor(Se.prototype,"subscribe"),Se.prototype),fe(Se.prototype,"presubscribe",[jF],Object.getOwnPropertyDescriptor(Se.prototype,"presubscribe"),Se.prototype),fe(Se.prototype,"massSubscribe",[BF],Object.getOwnPropertyDescriptor(Se.prototype,"massSubscribe"),Se.prototype),fe(Se.prototype,"unsubscribe",[WF],Object.getOwnPropertyDescriptor(Se.prototype,"unsubscribe"),Se.prototype),fe(Se.prototype,"massUnsubscribe",[GF],Object.getOwnPropertyDescriptor(Se.prototype,"massUnsubscribe"),Se.prototype),fe(Se.prototype,"setLowStreamParameter",[HF],Object.getOwnPropertyDescriptor(Se.prototype,"setLowStreamParameter"),Se.prototype),fe(Se.prototype,"enableDualStream",[KF],Object.getOwnPropertyDescriptor(Se.prototype,"enableDualStream"),Se.prototype),fe(Se.prototype,"disableDualStream",[zF],Object.getOwnPropertyDescriptor(Se.prototype,"disableDualStream"),Se.prototype),fe(Se.prototype,"setClientRole",[qF],Object.getOwnPropertyDescriptor(Se.prototype,"setClientRole"),Se.prototype),fe(Se.prototype,"setProxyServer",[YF],Object.getOwnPropertyDescriptor(Se.prototype,"setProxyServer"),Se.prototype),fe(Se.prototype,"setTurnServer",[JF],Object.getOwnPropertyDescriptor(Se.prototype,"setTurnServer"),Se.prototype),fe(Se.prototype,"setLicense",[XF],Object.getOwnPropertyDescriptor(Se.prototype,"setLicense"),Se.prototype),fe(Se.prototype,"startProxyServer",[$F],Object.getOwnPropertyDescriptor(Se.prototype,"startProxyServer"),Se.prototype),fe(Se.prototype,"stopProxyServer",[QF],Object.getOwnPropertyDescriptor(Se.prototype,"stopProxyServer"),Se.prototype),fe(Se.prototype,"setLocalAccessPointsV2",[ZF],Object.getOwnPropertyDescriptor(Se.prototype,"setLocalAccessPointsV2"),Se.prototype),fe(Se.prototype,"setLocalAccessPoints",[ej],Object.getOwnPropertyDescriptor(Se.prototype,"setLocalAccessPoints"),Se.prototype),fe(Se.prototype,"setRemoteDefaultVideoStreamType",[tj],Object.getOwnPropertyDescriptor(Se.prototype,"setRemoteDefaultVideoStreamType"),Se.prototype),fe(Se.prototype,"setRemoteVideoStreamType",[rj],Object.getOwnPropertyDescriptor(Se.prototype,"setRemoteVideoStreamType"),Se.prototype),fe(Se.prototype,"setStreamFallbackOption",[nj],Object.getOwnPropertyDescriptor(Se.prototype,"setStreamFallbackOption"),Se.prototype),fe(Se.prototype,"setEncryptionConfig",[ij],Object.getOwnPropertyDescriptor(Se.prototype,"setEncryptionConfig"),Se.prototype),fe(Se.prototype,"renewToken",[oj],Object.getOwnPropertyDescriptor(Se.prototype,"renewToken"),Se.prototype),fe(Se.prototype,"enableAudioVolumeIndicator",[sj],Object.getOwnPropertyDescriptor(Se.prototype,"enableAudioVolumeIndicator"),Se.prototype),fe(Se.prototype,"startLiveStreaming",[aj],Object.getOwnPropertyDescriptor(Se.prototype,"startLiveStreaming"),Se.prototype),fe(Se.prototype,"setLiveTranscoding",[cj],Object.getOwnPropertyDescriptor(Se.prototype,"setLiveTranscoding"),Se.prototype),fe(Se.prototype,"stopLiveStreaming",[lj],Object.getOwnPropertyDescriptor(Se.prototype,"stopLiveStreaming"),Se.prototype),fe(Se.prototype,"addInjectStreamUrl",[dj],Object.getOwnPropertyDescriptor(Se.prototype,"addInjectStreamUrl"),Se.prototype),fe(Se.prototype,"removeInjectStreamUrl",[uj],Object.getOwnPropertyDescriptor(Se.prototype,"removeInjectStreamUrl"),Se.prototype),fe(Se.prototype,"startChannelMediaRelay",[hj],Object.getOwnPropertyDescriptor(Se.prototype,"startChannelMediaRelay"),Se.prototype),fe(Se.prototype,"updateChannelMediaRelay",[pj],Object.getOwnPropertyDescriptor(Se.prototype,"updateChannelMediaRelay"),Se.prototype),fe(Se.prototype,"stopChannelMediaRelay",[fj],Object.getOwnPropertyDescriptor(Se.prototype,"stopChannelMediaRelay"),Se.prototype),fe(Se.prototype,"sendCustomReportMessage",[mj],Object.getOwnPropertyDescriptor(Se.prototype,"sendCustomReportMessage"),Se.prototype),fe(Se.prototype,"pickSVCLayer",[_j],Object.getOwnPropertyDescriptor(Se.prototype,"pickSVCLayer"),Se.prototype),fe(Se.prototype,"setRTMConfig",[Ej],Object.getOwnPropertyDescriptor(Se.prototype,"setRTMConfig"),Se.prototype),fe(Se.prototype,"enableContentInspect",[gj],Object.getOwnPropertyDescriptor(Se.prototype,"enableContentInspect"),Se.prototype),fe(Se.prototype,"disableContentInspect",[Sj],Object.getOwnPropertyDescriptor(Se.prototype,"disableContentInspect"),Se.prototype),fe(Se.prototype,"setImageModeration",[yj],Object.getOwnPropertyDescriptor(Se.prototype,"setImageModeration"),Se.prototype),fe(Se.prototype,"setP2PTransport",[vj],Object.getOwnPropertyDescriptor(Se.prototype,"setP2PTransport"),Se.prototype),fe(Se.prototype,"getJoinChannelServiceRecords",[Tj],Object.getOwnPropertyDescriptor(Se.prototype,"getJoinChannelServiceRecords"),Se.prototype),fe(Se.prototype,"setPublishAudioFilterEnabled",[Cj],Object.getOwnPropertyDescriptor(Se.prototype,"setPublishAudioFilterEnabled"),Se.prototype),Se);class Gf{constructor(t,r){b(this,"id",0),b(this,"element",void 0),b(this,"peerPair",void 0),b(this,"context",void 0),b(this,"audioPlayerElement",void 0),b(this,"audioTrack",void 0),Gf.count+=1,this.id=Gf.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;let t=async(i,s)=>{let c=s==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(c),i.iceGatheringState==="complete"?i.localDescription:new _e(l=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&l(i.localDescription)}})},r=async(i,s)=>await i.setRemoteDescription(s);try{let i=await t(this.peerPair[0],"offer");await r(this.peerPair[1],i);let s=await t(this.peerPair[1],"answer");await r(this.peerPair[0],s)}catch(i){throw new H(N.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(s){throw new H(N.LOCAL_AEC_ERROR,s.toString()).print()}if(!r)throw new H(N.LOCAL_AEC_ERROR,"no dest node when local aec").print();let i=r.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){v.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var wj,Hg;b(Gf,"count",0);let one=window.AudioContext||window.webkitAudioContext,sne=new(wj=ke({report:be}),fe((Hg=class{constructor(){b(this,"units",[]),b(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return v.debug("the system does not need to process local aec"),-1;this.context||(this.context=new one);let t=this.units.find(r=>r&&r.getElement()===e);return t||(t=new Gf(e,this.context),this.units.push(t)),t.startEchoCancellation(),v.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return dt().name!==yt.SAFARI}}).prototype,"processExternalMediaAEC",[wj],Object.getOwnPropertyDescriptor(Hg.prototype,"processExternalMediaAEC"),Hg.prototype),Hg);function Ij(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function bj(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ij(Object(r),!0).forEach(function(i){b(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ij(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let N0=window||document;function Aj(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!N0)return;let r=Mr._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);let i=s=>{if(!(s&&s.blockedURI&&(Mr.onSecurityPolicyViolation||Mr.getListeners(ga.SECURITY_POLICY_VIOLATION).length>0)))return;let c=s.blockedURI;x("CSP_DETECTED_HOSTNAME_LIST").some(l=>ge(c).call(c,l))&&(Mr.onSecurityPolicyViolation&&typeof Mr.onSecurityPolicyViolation=="function"&&Mr.onSecurityPolicyViolation(s),Mr.getListeners(ga.SECURITY_POLICY_VIOLATION).length>0&&Mr.safeEmit(ga.SECURITY_POLICY_VIOLATION,s))};r&&N0.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||Mr.getListeners(ga.SECURITY_POLICY_VIOLATION).length>0)&&N0.addEventListener("securitypolicyviolation",i),Mr._cspEventHandlerPointer=i}Ot("PROCESS_ID","process-".concat(kt(8,""),"-").concat(kt(4,""),"-").concat(kt(4,""),"-").concat(kt(4,""),"-").concat(kt(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void v.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();v.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(Ur,i)){let{value:s,expires:c}=t[i];if(c&&c<=r)return;Hc[i]=s,Ur[i]=s}})}catch(t){v.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Hc.AREAS)&&Hc.AREAS.length>0&&KR(Hc.AREAS,!0);let Oj=(e,t,r)=>{v.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Ot(e,t,r)},Mr=function(e){let t=new Jt,r=e,i={getListeners:t.getListeners.bind(t),on:(s,c)=>(function(l,u){l===ga.SECURITY_POLICY_VIOLATION&&Aj(u,!0)}(s,c),t.on.bind(t)(s,c)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return bj(bj({},r),i)}({__TRACK_LIST__:Qu,VERSION:Eo,BUILD:AR,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Oj,getParameter:x,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,r=await async function(i){let s;return at().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),s=(await i.createOffer()).sdp):s=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,s}(t);if(!r)return e;t.close(),t=null,e=function(i){let s={video:[],audio:[]};return i.match(/ VP8/i)&&s.video.push("VP8"),i.match(/ VP9/i)&&s.video.push("VP9"),i.match(/ AV1/i)&&s.video.push("AV1"),i.match(/ H264/i)&&s.video.push("H264"),i.match(/ H265/i)&&s.video.push("H265"),i.match(/ opus/i)&&s.audio.push("OPUS"),i.match(/ PCMU/i)&&s.audio.push("PCMU"),i.match(/ PCMA/i)&&s.audio.push("PCMA"),i.match(/ G722/i)&&s.audio.push("G722"),s}(r)}catch(t){throw new H(N.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=be.reportApiInvoke(null,{name:Pr.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:sr.TRACER}),t=!1;try{let c=window.RTCPeerConnection,l=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,u=window.WebSocket;t=!!(c&&l&&u),t&&_R()&&function(h){let f=dt();return!(f.name!==yt.CHROME||!f.osVersion)&&Number(f.version)<h}(75)&&new c().close()}catch(c){return v.error("check system requirement failed: ",c),!1}let r=!1,i=dt();i.name===yt.CHROME&&Number(i.version)>=58&&(ks.engine.name!=="WebKit"||function(){let c=dt();if(RE()){if(c.os===Yr.MAC_OS)return!0;if(c.os===Yr.IOS){let l=ks.os.version&&ks.os.version.split(".");if(l&&Number(l[0])===14&&l[1]&&Number(l[1])>=3||l&&Number(l[0])>14)return!0}}return!1}())&&(r=!0),(i.name===yt.FIREFOX&&Number(i.version)>=56||i.name===yt.OPERA&&Number(i.version)>=45||i.name===yt.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(bn()||Jo())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||hL()||dt().name===yt.QQ)&&(r=!0),v.debug("checkSystemRequirements, api:",t,"browser",r);let s=t&&r;return e.onSuccess(s),s},getDevices:function(e){return to.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return to.getRecordingDevices(e)},getCameras:function(e){return to.getCamerasDevices(e)},getElectronScreenSources:rx,getPlaybackDevices:function(e){return to.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},r=be.reportApiInvoke(null,{name:Pr.CREATE_CLIENT,options:[t],tag:sr.TRACER});try{(function(i){Gr(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Gr(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&Gr(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&dn(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&TL(i.turnServer),i.httpRetryConfig!==void 0&&vL(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&vL(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return(sL(16,0)||aL(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",v.debug("browser not support vp9, force use vp8")),Ot("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new ine(wo(wo({forceWaitGatewayResponse:!0},t),{},{role:ge(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=x("CAMERA_CAPTURE_CONFIG"),r=be.reportApiInvoke(null,{tag:sr.TRACER,name:Pr.CREATE_CAM_VIDEO_TRACK,options:[Xt({},e),t]});t&&(e.encoderConfig=t);let i=_g(e),s=kt(8,"track-cam-"),c=null,l=e.encoderConfig==="720p_auto";v.info("start create camera video track with config",JSON.stringify(e),"trackId",s);try{c=(await eo({video:i},s)).getVideoTracks()[0]||null}catch(h){throw r.onError(h),h}if(!c){let h=new ee(N.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(h),h.throw(v)}e.optimizationMode&&Zw(s,c,e,Ra(e.encoderConfig));let u=new Qw(c,e,i,e.scalabiltyMode?hg(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);return l&&u.startMonitorStats(),r.onSuccess(u.getTrackId()),v.info("create camera video success, trackId:",s),u},createCustomVideoTrack:function(e){let t=be.reportApiInvoke(null,{tag:sr.TRACER,name:Pr.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),r=new Lt(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?hg(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,kt(8,"track-cus-"),[Ft.CUSTOM_TRACK]);return t.onSuccess(r.getTrackId()),v.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",r=be.reportApiInvoke(null,{tag:sr.TRACER,name:Pr.CREATE_SCREEN_VIDEO_TRACK,options:[Xt({},e),t]}),i=e.encoderConfig==="720p_auto";e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let s=function(E){let S={};E.screenSourceType&&(S.mediaSource=E.screenSourceType),E.extensionId&&jc()&&(S.extensionId=E.extensionId);let{displaySurface:y,selfBrowserSurface:A,surfaceSwitching:T,systemAudio:w}=E;(fR(107)||iL(107)||cL(93))&&(y&&(Gr(y,"displaySurface",["browser","window","monitor"]),S.displaySurface=y),A?(Gr(A,"selfBrowserSurface",["exclude","include"]),S.selfBrowserSurface=A):S.selfBrowserSurface="include",T&&(Gr(T,"surfaceSwitching",["exclude","include"]),S.surfaceSwitching=T)),(fR(105)||iL(105)||cL(91))&&w&&(Gr(w,"systemAudio",["exclude","include"]),S.systemAudio=w),E.electronScreenSourceId&&(S.sourceId=E.electronScreenSourceId);let O=E.encoderConfig?Bw(E.encoderConfig):null;return S.mandatory={chromeMediaSource:"desktop",maxWidth:O?O.width:void 0,maxHeight:O?O.height:void 0},O&&(O.frameRate&&(typeof O.frameRate=="number"?(S.mandatory.maxFrameRate=O.frameRate,S.mandatory.minFrameRate=O.frameRate):(S.mandatory.maxFrameRate=O.frameRate.max||O.frameRate.ideal||O.frameRate.exact||void 0,S.mandatory.minFrameRate=O.frameRate.min||O.frameRate.ideal||O.frameRate.exact||void 0),S.frameRate=O.frameRate),O.width&&(S.width=O.width),O.height&&(S.height=O.height)),S}(e),c=kt(8,"track-scr-v-"),l=null,u=null,h=at();if(!h.supportShareAudio&&t==="enable"){let E=new ee(N.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(E),E.throw(v)}v.info("start create screen video track with config",e,"withAudio",t,"trackId",c);try{let E=await eo({screen:s,screenAudio:t==="auto"?h.supportShareAudio:t==="enable"},c);l=E.getVideoTracks()[0]||null,u=E.getAudioTracks()[0]||null}catch(E){throw r.onError(E),E}if(!l){let E=new ee(N.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(E),E.throw(v)}if(!u&&t==="enable"){l&&l.stop();let E=new ee(N.SHARE_AUDIO_NOT_ALLOWED);return r.onError(E),E.throw(v)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Zw(c,l,e,e.encoderConfig&&Bw(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let f=new Lt(l,e.encoderConfig?Bw(e.encoderConfig):{},e.scalabiltyMode?hg(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,c,[Ft.SCREEN_TRACK]);if(i&&f.startMonitorStats(),!u)return r.onSuccess(f.getTrackId()),v.info("create screen video track success","video:",f.getTrackId()),f;let m=new lr(u,void 0,kt(8,"track-scr-a-"),!1);return r.onSuccess([f.getTrackId(),m.getTrackId()]),v.info("create screen video track success","video:",f.getTrackId(),"audio:",m.getTrackId()),[f,m]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=x("CAMERA_CAPTURE_CONFIG"),i=be.reportApiInvoke(null,{tag:sr.TRACER,name:Pr.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);let s=t.encoderConfig==="720p_auto",c=_g(t),l=hx(e),u=kt(8,"track-mic-"),h=kt(8,"track-cam-"),f=null,m=null;v.info("start create camera video track(".concat(h,") and microphone audio track(").concat(u,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let y=await eo({audio:l,video:c},"".concat(u,"-").concat(h));f=y.getAudioTracks()[0],m=y.getVideoTracks()[0]}catch(y){throw i.onError(y),y}if(!f||!m){let y=new ee(N.UNEXPECTED_ERROR,"can not find tracks in media stream");return i.onError(y),y.throw(v)}t.optimizationMode&&Zw(h,m,t,Ra(t.encoderConfig));let E=new Eg(f,e,l,u),S=new Qw(m,t,c,t.scalabiltyMode?hg(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,h);return s&&S.startMonitorStats(),i.onSuccess([E.getTrackId(),S.getTrackId()]),v.info("create camera video track(".concat(h,") and microphone audio track(").concat(u,") success")),[E,S]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=be.reportApiInvoke(null,{tag:sr.TRACER,name:Pr.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=hx(e),i=kt(8,"track-mic-"),s=null;v.info("start create microphone audio track with config",JSON.stringify(e),"trackId",i);try{s=(await eo({audio:r},i)).getAudioTracks()[0]||null}catch(l){throw t.onError(l),l}if(!s){let l=new ee(N.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(l),l.throw(v)}let c=new Eg(s,e,r,i);return t.onSuccess(c.getTrackId()),v.info("create microphone audio track success, trackId:",i),c},createCustomAudioTrack:function(e){let t=be.reportApiInvoke(null,{tag:sr.TRACER,name:Pr.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new lr(e.mediaStreamTrack,e.encoderConfig?pg(e.encoderConfig):{},kt(8,"track-cus-"),!1);return v.info("create custom audio track success with config",e,"trackId",r.getTrackId()),t.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:r,encoderConfig:i}=e,{source:s}=e,c={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":s,cacheOnlineFile:r,encoderConfig:i},l=be.reportApiInvoke(null,{tag:sr.TRACER,name:Pr.CREATE_BUFFER_AUDIO_TRACK,options:[c]});if(x("DISABLE_WEBAUDIO"))throw new ee(N.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");let u=kt(8,"track-buf-");v.info("start create buffer source audio track with config",JSON.stringify(c),"trackId",u);let h=s;if(!(s instanceof AudioBuffer))try{s=await async function(E,S){let y=null;if(typeof E=="string"){let T=Qx.get(E);if(T)return v.debug("use cached audio resource: ",E),T;try{y=(await Ls(()=>si.get(E,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(w){throw new ee(N.FETCH_AUDIO_FILE_FAILED,w.toString())}}else y=await new _e((T,w)=>{let O=new FileReader;O.onload=P=>{P.target?T(P.target.result):w(new ee(N.READ_LOCAL_AUDIO_FILE_ERROR))},O.onerror=()=>{w(new ee(N.READ_LOCAL_AUDIO_FILE_ERROR))},O.readAsArrayBuffer(E)});let A=await function(T){let w=nh();return new _e((O,P)=>{w.decodeAudioData(T,F=>{O(F)},F=>{P(new ee(N.DECODE_AUDIO_FILE_FAILED,F.toString()))})})}(y);return typeof E=="string"&&S&&Qx.set(E,A),A}(s,r)}catch(E){return l.onError(E),E.throw(v)}let f=new ere(s),m=new Zte(h,f,i?pg(i):{},u);return v.info("create buffer source audio track success, trackId:",u),l.onSuccess(m.getTrackId()),m},setAppType:function(e){if(v.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw v.debug("Invalid appType"),new H(N.INVALID_PARAMS,"invalid app type",e);Ot("APP_TYPE",Math.floor(e))},setLogLevel:function(e){v.setLogLevel(e)},enableLogUpload:function(){x("USE_NEW_LOG")?Ot("UPLOAD_LOG",!0):v.enableLogUpload()},disableLogUpload:function(){x("USE_NEW_LOG")?Ot("UPLOAD_LOG",!1):v.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new UV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=be.reportApiInvoke(null,{tag:sr.TRACER,name:Pr.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof lr||e instanceof sh)){let h=new H(N.INVALID_TRACK,"the parameter is not a audio track");return r.onError(h),h.throw()}t&&t<1e3&&(t=1e3);let i=e instanceof lr?e.getTrackLabel():"remote_track",s=e.getVolumeLevel(),c=s,l=s,u=Date.now();return new _e(h=>{let f=setInterval(()=>{let m=e.getVolumeLevel();c=m>c?m:c,l=m<l?m:l;let E=c-l>1e-4,S=Date.now()-u;if(E||S>t){clearInterval(f);let y=E,A={duration:S,deviceLabel:i,maxVolumeLevel:c,result:y};v.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(A))),r.onSuccess(A),h(y)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=be.reportApiInvoke(null,{tag:sr.TRACER,name:Pr.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Lt||e instanceof oh)){let E=new H(N.INVALID_TRACK,"the parameter is not a video track");return r.onError(E),E.throw()}t&&t<1e3&&(t=1e3);let i=e instanceof Lt?e.getTrackLabel():"remote_track",s=e.getMediaStreamTrack(!0),c=document.createElement("video");c.style.width="1px",c.style.height="1px",c.setAttribute("muted",""),c.muted=!0,c.setAttribute("playsinline",""),c.controls=!1,(Jr()||RE())&&(c.style.opacity="0.01",c.style.position="fixed",c.style.left="0",c.style.top="0",document.body.appendChild(c)),c.srcObject=new MediaStream([s]),c.play();let l=document.createElement("canvas");l.width=160,l.height=120;let u=0,h=0;try{let E=Date.now();u=await function(S,y,A,T){let w,O=0,P=null;return new _e((F,W)=>{function K(){O>T&&w&&(w(),F(O));let X=A.getContext("2d");if(!X){let le=new H(N.UNEXPECTED_ERROR,"can not get canvas 2d context.");return v.error(le.toString()),void W(le)}X.drawImage(S,0,0,160,120);let ie=X.getImageData(0,0,A.width,A.height),ae=Math.floor(ie.data.length/3);if(P){for(let le=0;le<ae;le+=3)if(ie.data[le]!==P[le])return O+=1,void(P=ie.data);P=ie.data}else P=ie.data}setTimeout(()=>{w&&(w(),F(O))},y),w=zw(()=>{K()},30)})}(c,t,l,4),h=Date.now()-E}catch(E){throw r.onError(E),E}ene===yt.SAFARI&&(c.pause(),c.remove()),c.srcObject=null;let f=u>4,m={duration:h,changedPicNum:u,deviceLabel:i,result:f};return v.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(m))),r.onSuccess(m),f},setArea:KR,audioElementPlayCenter:ci,resumeAudioContext:function(){ci.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){sne.processExternalMediaAEC(e)},registerExtensions:function(e){let t=x("PLUGIN_INFO")||[];e.forEach(r=>{"name"in r&&!ge(t).call(t,r.name)&&t.push(r.name);let i=r;i.__registered__=!0,i.logger.hookLog=v.extLog,i.reporter.hookApiInvoke=be.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(s=>{i.parameters[s]=x(s)})}),Oj("PLUGIN_INFO",t)},ChannelMediaRelayError:Lu,ChannelMediaRelayEvent:$a,ChannelMediaRelayState:yi,RemoteStreamFallbackType:zte,RemoteStreamType:Kte,ConnectionDisconnectedReason:et,AudienceLatencyLevelType:iQ,AREAS:mt,preload:async function(e,t,r,i){return OF(e,t,r,i)}});return Object.defineProperties(Mr,{onAudioAutoplayFailed:{get:()=>ro.onAudioAutoplayFailed,set:e=>{ro.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ro.onAutoplayFailed,set:e=>{ro.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Mr._onSecurityPolicyViolation,set(e){Mr._onSecurityPolicyViolation=e,Aj(e)}},__CLIENT_LIST__:{get:()=>x("SHOW_GLOBAL_CLIENT_LIST")?Kc:[]}}),to.on(gd.CAMERA_DEVICE_CHANGED,e=>{v.info("camera device changed",JSON.stringify(e)),Mr.onCameraChanged&&Mr.onCameraChanged(e),Mr.safeEmit(ga.CAMERA_CHANGED,e)}),to.on(gd.RECORDING_DEVICE_CHANGED,e=>{v.info("microphone device changed",JSON.stringify(e)),Mr.onMicrophoneChanged&&Mr.onMicrophoneChanged(e),Mr.safeEmit(ga.MICROPHONE_CHANGED,e)}),to.on(gd.PLAYOUT_DEVICE_CHANGED,e=>{v.debug("playout device changed",JSON.stringify(e)),Mr.onPlaybackDeviceChanged&&Mr.onPlaybackDeviceChanged(e),Mr.safeEmit(ga.PLAYBACK_DEVICE_CHANGED,e)}),ci.onAutoplayFailed=()=>{v.info("detect audio element autoplay failed"),ro.onAudioAutoplayFailed&&ro.onAudioAutoplayFailed()},bt.on("autoplay-failed",()=>{v.info("detect webaudio autoplay failed"),ro.onAudioAutoplayFailed&&ro.onAudioAutoplayFailed(),Mr.safeEmit(ga.AUTOPLAY_FAILED)}),bt.on(un.STATE_CHANGE,(e,t)=>{v.info("audio context state changed: ".concat(t," => ").concat(e)),Mr.onAudioContextStateChanged&&Mr.onAudioContextStateChanged(e,t),Mr.safeEmit(ga.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),ar.on(ed.NETWORK_STATE_CHANGE,(e,t)=>{v.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Mr),Mr})}),NG={};lme(NG,{AgoraRTCProvider:()=>kG,AgoraRTCReactError:()=>Gi,AgoraRTCScreenShareProvider:()=>yme,LocalAudioTrack:()=>jG,LocalUser:()=>KG,LocalVideoTrack:()=>GG,RemoteAudioTrack:()=>zG,RemoteUser:()=>YG,RemoteVideoTrack:()=>qG,TrackBoundary:()=>Lme,VERSION:()=>Fme,default:()=>JG,useAutoPlayAudioTrack:()=>EO,useAutoPlayVideoTrack:()=>_O,useClientEvent:()=>Eme,useConnectionState:()=>Tme,useCurrentUID:()=>Cme,useIsConnected:()=>Ba,useJoin:()=>MG,useLocalCameraTrack:()=>VG,useLocalMicrophoneTrack:()=>UG,useLocalScreenTrack:()=>Pme,useNetworkQuality:()=>Rme,usePublish:()=>xG,useRTCClient:()=>oa,useRTCScreenShareClient:()=>vme,useRemoteAudioTracks:()=>Ome,useRemoteUserTrack:()=>Lb,useRemoteUsers:()=>FG,useRemoteVideoTracks:()=>Nme,useTrackEvent:()=>gme,useVolumeLevel:()=>Ime});var ume=$d(Qd());function Di(n,o,a){return n.on(o,a),()=>n.off(o,a)}function hme(n){try{return n()}catch(o){console.error(o)}}function Zd(n){return()=>n.forEach(hme)}function pme(n,o){let a=setInterval(n,o);return()=>clearInterval(a)}function Uv(n,o){let a=setTimeout(n,o);return()=>clearTimeout(a)}function fO(){let n,o,a;function d(){if(o){let D=o;o=void 0,D()}}async function p(){if(a){let D=a;a=void 0;try{await D()}catch(L){console.error(L)}}}async function _(D){n=!0,await p();try{a=await D()}catch(L){console.error(L)}n=!1,d()}async function g(){n=!0,await p(),n=!1,d()}function C(D){n?o=()=>_(D):_(D)}function R(){n?o=g:g()}return{run:C,dispose:R}}var Vv=typeof document<"u"?J.useLayoutEffect:J.useEffect;function fme(n){return n!=null&&typeof n.then=="function"}function Wl(){let n=J.useRef(!1);return J.useEffect(()=>(n.current=!1,()=>{n.current=!0}),[]),n}function mme(){let n=Wl();function o(a,d){return new Promise(async(p,_)=>{try{let g=await a;n.current||p(g)}catch(g){n.current?d&&d(g):_(g)}})}return J.useCallback(o,[n])}function DG(n){let o=mme(),[a,d]=J.useState();return Vv(()=>{fme(n)?o(n).then(d):d(n)},[n,o]),a}function eu(n,o){let a=J.useRef();J.useEffect(()=>{let{run:d,dispose:p}=a.current||(a.current=fO());return d(n),p},o)}function _me(n,o){let a=n.split("."),d=o.split("."),p=Math.max(a.length,d.length);for(let _=0;_<p;_++){let g=parseInt(a[_]||"0"),C=parseInt(d[_]||"0");if(g>C)return 1;if(g<C)return-1}return 0}function Eme(n,o,a){let d=J.useRef(a);Vv(()=>{d.current=a},[a]),J.useEffect(()=>{if(n)return Di(n,o,(...p)=>{d.current&&d.current(...p)})},[o,n])}function gme(n,o,a){let d=J.useRef(a);Vv(()=>{d.current=a},[a]),J.useEffect(()=>{if(n)return Di(n,o,(...p)=>{d.current&&d.current(...p)})},[o,n])}var PG=J.createContext(null);function kG({client:n,children:o}){return Z.jsx(PG.Provider,{value:n,children:o})}function Sme(n){let o=J.useContext(PG);return n||o}function oa(n){let o=Sme(n);if(!o)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return o}var LG=J.createContext(null);function yme({client:n,children:o}){return Z.jsx(LG.Provider,{value:n,children:o})}function vme(n){let o=J.useContext(LG);return n||o}function Tme(n){let o=oa(n),[a,d]=J.useState(o?o.connectionState:"DISCONNECTED");return J.useEffect(()=>{if(o){d(o.connectionState);let p;return Zd([Di(o,"connection-state-change",_=>{p==null||p(),_==="CONNECTED"?p=Uv(()=>d(_),0):d(_)}),()=>p==null?void 0:p()])}else d("DISCONNECTED")},[o]),a}function Ba(n){let o=oa(n),[a,d]=J.useState(o?o.connectionState==="CONNECTED":!1);return J.useEffect(()=>{if(o){d(o.connectionState==="CONNECTED");let p;return Zd([Di(o,"connection-state-change",_=>{p==null||p(),p=Uv(()=>d(_==="CONNECTED"),0)}),()=>p==null?void 0:p()])}else d(!1)},[o]),a}function Cme(n){let o=oa(n),[a,d]=J.useState(o==null?void 0:o.uid);return J.useEffect(()=>{if(o)return Di(o,"connection-state-change",p=>{if(p==="CONNECTED")return Uv(()=>d(o.uid),0);p==="DISCONNECTED"&&d(void 0)})},[o]),a}var Gi=class extends Error{constructor(o,a){var n=(...D_e)=>(super(...D_e),Hf(this,"rtcMethod"),Hf(this,"rtcError"),Hf(this,"name","AgoraRTCReactException"),this);n(typeof a=="string"?a:a.message),this.rtcMethod=o,this.rtcError=a}log(o){console[o](this)}};function MG(n,o=!0,a){let d=oa(a),p=Ba(a),_=J.useRef(),[g,C]=J.useState(!1),[R,D]=J.useState(0),[L,k]=J.useState(null),M=Wl();return eu(async()=>{if(M.current||(k(null),D(0),C(!1)),o&&d){try{M.current||C(!0);let{appid:z,channel:V,token:Q,uid:G}=typeof n=="function"?await n():n,B=await d.join(z,V,Q,G);M.current||D(B)}catch(z){console.error(z),M.current||k(new Gi("IAgoraRTCClient.join",z))}M.current||C(!1);let Y=_.current||(_.current=fO());return Zd([()=>{Y.dispose()},()=>{Y.run(()=>d.unpublish(d.localTracks))},()=>{for(let z of d.localTracks)z.isPlaying&&z.stop(),z.close();Y.run(()=>d.leave())}])}},[o,a]),{data:R,isLoading:g,isConnected:p,error:L}}var l5=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function Rme(n){let o=oa(n),[a,d]=J.useState(l5);return J.useEffect(()=>{if(o)return Di(o,"network-quality",p=>d({uplinkNetworkQuality:p.uplinkNetworkQuality,downlinkNetworkQuality:p.downlinkNetworkQuality,delay:o.getRTCStats().RTT??0}));d(l5())},[o]),a}var wme=$d(Qd());function xG(n,o=!0,a){let d=oa(a),p=Ba(a),_=J.useRef([]),[g,C]=J.useState(!1),[R,D]=J.useState(null),L=Wl();return eu(async()=>{if(L.current||(C(!1),D(null)),!d||!p||!o)return;let k=n.filter(Boolean),M=V=>{let Q=_me(wme.default.VERSION,"4.18.2")>=0;return Q||new Gi("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),Q?d.mode!=="live"||d.role!=="audience":!0},Y=V=>_.current.some(Q=>Q&&Q.getTrackId()===V.getTrackId()),z=V=>M()&&V.enabled&&o&&!Y(V);for(let V=0;V<k.length;V++){let Q=k[V];if(Q&&z(Q)){await d.unpublish(_.current.filter(G=>(G==null?void 0:G.trackMediaType)===Q.trackMediaType));try{L.current||C(!0),await d.publish(Q)}catch(G){console.error(G),L.current||D(new Gi("IAgoraRTCClient.publish",G))}L.current||C(!1)}}_.current=k},[p,o,d,n]),{isLoading:g,error:R}}function Ime(n){let[o,a]=J.useState(0);return J.useEffect(()=>{if(n)return pme(()=>{a(n.getVolumeLevel())},1e3)},[n]),o}var bme=$d(Qd());function UG(n=!0,o={ANS:!0,AEC:!0},a){let d=Ba(a),[p,_]=J.useState(null),[g,C]=J.useState(!1),[R,D]=J.useState(null),L=Wl();return eu(async()=>{if(L.current||(C(!1),D(null)),d&&n&&!p){try{L.current||C(!0);let k=await bme.default.createMicrophoneAudioTrack(o);L.current||_(k)}catch(k){console.error(k),L.current||D(new Gi("IAgoraRTC.createMicrophoneAudioTrack",k))}L.current||C(!1)}!d&&!L.current&&_(null)},[d,n]),{localMicrophoneTrack:p,isLoading:g,error:R}}var Ame=$d(Qd());function VG(n=!0,o,a){let d=Ba(a),[p,_]=J.useState(null),[g,C]=J.useState(!1),[R,D]=J.useState(null),L=Wl();return eu(async()=>{if(L.current||(C(!1),D(null)),d&&n&&!p){try{L.current||C(!0);let k=await Ame.default.createCameraVideoTrack(o);L.current||_(k)}catch(k){console.error(k),L.current||D(new Gi("IAgoraRTC.createCameraVideoTrack",k))}L.current||C(!1)}!d&&!L.current&&_(null)},[d,n]),{localCameraTrack:p,isLoading:g,error:R}}function Ome(n,o){let a=oa(o),[d,p]=J.useState([]),_=Ba(),g=J.useRef([]),[C,R]=J.useState(!1),[D,L]=J.useState(null),k=Wl();return eu(async()=>{if(k.current||L(null),!Array.isArray(n)||!_)return;let M=async V=>{if(!V.audioTrack&&n.some(({uid:Q})=>V.uid===Q)){try{k.current||R(!0),await a.subscribe(V,"audio")}catch(Q){console.error(Q),k.current||L(new Gi("IAgoraRTCClient.subscribe",Q))}V.audioTrack&&!g.current.some(Q=>Q.getUserId()===V.uid)&&g.current.push(V.audioTrack),g.current=g.current.map(Q=>V.audioTrack&&Q.getUserId()===V.uid&&Q.getTrackId()!==V.audioTrack.getTrackId()?V.audioTrack:Q),k.current||(p([...g.current]),R(!1))}},Y=async V=>{if(n.some(({uid:Q})=>V.uid===Q)){k.current||(g.current=g.current.filter(Q=>Q.getUserId()!==V.uid),p([...g.current]));try{k.current||R(!0),await a.unsubscribe(V,"audio")}catch(Q){console.error(Q),k.current||L(new Gi("IAgoraRTCClient.unsubscribe",Q))}k.current||R(!1)}};n.map(V=>{!V.audioTrack&&V.hasAudio&&M(V)});let z=[];for(let V=0;V<g.current.length;V++){let Q=g.current[V];if(!n.some(G=>G.uid===Q.getUserId())){let G=a.remoteUsers.find(B=>B.uid===Q.getUserId());G&&z.push({user:G,mediaType:"audio"}),g.current.splice(V,1),V--}}if(z.length>0){try{k.current||R(!0),await a.massUnsubscribe(z)}catch(V){console.error(V),k.current||L(new Gi("IAgoraRTCClient.massUnsubscribe",V))}k.current||(p(g.current.slice()),R(!1))}return Zd([Di(a,"user-published",(V,Q)=>{n.find(G=>G.uid===V.uid)&&Q==="audio"&&M(V)}),Di(a,"user-unpublished",(V,Q)=>{n.find(G=>G.uid===V.uid)&&Q==="audio"&&Y(V)})])},[_,a,n]),{audioTracks:d,isLoading:C,error:D}}function Nme(n,o){let a=oa(o),[d,p]=J.useState([]),_=Ba(),g=J.useRef([]),[C,R]=J.useState(!1),[D,L]=J.useState(null),k=Wl();return eu(async()=>{if(k.current||L(null),!Array.isArray(n)||!_)return;let M=async V=>{if(!V.videoTrack&&n.some(({uid:Q})=>V.uid===Q)){try{k.current||R(!0),await a.subscribe(V,"video")}catch(Q){console.error(Q),k.current||L(new Gi("IAgoraRTCClient.subscribe",Q))}V.videoTrack&&!g.current.some(Q=>Q.getUserId()===V.uid)&&g.current.push(V.videoTrack),g.current=g.current.map(Q=>V.videoTrack&&Q.getUserId()===V.uid&&Q.getTrackId()!==V.videoTrack.getTrackId()?V.videoTrack:Q),k.current||(p([...g.current]),R(!1))}},Y=async V=>{if(n.some(({uid:Q})=>V.uid===Q)){k.current||(g.current=g.current.filter(Q=>Q.getUserId()!==V.uid),p([...g.current]));try{k.current||R(!0),await a.unsubscribe(V,"video")}catch(Q){console.error(Q),k.current||L(new Gi("IAgoraRTCClient.unsubscribe",Q))}k.current||R(!1)}};n.map(V=>{!V.videoTrack&&V.hasVideo&&M(V)});let z=[];for(let V=0;V<g.current.length;V++){let Q=g.current[V];if(!n.some(G=>G.uid===Q.getUserId())){let G=a.remoteUsers.find(B=>B.uid===Q.getUserId());G&&z.push({user:G,mediaType:"video"}),g.current.splice(V,1),V--}}if(z.length>0){try{k.current||R(!0),await a.massUnsubscribe(z)}catch(V){console.error(V),k.current||L(new Gi("IAgoraRTCClient.massUnsubscribe",V))}k.current||(p(g.current.slice()),R(!1))}return Zd([Di(a,"user-published",(V,Q)=>{n.find(G=>G.uid===V.uid)&&Q==="video"&&M(V)}),Di(a,"user-unpublished",(V,Q)=>{n.find(G=>G.uid===V.uid)&&Q==="video"&&Y(V)})])},[_,a,n]),{videoTracks:d,isLoading:C,error:D}}function Lb(n,o,a){let d=oa(a),p=o==="audio"?"audioTrack":"videoTrack",[_,g]=J.useState(n&&n[p]),C=Ba(),R=J.useRef(),[D,L]=J.useState(!1),[k,M]=J.useState(null);return J.useEffect(()=>{if(!n||!C)return;let Y=!1;Y||M(null);let z=o==="audio"?"hasAudio":"hasVideo",V=n.uid,Q=async(q,se)=>{if(q[p]&&d.remoteUsers.some(({uid:ue})=>q.uid===ue))try{Y||L(!0),await d.unsubscribe(q,se)}catch(ue){Y||M(new Gi("IAgoraRTCClient.unsubscribe",ue)),console.error(ue)}Y||(g(void 0),L(!1))},G=async(q,se)=>{try{!q[p]&&d.remoteUsers.some(({uid:ue})=>q.uid===ue)&&(Y||L(!0),await d.subscribe(q,se)),Y||g(q[p])}catch(ue){Y||M(new Gi("IAgoraRTCClient.subscribe",ue)),console.error(ue)}Y||L(!1)},B=R.current||(R.current=fO());return!n[p]&&n[z]?B.run(()=>G(n,o)):g(n[p]),Zd([()=>{Y=!0,B.dispose()},Di(d,"user-published",(q,se)=>{q.uid===V&&se===o&&B.run(()=>G(q,o))}),Di(d,"user-unpublished",(q,se)=>{q.uid===V&&se===o&&B.run(()=>Q(q,o))})])},[C,d,n,o,p]),{track:_,isLoading:D,error:k}}function FG(n){let o=oa(n),[a,d]=J.useState(o?o.remoteUsers:[]);return J.useEffect(()=>{if(o){let p=()=>d(o.remoteUsers.slice());return Zd([Di(o,"user-joined",p),Di(o,"user-left",p),Di(o,"user-published",p),Di(o,"user-unpublished",p)])}},[o]),a}var Dme=$d(Qd());function Pme(n=!0,o,a,d){let p=Ba(d),[_,g]=J.useState(null),[C,R]=J.useState(!1),[D,L]=J.useState(null),k=Wl();return eu(async()=>{if(k.current||(R(!1),L(null)),p&&n&&!_){try{k.current||R(!0);let M=await Dme.default.createScreenVideoTrack(o,a);k.current||g(M)}catch(M){console.error(M),k.current||L(new Gi("IAgoraRTC.createScreenVideoTrack",M))}k.current||R(!1)}(!p||!n)&&!k.current&&g(null)},[p,n]),{screenTrack:_,isLoading:C,error:D}}function kme(){let n=new Map,o=1500;return{onMount:a=>{let d=n.get(a);d&&(d(),n.delete(a))},onUnmount:a=>{let d=n.get(a);d&&d(),n.set(a,Uv(()=>{a.isPlaying&&a.stop(),n.delete(a)},o))},dispose:()=>{for(let[a,d]of n)a.isPlaying&&a.stop(),d&&d();n.clear()}}}var mO=J.createContext(void 0);function Lme({children:n}){let[o]=J.useState(kme);return J.useEffect(()=>o.dispose,[o]),Z.jsx(mO.Provider,{value:o,children:n})}function _O(n,o,a,d){let p=J.useContext(mO);J.useEffect(()=>{if(n)return d&&o?n.play(d,a||void 0):n.stop(),p?(p.onMount(n),()=>p.onUnmount(n)):()=>{n.isPlaying&&n.stop()}},[n,d,o,p,a])}function EO(n,o){let a=J.useContext(mO);Vv(()=>{if(n)return o?n.play():n.stop(),a?(a.onMount(n),()=>a.onUnmount(n)):()=>{n.isPlaying&&n.stop()}},[n,o,a])}function jG({track:n,play:o=!1,volume:a,disabled:d,muted:p,children:_}){let g=DG(n);return EO(g,o),J.useEffect(()=>{g&&a!=null&&g.setVolume(a)},[g,a]),J.useEffect(()=>{g&&d!=null&&g.setEnabled(!d).catch(console.warn)},[d,g]),J.useEffect(()=>{g&&p!=null&&g.setMuted(p).catch(console.warn)},[p,g]),_?Z.jsx(Z.Fragment,{children:_}):null}var BG={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},WG={width:"100%",height:"100%"},gO={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},Fv=(n,o)=>J.useMemo(()=>({...n,...o}),[n,o]);function GG({track:n,play:o,disabled:a,muted:d,style:p,videoPlayerConfig:_,...g}){let C=Fv(WG,p),[R,D]=J.useState(null),L=DG(n);return _O(L,o,_,R),J.useEffect(()=>{L&&a!=null&&L.setEnabled(!a).catch(console.warn)},[a,L]),J.useEffect(()=>{L&&d!=null&&L.setMuted(d).catch(console.warn)},[d,L]),Z.jsx("div",{...g,ref:D,style:C})}var Mme={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},xme={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function HG({cover:n}){return Z.jsx("div",{style:gO,children:typeof n=="string"?Z.jsxs(Z.Fragment,{children:[Z.jsx("div",{style:{...Mme,backgroundImage:`url(${n})`}}),Z.jsx("img",{src:n,style:xme})]}):n()})}function KG({micOn:n,cameraOn:o,audioTrack:a,videoTrack:d,playAudio:p,playVideo:_,volume:g,cover:C,children:R,style:D,...L}){let k=Fv(BG,D);return _=_??!!o,p=p??!!n,Z.jsxs("div",{...L,style:k,children:[Z.jsx(GG,{disabled:!o,play:_,track:d}),Z.jsx(jG,{disabled:!n,play:p,track:a,volume:g}),C&&!o&&Z.jsx(HG,{cover:C}),Z.jsx("div",{style:gO,children:R})]})}function zG({track:n,play:o=!1,playbackDeviceId:a,volume:d,children:p}){return EO(n,o),J.useEffect(()=>{n&&a!=null&&n.setPlaybackDevice(a).catch(console.warn)},[n,a]),J.useEffect(()=>{n&&d!=null&&n.setVolume(d)},[n,d]),p?Z.jsx(Z.Fragment,{children:p}):null}function qG({track:n,play:o,style:a,videoPlayerConfig:d,...p}){let _=Fv(WG,a),[g,C]=J.useState(null);return _O(n,o,d,g),Z.jsx("div",{...p,ref:C,style:_})}function YG({user:n,playVideo:o,playAudio:a,playbackDeviceId:d,volume:p,cover:_,style:g,children:C,videoPlayerConfig:R,...D}){let L=Fv(BG,g),{track:k}=Lb(n,"video"),{track:M}=Lb(n,"audio");return o=o??(n==null?void 0:n.hasVideo),a=a??(n==null?void 0:n.hasAudio),Z.jsxs("div",{...D,style:L,children:[Z.jsx(qG,{play:o,track:k,videoPlayerConfig:R}),Z.jsx(zG,{play:a,playbackDeviceId:d,track:M,volume:p}),_&&!o&&Z.jsx(HG,{cover:_}),Z.jsx("div",{style:gO,children:C})]})}var Ume=$d(Qd()),Vme=class{constructor(){Hf(this,"appType",1001);Ume.default.setAppType(this.appType)}};new Vme;var Fme="2.2.0";dme(NG,$d(Qd()));var JG=ume.default;const jme=()=>{console.log=function(){},console.info=function(){},console.warn=function(){},console.error=function(){},console.debug=function(){}},XG=({appId:n,channel:o,token:a})=>{const[d,p]=J.useState(!0),[_,g]=J.useState(!0),[C,R]=J.useState(!0);J.useState({}),J.useEffect(()=>(jme(),()=>{}),[]),Ba(),MG({appid:n,channel:o,token:a||null},d);const{localMicrophoneTrack:D}=UG(_,{audioOptions:{echoCancellation:!0}}),{localCameraTrack:L}=VG(C);xG([D,L]);const k=FG();return Z.jsx(Z.Fragment,{children:Z.jsx(Po,{className:"room",children:Z.jsxs(Po,{className:"user-list",children:[Z.jsx(Po,{height:"180px",className:"local-user-container",sx:{borderRadius:"8px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",backgroundColor:"#fff",padding:"8px",width:"100%",position:"relative"},children:Z.jsxs(KG,{style:{height:"100%",minHeight:"100%"},audioTrack:D,cameraOn:C,micOn:_,videoTrack:L,cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",children:[Z.jsx("samp",{className:"user-name",children:"You"}),Z.jsxs("div",{className:"local-controls",children:[Z.jsx("button",{onClick:()=>g(M=>!M),children:_?"Mute":"Unmute"}),Z.jsx("button",{onClick:()=>R(M=>!M),children:C?"Disable Video":"Enable Video"})]})]})}),k.map(M=>Z.jsx(Po,{className:"remote-user-container",sx:{borderRadius:"8px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",backgroundColor:"#fff",padding:"8px",width:"100%",height:"180px",position:"relative"},children:Z.jsx(YG,{style:{height:"100%",minHeight:"100%"},cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",user:M,children:Z.jsx("samp",{className:"user-name",children:M.uid})})},M.uid))]})})})},Bme="0f81aa4f413b4daa829eaa46323cfea4",Wme=()=>{const n=MA(),[o,a]=J.useState([]),d=Dv(),p=J.useContext(ia),_=fn(M=>M.user.id),g=fn(M=>M.user.room);fn(M=>M.gameCondition.currentlyDrawing);const C=fn(M=>M.gameCondition.roomOwner),R=fn(M=>M.gameCondition.showResults),D=fn(M=>M.gameCondition.isGameStarted),[L,k]=J.useState(!1);return J.useEffect(()=>{p.on("error",()=>{Fd.error("Unexpected error occured"),n("/")}),p.on("update-game-conditions",M=>{d(Ife(M.wordChosen)),d(Afe(M.currentlyDrawing)),d(bfe(M.currentRound)),d(yG(M.totalRounds)),d(Nfe(M.totalDrawTime)),d(Ofe(M.currentWordLength)),d(kb(M.roomOwner)),d(vG(M.isGameStarted)),d(Dfe(M.showWaitingScreen)),d(i5(M.showingResults))}),p.on("game-over",M=>{d(i5(!0)),a(M)})},[]),J.useEffect(()=>{!C||C!=_?k(!1):k(!0)},[C]),Z.jsxs(Po,{className:"background",gap:1,alignItems:"center",children:[Z.jsx(tme,{}),Z.jsxs(Po,{direction:"row",justifyContent:"space-between",sx:{width:"95%"},gap:.5,children:[Z.jsx(qfe,{}),R&&Z.jsx(rme,{users:o}),Z.jsx("div",{children:!R&&(D?Z.jsx(eme,{}):Z.jsx(IG,{allowChange:L}))}),Z.jsx(Kfe,{}),Z.jsx(Po,{id:"video-call-users",sx:{maxWidth:"250px",width:"50%"},children:Z.jsx(XG,{appId:Bme,channel:g,token:""})})]})]})},Gme=$se([{path:"/",element:Z.jsx(HW,{}),children:[{path:"/",element:Z.jsx(Gfe,{})},{path:"create-game",element:Z.jsx(Wme,{}),children:[{path:"/create-game",element:Z.jsx(IG,{})},{path:"*",element:Z.jsx("div",{children:"404"})}]},{path:"/vc",element:Z.jsx(XG,{})},{path:"*",element:Z.jsx("div",{children:"404"})}]},{path:"*",element:Z.jsx("div",{children:"404"})}]),Hme=sfe({reducer:{user:Lfe,gameCondition:Pfe}}),Kme=JG.createClient({mode:"rtc",codec:"vp8"});gI.createRoot(document.getElementById("root")).render(Z.jsx(kG,{client:Kme,children:Z.jsx(Cpe,{children:Z.jsx(Che,{store:Hme,children:Z.jsx(sae,{router:Gme,children:Z.jsx(HW,{})})})})}));
